(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{"5Yfa":function(e,t,s){"use strict";s.d(t,"a",(function(){return i})),s.d(t,"b",(function(){return n})),s.d(t,"c",(function(){return o})),s.d(t,"e",(function(){return a})),s.d(t,"d",(function(){return r}));const i="bb-goal-selection-changed",n="bb-goal-alignment-saved",o="bb-goal-alignment-legacy-picker-saved";function a(e){return i+":"+e.getContentIdForGoalAlignment()}const r=({$scope:e,contents:t,goalCount:s})=>{0===e.goalAlignedContents.length&&(e.goalAlignedContents=t),e.alignedGoalsCount=s,e.alignedGoalsIsLoaded=!0}},GCTi:function(e,t,s){"use strict";s.d(t,"b",(function(){return n})),s.d(t,"d",(function(){return o})),s.d(t,"a",(function(){return a})),s.d(t,"c",(function(){return r}));var i=s("zGdY");function n(e,t){return e===i.e.OnSpecifiedDate&&t===i.e.AfterDueDate}function o(e,t){return e===i.e.OnSpecifiedDate&&t===i.e.AfterDueDate}function a(e,t){return e===i.e.AfterDueDate&&t===i.e.OnSpecifiedDate}function r(e,t){return o(e,t)||a(e,t)}},IHOP:function(e,t,s){"use strict";s.d(t,"a",(function(){return o})),s.d(t,"b",(function(){return a}));var i=s("yC9S");const n="delegated-grader-assigned";function o(e,t){return e.$emit(n,t.delegatedGraders)}function a(e,t){return i.b.OnScope(e,n,t)}},JuBR:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));var i=s("mrqE");function n(e){Object(i.a)(1,arguments);var t=Object.prototype.toString.call(e);return e instanceof Date||"object"==typeof e&&"[object Date]"===t?new Date(e.getTime()):"number"==typeof e||"[object Number]"===t?new Date(e):("string"!=typeof e&&"[object String]"!==t||"undefined"==typeof console||(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://git.io/fjule"),console.warn((new Error).stack)),new Date(NaN))}},Y0jG:function(e,t){e.exports='<bb-modal class="notification"\n          modal-title-key="course.content.assessment.test.settings.assessmentGrade.autoPostGrades.changeWarningModal.title"\n          modal-aria-type="alertdialog"\n          analytics-id-tag-prefix="course.content.assessment.settings.autoPostGrades.changeWarningModal">\n  <div name="modal-contents">\n    <p course-org-token-resolver bb-translate>course.content.assessment.test.settings.assessmentGrade.autoPostGrades.changeWarningModal.content</p>\n  </div>\n  <button\n    name="modal-footer-button-primary"\n    class="button confirm-ok js-primary-button"\n    ng-click="autoPostGradesChangeModal.confirmAction()"\n    analytics-id="confirmAction.button"\n    bb-translate>\n    course.content.assessment.test.settings.assessmentGrade.autoPostGrades.changeWarningModal.confirmButtonText\n  </button>\n  <button\n    name="modal-footer-button-secondary"\n    class="button button--secondary confirm-cancel js-secondary-button"\n    ng-click="autoPostGradesChangeModal.cancelAction()"\n    analytics-id="cancelAction.button"\n    bb-translate>\n    course.content.assessment.test.settings.assessmentGrade.autoPostGrades.changeWarningModal.cancelButtonText\n  </button>\n</bb-modal>\n'},gKdT:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function n(e){var t=void 0;return"undefined"!=typeof Reflect&&"function"==typeof Reflect.ownKeys?t=Reflect.ownKeys(e.prototype):(t=Object.getOwnPropertyNames(e.prototype),"function"==typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(e.prototype)))),t.forEach((function(t){if("constructor"!==t){var s=Object.getOwnPropertyDescriptor(e.prototype,t);"function"==typeof s.value&&Object.defineProperty(e.prototype,t,o(e,t,s))}})),e}function o(e,t,s){var n=s.value;if("function"!=typeof n)throw new Error("@autobind decorator can only be applied to methods not: "+(void 0===n?"undefined":i(n)));var o=!1;return{configurable:!0,get:function(){if(o||this===e.prototype||this.hasOwnProperty(t)||"function"!=typeof n)return n;var s=n.bind(this);return o=!0,Object.defineProperty(this,t,{configurable:!0,get:function(){return s},set:function(e){n=e,delete this[t]}}),o=!1,s},set:function(e){n=e}}}t.default=function(){return 1===arguments.length?n.apply(void 0,arguments):o.apply(void 0,arguments)}},hAzl:function(e,t,s){var i=s("ziER"),n=s("5JeM"),o=new i({id:"icon-medium-password",use:"icon-medium-password-usage",viewBox:"0 0 24 24",content:'<symbol fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="icon-medium-password"><path d="M3 8v5M1 12l4-3M1 9l4 3M1 16h4M12 8v5M10 12l4-3M10 9l4 3M10 16h4M21 8v5M19 12l4-3M19 9l4 3M19 16h4" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /></symbol>'});n.add(o);e.exports=o},iQEt:function(e,t,s){"use strict";var i=s("D57K"),n=s("Llzl"),o=s("wgY5"),a=s("aHpC"),r=s("IbyE"),d=s("Fvsw"),l=s("0JpG"),c=s("lEL+"),u=s("gZZS"),h=s("VdDF"),p=s("e6jQ"),g=s("nYkW");s.d(t,"c",(function(){return m})),s.d(t,"a",(function(){return b})),s.d(t,"b",(function(){return S}));const m="ultra.components.directives.content.dueDate",b="due-date",S="due-time";var D;!function(e){e.Overdue="overdue",e.TooSoon="tooSoon"}(D||(D={}));let y=class e{constructor(e,t,s,i,o,a,r){var d;this.$ngRedux=e,this.scope=t,this.form=s,this.element=i,this.bbLocalize=o,this.context=a,this.timeout=r,this.dueDateId="due-date-"+Object(p.a)(),this.container=this.dueDateId+"-container";const l=null!==(d=t.customDueDatePrefix)&&void 0!==d?d:"";this.dueDateFieldName=l+b,this.dueTimeFieldName=l+S,this.isMandatory=this.scope.isMandatory;const c=n.isFunction(this.scope.shouldDefaultDueDate);if(void 0===this.scope.model&&!1===c||!0===c&&this.scope.shouldDefaultDueDate()){const e=new Date(this.context.getServerTime().getTime());e.setDate(e.getDate()+1),this.scope.model=e}this.scope.skipBumpHalfHourOnSameDate()||this.registerTodayPlaceholderDate(),this.subscribeToReduxChanges();const u=this.bbLocalize.getAppLocaleISO();this.getLocaleSettings&&this.getLocaleSettings({locale:u}),this.scope.$watch((()=>this.scope.model&&this.scope.model.getTime()),((e,t)=>{this.dueDateField||(this.dueDateField=this.form[this.dueDateFieldName]),this.dueTimeField||(this.dueTimeField=this.form[this.dueTimeFieldName]),e&&(this.scope.onDateChangeValidation&&this.scope.onDateChangeValidation(),e!==t&&(this.dueDateField.$setDirty(),this.dueTimeField.$setDirty())),this.timeout((()=>{(this.scope.needsValidation&&this.scope.needsValidation()||!this.scope.needsValidation)&&this.checkDate(this.scope.model)}),this.scope,1e3,!0)})),this.onViewValueCleared=(e,t)=>{this.scope.model=t?null:this.scope.model}}static calculatePlaceholderDate(t){const s=e.TODAY_OFFSET-(t.minutes()+e.FUTURE_OFFSET)%e.TODAY_OFFSET+e.FUTURE_OFFSET;return t.add(s,"minutes").toDate()}get isDisabled(){return this.scope.disabled&&!this.scope.readOnly}get isReadOnly(){return this.scope.readOnly}get isDueDateValid(){var e;return null===(e=this.dueDateField)||void 0===e?void 0:e.$valid}get isTimeDueDateValid(){var e;return null===(e=this.dueTimeField)||void 0===e?void 0:e.$valid}getLabelToken(){return this.scope.alternateLabelToken?this.scope.alternateLabelToken:"components.directives.due-date.label"}shouldFocus(){return this.scope.shouldFocusOnDateField&&this.scope.shouldFocusOnDateField()}checkDate(t){var s,i;let n=!1,o=!1,a=!1,r=!1;if(t){const d=this.context.getServerTime(),l=t.getTime()-d.getTime(),c=l<0;o=c&&h.a.isSameDay(t,d),n=!o&&c,a=!c&&l<e.FUTURE_OFFSET_MS;const u=null===(i=(s=this.scope).getOriginalDueDate)||void 0===i?void 0:i.call(s);r=(null==u?void 0:u.getTime())===t.getTime()}return this.dueDateField.$setValidity(D.Overdue,r||!n),this.dueTimeField.$setValidity(D.Overdue,r||!o),this.dueTimeField.$setValidity(D.TooSoon,!a),this.scope.model}registerTodayPlaceholderDate(){this.timeout((()=>{this.element.find("#"+this.dueDateId).on("changeDate",(t=>{if(t.date){const s=new Date;h.a.isSameDay(t.date,s)&&(this.scope.model=e.calculatePlaceholderDate(o(s)))}}))}),this.scope,0,!0)}subscribeToReduxChanges(){const e=this.$ngRedux.connect((e=>({localeSettings:r.gc.locale.getLocaleSettings(e,this.bbLocalize.getAppLocaleISO())})),(e=>({getLocaleSettings:t=>e(r.X.locale.getLocaleSettings(t))})))(this);this.scope.$on("$destroy",e)}};y.FUTURE_OFFSET=5,y.FUTURE_OFFSET_MS=60*y.FUTURE_OFFSET*1e3,y.TODAY_OFFSET=30,y=Object(i.a)([Object(i.c)(0,Object(a.b)("$ngRedux")),Object(i.c)(1,Object(a.b)("scope")),Object(i.c)(2,Object(a.b)("form")),Object(i.c)(3,Object(a.b)("element")),Object(i.c)(4,Object(a.b)(l.serviceName)),Object(i.c)(5,Object(a.b)(d.b)),Object(i.c)(6,Object(a.b)(c.b))],y);class A{constructor(e){this.$injector=e,this.restrict="E",this.require="^form",this.template=g,this.transclude={customValidationMessages:"?bbDueDateCustomValidationMessages"},this.scope={disabled:"=?ngDisabled",model:"=",needsValidation:"&?",shouldFocusOnDateField:"&?",shouldDefaultDueDate:"&?",alternateLabelToken:"@",skipBumpHalfHourOnSameDate:"&",isDataLoadedExternal:"&?",onDateChangeValidation:"&?",isMandatory:"@?",analyticsIdTagPrefix:"@?",readOnly:"<?",customDueDatePrefix:"<?",getOriginalDueDate:"&?"},this.link=(e,t,s,i)=>{e.dueDate=this.$injector.instantiate(y,{scope:e,form:i,element:t})}}}A.$inject=["$injector"],n.module(m,[d.a,l.moduleName,u.a,c.a]).directive("bbDueDate",["$injector",e=>e.instantiate(A)])},iU4J:function(e,t,s){"use strict";var i=s("D57K"),n=(s("s5UK"),s("67oV"),s("1NX5"),s("dV61"),s("2MQt"),s("xoIb"),s("dcnw"),s("sZYy"),s("HApu"),s("hAzl"),s("4VOk"),s("nsO7")),o=s("Llzl"),a=s("JuBR"),r=s("mrqE");function d(e){Object(r.a)(1,arguments);var t=Object(a.a)(e);return t.setSeconds(0,0),t}var l,c=s("Sa5G"),u=s("ZQFV"),h=s("bd9L"),p=s("0JpG"),g=s("en1n"),m=s("nYZ0"),b=s("Fvsw"),S=s("NxQJ"),D=s("fYJU"),y=s("jhBu"),A=s("5Yfa"),v=s("2lxm"),R=s("X/qj"),E=s("lEL+"),f=s("gKdT"),P=s.n(f),C=s("VdDF"),I=s("oi1r"),O=s("P2dS"),T=s("YHe3"),_=s("pjml"),G=s("w/V/"),w=s("TnpK"),$=s("gkef"),L=s("5uPl"),F=s("k9iv"),k=s("IbyE"),M=s("zGdY"),N=s("MoIS"),x=s("aHpC"),j=s("3Nzc"),V=s("vdfi"),U=s("lmMM"),B=s("+O05"),z=s("GCTi"),K=s("iQEt"),Q=s("DU7P"),H=s("12mu"),q=s("IHOP"),Y=s("Y+9S");!function(e){e.AccessCode="accessCode",e.AnonymousGrading="anonymousGrading",e.Conversations="conversations",e.DueDateEnforced="isDueDateEnforced",e.EntitlementRestriction="entitlementRestriction",e.ExternalSubmissions="externalSubmissions",e.Groups="groups",e.HasResponses="hasResponses",e.LateAttemptCreationDisallowed="isLateAttemptCreationDisallowed",e.MultipleAttempts="multipleAttempts",e.NoAnswerableQuestions="noAnswerableQuestions",e.NoPageBreaks="noPageBreaks",e.NotDueDate="notDueDate",e.OriginalityReport="originalityReport",e.PeerGrading="peerGrading",e.PresentationOnlyQuestions="presentationOnlyQuestions",e.SecurityFeatures="testSecurity",e.None="None"}(l||(l={}));class W{static hasDisabledReason(e){return e!==l.None}static hasAnyDisabledReason(...e){return e.some((e=>this.hasDisabledReason(e)))}}W.Reason=l;var Z=s("AuQm"),J=s("ohO4"),X=s("Y0jG");s.d(t,"c",(function(){return ee})),s.d(t,"a",(function(){return se})),s.d(t,"b",(function(){return oe}));const ee="ultra.features.course.content.assessment.settings.assessmentSettings.controller",te="assessment-settings",se="bb-assessment-settings-auto-post-grades-updated",ie="course.content.assessment.test.settings.testResults.restriction.entitlementRestriction",ne=[M.ac.Tabular,M.ac.Score,M.ac.Percent];let oe=class e{constructor(t,s,i,n,o,a,r,d,l,p,b,S,D,y,v,R,E,f,P,C,I,O,T,w,$,L,F,k,N){var x,j;this.$injector=t,this.$log=s,this.$q=i,this.$rootScope=n,this.$scope=o,this.$ngRedux=a,this.course=r,this.bbLocalize=d,this.contentSvc=l,this.schemaService=p,this.categoryService=b,this.ultraState=S,this.windowSize=D,this.context=v,this.entitlement=R,this.gradableItemUserOptionService=E,this.gradebookPermissionService=f,this.contextUser=P,this.timeout=C,this.assessment=I,this.localize=O,this.originalityReportService=T,this.CourseModel=w,this.ContentModel=$,this.proctoring=L,this.errorModal=F,this.flagService=k,this.$modal=N,this.assessmentResultOptions=[{option:M.f.UserAnswers,icon:"visible",modeLabel:"",optionLabel:""},{option:M.f.InstructorFeedback,icon:"feedback",modeLabel:"",optionLabel:""},{option:M.f.Score,icon:"grade",modeLabel:"",optionLabel:""},{option:M.f.CorrectAnswers,icon:"check-circle",modeLabel:"",optionLabel:""}],this.analyticsContext=!1,this.alignedGoalsCount=0,this.canCreateRubrics=!1,this.categoryOptions=[],this.unsavedSafeAssignSettings=void 0,this.gradebookCategoryTitle="",this.goalAlignedContents=[],this.isMobile=!1,this.isAllowTimeLimit=!1,this.shouldFocusPeerReviewDueDate=!1,this.subpanelId="",this.showSafeAssignSettings=!1,this.isRespondusAvailable=!1,this.isIMSProctoringAvailable=!1,this.isRubricMaxPointsUpdated=!1,this.rubricMaxPoints=void 0,this.maxTimeLimit=e.DEFAULT_MAX_TIME_LIMIT,this.accessCodeRestrictionKey=ie,this.testResultsRestrictionKey="",this.hasDueDateExceptions=!1,this.showHasDueDateExceptionsAlert=!1,this.startDate=null,this.endDate=null,this.confirmedToClose=!1,this.previousDueDate=null,this.isOriginalDueDateUpdated=!1,this.originalDueDate=null,this.peerReviewDueDateObject=null,this.multipleAttemptsAndGroupsFeatureFlag=!1,this.onRandomizePagesChanged=e=>{this.$scope.$apply((()=>{var t;(null===(t=this.deployedAssessment)||void 0===t?void 0:t.deploymentSettings)&&(this.deployedAssessment.deploymentSettings.isRandomizationOfPagesRequired=e,e||(this.shouldKeepFirstPageFirst=!1))}))},this.onKeepFirstPageFirstChanged=e=>{this.$scope.$apply((()=>{var t;(null===(t=this.deployedAssessment)||void 0===t?void 0:t.deploymentSettings)&&(this.deployedAssessment.deploymentSettings.isKeepFirstPageFirstRequired=e)}))},this.onDisplayOneQuestionAtATimeChanged=e=>{this.$scope.$apply((()=>{var t;(null===(t=this.deployedAssessment)||void 0===t?void 0:t.deploymentSettings)&&(this.deployedAssessment.deploymentSettings.deliveryType=e?M.c.Item:M.c.Assessment,!e&&this.shouldProhibitBacktracking&&(this.shouldProhibitBacktracking=!1),e&&(this.shouldRandomizePages=!1,this.shouldKeepFirstPageFirst=!1))}))},this.onRandomizeQuestionsChanged=e=>{this.$scope.$apply((()=>{var t;(null===(t=this.deployedAssessment)||void 0===t?void 0:t.deploymentSettings)&&(this.deployedAssessment.deploymentSettings.isRandomizationOfQuestionsRequired=e)}))},this.isShowingSubpanel=()=>!!this.subpanelId,this.isShowingNewSubpanel=()=>this.isFeedbackSubpanelShowing||this.isImsProctoringSubpanelShowing,this.hideSubpanel=()=>{this.subpanelId="",this.scrollPanelToTop(),this.timeout((()=>{this.subpanelId=""}),this.$scope)},this.showSubpanel=e=>{this.subpanelId=e,this.scrollPanelToTop()},this.scrollPanelToTop=()=>{const e=g.k()?"assessment-settings-panel-content":"assessment-settings-panel-wrap";document.getElementById(e).scrollTop=0},this.onAccessCodeSettingsConfirm=(e,t)=>{this.accessCode=e.accessCode,e.accessCodeEnabled?(this.accessCodeEnabled=e.accessCodeEnabled,this.hideSubpanel()):this.showRemoveAccessCodeModal()},this.showRemoveAccessCodeModal=()=>{this.$scope.$broadcast(U.a,"remove-access-code-from-assessment")},this.confirmAccessCodeRemovalModal=()=>{this.accessCodeEnabled=!1,this.accessCode=this.pristineDeployedAssessment.deploymentSettings.password,this.hideSubpanel()},this.toggleSafeAssign=()=>{var e;this.unsavedSafeAssignSettings.checkAttempts=!(null===(e=this.unsavedSafeAssignSettings)||void 0===e?void 0:e.checkAttempts),this.clearSafeAssignSetting()},this.toggleSafeAssign$apply=()=>{this.$scope.$applyAsync((()=>this.toggleSafeAssign()))},this.toggleIntegrationOriginality=()=>{this.isOriginalityIntegrationEnabled=!this.isOriginalityIntegrationEnabled},this.toggleIntegrationOriginality$apply=()=>{this.$scope.$applyAsync((()=>this.toggleIntegrationOriginality()))},this.onSaveOriginalityReportSettings=()=>(this.originalitySubmissionService.capabilities.OriginalityReport.enabled=this.isOriginalityIntegrationEnabled,this.originalityReportService.setCourseContent(this.content,!0),this.originalitySettingsSaving=!0,this.originalityReportService.saveOriginalityConfiguration(this.originalitySubmissionService).then((e=>{this.originalitySettingsSaving=!1,e.success?(this.setOriginalityReportProvider(),this.$scope.$root.$broadcast("originality-updated",this.originalitySubmissionService),this.originalitySettingsError=void 0,this.hideSubpanel()):this.originalitySettingsError=e.error}))),this.hasACLCriteria=()=>!!this.aclCriteria,o.assessmentSettings=this,this.stateParams=S.params,(null===(x=this.stateParams)||void 0===x?void 0:x.subpanelId)&&(this.subpanelId=null===(j=this.stateParams)||void 0===j?void 0:j.subpanelId),this.focusEleId=this.stateParams.focusEleId,this.isMobile=window.Modernizr.touch&&!this.windowSize.isLargeBreakpoint(),this.alignedGoalsCount=y.alignedGoalsCount,this.canModifyGradebookContent=this.isEditable()&&this.gradebookPermissionService.canModify(),this.canViewGradebookContent=this.gradebookPermissionService.canView(),this.canViewGroupsAsAdmin=this.entitlement.isEntitled(c.o.ViewGroupsAsAdmin),this.canModifySettings=this.entitlement.isEntitled(c.j.ModifyAssessment),this.canCreateRubrics=this.entitlement.isEntitled(c.l.CreateRubrics),this.schemaService.loadSchemas(this.course.id,ne).then((e=>{if(this.schemas=e,this.schemas.forEach((e=>{e.localizableTitle&&(e.ui.displayTitle=this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:e.ui.displayTitleKey}))})),o.gradebookItem){const e=o.$watch("gradebookItem.content",(t=>{t&&(this.content=t,this.setupContent(),this.showPeerSettingsPanelOnStart(),e())}))}else{const e=l.findRootNode(r,_.p.ContentRootNode.ROOT);l.getContentInContentTree(e,this.stateParams.courseId,this.stateParams.contentId).then((e=>{this.content=e.content,this.setupContent(),this.showPeerSettingsPanelOnStart()}))}})),this.canViewGradebookContent&&this.loadCategories(),this.subscribeToReduxStore(),this.getLocaleSettings({locale:this.bbLocalize.getAppLocaleISO()}),this.setColorClass(),this.checkProctoringServicesAvailability(),this.registerSaveAndCloseListener(),this.registerRestoreFromBrowserListener(),this.registerStateChangeListener(),this.registerDelegatedGradersSettingsUpdateListener(),this.registerProctoringServiceWatchers(),this.$scope.$on("event-error-settings-fields-conflict",(()=>{this.$scope.$broadcast(h.b),this.confirmToClose()})),this.$scope.$on("open-rubric-list-panel",(()=>{this.subpanelId=e.RUBRICS_SUBPANEL_ID})),this.$scope.$on(G.a,((e,t,s)=>{if(!this.isRubricMaxPointsUpdated)return;this.isRubricMaxPointsUpdated=!1;const i=this.content.$getPreviousVersion();i.contentDetail[i.contentHandler.toString()].test.gradingColumn.possible=this.rubricMaxPoints,this.maxPointsInput=u.P.parseGradeValue(this.rubricMaxPoints),this.deployedAssessment.gradingColumn.possible=this.rubricMaxPoints})),this.$scope.$on(m.a,((e,t)=>{this.content&&this.content.$getPreviousVersion()&&(this.content.$getPreviousVersion().assignedGroups=t.assignedGroups,this.content.$getPreviousVersion().isGroupContent=t.isGroupContent)})),this.$scope.$on("date-selection-changed",((e,t,s)=>{this.dateSelection={start:t,end:s}})),this.$scope.$on("$destroy",(()=>{this.unsubscribeFromReduxStore&&this.unsubscribeFromReduxStore()})),this.$scope.$on(A.b,(()=>{y.resolveGoalAlignableContents(this.course,this.content,{id:this.deployedAssessment.gradingColumn.id}).then((([e,t])=>{this.goalAlignedContents=e,this.alignedGoalsCount=t}))})),r.gradebook.settings.$resolve().$then((e=>{this.isPastDueSettingTurnOn=e.countUnsubmittedWorkAsZero||!1})),this.gradableItemUserOptionService.getGradableItemUserOptionCount(this.course.id,this.$scope.gradebookItem.column.id).then((e=>{this.hasDueDateExceptions=e.results.withDueDateExceptionCount>0})),this.setMultipleAttemptGroupsFeatureFlag()}checkProctoringServicesAvailability(){return this.proctoring.fetchProctoringServices().then((e=>{this.isRespondusAvailable=e.some((e=>e.handle===Q.b)),this.isIMSProctoringAvailable=e.some((e=>e.handle!==Q.b))}))}setProctoringService(e){return this.proctoring.getProctoringServiceByHandle(e).then((e=>{this.proctoringService=e}))}showPeerSettingsPanelOnStart(){this.contentPromise&&this.contentPromise.then((()=>{"enable-peer-grading"===this.focusEleId&&this.peerGrading&&(this.subpanelId=e.PEER_SETTINGS_SUBPANEL_ID)}))}initAssessmentResultOptions(e,t){var s;const i=null!=e?e:null===(s=this.deployedAssessment)||void 0===s?void 0:s.deploymentSettings.feedbackSettings;t&&(this.analyticsContext=!0),this.assessment.getFeedbackModeLabels(B.d,i).then((e=>{this.assessmentResultOptions=B.d.map(((t,s)=>{const i=this.bbLocalize.getLocale(this.$scope),n=this.bbLocalize.translateSync({key:`${B.f}.${t}`,locale:i});let o=B.e[t].visible,a=e[s];return null===a&&(o=B.e[t].invisible,a=this.assessment.isUserAnswersOption(t)?this.bbLocalize.translateSync({key:"course.content.assessment.test.settings.testResults.feedbackMode.submissionHidden",locale:i}):this.bbLocalize.translateSync({key:"course.content.assessment.test.settings.testResults.feedbackMode.enableMode",locale:i})),{option:t,icon:o,modeLabel:a,optionLabel:n}}))}))}registerProctoringServiceWatchers(){this.$scope.$watch((()=>{var e;return null===(e=this.deployedAssessment)||void 0===e?void 0:e.deploymentSettings.proctoringServiceHandle}),((e,t)=>{t!==e&&this.setProctoringService(e)})),this.$scope.$watchCollection((()=>{var e;return null===(e=this.content)||void 0===e?void 0:e.getDeployedAssessment().deploymentSettings}),((e,t)=>{n.isEqual(e,t)||(this.deployedAssessment.deploymentSettings.proctoringServiceHandle=e.proctoringServiceHandle,this.deployedAssessment.deploymentSettings.proctoringServiceVendor=e.proctoringServiceVendor,this.deployedAssessment.deploymentSettings.proctoringDownloadUrl=e.proctoringDownloadUrl,this.deployedAssessment.deploymentSettings.isSecureBrowserRequiredToTake=e.isSecureBrowserRequiredToTake,this.deployedAssessment.deploymentSettings.isSecureBrowserRequiredToReview=e.isSecureBrowserRequiredToReview,this.deployedAssessment.deploymentSettings.isWebcamRequired=e.isWebcamRequired)}))}registerDelegatedGradersSettingsUpdateListener(){Object(q.b)(this.$rootScope,this.updateWithNewDelegatedGraders.bind(this))}updateWithNewDelegatedGraders(e,t){this.deployedAssessment.gradingColumn.delegatedGraders=t}shouldFocus(e){return this.focusEleId===e}subscribeToReduxStore(){this.unsubscribeFromReduxStore=this.$ngRedux.connect((e=>{var t;const s=this.stateParams?this.stateParams.contentId:null,i=k.gc.gradebookColumn.getGradebookColumnByContentId(e,s),o=n.cloneDeep(i),a=k.gc.locale.getLocaleSettings(e,this.bbLocalize.getAppLocaleISO()),r=this.getMultipleAttemptGroupsFeatureFlagValue(e),d=null===(t=this.deployedAssessment)||void 0===t?void 0:t.assessment.id;return{localeSettings:a,reduxColumn:o,multipleAttemptsAndGroupsFeatureFlag:r,pageBreaks:d?k.gc.question.getPageBreakQuestionsByAssessmentId(e,d):[]}}),(e=>({getLocaleSettings:t=>e(k.X.locale.getLocaleSettings(t))})))(this)}registerSaveAndCloseListener(){this.$scope.$on("bb-autosave-form",((e,t)=>{Z.d.Saved===t&&(this.$scope.$root.$broadcast("content-column",this.pristineDeployedAssessment.gradingColumn,!0),this.ultraState.leavePeekState(this.ultraState.current.name))}))}registerRestoreFromBrowserListener(){this.$scope.$on("bb-autosave-browser-restore-data",((t,s)=>{this.contentPromise.then((()=>{const t=s.assessmentSettings.content?s.assessmentSettings.content.adaptiveReleaseRules:null;t&&(t.startDate=t.startDate&&C.a.parseStringToDate(t.startDate.toString()),t.endDate=t.endDate&&C.a.parseStringToDate(t.endDate.toString())),n.assign(this.content,n.omit(s.assessmentSettings.content,e.ADDITIONAL_CONTENT_FIELDS))}))}))}registerStateChangeListener(){this.stateChangeListener=this.$scope.$on("$stateChangeStart",((e,t)=>{if(t.name.indexOf(te)<0){if(!this.confirmedToClose&&(this.contentSettingsChanged()||!o.equals(this.dateSelection,this.originalDateSelection)))return e.preventDefault(),void this.$scope.$broadcast(U.a,te);this.content.ui.hasConversationAttached=void 0,this.content.$revert(),this.$scope.$broadcast(h.b)}}))}contentSettingsChanged(){const e=!o.equals(this.deployedAssessment,this.pristineDeployedAssessment);return!o.equals(this.content.$wrap("U"),this.content.$getPreviousVersion())||e}shouldShowExceptionsErrorMessage(){return!Object.keys(this.$scope.assessmentSettingsForm.$error).length&&this.isDueDateExceptionRemovalNeeded()}isDueDateExceptionRemovalNeeded(){return this.hasDueDateExceptions&&!this.dueDate}validate(){const e=this.isDueDateValid(),t=this.isPossiblePointsValid(),s=this.isDueDateExceptionRemovalNeeded();return e&&t&&!s}castAssessmentFormItem(e){return this.$scope.assessmentSettingsForm[e]}persist(){this.content.ui.hasConversationAttached=this.content.allowConversations,this._conversationService.markAllConversationsForRemoval();const e=this.castAssessmentFormItem(K.b).$dirty||this.castAssessmentFormItem(K.a).$dirty,t=this.castAssessmentFormItem("grade-using").$dirty,s=this.castAssessmentFormItem("max-points").$dirty,i=this.castAssessmentFormItem("grade-category").$dirty,n=this.castAssessmentFormItem("auto-post-grades").$dirty;return this.content.$patch().$then((()=>{this.canModifyGradebookContent&&this.$scope.$broadcast(G.c),this._conversationService.checkAndAddAllConversations(),(e||t||i)&&(this.$scope.$root.$broadcast("attempt-base-content-update",this.content),this.$scope.gradebookItem&&(t&&(this.$scope.gradebookItem.column.gradingSchemaId=this.schema.id,this.$scope.$root.$broadcast("bb-grid-refresh-columns",[this.$scope.gradebookItem.column.id])),e?this.$scope.gradebookItem.column.dueDate=this.dueDate:this.$scope.$root.$broadcast(m.a,this.content),i&&(this.$scope.$root.$broadcast("bb-update-category-icon",this.pristineDeployedAssessment.gradingColumn,this.pristineDeployedAssessment.gradingColumn.gradebookCategoryId),this.$scope.gradebookItem.column.gradebookCategory=this.pristineDeployedAssessment.gradingColumn.gradebookCategory))),s&&this.$scope.$root.$broadcast("bb-update-max-points",this.pristineDeployedAssessment.gradingColumn),n&&this.$scope.$root.$broadcast(se,this.autoPostGrades)})).$asPromise()}cancelClicked(){return this.ultraState.leavePeekState(this.ultraState.current.name)}saveClicked(){return this.shouldDisplayDueDateChangedDialog()?(this.$scope.$broadcast(N.a,"assessment.enforced"),this.$q.resolve()):this.shouldDisplayPastDueZero()?(this.$scope.$broadcast(N.a,this.pastDueStatus),this.$q.resolve()):this.checkDelegatedAssignment()&&this.checkPeerSettings()&&this.checkMaxPoints()?this.saveAction():this.$q.resolve()}getContext(){var e;return this.analyticsContext?null===(e=this.deployedAssessment)||void 0===e?void 0:e.deploymentSettings.feedbackSettings:""}isIMSProctoringServiceAdded(){const{proctoringServiceHandle:e}=this.pristineDeployedAssessment.deploymentSettings,{proctoringServiceHandle:t}=this.deployedAssessment.deploymentSettings;return!e&&!!t}isIMSProctoringServiceRemoved(){const{proctoringServiceHandle:e}=this.pristineDeployedAssessment.deploymentSettings,{proctoringServiceHandle:t}=this.deployedAssessment.deploymentSettings;return!!e&&!t}isIMSProctoringServiceChanged(){const{proctoringServiceHandle:e}=this.pristineDeployedAssessment.deploymentSettings,{proctoringServiceHandle:t}=this.deployedAssessment.deploymentSettings;return!!e&&!!t&&e!==t}clearProctoringService(){return this.content.patchProctoringService("")}promptIntegrationToSave(e,t){const s=this.content.id,i=this.course.uuid;return this.proctoring.promptIntegrationToSave(e,i,s,t).then((e=>{if(!e.success)return this.$q.reject(e.error)}),(t=>{this.$log.error(`Error calling out to the proctoring tool provider (handle: ${e}) to save assessment proctoring settings.`,t)}))}saveProctoringServiceSettings(){const{proctoringServiceHandle:e}=this.pristineDeployedAssessment.deploymentSettings,{proctoringServiceHandle:t}=this.deployedAssessment.deploymentSettings;return this.isIMSProctoringServiceChanged()?this.promptIntegrationToSave(e,!1).then((()=>this.clearProctoringService())).then((()=>this.promptIntegrationToSave(t,!0))).catch((e=>this.$q.reject(e))):this.isIMSProctoringServiceRemoved()?this.promptIntegrationToSave(e,!1):this.promptIntegrationToSave(t,!0)}assignAssessmentChangesAndSaveToServer(){Object.assign(this.pristineDeployedAssessment,this.deployedAssessment),this.$scope.$broadcast(h.f)}shouldShowPossiblePointsMessage(){return n.isFinite(this.rubricMaxPoints)&&parseFloat(this.maxPointsInput)===this.rubricMaxPoints}checkMaxPoints(){var e;return this.pristineDeployedAssessment.gradingColumn.possible===this.deployedAssessment.gradingColumn.possible||!(null===(e=this.$scope.gradebookItem)||void 0===e?void 0:e.column.hasRubricAssociation())||(this.$scope.$broadcast(U.a,"max-points-updated-having-associated-rubric"),!1)}restoreMaxPoints(){this.maxPointsInput=u.P.parseGradeValue(this.pristineDeployedAssessment.gradingColumn.possible),this.deployedAssessment.gradingColumn.possible=this.pristineDeployedAssessment.gradingColumn.possible}saveAction(){if(!this.validate())return this.$q.reject();this.stateChangeListener(),null==this.deployedAssessment.gradingColumn.possible&&(this.deployedAssessment.gradingColumn.possible=u.P.GRADE_DEFAULT_POINTS);const e=[];if(this.deployedAssessment.gradingColumn.peerGrading&&e.push(this.fetchPotentialGraders()),this.isIMSProctoringServiceAdded()||this.isIMSProctoringServiceChanged()||this.isIMSProctoringServiceRemoved()){const t=this.saveProctoringServiceSettings().catch((()=>{const e=this.localize.translateSync({key:"course.content.assessment.test.modal.proctoringSaveError.body",locale:this.localize.getLocale(this.$scope)});return this.errorModal.handleError(e),this.$q.reject()}));e.push(t)}return this.$q.all(e).then((()=>{this.assignAssessmentChangesAndSaveToServer()}))}editCurrentDelegatedGraders(e){const t=this.delegatedGraders.reduce(((e,{userId:t},s)=>e.set(t,s)),new Map);e.forEach((e=>{var s;const i=null===(s=null==e?void 0:e.user)||void 0===s?void 0:s.id,n={userId:i,canReconcile:!0,isUnassigned:!1};t.has(i)?this.delegatedGraders[t.get(i)]=n:this.delegatedGraders.push(n)}))}fetchPotentialGraders(){return this.course.memberships.$refresh({filter:k.m.PotentialGraders,expand:k.l.DefaultReconciler}).$asPromise().then((e=>this.editCurrentDelegatedGraders(e)))}get deployedAssessment(){return this.unsavedDeployedAssessment?this.unsavedDeployedAssessment:this.pristineDeployedAssessment}get pristineDeployedAssessment(){var e;return null===(e=this.content)||void 0===e?void 0:e.getDeployedAssessment()}get column(){return this.deployedAssessment&&this.deployedAssessment.gradingColumn}get schema(){if(this.schemas&&this.deployedAssessment&&this.deployedAssessment.gradingColumn)return n.find(this.schemas,(e=>e.id===this.deployedAssessment.gradingColumn.gradingSchemaId))}set schema(e){this.deployedAssessment.gradingColumn.gradingSchemaId=e.id}set description(e){(e||""===e)&&(this.content.description=e)}get description(){if(this.content&&(this.content.description||""===this.content.description))return this.content.description}set dueDate(e){this.deployedAssessment&&(this.deployedAssessment.gradingColumn.dueDate=C.a.parseDateToISOString(e)||null,this.isDueDateValid()),e?this.canModifySettings||(this.isDueDateEnforced=this.pristineDeployedAssessment.deploymentSettings.isDueDateEnforced,this.isLateAttemptCreationDisallowed=this.pristineDeployedAssessment.deploymentSettings.isLateAttemptCreationDisallowed):this.isDueDateEnforced=!1}get dueDate(){if(this.deployedAssessment&&this.deployedAssessment.gradingColumn){const e=C.a.parseStringToDate(this.deployedAssessment.gradingColumn.dueDate);return this.originalDueDate||this.isOriginalDueDateUpdated||(this.originalDueDate=e,this.isOriginalDueDateUpdated=!0),(this.previousDueDate&&this.previousDueDate.getTime())===(e&&e.getTime())?this.previousDueDate:this.previousDueDate=e}}set peerReviewDueDate(e){this.deployedAssessment&&this.deployedAssessment.peerSettings&&(this.deployedAssessment.peerSettings.peerReviewDueDate=C.a.parseDateToISOString(e))}get peerReviewDueDate(){if(this.deployedAssessment&&this.deployedAssessment.peerSettings)return null==this.peerReviewDueDateObject&&(this.peerReviewDueDateObject=C.a.parseStringToDate(this.deployedAssessment.peerSettings.peerReviewDueDate)),C.a.parseDateToISOString(this.peerReviewDueDateObject)!==this.deployedAssessment.peerSettings.peerReviewDueDate&&(this.peerReviewDueDateObject=C.a.parseStringToDate(this.deployedAssessment.peerSettings.peerReviewDueDate)),this.peerReviewDueDateObject}updateMaxPoints(){const e=parseFloat(this.maxPointsInput);this.deployedAssessment.gradingColumn.possible=Number.isNaN(e)?null:e,this.isPossiblePointsValid()}get gradingColumnMaxPoints(){return this.deployedAssessment&&this.deployedAssessment.gradingColumn.possible}get maxPointsDecimals(){return u.P.GRADE_POINTS_DECIMALS_RULE_1}get maxPossiblePoints(){return u.P.GRADE_MAX_POINTS}get minPossiblePoints(){return u.P.GRADE_MIN_POINTS}set anonymousGrading(e){this.deployedAssessment&&(this.deployedAssessment.gradingColumn.anonymousGrading=e)}get anonymousGrading(){return this.deployedAssessment&&this.deployedAssessment.gradingColumn.anonymousGrading}set isDueDateEnforced(e){this.deployedAssessment&&(this.deployedAssessment.deploymentSettings.isDueDateEnforced=e,this.deployedAssessment.deploymentSettings.isLateAttemptCreationDisallowed=e,e&&(this.deployedAssessment.gradingColumn.peerGrading=!1,this.delegatedGrading=!1,this.deployedAssessment.deploymentSettings.isCollectExternalSubmissions=!1),this.shouldShowEnforceDueDateBanner=e&&this.hasTimeLimit()&&(!this.isAutoSubmissionTimeLimit()||this.isUnlimitedTime()))}get isDueDateEnforced(){var e,t;return null!==(t=null===(e=this.deployedAssessment)||void 0===e?void 0:e.deploymentSettings.isDueDateEnforced)&&void 0!==t&&t}set isLateAttemptCreationDisallowed(e){this.deployedAssessment&&(this.deployedAssessment.deploymentSettings.isLateAttemptCreationDisallowed=e)}get isLateAttemptCreationDisallowed(){var e,t;return null!==(t=null===(e=this.deployedAssessment)||void 0===e?void 0:e.deploymentSettings.isLateAttemptCreationDisallowed)&&void 0!==t&&t}set delegatedGrading(e){this.deployedAssessment&&(this.deployedAssessment.gradingColumn.delegatedGrading=e)}get delegatedGrading(){return this.deployedAssessment&&this.deployedAssessment.gradingColumn&&this.deployedAssessment.gradingColumn.delegatedGrading&&!this.deployedAssessment.gradingColumn.peerGrading}get delegatedGraders(){var e,t,s;return(null===(e=this.deployedAssessment)||void 0===e?void 0:e.gradingColumn)&&!this.deployedAssessment.gradingColumn.delegatedGraders&&(this.deployedAssessment.gradingColumn.delegatedGraders=[]),null===(s=null===(t=this.deployedAssessment)||void 0===t?void 0:t.gradingColumn)||void 0===s?void 0:s.delegatedGraders}set peerGrading(e){this.deployedAssessment&&(this.deployedAssessment.gradingColumn.peerGrading=e,this.delegatedGrading=e,e&&this.disableDueDateOptions())}get peerGrading(){return this.deployedAssessment&&this.deployedAssessment.gradingColumn&&this.deployedAssessment.gradingColumn.delegatedGrading&&this.deployedAssessment.gradingColumn.peerGrading}set gradeCategory(e){this.deployedAssessment.gradingColumn.gradebookCategoryId=e}get gradeCategory(){return this.deployedAssessment&&this.deployedAssessment.gradingColumn&&this.deployedAssessment.gradingColumn.gradebookCategoryId}get usingSecureFeatures(){return this.deployedAssessment&&this.deployedAssessment.deploymentSettings&&(this.deployedAssessment.deploymentSettings.isSecureBrowserRequiredToTake||this.deployedAssessment.deploymentSettings.isSecureBrowserRequiredToReview||this.deployedAssessment.deploymentSettings.isWebcamRequired||this.proctoringServiceType===Q.a.IMS)}get disabledReasonHelper(){return W}get disableDisplayOneQuestionAtATime(){return!this.canEdit()||(this.shouldProhibitBacktracking?W.hasAnyDisabledReason(this.getProhibitBacktrackingDisabledReason(),this.getQuestionOneAtATimeDisabledReason()):W.hasDisabledReason(this.getQuestionOneAtATimeDisabledReason()))}get shouldDisableRandomizePages(){return!this.canEdit()||null!==this.getPageRandomizationDisabledReason()}get shouldDisableKeepFirstPageFirst(){return!this.shouldRandomizePages||(!this.canEdit()||this.hasResponses())}get shouldDisplayOneQuestionAtATime(){var e,t;return(null===(t=null===(e=this.deployedAssessment)||void 0===e?void 0:e.deploymentSettings)||void 0===t?void 0:t.deliveryType)===M.c.Item}get shouldKeepFirstPageFirst(){var e,t,s;return null!==(s=null===(t=null===(e=this.deployedAssessment)||void 0===e?void 0:e.deploymentSettings)||void 0===t?void 0:t.isKeepFirstPageFirstRequired)&&void 0!==s&&s}set shouldKeepFirstPageFirst(e){this.deployedAssessment&&(this.deployedAssessment.deploymentSettings.isKeepFirstPageFirstRequired=e)}get shouldRandomizePages(){var e,t,s;return null!==(s=null===(t=null===(e=this.deployedAssessment)||void 0===e?void 0:e.deploymentSettings)||void 0===t?void 0:t.isRandomizationOfPagesRequired)&&void 0!==s&&s}set shouldRandomizePages(e){this.deployedAssessment&&(this.deployedAssessment.deploymentSettings.isRandomizationOfPagesRequired=e)}get shouldDisableProhibitBacktracking(){return W.hasDisabledReason(this.getProhibitBacktrackingDisabledReason())||!this.shouldDisplayOneQuestionAtATime||!this.canEdit()}getProhibitBacktrackingDisabledReason(){return this.deployedAssessment&&this.hasResponses()?l.HasResponses:l.None}get shouldProhibitBacktracking(){var e,t,s;return null!==(s=null===(t=null===(e=this.deployedAssessment)||void 0===e?void 0:e.deploymentSettings)||void 0===t?void 0:t.isBacktrackingProhibited)&&void 0!==s&&s}set shouldProhibitBacktracking(e){this.deployedAssessment&&(this.deployedAssessment.deploymentSettings.isBacktrackingProhibited=e)}get disableRandomizeQuestions(){return!this.canEdit()||null!==this.getQuestionRandomizationDisabledReason()}get shouldRandomizeQuestions(){var e,t,s;return null!==(s=null===(t=null===(e=this.deployedAssessment)||void 0===e?void 0:e.deploymentSettings)||void 0===t?void 0:t.isRandomizationOfQuestionsRequired)&&void 0!==s&&s}get assessmentId(){var e;return null===(e=this.deployedAssessment)||void 0===e?void 0:e.assessment.id}set autoPostGrades(e){if(this.deployedAssessment)if(this.hasResponses()){let t;this.$scope.autoPostGradesChangeModal={confirmAction:()=>{this.deployedAssessment.gradingColumn.autoPostGrades=e,t.close()},cancelAction:()=>{t.close()}},t=this.$modal.open({template:X,scope:this.$scope,resolve:{translations:[p.serviceName,e=>e.loadBundle("features/course/content/assessment/assessment")]}})}else this.deployedAssessment.gradingColumn.autoPostGrades=e}get autoPostGrades(){return this.deployedAssessment&&this.deployedAssessment.gradingColumn.autoPostGrades}get proctoringServiceType(){return this.proctoring.getCurrentProctoringProviderType(this.proctoringServiceHandle)}showRespondusProctoringSummary(){return this.isRespondusAvailable&&this.proctoringServiceType!==Q.a.IMS||!this.isRespondusAvailable&&this.proctoringServiceType===Q.a.Respondus}showIMSProctoringSummary(){return this.isIMSProctoringAvailable&&this.proctoringServiceType!==Q.a.Respondus||!this.isIMSProctoringAvailable&&this.proctoringServiceType===Q.a.IMS}showErrorInIMSProctoringSummary(){return this.proctoring.isProctoringServiceUnavailable(this.proctoringServiceHandle,this.proctoringService)}get proctoringServiceHandle(){var e;return null===(e=this.deployedAssessment)||void 0===e?void 0:e.deploymentSettings.proctoringServiceHandle}isEditable(){return!(!this.course||!("isClosed"in this.course))&&!this.course.isClosed}get hasPeerReviews(){var e;const t=!!(null===(e=this.columnSummary)||void 0===e?void 0:e.hasAnyPeerReviewsBeenSubmitted);return this.peerGrading&&t}canEdit(){const e=this.deployedAssessment&&this.deployedAssessment.permissions;return this.isEditable()&&e&&e.modify}canCreateGroups(){return this.entitlement.isEntitled(c.o.CreateGroups)}canEditGroups(){return this.entitlement.isEntitled(c.o.ModifyGroups)}canViewGroups(){return this.entitlement.isEntitled(c.o.ViewGroups)||this.entitlement.isEntitled(c.o.ViewGroupsAsAdmin)}get shouldRandomizeAnswers(){var e,t;return(null===(t=null===(e=this.deployedAssessment)||void 0===e?void 0:e.deploymentSettings)||void 0===t?void 0:t.isRandomizationOfAnswersRequired)===M.Wb.Always}set shouldRandomizeAnswers(e){const t=e?M.Wb.Always:M.Wb.Never;this.deployedAssessment&&this.deployedAssessment.deploymentSettings&&(this.deployedAssessment.deploymentSettings.isRandomizationOfAnswersRequired=t)}isPossiblePointsValid(){return this.gradingColumnMaxPoints>=u.P.GRADE_MIN_POINTS&&this.gradingColumnMaxPoints<=u.P.GRADE_MAX_POINTS}canEditDueDate(){var e,t,s,i;const n=!!(null===(t=null===(e=this.deployedAssessment)||void 0===e?void 0:e.permissions)||void 0===t?void 0:t.modifyDueDate),o=!!(null===(i=null===(s=this.deployedAssessment)||void 0===s?void 0:s.permissions)||void 0===i?void 0:i.modify);return n||o}isNotEnoughPeerSubmissionsToStart(){var e,t,s,i;if(!this.peerGrading)return!1;const n=null!==(t=null===(e=this.columnSummary)||void 0===e?void 0:e.numStudentSubmissions())&&void 0!==t?t:0,o=null!==(i=null===(s=this.deployedAssessment.peerSettings)||void 0===s?void 0:s.peerReviewsPerStudent)&&void 0!==i?i:0;return this.isPastDue(this.dueDate)&&n<o+1}get collectExternalSubmissions(){return this.deployedAssessment&&this.deployedAssessment.deploymentSettings&&this.deployedAssessment.deploymentSettings.isCollectExternalSubmissions}set collectExternalSubmissions(e){this.deployedAssessment&&this.deployedAssessment.deploymentSettings&&(this.deployedAssessment.deploymentSettings.isCollectExternalSubmissions=e,e&&(this.removeTimeLimit(),this.content.isSafeAssignOn()&&(this.content.contentDetail[this.content.contentHandler.toString()].safeAssignOptions={checkAttempts:!1,canStudentViewReports:!1,excludeSubmissions:!1,globalSearch:!1},this.clearSafeAssignSetting()),this.disableDueDateOptions()))}disableDueDateOptions(){this.deployedAssessment.deploymentSettings.isDueDateEnforced=!1,this.deployedAssessment.deploymentSettings.isLateAttemptCreationDisallowed=!1}isDueDateValid(){return this.isDueDateValidForPeerReview()&&this.isDueDateValidForConditionalAvailability()&&this.isDueDateValidForFeedbackResults()&&this.isDueDateValidWhenEnforceDueDateIsSet()}isDueDateValidForConditionalAvailability(){return this.isDateValid(this.startDate,this.endDate,e.INVALID_DUE_DATE_PER_START_END_RANGE_ERROR_KEY,e.INVALID_DUE_DATE_PER_START_END_RANGE_ERROR_KEY)}isDueDateValidForPeerReview(){return this.peerGrading?this.isDateValid(null,this.peerReviewDueDate,e.INVALID_DUE_DATE_PER_PEER_REVIEW_DATE_ERROR_KEY,e.INVALID_DUE_DATE_PER_PEER_REVIEW_TIME_ERROR_KEY):(this.castAssessmentFormItem(K.a).$setValidity(e.INVALID_DUE_DATE_PER_PEER_REVIEW_DATE_ERROR_KEY,!0),this.castAssessmentFormItem(K.b).$setValidity(e.INVALID_DUE_DATE_PER_PEER_REVIEW_TIME_ERROR_KEY,!0),!0)}isDueDateValidForFeedbackResults(){var t,s;const i=null===(s=null===(t=this.deployedAssessment)||void 0===t?void 0:t.deploymentSettings)||void 0===s?void 0:s.feedbackSettings,n=k.s.getFeedbackModeByOption(M.f.Score,i),o=k.s.getFeedbackModeByOption(M.f.CorrectAnswers,i);let a=null,r=null;return Object(z.c)(n.mode,o.mode)&&(a=n.associatedDate,r=o.associatedDate),this.isDateValid(a,r,e.INVALID_DUE_DATE_PER_FEEDBACK_RELEASE_DATE_ERROR_KEY,e.INVALID_DUE_DATE_PER_FEEDBACK_RELEASE_DATE_ERROR_KEY)}isDueDateValidWhenEnforceDueDateIsSet(){var t,s,i,n;const o=(null===(t=this.originalDueDate)||void 0===t?void 0:t.getTime())!==(null===(s=this.dueDate)||void 0===s?void 0:s.getTime()),a=this.isDueDateEnforced!==(null===(n=null===(i=this.pristineDeployedAssessment)||void 0===i?void 0:i.deploymentSettings)||void 0===n?void 0:n.isDueDateEnforced);return this.isDueDateEnforced&&(o||a)&&this.hasResponses()?this.isDateValid(this.context.getServerTime(),null,e.INVALID_DUE_DATE_PER_ENFORCE_DUE_DATE_ERROR_KEY,e.INVALID_DUE_DATE_PER_ENFORCE_DUE_DATE_ERROR_KEY):(this.castAssessmentFormItem(K.a).$setValidity(e.INVALID_DUE_DATE_PER_ENFORCE_DUE_DATE_ERROR_KEY,!0),this.castAssessmentFormItem(K.b).$setValidity(e.INVALID_DUE_DATE_PER_ENFORCE_DUE_DATE_ERROR_KEY,!0),!0)}isDateValid(e,t,s,i){const{isValidDate:n,isValidTime:o}=C.a.testWithinDateRange(this.dueDate,{end:t,start:e},!1),a=n&&o;return this.castAssessmentFormItem(K.a).$setValidity(s,n),this.castAssessmentFormItem(K.b).$setValidity(i,o),(this.$scope.assessmentSettingsForm[K.a].$invalid||this.$scope.assessmentSettingsForm[K.b].$invalid)&&(this.$scope.assessmentSettingsForm[K.a].$setDirty(),this.$scope.assessmentSettingsForm[K.b].$setDirty(),this.$scope.assessmentSettingsForm[K.a].$setTouched(),this.$scope.assessmentSettingsForm[K.b].$setTouched()),a}getColumnSummary(){this.deployedAssessment&&this.deployedAssessment.gradingColumn&&(this.columnSummary=this.course.gradebook.columns.$buildRaw(this.deployedAssessment.gradingColumn).summary,this.columnSummary.$fetch())}setupMaxPointsInput(){this.contentPromise&&this.contentPromise.then((()=>{this.updateMaxPointsInput()}))}updateMaxPointsInput(){this.deployedAssessment&&null!=this.deployedAssessment.gradingColumn.possible?this.maxPointsInput=u.P.parseGradeValue(this.deployedAssessment.gradingColumn.possible):this.maxPointsInput=u.P.GRADE_DEFAULT_POINTS.toString()}setupContent(){this.contentPromise=this.content.$fetch({expand:e.ADDITIONAL_CONTENT_FIELDS.join(",")}).$then((()=>{this.originalDeploymentSettings=n.assign({},this.content&&this.pristineDeployedAssessment.deploymentSettings),this.content.$snapshot(),this.unsavedDeployedAssessment=n.cloneDeep(this.pristineDeployedAssessment),this.content.adaptiveReleaseRules&&(this.dateSelection=this.originalDateSelection={start:!!this.content.adaptiveReleaseRules.startDate,end:!!this.content.adaptiveReleaseRules.endDate}),this.canModifyGradebookContent&&(this.getColumnSummary(),this.setupMaxPointsInput()),this.content.$getPreviousVersion()&&(this.content.$getPreviousVersion().allowConversations=this.content.hasConversation()),this.getAdaptiveReleaseCriteria(),this._conversationService=this.$injector.instantiate(S.a,{currentCourse:this.course,coreContent:this.content}),this.$scope.$emit(A.b),this.calculateCategoryDependentLocaleKeys(),this.initAssessmentResultOptions(),this.originalityReportService.setCourseContent(this.content,!0),this.setOriginalityReportProvider()})).$asPromise()}getAdaptiveReleaseCriteria(){var e;const t=this.content&&this.content.adaptiveReleaseRules;if(null===(e=null==t?void 0:t.rules)||void 0===e?void 0:e.length){const e=t.rules[0].criteria;this.dateCriteria=e.find((e=>"Date_Range"===e.type)),this.dateCriteria&&(this.startDate=C.a.parseStringToDate(this.dateCriteria.start),this.endDate=C.a.parseStringToDate(this.dateCriteria.end)),this.aclCriteria=e.find((e=>"ACL"===e.type))}}get isImsProctoringSubpanelShowing(){return this.subpanelId===e.IMS_PROCTORING_SUBPANEL_ID}get isFeedbackSubpanelShowing(){return this.subpanelId===e.FEEDBACK_SUBPANEL_ID}get isGoalsSubpanelShowing(){return this.subpanelId===e.GOALS_SUBPANEL_ID}get isRubricsSubpanelShowing(){return this.subpanelId===e.RUBRICS_SUBPANEL_ID}hasTimeLimit(){return this.getDisplayTimeLimit()>0}get isTimeLimitSubpanelShowing(){return this.subpanelId===e.TIME_LIMIT_SUBPANEL_ID}get isPeerSettingsSubpanelShowing(){return this.subpanelId===e.PEER_SETTINGS_SUBPANEL_ID}showPeerSettingsPanel(t){this.showSubpanel(e.PEER_SETTINGS_SUBPANEL_ID),this.shouldFocusPeerReviewDueDate=t}openOriginalitySubPanel(){this.originalityReportService.isSafeAssignActiveOriginalityProvider()?this.showSubpanel(e.SAFE_ASSIGN_SUBPANEL_ID):this.originalityReportService.isIntegrationActiveOriginalityProvider()&&this.showSubpanel(e.ORIGINALITY_REPORT_SUBPANEL_ID)}get isAccessCodeSubpanelShowing(){return this.subpanelId===e.ACCESS_CODE_SUBPANEL_ID}get accessCodeEnabled(){var e;return null===(e=null==this?void 0:this.deployedAssessment)||void 0===e?void 0:e.deploymentSettings.isPasswordRequired}set accessCodeEnabled(e){var t;(null===(t=null==this?void 0:this.deployedAssessment)||void 0===t?void 0:t.deploymentSettings).isPasswordRequired=e}get accessCode(){var e;return null===(e=null==this?void 0:this.deployedAssessment)||void 0===e?void 0:e.deploymentSettings.password}set accessCode(e){var t;(null===(t=null==this?void 0:this.deployedAssessment)||void 0===t?void 0:t.deploymentSettings).password=e}hidePeerSettingsPanel(e){if(e){const{dueDate:t,peerGrading:s,...i}=e;null!=t&&(this.dueDate=t),this.deployedAssessment.peerSettings={...this.deployedAssessment.peerSettings,...i,allowLatePeerReviews:!0},this.deployedAssessment.peerSettings.evaluationColumnName=this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:"course.content.assessment.test.settings.peerGrading.evaluationColumnTitle",params:{columnName:this.deployedAssessment.gradingColumn.columnName},noWrap:!0}),this.peerGrading=s,this.peerReviewDueDate=i.peerReviewDueDate}this.subpanelId=""}getExtraTime(){const e=this.deployedAssessment&&this.deployedAssessment.deploymentSettings;return e&&e.softTimeLimit&&e.timeLimit-e.softTimeLimit}getDisplayTimeLimit(){const e=this.deployedAssessment&&this.deployedAssessment.deploymentSettings;return e&&(e.softTimeLimit||e.timeLimit)}removeTimeLimit(){const e=this.deployedAssessment&&this.deployedAssessment.deploymentSettings;this.originalDeploymentSettings&&e&&(delete this.originalDeploymentSettings.timeLimit,delete this.originalDeploymentSettings.softTimeLimit,this.originalDeploymentSettings.timerCompletion=M.gc.Continual,delete e.timeLimit,delete e.softTimeLimit,e.timerCompletion=M.gc.Continual,this.content&&this.content.removeTimeLimit(this.originalDeploymentSettings))}hideTimeLimit(){this.subpanelId="",this.$scope.$root.$broadcast("bb-save-time-limit")}isUnlimitedTime(){const e=this.deployedAssessment&&this.deployedAssessment.deploymentSettings;return e&&e.timeLimit&&e.timerCompletion===M.gc.Continual}isAutoSubmissionTimeLimit(){const e=this.deployedAssessment&&this.deployedAssessment.deploymentSettings;return e&&!e.softTimeLimit&&e.timerCompletion===M.gc.HardStop}get isSafeAssignSubpanelShowing(){return this.subpanelId===e.SAFE_ASSIGN_SUBPANEL_ID}get isOriginalityReportSubpanelShowing(){return this.subpanelId===e.ORIGINALITY_REPORT_SUBPANEL_ID}setOriginalityReportProvider(){this.originalityReportService.retrieveOriginalityIntegration(this.content).then((e=>{if(e)return this.originalitySubmissionService=n.cloneDeep(e),this.isOriginalityIntegrationEnabled=e.capabilities.OriginalityReport.enabled,this.originalityReportService.isSafeAssignActiveOriginalityProvider()&&this.resetUnsavedSafeAssignSettings(),this.originalitySubmissionService}))}onCancelOriginalityReportSettings(){this.setOriginalityReportProvider(),this.hideSubpanel()}canConfigureOriginalityReport(){return this.canEdit()&&!B.a.isExternalSubmissionsAssessment(this.content)}get originalityButtonSwitchAnalyticsId(){var e;return`course.content.assessment.settings.originalityReport.${(null===(e=this.originalitySubmissionService)||void 0===e?void 0:e.uniqueHandle)||"unknown"}.attempts.${this.isOriginalityIntegrationEnabled?"disable":"enable"}.switch`}get originalityButtonSwitchLabel(){var e;return this.localize.translateSync({locale:this.localize.getAppLocale(),key:"course.content.originalityReport.settings.providerSwitchLabel",noWrap:!0,params:{originalityReportProvider:null===(e=this.originalitySubmissionService)||void 0===e?void 0:e.displayName},noEscape:!0})}get safeAssignButtonSwitchlabel(){var e;return this.localize.translateSync({locale:this.localize.getAppLocale(),key:"course.content.originalityReport.settings.enableProvider",noWrap:!0,params:{originalityProvider:null===(e=this.originalitySubmissionService)||void 0===e?void 0:e.displayName},noEscape:!0})}safeAssignCancelled(){this.resetUnsavedSafeAssignSettings(),this.hideSubpanel()}safeAssignSaved(){var e,t,s,i;const n=this.content.getSafeAssignAttrs();n.canStudentViewReports=null===(e=this.unsavedSafeAssignSettings)||void 0===e?void 0:e.canStudentViewReports,n.checkAttempts=null===(t=this.unsavedSafeAssignSettings)||void 0===t?void 0:t.checkAttempts,n.excludeSubmissions=null===(s=this.unsavedSafeAssignSettings)||void 0===s?void 0:s.excludeSubmissions,n.globalSearch=null===(i=this.unsavedSafeAssignSettings)||void 0===i?void 0:i.globalSearch,this.resetUnsavedSafeAssignSettings(),this.hideSubpanel()}resetUnsavedSafeAssignSettings(){this.unsavedSafeAssignSettings={...this.content.getSafeAssignAttrs()}}isMultipleAttempts(){return this.deployedAssessment&&1!==this.deployedAssessment.deploymentSettings.attemptCount}isActiveMultipleAttemptsAndGroupsRestriction(){return!this.multipleAttemptsAndGroupsFeatureFlag}setMultipleAttemptGroupsFeatureFlag(){const e=this.flagService.isFeatureEnabled(k.r.MultipleAttemptsAndGroups);this.multipleAttemptsAndGroupsFeatureFlag=e}getMultipleAttemptGroupsFeatureFlagValue(e){if(!e)return;const t=k.gc.featureFlags.getFeatureFlagValue(e,k.r.MultipleAttemptsAndGroups);return"true"===(null==t?void 0:t.flagValue)}getQuestionOneAtATimeDisabledReason(){return this.deployedAssessment?this.canModifySettings?this.hasAnswerableQuestions()?this.deployedAssessment.deploymentSettings.isCollectExternalSubmissions?l.ExternalSubmissions:this.hasResponses()?l.HasResponses:l.None:l.NoAnswerableQuestions:l.EntitlementRestriction:l.None}getQuestionRandomizationDisabledReason(){return this.deployedAssessment?this.peerGrading?l.PeerGrading:this.deployedAssessment.deploymentSettings.isCollectExternalSubmissions?l.ExternalSubmissions:this.hasAnswerableQuestions()?this.hasResponses()?l.HasResponses:null:l.NoAnswerableQuestions:null}getQuestionRandomizationExtraInfo(){return this.deployedAssessment&&this.pageBreaks.length>0?"pageBreaks":null}getPageRandomizationDisabledReason(){return this.deployedAssessment?this.hasResponses()?l.HasResponses:this.peerGrading?l.PeerGrading:this.deployedAssessment.deploymentSettings.isCollectExternalSubmissions?l.ExternalSubmissions:this.hasAnswerableQuestions()?0===this.pageBreaks.length?l.NoPageBreaks:null:l.NoAnswerableQuestions:null}getAnswerRandomizationDisabledReason(){return this.deployedAssessment?this.peerGrading?"peerGrading":this.hasResponses()?"hasResponses":this.deployedAssessment.deploymentSettings.isCollectExternalSubmissions?"externalSubmissions":this.hasAnswerableQuestions()?null:"noAnswerableQuestions":null}getImsProctoringDisabledReason(){return this.deployedAssessment&&this.proctoringServiceType!==Q.a.IMS?this.collectExternalSubmissions?"imsProctoringSummary.restriction.externalSubmission":this.content.isGroupContent?"imsProctoringSummary.restriction.groups":void 0:null}getExternalSubmissionDisabledReason(){return!this.deployedAssessment||this.collectExternalSubmissions?null:this.hasResponses()?"hasResponses":this.hasAnswerableQuestions()?"answerableQuestions":this.anonymousGrading?"anonymousGrading":this.peerGrading?"peerGrading":this.isDueDateEnforced?"isDueDateEnforced":this.isLateAttemptCreationDisallowed?"isLateAttemptCreationDisallowed":this.isMultipleAttempts()?"multipleAttempts":this.usingSecureFeatures?"testSecurity":this.accessCodeEnabled?"accessCode":this.originalityReportService.isOriginalityReportEnabled()?"originalityReport":null}getAnonymousGradingDisabledReason(){return this.deployedAssessment?this.hasResponses()&&!this.anonymousGrading?"hasResponsesShowingNames":this.hasResponses()&&this.anonymousGrading?"hasResponsesHidingNames":this.hasAnswerableQuestions()?"answerableQuestions":this.content.allowConversations?"conversations":this.deployedAssessment.deploymentSettings.isCollectExternalSubmissions?"externalSubmissions":this.content.isGroupContent?"groups":this.peerGrading?"peerGrading":null:null}shouldShowAutoPostGradesDescription(){return null===this.getAutoPostGradesDisabledReason()}getAutoPostGradesDisabledReason(){return this.deployedAssessment?this.canModifySettings?null:"entitlementRestriction":null}shouldShowAccessCodeSetting(){return this.canModifySettings}getAccessCodeDisabledReason(){var e,t;return(null===(t=null===(e=this.deployedAssessment)||void 0===e?void 0:e.deploymentSettings)||void 0===t?void 0:t.isCollectExternalSubmissions)?"externalSubmission":null}getDelegatedGradingDisabledReason(){return this.deployedAssessment?this.hasAnswerableQuestions()?"answerableQuestions":this.content.isGroupContent?"groups":this.peerGrading?"peerGrading":null:null}shouldShowEnforceDueDateDescription(){const e=this.getEnforceDueDateDisabledReason();return null===e||"notDueDate"===e}getEnforceDueDateDisabledReason(){return this.deployedAssessment?this.canModifySettings?this.dueDate?this.peerGrading?"peerGrading":this.deployedAssessment.deploymentSettings.isCollectExternalSubmissions?"externalSubmissions":this.content.isGroupContent?"groupAssessment":null:"notDueDate":"entitlementRestriction":null}shouldShowProhibitNewAttemptsAfterDueDateDescription(){const e=this.getProhibitNewAttemptsAfterDueDateDisabledReason();return null===e||"isDueDateEnforced"===e||"notDueDate"===e}getProhibitNewAttemptsAfterDueDateDisabledReason(){return this.deployedAssessment?this.canModifySettings?this.isDueDateEnforced?"isDueDateEnforced":this.dueDate?this.peerGrading?"peerGrading":this.deployedAssessment.deploymentSettings.isCollectExternalSubmissions?"externalSubmissions":null:"notDueDate":"entitlementRestriction":null}getPeerGradingDisabledReason(){return this.deployedAssessment?this.hasAnswerableQuestions()?"answerableQuestions":this.isMultipleAttempts()?"multipleAttempts":this.deployedAssessment.deploymentSettings.isCollectExternalSubmissions?"externalSubmissions":this.anonymousGrading?"anonymousGrading":this.delegatedGrading?"delegatedGrading":this.content.isGroupContent?"groups":this.isDueDateEnforced?"isDueDateEnforced":this.isLateAttemptCreationDisallowed?"isLateAttemptCreationDisallowed":this.deployedAssessment.deploymentSettings.timeLimit?"timeLimit":this.hasResponses()&&!this.peerGrading?"hasSubmissionsNotPeer":this.hasResponses()&&this.peerGrading?"hasSubmissionsIsPeer":null:null}getGroupDisabledReason(){return this.deployedAssessment?this.isMultipleAttempts()&&this.isActiveMultipleAttemptsAndGroupsRestriction()?"course.content.groupRestriction.multipleAttempt":this.anonymousGrading?"course.content.groupRestriction.anonymousGrading":this.delegatedGrading?"course.content.groupRestriction.delegatedGrading":this.peerGrading?"course.content.groupRestriction.peerGrading":this.deployedAssessment.deploymentSettings.timeLimit?"course.content.groupRestriction.timedAssessment":this.usingSecureFeatures?"course.content.groupRestriction.testSecurity":this.hasACLCriteria()?"course.content.groupRestriction.conditionalRelease":this.isDueDateEnforced?"course.content.groupRestriction.enforceDueDate":null:null}getTimeLimitDisabledReason(){return this.deployedAssessment?this.peerGrading?"peerGrading":this.deployedAssessment.deploymentSettings.isCollectExternalSubmissions?"externalSubmissions":null:null}getGroupsLinkKey(){return this.canCreateGroups?"course.content.assessment.settings.makeGroup":"course.content.assessment.settings.viewGroup"}getOriginalityReportDisabledReason(){return!this.deployedAssessment||this.originalityReportService.isOriginalityReportEnabled()?null:this.deployedAssessment.deploymentSettings.isCollectExternalSubmissions?"externalSubmissions":null}associateRubric(e,t){n.isFinite(t)&&(this.rubricMaxPoints=t,this.isRubricMaxPointsUpdated=!0),this.$scope.$root.$broadcast("associate-rubric",e,t),this.subpanelId=""}addGoals(){this.ultraState.goPeekState("goal-picker-legacy",{goalAlignableContent:this.content})}hasAnswerableQuestions(){return this.content&&!this.content.isAssignment()&&this.pristineDeployedAssessment.assessment.hasAnswerableQuestions}hasAssignedGroups(){return this.content&&this.content.assignedGroups&&this.content.assignedGroups.length>0}hasTimeLimitRestrictions(){return null!=this.getTimeLimitDisabledReason()}editGroups(){this.persist().then((()=>{this.ultraState.goPeekState("course-group",{groupCourseId:this.content.courseId,groupContentId:this.content.id,groupColumnId:this.deployedAssessment.gradingColumn.id})}))}calculateCategoryDependentLocaleKeys(){const e=this.pristineDeployedAssessment.gradingColumn.gradebookCategory;this.gradebookCategoryTitle=e.title;const t=this.course.isOrganization?"organization":"course";e.isUserDefined?(this.panelTitle=this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:"course.content.assessment.settings.header.custom",params:{title:this.gradebookCategoryTitle},noEscape:!0,noWrap:!0}),this.dueDateErrorKey="course.content.assessment.settings.dueDate.outOfShowHideRangeError.custom",this.groupDescriptionLocalizeId="course.content.assessment.settings.groupDescription.custom",this.cannotMakeGroupLocalizeId=`${t}.content.assessment.settings.cannotMakeGroup.custom`,this.cannotMakeGroupNoPermissionLocalizedId="course.content.assessment.settings.cannotMakeGroupNoPermission.custom",this.cannotMakeGroupPostedLocalizeId="course.content.assessment.settings.cannotMakeGroupPosted.custom"):(this.panelTitle=this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:"course.content.assessment.settings.header."+this.gradebookCategoryTitle}),this.dueDateErrorKey="course.content.assessment.settings.dueDate.outOfShowHideRangeError."+this.gradebookCategoryTitle,this.groupDescriptionLocalizeId="course.content.assessment.settings.groupDescription."+this.gradebookCategoryTitle,this.cannotMakeGroupLocalizeId=`${t}.content.assessment.settings.cannotMakeGroup.${this.gradebookCategoryTitle}`,this.cannotMakeGroupNoPermissionLocalizedId="course.content.assessment.settings.cannotMakeGroupNoPermission."+this.gradebookCategoryTitle,this.cannotMakeGroupPostedLocalizeId="course.content.assessment.settings.cannotMakeGroupPosted."+this.gradebookCategoryTitle),this.dueDatePeerReviewErrorKey="course.content.assessment.settings.dueDate.notBeforePeerReviewStart",this.notifyMobileApp()}notifyMobileApp(){var e;const t={type:Y.c.AssessmentSettingsOpened,status:Y.b.Success,pageTitle:this.panelTitle,prevState:Object(Y.i)(null===(e=this.ultraState.prev)||void 0===e?void 0:e.name)};Object(Y.r)(t)}clearGroups(){this.content&&this.contentSvc.clearContentGroups(this.content,this.course).then((()=>{this.$scope.$root.$broadcast(j.c,this.content)}))}hasResponses(){return this.deployedAssessment&&this.deployedAssessment.assessment.hasResponses}hasPostedGrades(){return this.columnSummary&&(this.columnSummary.numGroupsPosted||this.columnSummary.numPosted)}hasFeedbacks(){return this.hasResponses()||this.hasPostedGrades()}confirmToClose(){this.confirmedToClose=!0,this.ultraState.leavePeekState(this.ultraState.current.name)}checkDelegatedAssignment(){if(this.delegatedGrading){if(!this.areDelegatedGradersAssigned())return this.$scope.$broadcast(U.a,"assessment-settings-no-delegated-graders"),!1;if(!this.areReconcilersAssigned()&&this.hasCanConfigureReconcilersPermission())return this.$scope.$broadcast(U.a,"assessment-settings-no-reconcilers"),!1}return!0}areDelegatedGradersAssigned(){return 0!==this.delegatedGraders.filter((e=>!e.isUnassigned&&!e.canReconcile)).length}areReconcilersAssigned(){return!!this.delegatedGrading&&!!this.delegatedGraders.some((e=>e.canReconcile&&!e.isUnassigned))}confirmSave(){return this.saveAction()}openDelegatedGradingSettingsPanel(){this.ultraState.goPeekState("assign-graders")}setColorClass(){this.$scope.course?this.courseColorClass=this.$scope.course.courseColorClass:this.course.memberships.$search({userId:this.contextUser.userId}).$then((e=>{this.courseColorClass=e[0].getCourseColorClass()}))}getColorClass(){return this.courseColorClass}loadCategories(){this.categoryService.getFilteredCategoriesForCourse(this.course.id,(e=>e.title!==M.W.Attendance)).then((e=>{e.forEach((e=>{const t=e.title,s={label:e.isUserDefined?t:this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:"course.content.assessment.type."+t}),value:e.id};this.categoryOptions.push(s)}))}))}clearSafeAssignSetting(){this.unsavedSafeAssignSettings.canStudentViewReports=!1,this.unsavedSafeAssignSettings.excludeSubmissions=!1}automaticZeroConfirm(){this.originalDueDate=this.dueDate,this.saveAction()}automaticZeroCancel(){this.dueDate=this.originalDueDate}automaticZeroDismiss(){this.dueDate=this.originalDueDate}isPastDue(e){return!!e&&e<this.context.getServerTime()}shouldDisplayPastDueZero(){if(!1===this.isPastDueSettingTurnOn)return!1;let e=this.isPastDue(this.originalDueDate);this.pristineDeployedAssessment.gradingColumn.peerGrading&&(e=this.isPastDue(C.a.parseStringToDate(this.pristineDeployedAssessment.peerSettings.peerReviewDueDate)));let t=this.isPastDue(this.dueDate);return this.peerGrading&&(t=this.isPastDue(this.peerReviewDueDate)),this.pastDueStatus=e&&!t?"after":!e&&t?"before":null,null!==this.pastDueStatus}shouldDisplayDueDateChangedDialog(){return!this.isPastDue(this.originalDueDate)&&this.dueDate!==this.originalDueDate&&this.isDueDateEnforced&&this.hasResponses()}hasCanConfigureReconcilersPermission(){return!!(this.reduxColumn&&this.reduxColumn.permissions&&this.reduxColumn.permissions.canConfigureReconcilers)}checkPeerSettings(){return!(this.column.peerGrading&&!this.deployedAssessment.peerSettings)||(this.$scope.$broadcast(U.a,"assessment-settings-no-peer-grade-settings"),!1)}disablePeerAndConfirmSave(){return this.peerGrading=!1,this.confirmSave()}handlePeerSettingsClose(){this.$scope.$broadcast("close-peer-review-slide-panel")}getShowTestResultsDisabledReason(){return this.deployedAssessment?this.canModifySettings?this.anonymousGrading?(this.testResultsRestrictionKey="course.content.assessment.test.settings.testResults.restriction.anonymousGrading","anonymousGrading"):this.delegatedGrading?(this.testResultsRestrictionKey="course.content.assessment.test.settings.testResults.restriction.delegatedGrading","delegatedGrading"):this.deployedAssessment.deploymentSettings.isCollectExternalSubmissions?(this.testResultsRestrictionKey="course.content.assessment.test.settings.testResults.restriction.externalSubmissions","externalSubmissions"):this.peerGrading?(this.testResultsRestrictionKey="course.content.assessment.test.settings.testResults.restriction.peerGrading","peerGrading"):this.hasAnswerableQuestions()?null:(this.testResultsRestrictionKey="course.content.assessment.test.settings.testResults.restriction.noAnswerableQuestions","noAnswerableQuestions"):(this.testResultsRestrictionKey=ie,"entitlementRestriction"):null}displayHasDueDateExceptionsAlert(){if(!this.hasDueDateExceptions)return;const e=!function(e,t){Object(r.a)(2,arguments);var s=d(e),i=d(t);return s.getTime()===i.getTime()}(this.originalDueDate,this.dueDate);this.showHasDueDateExceptionsAlert=e}hideHasDueDateExceptionsAlert(){this.showHasDueDateExceptionsAlert=!1}};oe.INVALID_DUE_DATE_PER_START_END_RANGE_ERROR_KEY="dueDateNotWithinStartEndRange",oe.INVALID_DUE_DATE_PER_PEER_REVIEW_DATE_ERROR_KEY="dueDateNotBeforePeerReviewStart",oe.INVALID_DUE_DATE_PER_FEEDBACK_RELEASE_DATE_ERROR_KEY="dueDateNotBeforeOnFeedbackReleaseDate",oe.INVALID_DUE_DATE_PER_PEER_REVIEW_TIME_ERROR_KEY="dueTimeNotBeforePeerReviewStart",oe.INVALID_DUE_DATE_PER_ENFORCE_DUE_DATE_ERROR_KEY="dueDateNotAfterCurrentDate",oe.ADDITIONAL_CONTENT_FIELDS=["alignedGoals","assignedGroups","selfEnrollmentGroups.group","gradebookCategory","isGroupContent","permissions"],oe.DEFAULT_TIME_LIMIT=60,oe.DEFAULT_MAX_TIME_LIMIT=1440,oe.NUMBER_SMALL_KEY="numberSmall",oe.ACCESS_CODE_SUBPANEL_ID="accessCode",oe.FEEDBACK_SUBPANEL_ID="feedback",oe.GOALS_SUBPANEL_ID="goals",oe.RUBRICS_SUBPANEL_ID="rubrics",oe.TIME_LIMIT_SUBPANEL_ID="timeLimit",oe.SAFE_ASSIGN_SUBPANEL_ID="safeAssign",oe.ORIGINALITY_REPORT_SUBPANEL_ID="originalityReport",oe.PEER_SETTINGS_SUBPANEL_ID="peerSettings",oe.IMS_PROCTORING_SUBPANEL_ID="imsProctoring",Object(i.a)([P.a],oe.prototype,"hidePeerSettingsPanel",null),oe=Object(i.a)([Object(i.c)(0,Object(x.b)("$injector")),Object(i.c)(1,Object(x.b)("$log")),Object(i.c)(2,Object(x.b)("$q")),Object(i.c)(3,Object(x.b)("$rootScope")),Object(i.c)(4,Object(x.b)("$scope")),Object(i.c)(5,Object(x.b)("$ngRedux")),Object(i.c)(6,Object(x.b)("currentCourse")),Object(i.c)(7,Object(x.b)(p.serviceName)),Object(i.c)(8,Object(x.b)(m.f)),Object(i.c)(9,Object(x.b)(I.b)),Object(i.c)(10,Object(x.b)(O.c)),Object(i.c)(11,Object(x.b)(w.d)),Object(i.c)(12,Object(x.b)($.b)),Object(i.c)(13,Object(x.b)(V.d)),Object(i.c)(14,Object(x.b)(b.b)),Object(i.c)(15,Object(x.b)(y.b)),Object(i.c)(16,Object(x.b)(v.b)),Object(i.c)(17,Object(x.b)(R.b)),Object(i.c)(18,Object(x.b)(D.b)),Object(i.c)(19,Object(x.b)(E.b)),Object(i.c)(20,Object(x.b)(B.h)),Object(i.c)(21,Object(x.b)(p.serviceName)),Object(i.c)(22,Object(x.b)(L.b)),Object(i.c)(23,Object(x.b)(_.m.serviceName)),Object(i.c)(24,Object(x.b)(_.p.serviceName)),Object(i.c)(25,Object(x.b)(T.b)),Object(i.c)(26,Object(x.b)(F.c)),Object(i.c)(27,Object(x.b)(J.b)),Object(i.c)(28,Object(x.b)(H.b))],oe)},mrqE:function(e,t,s){"use strict";function i(e,t){if(t.length<e)throw new TypeError(e+" argument"+(e>1?"s":"")+" required, but only "+t.length+" present")}s.d(t,"a",(function(){return i}))},nYkW:function(e,t){e.exports='<div class="row collapse due-date" bb-load-bundle="components/directives/due-date">\n  <div class="inline-form-row row collapse">\n    <div class="columns small-12">\n      <label bb-form-label-decorator="{required:dueDate.isMandatory}" class="date-time-label due-date-label settings-subheader" bb-translate>\n        {{::dueDate.getLabelToken()}}\n      </label>\n    </div>\n    <div class="columns small-12 date-time-inputs">\n      <div class="columns small-6">\n        <div class="due-date-input {{dueDate.container}}">\n          <input ng-model="model"\n                id="{{dueDate.dueDateId}}"\n                name="{{::dueDate.dueDateFieldName}}"\n                ng-disabled="dueDate.isDisabled"\n                ng-readonly="dueDate.isReadOnly"\n                aria-invalid="{{!dueDate.isDueDateValid}}"\n                aria-describedby="{{dueDate.dueDateId}}-date-from-error"\n                bb-translate-attrs="{\'aria-label\': \'components.directives.due-date.aria-label.dueDateDate\', \'placeholder\': \'components.directives.due-date.datePlaceholder\'}"\n                ng-attr-bb-focus="dueDate.shouldFocus()"\n                bb-validate-date\n                bb-date-picker\n                container=".{{dueDate.container}}"\n                orientation="auto left"\n                first-day-of-week="dueDate.localeSettings.calendar.firstDayOfWeek"\n                analytics-id="{{::analyticsIdTagPrefix}}.dateTime.input.date"\n                class="show-calendar-icon">\n        </div>\n      </div>\n      <div class="columns small-6">\n        <div class="time-input">\n          <bb-time-picker name="{{::dueDate.dueTimeFieldName}}"\n                               analytics-id="{{::analyticsIdTagPrefix}}.time.input.text"\n                               current-date="model"\n                               ng-model="model"\n                               on-view-value-cleared="dueDate.onViewValueCleared"\n                               invalid-validation-key="time"\n                               disabled="dueDate.isDisabled"\n                               readonly="dueDate.isReadOnly"\n                               aria-invalid="{{!dueDate.isTimeDueDateValid}}"\n                               aria-describedby="{{dueDate.dueDateId}}-time-from-error"\n                               bb-translate-attrs="{\'aria-label\': \'components.directives.due-date.aria-label.dueDateTime\',\n                                    \'placeholder\': \'components.directives.due-date.timePlaceholder\'}">\n          </bb-time-picker>\n        </div>\n      </div>\n    </div>\n  </div>\n  \x3c!-- It appears the html renders before the dueDateFieldName is defined. If the validation messages are in the DOM\n      before the field names are present then an error is thrown and nothing renders. The ng-if is used to remove the\n      validation messages until the field name is defined allowing everything to render correctly. --\x3e\n  <div ng-if="dueDate.dueDateFieldName && dueDate.dueTimeFieldName" class="due-date-error-messages row collapse">\n    <div class="columns small-12">\n      <div bb-validation-messages id="{{dueDate.dueDateId}}-date-from-error" for="{{::dueDate.dueDateFieldName}}" immediate="true">\n        <span ng-message="date"><span bb-translate>components.directives.validation.messages.errors.date</span></span>\n        <span ng-message="overdue"><span bb-translate>components.directives.due-date.validation.dateInPast</span></span>\n        <span ng-message="overdueOnsubmit"><span bb-translate>components.directives.due-date.validation.dateInPast</span></span>\n        <span ng-transclude="customValidationMessages"></span>\n      </div>\n      <div bb-validation-messages id="{{dueDate.dueDateId}}-time-from-error" for="{{::dueDate.dueTimeFieldName}}" immediate="true">\n        <span ng-message="time" bb-translate>components.directives.validation.messages.errors.invalidTime</span>\n        <span ng-message="overdue"><span bb-translate>components.directives.due-date.validation.dateInPast</span></span>\n        <span ng-message="overdueOnsubmit"><span bb-translate>components.directives.due-date.validation.dateInPast</span></span>\n        <span ng-message="tooSoon"><span bb-translate>components.directives.due-date.validation.dateTooSoon</span></span>\n        <span ng-message="tooSoonOnsubmit"><span bb-translate>components.directives.due-date.validation.dateTooSoon</span></span>\n        <span ng-transclude="customValidationMessages"></span>\n      </div>\n    </div>\n  </div>\n</div>\n'}}]);