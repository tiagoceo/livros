(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{"06dA":function(e,t,a){"use strict";var r=a("ERkP"),i=a("Al7u"),n=a("myse"),s=a("C+e0"),c=a("eqO1"),o=a("THXI");const l=()=>Object(c.e)({styles:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}}),d=e=>Object(c.e)({gradePill:{background:e.palette.background.b4,borderRadius:"30px",display:"flex",justifyContent:"center",alignItems:"center"}}),u=e=>({padding:"10px",paddingLeft:"14px",backgroundColor:e.palette.background.b2,borderRadius:"2px",border:`1px solid ${e.palette.border.main}`,marginBottom:"10px","& button":{width:"100%",display:"flex",justifyContent:"space-between",alignItems:"center"},"& $titleAchievement":{fontSize:e.typography.fontSizeDefault,fontWeight:e.typography.fontWeightSemiBold},"& $paragraph":{margin:0,fontWeight:e.typography.fontWeightLight},"& $label":{margin:"5px",whiteSpace:"nowrap",fontWeight:e.typography.fontWeightSemiBold},"& $descriptionAchievement":{wordBreak:"break-word",marginRight:"5px",textAlign:"left"}}),p=e=>({"& $titleCriterion$titleCriterion":{margin:0,fontSize:e.typography.fontSizeMedium,fontWeight:e.typography.fontWeightSemiBold,wordBreak:"break-word"},"& $percentageCriterion":{margin:0,fontSize:e.typography.fontSizeSmall,color:e.palette.text.secondary}}),m={paddingLeft:0,margin:0,"& li":{listStyleType:"none"},"& .bb-AccordionTab-Icon-Button-Class":{flexShrink:0}},b=e=>Object(c.e)({styles:{"& $header":{[e.breakpoints.up("sm")]:{"& .ms-Panel-commands":{backgroundColor:e.palette.common.white}},"& .ms-Panel-header":{boxShadow:"none",[e.breakpoints.up("sm")]:{alignItems:"flex-end",minHeight:0,"& .header-actions":{margin:0,flex:0}},"& .ms-Panel-titles-container":{maxWidth:"100%",[e.breakpoints.up("sm")]:{position:"static"},"& .ms-Panel-subTitle":{display:"block",...l().styles},"& .ms-Panel-headerText":{...l().styles,textAlign:"center",[e.breakpoints.up("sm")]:{fontSize:e.typography.fontSizeXXLarge,fontFamily:e.typography.fontFamilySerif,color:e.palette.text.primary,textAlign:"initial"}}}}},"& $body":{paddingBottom:"0 !important",paddingTop:0}}}),h=e=>({marginTop:"24px",marginBottom:"3px",height:"62px",backgroundColor:e.palette.background.b2,display:"flex",justifyContent:"space-between",border:`1px solid ${e.palette.border.main}`,"& $description":{display:"flex",alignItems:"center"},"& $icon":{margin:"0 10px"}}),g=()=>({"& .green":{backgroundColor:o.d.green},"& .yellowgreen":{backgroundColor:o.d.yellowGreen},"& .yellow":{backgroundColor:o.d.yellow},"& .orange":{backgroundColor:o.d.brightOrange},"& .red":{backgroundColor:o.d.red},"& .color-disabled":{backgroundColor:o.c.black,color:o.c.white}}),v=Object(c.l)((e=>Object(c.e)({criterionOverview:{cursor:"pointer",paddingTop:"16px",paddingBottom:"8px",...p(e)},titleCriterion:{},percentageCriterion:{}})));var S=a("nsO7"),x=a("zGdY"),y=a("ZQFV");const E=r.createContext({}),f=(e,t)=>{if("number"==typeof e)return e/t*100},I=(e,t,a,r,i,n)=>{let s=0;switch(r){case x.Zb.PERCENTAGE:s=a*i/100;break;case x.Zb.POINTS:s=i;break;case x.Zb.PERCENTAGE_RANGE:s=a*i/100,t.score=s*n/100,t.rangeScoreValue=n;break;case x.Zb.POINTS_RANGE:s=i,t.score=n,t.rangeScoreValue=n}e.scoreValue=t.score,t.colorPercentage=f(e.scoreValue,s),e.colorPercentage=t.colorPercentage},k=(e,t,a)=>e.map((e=>(e.achievements.map((r=>(r.isSelected&&I(e,r,t,a,e.value,r.rangeScoreValue),r))),e))),C=(e,t)=>""!==e?f(Number(e),t):void 0,O=e=>{e.scoreValue=null,e.colorPercentage=null,e.achievements.map((e=>(e.isSelected=!1,"number"==typeof e.colorPercentage&&delete e.colorPercentage,e.rangeScore&&(e.score=null,e.rangeScoreValue=null),e)))},w=e=>e===x.Zb.POINTS||e===x.Zb.POINTS_RANGE,F=e=>{const t=Object(S.cloneDeep)(e);return t.forEach((e=>{O(e),e.feedback="",e.hasUnsavedFeedback=!1,e.lastFeedbackSaveDate=void 0,e.lastSaveFailed=!1})),t},D=(e,t)=>{const a=Object(S.cloneDeep)(t);return e.forEach((e=>{const t=a.rubricCriteria.find((t=>t.id===e.id));t.lastFeedbackSaveDate=e.lastFeedbackSaveDate,t.hasUnsavedFeedback=!1})),a},N=e=>{const t=Object(S.cloneDeep)(e);t.criteria=[];const a=e.criteria.filter((e=>(e.scoreValue||0===e.scoreValue)&&e.hasUnsavedFeedback)),r=e.criteria.filter((e=>(e.scoreValue||0===e.scoreValue)&&!e.hasUnsavedFeedback));return a.length>0&&(t.criteria=[...a,...r]),t},j=(e,t,a)=>{if(e.hasMultipleAttempts)return e;const r=Object(S.cloneDeep)(e);return r.studentGrade=t,r.gradePercentageColor=C(t,a),r},R=e=>Object(S.isNumber)(e)&&Object(S.isFinite)(e)?e:Object(S.toNumber)(e),P=(e,t)=>0===t?100:e/t*100,T=e=>{if(!e.criteria)return!1;return e.criteria.filter((e=>null!=e.scoreValue)).length===e.criteria.length},A=()=>!window.navigator.onLine,V=(e,t=!0)=>{var a;let r=e;return t&&(r=(e=>{const{criteria:t,maxScore:a,grade:r,rubricType:i}=e;return{...e,gradeColorPercentage:C(r,a),criteria:t?k(t,a,i):[]}})(e)),{rubricCriteria:null!==(a=r.criteria)&&void 0!==a?a:[],studentGrade:r.grade,gradePercentageColor:r.gradeColorPercentage,rubricMaxScore:r.maxScore,gradeIsOverridden:r.isGradeOverridden,gradeIsAnonymous:r.isAnonymousGrading,hasMultipleAttempts:r.isMultipleAttempts,rubricIsEditable:r.isEditable,isStudent:r.isStudent,canOverride:r.isOverrideAvailable,isGroupGradeMultiple:r.isGroupGradeMultiple,isGradingInProgress:r.isGradingInProgress,rubricIsFullyGraded:T(r),okConfirmationClicked:r.okConfirmationClicked,confirmationHandledForCriterionId:r.confirmationHandledForCriterionId,decimalsLength:r.decimalsLength,isSavingRubric:r.isSavingRubric,rubricType:r.rubricType,onGradeInputUpdate:r.onGradeInputUpdate}},G=e=>({criteria:e.rubricCriteria,isEditable:e.rubricIsEditable,grade:e.studentGrade,isGradeOverridden:e.gradeIsOverridden,isMultipleAttempts:e.hasMultipleAttempts,isGroupGradeMultiple:e.isGroupGradeMultiple,isGradingInProgress:e.isGradingInProgress,isAnonymousGrading:e.gradeIsAnonymous,rubricType:e.rubricType,onGradeInputUpdate:e.onGradeInputUpdate}),M=e=>{const t=Object(S.omitBy)(V(e,!1),S.isNil);return Object(S.omitBy)(t,(e=>Object(S.isArray)(e)&&Object(S.isEmpty)(e)))},L=(e,t)=>{const a=Object(S.cloneDeep)(e);return a.criteria.forEach((e=>{e.lastSaveFailed=t})),a},B=(e,t,a)=>{const r=Object(S.cloneDeep)(t),i=r.rubricCriteria.find((e=>e.id===a));return i.feedback=e,i.hasUnsavedFeedback=!0,r},U=(e,t)=>{const a=Object(S.cloneDeep)(t),r=a.rubricCriteria.find((t=>t.id===e));return r.feedback=null,r.hasUnsavedFeedback=!1,a},$=e=>{const t=y.P.sumFloatValues(e.map((e=>{var t;return null===(t=e.achievements.find((({isSelected:e})=>e)))||void 0===t?void 0:t.score})).filter((e=>void 0!==e)));return"number"==typeof t?(e=>{const t=Math.trunc(e),a=Math.floor(Math.log(t)*Math.LOG10E+1);return a<=3?Object(S.floor)(e,2):4===a?Object(S.floor)(e,1):Object(S.floor)(e)})(t):""},z=e=>0!==e.filter((e=>null!=e.scoreValue)).length,W=e=>{const t=Object(S.cloneDeep)(e);return t.studentGrade="",t.gradeIsOverridden=!1,z(t.rubricCriteria)&&(t.rubricCriteria=F(t.rubricCriteria)),t},H=e=>{const t=(e,t,a,r,i,n,s)=>{const c=Object(S.cloneDeep)(e),o=c.find((e=>e.id===a));return O(o),((e,t,a,r,i,n)=>{const s=e.achievements.find((e=>e.id===a));s.isSelected=!0,I(e,s,t,r,i,n)})(o,t,r,i,n,s),c};return a=>{const i={calculateCompletion:f,updateCriteria:t};return r.createElement(E.Consumer,null,(t=>r.createElement(e,{...a,...t,...i})))}},K=Object(n.withAnalytics)(Object(s.a)((({analyticsId:e,analyticsEventAugmentor:t,criterionId:a,title:i,value:s,decimalsLength:c,rubricType:o,rubricMaxScore:l,maxScore:d,localize:{translate:u,formatNumber:p},onClick:m})=>{const b=p(s,{maximumFractionDigits:c}),h=p(P(s,l||d),{maximumFractionDigits:c}),g=v(),S=`${e}.criterionOverview.button`,x=t(n.AnalyticsEventTypes.CLICK_EVENT,m,S);return r.createElement("div",{className:g.criterionOverview,"data-analytics-id":S,onClick:x},r.createElement("h2",{className:g.titleCriterion,id:a},i),r.createElement("p",{className:g.percentageCriterion},!w(o)&&u("rubrics.criterion.percentage",{percentage:b}),w(o)&&u("rubrics.criterion.possiblePoints",{points:b,percentage:h})))})));var _=a("7O4Y");const Z=Object(c.l)((e=>Object(c.e)({criterionAchievement:{...u(e)},titleAchievement:{},paragraph:{},label:{},descriptionAchievement:{},scoreAchievement:{height:"30px",minWidth:"50px",...d(e).gradePill},scoreIsRange:{minWidth:"80px"}}))),q=Object(s.a)((({title:e,description:t,score:a,rangeScore:i,decimalsLength:n,rubricType:s,localize:{translate:c,formatNumber:o,parseNumber:l}})=>{const d=Z(),u=null!=a,p=w(s)?"rubrics.criterion.pointsRangeScore":"rubrics.criterion.percentageRangeScore",m=u?o(a,{maximumFractionDigits:n}):c(p,{minValue:l(o(i.minValue,{maximumFractionDigits:n})),maxValue:l(o(i.maxValue,{maximumFractionDigits:n}))});return r.createElement("div",{className:d.criterionAchievement},r.createElement("button",{"aria-label":`${e} ${m}`,tabIndex:0},r.createElement("div",{className:d.descriptionAchievement},r.createElement("span",{className:d.titleAchievement},e),r.createElement("p",{className:d.paragraph},t)),r.createElement("div",{className:Object(_.a)("js-rubric-view-achievement-score",d.scoreAchievement,{[d.scoreIsRange]:!u})},r.createElement("div",{className:d.label},m))))})),J=Object(c.l)((()=>Object(c.e)({criterionContent:{margin:"12px 0"}}))),X=({achievements:e,decimalsLength:t,rubricType:a})=>{const i=J();return r.createElement("div",{className:i.criterionContent},e.map((e=>r.createElement("div",{key:e.id},(e=>r.createElement(q,{title:e.title,description:e.description,score:e.score,rangeScore:e.rangeScore,decimalsLength:t,rubricType:a}))(e)))))};class Q extends r.Component{constructor(e){super(e),this.onToggleCallBack=()=>{const{shouldOpenAccordion:e}=this.state;this.setState({shouldOpenAccordion:!e})},this.state={shouldOpenAccordion:!1}}render(){const{title:e,value:t,achievements:a,analyticsId:n,decimalsLength:s,rubricType:c,maxScore:o,criterionId:l}=this.props,{shouldOpenAccordion:d}=this.state,u=`${n}.accordionTab`,p=`criterion${l}`;return r.createElement(i.AccordionTab,{showExpander:!0,expanded:d,ariaLabelledby:p,contents:r.createElement(X,{achievements:a,decimalsLength:s,rubricType:c}),analyticsId:u,title:r.createElement(K,{criterionId:p,analyticsId:u,title:e,value:t,onClick:this.onToggleCallBack,rubricType:c,decimalsLength:s,maxScore:o})})}}const Y=Object(c.l)((()=>Object(c.e)({rubricViewRubric:{...m}}))),ee=({analyticsId:e,criteria:t,isUsingAnalyticContext:a,decimalsLength:i,rubricType:n,maxScore:s})=>{const c=Y(),o=a?`${e}.rubricView`:`${e}.rubrics.components.rubricView`;return r.createElement("ul",{className:c.rubricViewRubric},t.map((e=>r.createElement(Q,{key:e.id,title:e.title,value:e.value,achievements:e.achievements,decimalsLength:i,analyticsId:o,rubricType:n,maxScore:s,criterionId:e.id}))))},te=Object(c.l)((e=>Object(c.e)({rubricViewScore:{...h(e)},description:{},icon:{},maximumScore:{fontWeight:e.typography.fontWeightBold},points:{padding:"0 15px",borderLeft:`1px solid ${e.palette.border.main}`,display:"flex",alignItems:"center"}})));var ae=a("Gvux");const re=({iconName:e})=>{let t=ae.DocumentBlank;switch(e){case"assignment":t=ae.Assignments;break;case"attendance":t=ae.Attendance;break;case"audio":t=ae.Audio;break;case"blog":t=ae.Blog;break;case"calculation":t=ae.Calculation;break;case"discussion":t=ae.Discussion;break;case"document-blank":t=ae.DocumentBlank;break;case"document-text":t=ae.DocumentText;break;case"folder":case"folder-open":t=ae.Folder;break;case"homework":t=ae.Homework;break;case"journal":t=ae.Journal;break;case"learning-module":t=ae.LearningModule;break;case"link":t=ae.Link;break;case"lti":t=ae.Lti;break;case"overall-grade":t=ae.OverallGrade;break;case"pdf":t=ae.Pdf;break;case"photo":t=ae.Photo;break;case"presentation":t=ae.Presentation;break;case"scormengine":t=ae.Scormengine;break;case"spreadsheet":t=ae.Spreadsheet;break;case"survey":t=ae.Survey;break;case"test":case"quiz":case"exam":t=ae.Test;break;case"textbook":t=ae.Textbook;break;case"video":t=ae.Video;break;case"zip":t=ae.Zip}return r.createElement(t,{color:"primary"})},ie=Object(s.a)((({maxScore:e,contentIconName:t,shouldShowIcon:a,localize:{translate:i,formatNumber:n}})=>{const s=te(),c=i("rubrics.score.maxScoreLabel"),o=i("rubrics.score.maxScorePoints",{maxScore:n(e)});return r.createElement("div",{className:s.rubricViewScore},r.createElement("div",{className:s.description},r.createElement("span",{className:s.icon},a&&r.createElement(re,{iconName:t})),r.createElement("span",{className:s.maximumScore},c)),r.createElement("div",{className:s.points},r.createElement("span",{className:"js-rubric-view-score-value"},o)))}));var ne=a("Zwiy");const se=Object(c.l)((e=>Object(c.e)({rubricViewPanel:{...b(e).styles},header:{},body:{}}))),ce=Object(s.a)((({analyticsId:e,smallTitle:t,contentIconName:a,maxScore:i,criteria:n,decimalsLength:s,rubricType:o,localize:{translate:l},hideNavMenu:d})=>{const u=se(),p=`${e}.rubrics.components.rubricViewPanel`,m=Object(c.s)(Object(c.t)().breakpoints.down("xs"));return r.createElement("div",{className:Object(_.a)("panel-wrap",u.rubricViewPanel)},r.createElement("div",{className:Object(_.a)("panel-header","simple-header",u.header)},r.createElement(ne.BbPanelHeader,{analyticsId:`${p}.header`,title:l("rubrics.title"),smallHeaderTitle:m?void 0:t,type:ne.BbPanelType.full,hideNavMenu:!!d,navMenuAriaLabel:l("global.navigationMenu")})),r.createElement("div",{className:Object(_.a)("panel-body","panel-content",u.body)},r.createElement(ie,{contentIconName:a,maxScore:i,shouldShowIcon:!0}),r.createElement(ee,{isUsingAnalyticContext:!0,analyticsId:p,criteria:n,decimalsLength:s,maxScore:i,rubricType:o})))})),oe=Object(c.l)((e=>Object(c.e)({evaluationCriterionOverview:{cursor:"pointer",paddingTop:"16px",paddingBottom:"8px",display:"flex",justifyContent:"space-between",alignItems:"center",...p(e),...g()},titleCriterion:{},percentageCriterion:{},description:{display:"flex",flexDirection:"column",alignItems:"flex-start",marginRight:"5px"},pill:{height:"25px",minWidth:"50px",...d(e).gradePill},pillLabel:{margin:"5px",fontWeight:e.typography.fontWeightSemiBold},pillAndFeedback:{display:"inline-flex",alignItems:"center",justifyContent:"flex-end"},feedbackIcon:{height:"16px",marginLeft:"11px"}})));var le=a("0x+l");const de=H(Object(n.withAnalytics)(Object(s.a)((({analyticsId:e,analyticsEventAugmentor:t,title:a,feedback:i,value:s,scoreValue:c,colorPercentage:l,isStudent:d,gradingPillColor:u,decimalsLength:p,rubricType:m,rubricMaxScore:b,onClick:h,localize:{translate:g,formatNumber:v},criterionId:S})=>{const x=c||0===c,y=v(s,{maximumFractionDigits:p}),E=v(P(s,b),{maximumFractionDigits:p}),f=!d||i&&""!==i,I=oe(),k=`${e}.criterionOverview.button`,C=t(n.AnalyticsEventTypes.CLICK_EVENT,h,k);return r.createElement("div",{"data-analytics-id":k,onClick:C,className:I.evaluationCriterionOverview},r.createElement("div",{className:I.description},r.createElement("h2",{className:I.titleCriterion,id:S},a),r.createElement("p",{className:I.percentageCriterion},!w(m)&&g("rubrics.criterion.percentage",{percentage:y}),w(m)&&g("rubrics.criterion.possiblePoints",{points:y,percentage:E}))),r.createElement("div",{className:I.pillAndFeedback},r.createElement("div",{className:Object(_.a)("js-rubric-evaluation-criterion-score",I.pill,x&&void 0!==u?u(l):"")},r.createElement("span",{className:I.pillLabel},x?v(c,{round:"truncate",maximumFractionDigits:p}):"-")),f&&r.createElement("div",{className:I.feedbackIcon},i&&""!==i?r.createElement(le.Feedback,{htmlColor:o.c.purpleDark}):d?"":r.createElement(le.AddFeedback,{color:"primary"}))))})))),ue=Object(c.l)((e=>Object(c.e)({achievement:{cursor:"pointer",...u(e),...g(),"& .color-disabled":{backgroundColor:o.c.white}},achievementSelected:{backgroundColor:e.palette.background.b9},titleAchievement:{},paragraph:{},label:{},descriptionAchievement:{},descriptionSelected:{color:e.palette.primary.contrastText},scoreAchievement:{height:"30px",minWidth:"50px",...d(e).gradePill},scoreIsRange:{minWidth:"80px"},scoreContainer:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"}}))),pe=H(Object(s.a)((({rangeScoreValue:e,score:t,rangeScore:a,rubricType:i,title:n,isSelected:s,description:c,colorPercentage:o,gradingPillColor:l,children:d,localize:{translate:u,formatNumber:p}})=>{const m=ue();return r.createElement("div",{className:Object(_.a)("js-rubric-evaluation-achievement",m.achievement,{[m.achievementSelected]:s})},r.createElement("button",{"aria-label":n,tabIndex:0},r.createElement("div",{className:Object(_.a)(m.descriptionAchievement,{[m.descriptionSelected]:s})},r.createElement("span",{className:m.titleAchievement},n),r.createElement("p",{className:m.paragraph},c)),r.createElement("div",{className:Object(_.a)("js-rubric-evaluation-achievement-score",m.scoreContainer)},d||r.createElement("div",{className:Object(_.a)(m.scoreAchievement,void 0!==l&&null!=o?l(o):"",{[m.scoreIsRange]:a})},r.createElement("div",{className:m.label},(()=>{const r=w(i)?"rubrics.criterion.pointsRangeScore":"rubrics.criterion.percentageRangeScore";return null!=e||null!=t?p(null!=e?e:t):u(r,{minValue:a.minValue,maxValue:a.maxValue})})())))))})));class me extends r.Component{constructor(e){super(e),this.handleChange=e=>{let t;const{onChange:a,allowDecimals:r,localize:{parseNumber:i}}=this.props,n=new RegExp("^(\\d{0,5}(\\.\\d{0,2})?)$"),s=new RegExp("^(\\d{0,5})$"),c=r?n:s,o=e.target.value;let l=o;if(""!==o&&(t=r?i(o):Object(S.toInteger)(i(o)),l=Object(S.toString)(i(o))),this.setState({inputValue:o,grade:t}),!c.test(l))return this.setState({hasError:!0}),void this.handleError();this.setState({hasError:!1}),a&&a(t)},this.handleKeyDown=e=>{13===e.keyCode&&(e.preventDefault(),this.submit())},this.handleBlur=()=>{this.submit()},this.submit=()=>{const{grade:e,inputValue:t}=this.state,{onSubmit:a,allowEmptyValue:r}=this.props;(""!==t||r)&&(this.isValidInput()?a(e):this.handleError())};const{initialValue:t}=e;this.state={inputValue:(null!=t?t:"").toString(),grade:this.parseInitialValue(t),hasError:!1}}componentDidMount(){this.inputRef.focus()}parseInitialValue(e){const{localize:{parseNumber:t}}=this.props;if(Object(S.isString)(e)){const a=t(e);if(Object(S.isFinite)(a))return a}return e}inputSize(e){const{isExpandable:t}=this.props;return t?0===e?1:e>8?8:e:5}isValidInput(){const{grade:e,inputValue:t,hasError:a}=this.state,{minValue:r=0,maxValue:i,allowEmptyValue:n}=this.props;return!a&&(!(!n||e||""!==t)||(i?r<=e&&e<=i:r<=e))}handleError(){const{onError:e}=this.props;e&&e()}render(){const{inputValue:e}=this.state,{analyticsId:t,analyticsEventAugmentor:a,ariaLabel:i,onClick:s,classes:{pillInput:c}}=this.props,o=`${t}.input.text`,l=a(n.AnalyticsEventTypes.CLICK_EVENT,s||n.defaultOnClick,o),d=a(n.AnalyticsEventTypes.CLICK_EVENT,this.handleKeyDown||n.defaultOnClick,o),u=a(n.AnalyticsEventTypes.CLICK_EVENT,this.handleBlur||n.defaultOnClick,o);return r.createElement("input",{tabIndex:0,"data-analytics-id":o,className:c,value:e,placeholder:"--",ref:e=>this.inputRef=e,onChange:this.handleChange,onKeyDown:d,onBlur:u,onClick:l,size:this.inputSize(e.length),"aria-label":i})}}const be=Object(n.withAnalytics)(Object(s.a)(Object(c.u)((e=>Object(c.e)({pillInput:{textAlign:"center",border:"none",fontWeight:e.typography.fontWeightSemiBold,boxSizing:"border-box",lineHeight:1.2,backgroundColor:"inherit","&:focus":{outline:"none",boxShadow:"none"}}})),{name:"GradingInput"})(me)));class he extends r.Component{constructor(e){super(e),this.handleClick=e=>{e.preventDefault(),this.select()},this.handleKeyDown=e=>{32===e.keyCode&&(e.preventDefault(),this.select())},this.handleGradingInputError=()=>{this.setState({hasError:!0})},this.handleGradingInputChange=e=>{const{rangeScore:{minValue:t,maxValue:a}}=this.props;e||0===e?e<t||e>a?this.setState({hasError:!0}):e>=t&&e<=a&&this.setState({hasError:!1}):this.setState({hasError:!1})},this.updateRangeGrade=e=>{const{rangeScoreValue:t,reserveInput:a}=this.props;if(a(null),t===e)return void this.setState({showInput:!1});const{updateCriteria:r,criterionId:i,achievementId:n,criterionPercentage:s,updateRubric:c,rubricCriteria:o,rubricMaxScore:l,rubricType:d,calculateCompletion:u,hasUnsavedFeedback:p}=this.props,m=r(o,l,i,n,d,s,e),b=$(m),h=u(b,l);this.setState({showInput:!1},(()=>{c({grade:b,gradeColorPercentage:h,rubricGrade:b,rubricType:d,criteria:m,criterionFeedbackWasUpdated:p})}))},this.state={showInput:!1,hasError:!1}}componentDidUpdate(e){const{achievementId:t,achievementIdUnderEdit:a}=this.props;e.achievementId===e.achievementIdUnderEdit&&t!==a&&this.setState({hasError:!1})}select(){const{achievementId:e,reserveInput:t}=this.props;t(e),this.setState({showInput:!0})}gradingInputCanBeDisplayed(){const{showInput:e}=this.state,{achievementId:t,achievementIdUnderEdit:a}=this.props;return e&&t===a}isActiveOrSelected(){const{achievementId:e,achievementIdUnderEdit:t,isSelected:a}=this.props;return e===t||a&&null==t}render(){const{hasError:e}=this.state,{analyticsId:t,analyticsEventAugmentor:a,rangeScore:i,title:s,description:c,rangeScoreValue:o,colorPercentage:l,localize:{translate:d},classes:{pill:u,pillSelected:p,pillError:m,rangeLabel:b,error:h,errorLabel:g}}=this.props,v=`${t}.range`,S=a(n.AnalyticsEventTypes.CLICK_EVENT,this.handleClick,v),x=a(n.AnalyticsEventTypes.CLICK_EVENT,this.handleKeyDown,v);return r.createElement(r.Fragment,null,r.createElement("div",{onClick:S,onKeyDown:x},r.createElement(pe,{rangeScore:i,title:s,isSelected:this.isActiveOrSelected(),rangeScoreValue:o,description:c,colorPercentage:l},this.gradingInputCanBeDisplayed()&&r.createElement(r.Fragment,null,r.createElement("div",{id:"rubric-evaluation-editable-achievement-range-pill",className:Object(_.a)(u,{[p]:this.isActiveOrSelected()},{[m]:this.gradingInputCanBeDisplayed()&&e})},r.createElement(be,{ariaLabel:d("rubrics.criterion.inputRange"),analyticsId:v,initialValue:o,minValue:i.minValue,maxValue:i.maxValue,onSubmit:this.updateRangeGrade,onError:this.handleGradingInputError,onChange:this.handleGradingInputChange,allowDecimals:w(this.props.rubricType)})),r.createElement("span",{id:"rubric-evaluation-editable-achievement-range-label",className:b},d("rubrics.criterion.rangeScoreLabel",{minValue:i.minValue,maxValue:i.maxValue}))))),e&&this.gradingInputCanBeDisplayed()&&r.createElement("div",{id:"rubric-evaluation-editable-achievement-range-error",className:h},r.createElement(le.Attention,{color:"inherit"}),r.createElement("span",{className:g},d("rubrics.criterion.valueOutOfRange",{minValue:i.minValue,maxValue:i.maxValue}))))}}const ge=H(Object(n.withAnalytics)(Object(s.a)(Object(c.u)((e=>Object(c.e)({rangeLabel:{color:e.palette.primary.contrastText},error:{margin:"-3px 0 5px 11px",display:"flex",justifyContent:"flex-start",alignItems:"center",color:e.palette.error.main},errorLabel:{paddingLeft:"4px",fontSize:e.typography.fontSizeSmall},pill:{height:"30px",minWidth:"80px",padding:"0 10px",...d(e).gradePill},pillError:{border:`1px solid ${e.palette.border.main}`,boxShadow:`inset 0 0 0 1px ${e.palette.error.main}, inset 0 0 0 4px ${c.d.fade(e.palette.error.main,.1)}`},pillSelected:{background:e.palette.background.b1}})),{name:"EditableRangeAchievement"})(he)))),ve=H(Object(s.a)(Object(n.withAnalytics)((({analyticsId:e,analyticsEventAugmentor:t,score:a,rangeScore:i,title:s,isSelected:c,rangeScoreValue:o,description:l,criterionPercentage:d,criterionId:u,value:p,achievementId:m,achievementIdUnderEdit:b,reserveInput:h,updateCriteria:g,updateRubric:v,calculateCompletion:S,rubricCriteria:x,rubricMaxScore:y,rubricType:E,colorPercentage:f,hasUnsavedFeedback:I})=>{const k=()=>{const e=g(x,y,u,m,E,d),t=$(e),a=S(t,y);v({grade:t,gradeColorPercentage:a,rubricGrade:t,criteria:e,criterionFeedbackWasUpdated:I})},C=`${e}.percentage`,O=t(n.AnalyticsEventTypes.CLICK_EVENT,(e=>{e.preventDefault(),k()}),C),w=t(n.AnalyticsEventTypes.CLICK_EVENT,(e=>{32===e.keyCode&&(e.preventDefault(),k())}),C);return r.createElement(r.Fragment,null,i?r.createElement(ge,{analyticsId:C,rangeScore:i,criterionPercentage:d,value:p,title:s,isSelected:c,colorPercentage:f,rangeScoreValue:o,description:l,criterionId:u,hasUnsavedFeedback:I,achievementId:m,achievementIdUnderEdit:b,reserveInput:h}):r.createElement("div",{onClick:O,onKeyDown:w},r.createElement(pe,{score:a,title:s,isSelected:c,rangeScoreValue:o,description:l,colorPercentage:f})))}))));class Se extends r.Component{constructor(e){super(e),this.reserveInput=e=>{e?this.setState({achievementIdUnderEdit:e}):this.setState({achievementIdUnderEdit:null})},this.state={achievementIdUnderEdit:null}}render(){const{achievementIdUnderEdit:e}=this.state,{analyticsId:t,achievements:a,criterionPercentage:i,criterionId:n,classes:s,hasMultipleAttempts:c,rubricIsEditable:o,gradeIsOverridden:l,hasUnsavedFeedback:d,decimalsLength:u,localize:{formatNumber:p,parseNumber:m}}=this.props,b=`${t}.achievement`,h=e=>e?{minValue:m(p(e.minValue,{maximumFractionDigits:u})),maxValue:m(p(e.maxValue,{maximumFractionDigits:u}))}:e,g=e=>e?m(p(e,{maximumFractionDigits:u})):e,v=e=>e?m(p(e,{maximumFractionDigits:u})):e,S=t=>r.createElement(ve,{analyticsId:b,score:v(t.score),rangeScoreValue:g(t.rangeScoreValue),rangeScore:h(t.rangeScore),title:t.title,isSelected:t.isSelected,description:t.description,criterionPercentage:i,criterionId:n,hasUnsavedFeedback:d,value:t.value,achievementId:t.id,colorPercentage:t.colorPercentage,achievementIdUnderEdit:e,reserveInput:this.reserveInput});return r.createElement("div",{className:s.evaluationCriterionAchievement},a.map((e=>r.createElement("div",{key:e.id},!o||l&&!c?(e=>r.createElement(pe,{score:v(e.score),rangeScoreValue:g(e.rangeScoreValue),rangeScore:h(e.rangeScore),title:e.title,isSelected:e.isSelected,description:e.description,colorPercentage:e.colorPercentage}))(e):S(e)))))}}const xe=H(Object(s.a)(Object(c.u)((()=>Object(c.e)({evaluationCriterionAchievement:{margin:"12px 0"}})),{name:"CriterionAchievement"})(Se)));var ye=a("ERsv"),Ee=a("ml91"),fe=a("np6O"),Ie=a("tN4z"),ke=a("jZnR");var Ce=a("n7/H");class Oe extends r.Component{constructor(e){super(e),this.MemoizedBbEditor=r.memo((({autoSaveMilliseconds:e,bbml:t,isReadOnly:a,placeholder:i,autoSaveCallback:n,onBlur:s,onChange:c,isDisabled:o,ariaLabelledBy:l})=>r.createElement(ye.BbEditor,{bbml:t,onChange:c,autoSaveCallback:n,autoSaveMilliseconds:e,isReadOnly:a,placeholder:i,onBlur:s,isDisabled:o,disablePasteFormat:!0,isToolbarHidden:!0,ariaLabelledBy:l})),((e,t)=>{const a=e.isReadOnly!==t.isReadOnly,r=(""===t.studentGrade||null==t.studentGrade)&&""===t.bbml,i=e.isDisabled!==t.isDisabled;return!(a||r||i)})),this.saveFeedback=()=>{const{updateRubric:e,rubricCriteria:t,studentGrade:a,rubricType:r}=this.props;e({grade:a,rubricGrade:a,criterionFeedbackWasUpdated:!0,criteria:t,rubricType:r})},this.bbmlOnBlur=()=>{const{currentFeedback:e,lastFeedbackSaved:t}=this.state;e!==t&&(this.saveFeedback(),this.setState({lastFeedbackSaved:e}))},this.bbmlOnAutoSave=()=>{const{lastFeedbackSaved:e,currentFeedback:t}=this.state;t!==e&&(this.saveFeedback(),this.setState({lastFeedbackSaved:t}))},this.bbmlOnChange=e=>{const t=e.toBbML(),{updateFeedback:a,criterionId:r,feedback:i}=this.props;this.setState({currentFeedback:t}),i!==t&&a(t,r)},this.getBbmlStyleClass=()=>{const{feedback:e,rubricIsEditable:t,classes:a,lastSaveFailed:r}=this.props,{wasPencilSelected:i,currentFeedback:n}=this.state;return!e||i||n?t&&r?`${a.bbmlEditable} ${a.bbmlSmallMargin}`:t&&!r?`${a.bbmlEditable} ${a.bbmlLargeMargin}`:"":a.bbmlReadOnly},this.getPencilStyleClass=()=>{const{classes:e}=this.props;return this.shouldShowSavingMessage()?"":e.titleLargeMargin},this.getTitleStyleClass=()=>{const{classes:e}=this.props;return this.shouldShowSavingMessage()?`${e.feedbackTitle} ${e.titleSmallMargin}`:`${e.feedbackTitle} ${e.titleLargeMargin}`},this.getHeaderStyleClass=()=>{const{classes:e}=this.props;return this.shouldShowSavingMessage()?`${e.feedbackHeader} ${e.feedbackHeaderSmallHeight}`:`${e.feedbackHeader} ${e.feedbackHeaderLargeHeight}`},this.getBbmlText=()=>{const{feedback:e}=this.props;return e||""},this.isBbmlReadOnly=()=>{const{feedback:e}=this.props,{wasPencilSelected:t,currentFeedback:a}=this.state;return!(!e||t||a)},this.isBbmlDisabled=()=>{const{gradeIsOverridden:e,rubricIsEditable:t}=this.props;return!(!e||!t)},this.shouldShowPencil=()=>{const{feedback:e,rubricIsEditable:t,gradeIsOverridden:a}=this.props,{wasPencilSelected:r,currentFeedback:i}=this.state;return!(!t||!e||r||i||a)},this.shouldShowSavingMessage=()=>{const{currentlySavingFeedback:e,lastFeedbackSaveDate:t,hasUnsavedFeedback:a,rubricIsEditable:r}=this.props;return r&&(e&&a||t)},this.setBbmlEditMode=()=>{this.setState({wasPencilSelected:!0,shouldFocusBbml:!0})},this.getSavingMessage=()=>{const{localize:{translate:e,formatTime:t},lastFeedbackSaveDate:a}=this.props;if(a){return e("rubrics.criterion.savedMessage",{time:t(a,Ce.ILocaleTimeFormat.Short)})}return e("rubrics.criterion.savingMessage")},this.state={wasPencilSelected:!1,shouldFocusBbml:!1,lastFeedbackSaved:null,currentFeedback:null},this.editorReference=r.createRef()}componentDidUpdate(e,t){const{shouldFocusBbml:a}=this.state;if(a&&a!==t.shouldFocusBbml){const e=this.editorReference.current.getElementsByClassName("bb-editor")[0];e&&e.focus(),this.setState({shouldFocusBbml:!1})}}render(){const{rubricIsEditable:e,feedback:t,localize:{translate:a},analyticsId:i,classes:n,studentGrade:s,lastSaveFailed:c,showLoader:o,criterionId:l}=this.props,d=`rubrics-criterion${l}-feedback-title`;return r.createElement(r.Fragment,null,(e||t)&&r.createElement(r.Fragment,null,r.createElement("div",{className:this.getHeaderStyleClass()},r.createElement("h3",{id:d,className:this.getTitleStyleClass()},a("rubrics.criterion.feedbackTitle")),this.shouldShowPencil()&&r.createElement(fe.AnalyticsIconButton,{onClick:this.setBbmlEditMode,"aria-label":a("rubrics.criterion.pencilAriaLabel"),analyticsId:`${i}.feedback.edit`,className:this.getPencilStyleClass()},r.createElement(Ee.a,{color:"primary","aria-hidden":"true"}))),this.shouldShowSavingMessage()&&r.createElement("h4",{className:Object(_.a)("js-feedback-time",n.savingMessage)},this.getSavingMessage()),o&&r.createElement(Ie.AnalyticsCircularProgress,{ariaLabel:a("rubrics.criterion.loadingAriaLabel"),size:"small",id:"rubrics-criterion-feedback-loader"}),r.createElement("div",{className:this.getBbmlStyleClass(),ref:this.editorReference},r.createElement(this.MemoizedBbEditor,{bbml:this.getBbmlText(),studentGrade:s,onChange:this.bbmlOnChange,autoSaveCallback:this.bbmlOnAutoSave,autoSaveMilliseconds:5e3,isReadOnly:this.isBbmlReadOnly(),placeholder:a("rubrics.criterion.feedbackPlaceHolder"),onBlur:this.bbmlOnBlur,isDisabled:this.isBbmlDisabled(),ariaLabelledBy:d})),c&&r.createElement("p",{className:n.errorMessage},a("rubrics.criterion.connectionMessage"))))}}const we=Object(s.a)(H(Object(c.u)((e=>Object(ke.a)({bbmlEditable:{"& .bb-editor-root":{"& .ql-container":{boxShadow:"none",borderTop:`1px solid ${e.palette.border.dark}`,borderColor:e.palette.border.dark,"& .ql-editor":{height:"132px"}},"& .has-focus":{boxShadow:"none",borderTop:`1px solid ${e.palette.focus.light}`,borderColor:e.palette.focus.light},"& .has-keyboard-focus":{boxShadow:"none",border:`2px solid ${e.palette.focus.light}`}}},bbmlSmallMargin:{marginBottom:"12px"},bbmlLargeMargin:{marginBottom:"20px"},bbmlReadOnly:{"& .bb-editor-root":{"& .ql-container":{"& .ql-editor":{padding:0,minHeight:"0px"}}},marginBottom:"26px"},titleSmallMargin:{marginBottom:"0"},titleLargeMargin:{marginBottom:"12px"},feedbackTitle:{fontSize:e.typography.fontSizeDefault,fontFamily:e.typography.fontFamily,fontWeight:e.typography.fontWeightSemiBold,marginTop:"2px"},savingMessage:{fontSize:e.typography.fontSizeSmall,color:e.palette.text.secondary,margin:"2px 0 12px 0"},feedbackHeader:{display:"flex",alignItems:"center",justifyContent:"space-between"},feedbackHeaderSmallHeight:{height:"21px"},feedbackHeaderLargeHeight:{height:"33px"},errorMessage:{fontSize:e.typography.fontSizeSmall,color:e.palette.error.main,marginBottom:"20px"}})))(Oe))),Fe=({feedback:e,criterionId:t,hasUnsavedFeedback:a,analyticsId:i,achievements:n,criterionPercentage:s,lastFeedbackSaveDate:c,lastSaveFailed:o,showLoader:l})=>{const d=`${i}.criterionContent`;return r.createElement("div",null,r.createElement(xe,{analyticsId:d,achievements:n,criterionPercentage:s,criterionId:t,hasUnsavedFeedback:a}),r.createElement(we,{feedback:e,lastSaveFailed:o,lastFeedbackSaveDate:c,criterionId:t,analyticsId:d,showLoader:l,hasUnsavedFeedback:a}))};class De extends r.Component{constructor(e){super(e),this.onToggleCallBack=()=>{const{showConfirmationModal:e,criterionId:t,hasUnsavedFeedback:a,scoreValue:r}=this.props;if(this.shouldShowConfirmationModal())return void e(t,!0);if(a&&"number"==typeof r)return void this.setState({showLoader:!0});const{shouldOpenAccordion:i}=this.state;this.setState({shouldOpenAccordion:!i})};const{isExpanded:t}=this.props;this.state={shouldOpenAccordion:t||!1,showLoader:!1}}componentDidUpdate(e){const{showLoader:t}=this.state,{isExpanded:a,studentGrade:r,okConfirmationClicked:i,criterionId:n,hasUnsavedFeedback:s,removeFeedbackOnCriterion:c,confirmationHandledForCriterionId:o,isSavingRubric:l}=this.props,{shouldOpenAccordion:d}=this.state,u=null==r||""===r,p=e.studentGrade!==r;u&&p&&d!==a&&this.setState({shouldOpenAccordion:a});const m=e.okConfirmationClicked!==i&&i,b=this.shouldShowConfirmationModal()&&o===n;if(m&&b){const{shouldOpenAccordion:e}=this.state;this.setState({shouldOpenAccordion:!e},(()=>{c(n)}))}t&&s!==e.hasUnsavedFeedback&&this.setState({showLoader:!1,shouldOpenAccordion:!1}),l!==e.isSavingRubric&&this.setState({showLoader:l})}shouldShowConfirmationModal(){const{scoreValue:e,hasUnsavedFeedback:t,feedback:a}=this.props;return"number"!=typeof e&&t&&!(""===a||null==a)}render(){const{showLoader:e}=this.state,{analyticsId:t,title:a,value:n,criterionId:s,scoreValue:c,colorPercentage:o,achievements:l,feedback:d,lastFeedbackSaveDate:u,lastSaveFailed:p,hasUnsavedFeedback:m}=this.props,{shouldOpenAccordion:b}=this.state,h=`${t}.criterion.accordionTab`,g=`criterion${s}`;return r.createElement(i.AccordionTab,{showExpander:!0,delegateToggleAction:!0,expanded:b,onToggle:this.onToggleCallBack,analyticsId:h,ariaLabelledby:g,contents:r.createElement(Fe,{analyticsId:t,feedback:d,lastSaveFailed:p,lastFeedbackSaveDate:u,achievements:l,criterionPercentage:n,criterionId:s,hasUnsavedFeedback:m,showLoader:e}),title:r.createElement(de,{criterionId:g,analyticsId:h,title:a,feedback:d,value:n,scoreValue:c,colorPercentage:o,onClick:this.onToggleCallBack})})}}const Ne=H(De),je=Object(c.l)((e=>Object(c.e)({rubricEvaluation:{...m},saveMessage:{marginTop:"12px",marginBottom:"4px",fontSize:e.typography.fontSizeSmall}}))),Re=Object(s.a)(H((({analyticsId:e,rubricCriteria:t,rubricIsEditable:a,localize:{translate:i}})=>{const n=je(),s=`${e}.rubricEvaluation.rubric`,c=e=>t.findIndex((t=>t.id===e.id)),o=e=>"number"!=typeof e.scoreValue&&(!(z(t)||!(e=>0===c(e))(e))||!!(e=>{const a=c(e),r=t[a-1];return r&&null!=r.scoreValue})(e));return r.createElement(r.Fragment,null,a&&r.createElement("p",{className:n.saveMessage},i("rubrics.saveMessage")),r.createElement("ul",{className:n.rubricEvaluation},t.map((e=>r.createElement(Ne,{key:e.id,lastSaveFailed:e.lastSaveFailed,isExpanded:o(e),criterionId:e.id,lastFeedbackSaveDate:e.lastFeedbackSaveDate,title:e.title,value:e.value,scoreValue:e.scoreValue,feedback:e.feedback,hasUnsavedFeedback:e.hasUnsavedFeedback,achievements:e.achievements,analyticsId:s,colorPercentage:e.colorPercentage})))))})));var Pe=a("ECG1"),Te=a("/n7R");class Ae extends r.Component{componentDidMount(){this.focusScore()}getGradingPillColorClass(){const{studentGrade:e,gradePercentageColor:t,isGroupGradeMultiple:a,gradingPillColor:r,showInput:i,classes:n,hasMultipleAttempts:s}=this.props;return""!==e&&"number"==typeof t&&(!i&&r)&&!a?r(t):n.pillEmpty}focusScore(){const{shouldFocusScore:e,showInput:t,hasMultipleAttempts:a}=this.props;t&&!a||!e||this.scoreRef.focus()}getInfoMessage(){const{classes:e,localize:{translate:t}}=this.props;return r.createElement("div",null,r.createElement("p",{className:e.infoTitle},t("rubrics.score.info.title")),r.createElement("p",null,t("rubrics.score.info.message")))}handleClick(e){e.stopPropagation()}renderPillContent(){const{children:e,rubricMaxScore:t,isGroupGradeMultiple:a,isGradingInProgress:i,classes:n,localize:{translate:s,formatNumber:c}}=this.props;return i?r.createElement("span",null,s("rubrics.score.inProgress")):a?r.createElement("span",null,s("rubrics.score.multiple")):r.createElement(r.Fragment,null,e,r.createElement("span",{className:n.gradeLabel},s("rubrics.score.maxScore",{maxScore:c(t)})))}render(){const{contentIconName:e,hasError:t,showInput:a,submissionLabel:i,submissionDetail:n,classes:s,shouldShowIcon:c,hasMultipleAttempts:o,rubricMaxScore:l}=this.props;return r.createElement("button",{disabled:o,tabIndex:0,"aria-label":i,className:Object(_.a)(s.rubricEvaluationScore,o&&s.rubricIsMultiple),ref:e=>this.scoreRef=e},r.createElement("div",{className:s.gradepillWrapper},r.createElement("div",{className:s.description},r.createElement("span",{className:s.icon},c&&r.createElement(re,{iconName:e})),r.createElement("div",{className:s.maximumScore},r.createElement("span",{className:s.maximumScoreTitle},i),r.createElement("span",{className:Object(_.a)(s.maximumScorePercentage,{[s.maximumScorePercentageEllipsis]:a})},n))),r.createElement("div",{id:"rubric-pill-container",className:Object(_.a)(s.pill,{[s.pillError]:t,[s.pillBigPoint]:(null==l?void 0:l.toString().length)>4},this.getGradingPillColorClass())},this.renderPillContent())),r.createElement("div",{onClick:this.handleClick},r.createElement(Te.AnalyticsTooltip,{id:"grade-discrepancy-info-rubric",placement:"top",title:this.getInfoMessage(),analyticsId:"components.rubrics.score.base.discrepancy.info.tooltip"},r.createElement(Pe.a,{className:s.infoIcon}))))}}const Ve=H(Object(s.a)(Object(c.u)((e=>Object(c.e)({rubricEvaluationScore:{width:"100%",alignItems:"center",...h(e),...g()},rubricIsMultiple:{cursor:"default"},description:{},icon:{},maximumScore:{display:"flex",justifyContent:"center",alignItems:"flex-start",flexDirection:"column"},maximumScoreTitle:{fontWeight:e.typography.fontWeightBold},maximumScorePercentage:{margin:0,fontSize:e.typography.fontSizeSmall,color:e.palette.text.secondary,lineHeight:1.4,textAlign:"left"},maximumScorePercentageEllipsis:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",width:"122px"},pill:{height:"30px",minWidth:"80px",marginRight:"9px",boxSizing:"border-box",padding:"0 10px",...d(e).gradePill},pillBigPoint:{minWidth:"max-content"},pillEmpty:{border:`1px solid ${e.palette.common.black}`,background:e.palette.primary.contrastText},pillError:{border:"none",boxShadow:`inset 0 0 0 1px ${e.palette.error.main}, inset 0 0 0 4px ${c.d.fade(e.palette.error.main,.1)}`},gradeLabel:{lineHeight:1.2,whiteSpace:"nowrap",fontWeight:e.typography.fontWeightSemiBold},infoIcon:{verticalAlign:"middle",marginRight:"8px"},infoTitle:{fontWeight:e.typography.fontWeightBold,fontSize:e.typography.fontSizeMedium},gradepillWrapper:{justifyContent:"space-between",display:"flex",flex:"auto"}})),{name:"Score"})(Ae)));var Ge=a("AuQm"),Me=a("MC1S");class Le extends r.Component{constructor(){super(...arguments),this.executeRegrade=()=>{const{updateRubric:e,rubricMaxScore:t,gradeIsOverridden:a,rubricCriteria:r,calculateCompletion:i,rubricType:n}=this.props,s=$(r);e({grade:s,gradeColorPercentage:i(s,t),rubricGrade:s,isGradeOverridden:!a,criteria:r,isGradingInProgress:!1,isGroupGradeMultiple:!1,rubricType:n})}}render(){const{analyticsId:e,classes:t,localize:{translate:a}}=this.props;return r.createElement(r.Fragment,null,r.createElement("span",{className:t.overrideWrapText},a("rubrics.score.overriddenScore")),r.createElement("br",null),r.createElement(Ie.AnalyticsLink,{analyticsId:`${e}.regrader.link`,className:t.regrader,onClick:this.executeRegrade},a("rubrics.score.regradeScore")))}}const Be=H(Object(c.u)((e=>Object(c.e)({regrader:{margin:"10px 0",fontStyle:"italic",flexWrap:"wrap",cursor:"pointer"},link:{color:e.palette.link.active,textDecoration:`underline ${e.palette.link.active}`,textAlign:"left",lineHeight:"1.5"},overrideWrapText:{overflowWrap:"break-word",textAlign:"left",marginRight:"4px",lineHeight:"1.5"}})))(Object(s.a)(Le))),Ue=e=>Object(c.e)({gradeLabel:{minWidth:"max-content",lineHeight:1.2,textAlign:"center",marginRight:"4px",fontWeight:e.typography.fontWeightSemiBold},gradingInputCallout:{maxWidth:"200px"},overrideBlocked:{marginTop:"12px",marginBottom:"10px",fontStyle:"italic"},errorMessage:{color:e.palette.error.main,margin:"8px 12px 8px 12px"}});class $e extends r.Component{constructor(e){super(e),this.handleSelect=()=>{this.setState({showInput:!0})},this.handleGradingInputSubmit=e=>{var t,a;const r=this.props.studentGrade?Number(this.props.studentGrade):null;null===(a=(t=this.props).onGradeInputUpdate)||void 0===a||a.call(t,e),null!=e?r!==Number(e)?this.setState({hasError:!1,showInput:!1},(()=>{this.updateRubricValue(e)})):this.setState({showInput:!1}):this.setState({clearConfirmationIsVisible:!0})},this.handleGradingInputError=()=>{this.setState({hasError:!0})},this.handleGradingInputChange=()=>{this.setState({hasError:!1})},this.onClearRubricSuccess=()=>{const{rubricCriteria:e,updateRubric:t}=this.props;this.setState({showInput:!1,clearConfirmationIsVisible:!1});t({grade:"",criteria:F(e),isGradeOverridden:!1})},this.onClearRubricDismiss=()=>{this.setState({showInput:!1,clearConfirmationIsVisible:!1})},this.state={showInput:!1,hasError:!1,clearConfirmationIsVisible:!1},this.gradingInputErrorRef=r.createRef()}updateRubricValue(e){const{rubricCriteria:t,updateRubric:a,rubricMaxScore:r,calculateCompletion:i}=this.props,{gradeIsAnonymous:n}=this.props,s={grade:e,rubricGrade:n?$(t):e,gradeColorPercentage:i(Number(e),r),isGradeOverridden:!0};n&&(s.criteria=t),a(s)}render(){const{showInput:e,hasError:t,clearConfirmationIsVisible:a}=this.state,{analyticsId:i,contentIconName:n,rubricMaxScore:s,studentGrade:c,isExternalSubmission:o,gradeIsOverridden:l,children:d,hasMultipleAttempts:u,shouldFocusScore:p,shouldShowIcon:m,localize:{translate:b,formatNumber:h},classes:{overrideBlocked:g,gradingInputCallout:v,errorMessage:S}}=this.props,x={label:b(o?"rubrics.score.externalSubmission":"rubrics.score.submission"),detail:`${b("rubrics.score.maxScoreLabel")}: ${b("rubrics.score.maxScorePoints",{maxScore:h(s)})}`},y={title:b("rubrics.score.clearRubricConfirmationCallout.title"),body:b("rubrics.score.clearRubricConfirmationCallout.body"),primaryButtonText:b("rubrics.score.clearRubricConfirmationCallout.primaryButtonText"),secondaryButtonText:b("rubrics.score.clearRubricConfirmationCallout.secondaryButtonText")},E=c?b("rubrics.score.inputLabelGraded",{grade:c,total:h(s)}):b("rubrics.score.inputLabelEmpty"),f=`${i}.editableScore`,I=c||0===c?h(R(c)):c;return r.createElement(r.Fragment,null,r.createElement("div",{onClick:()=>!u&&this.handleSelect(),ref:this.gradingInputErrorRef},r.createElement(Ve,{contentIconName:n,hasError:t,submissionLabel:x.label,submissionDetail:x.detail,showInput:e,shouldFocusScore:p,shouldShowIcon:m,hasMultipleAttempts:u},e&&!u?(()=>r.createElement(be,{ariaLabel:E,analyticsId:f,allowEmptyValue:!0,allowDecimals:!0,isExpandable:!0,initialValue:I,onSubmit:this.handleGradingInputSubmit,onError:this.handleGradingInputError,onChange:this.handleGradingInputChange}))():d)),r.createElement(Ge.h,{target:"#rubric-pill-container",onSuccess:this.onClearRubricSuccess,onDismiss:this.onClearRubricDismiss,textContent:y,analyticsId:`${f}.clearRubricConfirmation`,isVisible:a}),l&&!u&&r.createElement(Be,{analyticsId:i}),u&&r.createElement("p",{className:g},b("rubrics.score.overrideBlocked")),t&&r.createElement(Me.Callout,{className:v,target:this.gradingInputErrorRef.current},r.createElement("div",{className:S},b("rubrics.criterion.scoreInputError"))))}}const ze=H(Object(s.a)(Object(c.u)(Ue,{name:"EditableScore"})($e))),We=H(Object(s.a)(Object(c.u)(Ue,{name:"RubricEvaluationscore"})((({analyticsId:e,contentIconName:t,rubricIsEditable:a,canOverride:i,studentGrade:n,isExternalSubmission:s,classes:c,rubricIsFullyGraded:o,shouldShowIcon:l,localize:{translate:d,formatNumber:u},onGradeInputUpdate:p})=>{const m=()=>r.createElement("span",{id:"rubric-evaluation-score-value",className:c.gradeLabel},n||0===n?u(R(n)):"--");return r.createElement(r.Fragment,null,i?r.createElement(ze,{analyticsId:e,contentIconName:t,isExternalSubmission:s,shouldFocusScore:o,shouldShowIcon:l,onGradeInputUpdate:p},r.createElement(m,null)):r.createElement(Ve,{contentIconName:t,submissionLabel:d("rubrics.score.yourScore"),shouldFocusScore:o,shouldShowIcon:l},r.createElement(m,null)))}))));var He=a("E1pj");class Ke extends r.Component{constructor(e){super(e),this.updateRubric=e=>{const{contextData:t}=this.state,{onRubricUpdate:a}=this.props;e.criterionFeedbackWasUpdated&&"criteria"in e?this.updateRubricWithFeedback(e):(this.setState({contextData:{...t,...M(e)}}),a(e))},this.updateFeedback=(e,t)=>{const{contextData:a}=this.state;this.setState({contextData:{...a,...B(e,a,t)}},(()=>{this.updateRubricDataInUltra(!0)}))},this.removeFeedbackOnCriterion=e=>{const{contextData:t}=this.state;this.setState({contextData:{...t,...U(e,t)}},(()=>{this.updateRubricDataInUltra(!0)}))};const{getGradingPillColor:t,showConfirmationModal:a}=e;this.state={contextData:{showConfirmationModal:a,...V(e),updateRubric:this.updateRubric,updateFeedback:this.updateFeedback,removeFeedbackOnCriterion:this.removeFeedbackOnCriterion,gradingPillColor:t}}}componentDidUpdate(e){const{contextData:t}=this.state,{shouldUndoOverride:a,maxScore:r,okConfirmationClicked:i,confirmationHandledForCriterionId:n,shouldUpdateCriterionFeedback:s,criteria:c,isSavingRubric:o}=this.props;if(o===e.isSavingRubric)if(t.okConfirmationClicked===i)if(a&&t.gradeIsOverridden){const e=$(t.rubricCriteria);this.setState({contextData:{...j(t,e,r),gradeIsOverridden:!1}},(()=>{this.updateRubricDataInUltra()}))}else s&&!e.shouldUpdateCriterionFeedback&&this.setState({contextData:{...D(c,t),currentlySavingFeedback:!1}},(()=>{this.updateRubricDataInUltra()}));else this.setState({contextData:{...t,okConfirmationClicked:i,confirmationHandledForCriterionId:n}});else this.setState({contextData:{...t,isSavingRubric:o}})}getSmallHeaderTitle(){const{smallTitle:e,UltraWindowSize:t}=this.props;return t.isSmallBreakpoint()?void 0:e}updateRubricWithFeedback(e){const{contextData:t}=this.state,{onRubricUpdate:a}=this.props;if(A()){const a=L(e,!0);return void this.setState({contextData:{...t,...M(a)}})}const r=L(e,!1),i=N(r);0!==i.criteria.length?(this.setState({contextData:{...t,...M(r),currentlySavingFeedback:!0}}),a(i)):this.setState({contextData:{...t,...M(r)}})}updateRubricDataInUltra(e){const{contextData:t}=this.state,{onRubricPostUpdate:a}=this.props;a(G(t),{isUpdatingFeedback:e})}render(){const{contextData:e}=this.state,{analyticsId:t,localize:{translate:a},smallTitle:i,contentIconName:n,courseColorClass:s,classes:c,isExternalSubmission:o}=this.props,l=`${t}.rubrics.components.rubricEvaluationPanel`;return r.createElement("div",{className:Object(_.a)("panel-wrap",c.rubricEvaluationPanel,s)},r.createElement("div",{className:Object(_.a)("panel-header","simple-header",c.header)},r.createElement(ne.BbPanelHeader,{analyticsId:`${l}.header`,title:a("rubrics.title"),type:ne.BbPanelType.full,smallHeaderTitle:this.getSmallHeaderTitle(),navMenuAriaLabel:a("global.navigationMenu")})),r.createElement(E.Provider,{value:{...e}},r.createElement("div",{className:Object(_.a)("panel-body","panel-content",c.body)},r.createElement(We,{analyticsId:l,contentIconName:n,isExternalSubmission:o,shouldShowIcon:!0}),r.createElement(Re,{analyticsId:l}))))}}const _e=Object(He.windowResizingResponsiveComponentWrapper)(Object(s.a)(Object(c.u)((e=>Object(c.e)({rubricEvaluationPanel:{"&::before":{content:'""',display:"block",position:"absolute",height:"5px",left:"-1px",right:"-1px",top:"-1px"},...b(e).styles},header:{},body:{}})),{name:"RubricEvaluationPanel"})(Ke)));class Ze extends r.Component{constructor(e){super(e),this.updateRubric=e=>{const{contextData:t}=this.state,{onRubricUpdate:a}=this.props;e.criterionFeedbackWasUpdated&&"criteria"in e?this.updateRubricWithFeedback(e):(this.setState({contextData:{...t,...M(e)}}),a(e))},this.updateFeedback=(e,t)=>{const{contextData:a}=this.state;this.setState({contextData:{...a,...B(e,a,t)}},(()=>{this.updateRubricDataInUltra(!0)}))},this.removeFeedbackOnCriterion=e=>{const{contextData:t}=this.state;this.setState({contextData:{...t,...U(e,t)}},(()=>{this.updateRubricDataInUltra(!0)}))};const{getGradingPillColor:t,showConfirmationModal:a}=e;this.state={contextData:{showConfirmationModal:a,...V(e),updateRubric:this.updateRubric,updateFeedback:this.updateFeedback,removeFeedbackOnCriterion:this.removeFeedbackOnCriterion,gradingPillColor:t}}}componentDidUpdate(e){const{contextData:t}=this.state,{shouldUndoOverride:a,grade:r,maxScore:i,shouldEmptyRubric:n,shouldPerformOverride:s,okConfirmationClicked:c,confirmationHandledForCriterionId:o,shouldUpdateCriterionFeedback:l,criteria:d,isSavingRubric:u,isGroupGradeMultiple:p,isGradeOverridden:m}=this.props;if(u===e.isSavingRubric)if(t.okConfirmationClicked===c)if(a&&!s&&t.gradeIsOverridden){const e=$(t.rubricCriteria);this.setState({contextData:{...j(t,e,i),gradeIsOverridden:!1,isGroupGradeMultiple:p}},(()=>{this.updateRubricDataInUltra()}))}else!s||a||t.gradeIsOverridden?n&&null!=t.studentGrade&&""!==t.studentGrade?this.setState({contextData:W(t)},(()=>{this.updateRubricDataInUltra()})):t.gradeIsOverridden&&s&&r&&t.studentGrade!==r?this.setState({contextData:{...j(t,r,i),isGroupGradeMultiple:p}},(()=>{this.updateRubricDataInUltra()})):(m!==e.isGradeOverridden&&this.setState({contextData:{...t,gradeIsOverridden:m}}),l&&!e.shouldUpdateCriterionFeedback&&this.setState({contextData:{...D(d,t),currentlySavingFeedback:!1}},(()=>{this.updateRubricDataInUltra()}))):this.setState({contextData:{...j(t,r,i),gradeIsOverridden:!0}},(()=>{this.updateRubricDataInUltra()}));else this.setState({contextData:{...t,okConfirmationClicked:c,confirmationHandledForCriterionId:o}});else this.setState({contextData:{...t,isSavingRubric:u}})}updateRubricWithFeedback(e){const{contextData:t}=this.state,{onRubricUpdate:a}=this.props;if(A()){const a=L(e,!0);return void this.setState({contextData:{...t,...M(a)}})}const r=L(e,!1),i=N(r);0!==i.criteria.length?(this.setState({contextData:{...t,...M(r),currentlySavingFeedback:!0}}),a(i)):this.setState({contextData:{...t,...M(r)}})}updateRubricDataInUltra(e){const{contextData:t}=this.state,{onRubricPostUpdate:a}=this.props;a(G(t),{isUpdatingFeedback:e})}render(){const{contextData:e}=this.state,{analyticsId:t,criteria:a,shouldRenderRubricEvaluation:i,contentIconName:n,maxScore:s,isExternalSubmission:c,decimalsLength:o,rubricType:l,classes:d,onGradeInputUpdate:u}=this.props,p=`${t}.rubrics.components.rubricInline`;return r.createElement(r.Fragment,null,i&&r.createElement("div",{className:d.rubricEvaluationInline},r.createElement(E.Provider,{value:{...e}},r.createElement(We,{analyticsId:p,contentIconName:n,isExternalSubmission:c,onGradeInputUpdate:u}),r.createElement(Re,{analyticsId:p}))),!i&&a&&r.createElement(r.Fragment,null,r.createElement(ie,{contentIconName:n,maxScore:s}),r.createElement(ee,{analyticsId:p,criteria:a,decimalsLength:o,maxScore:s,rubricType:l})))}}const qe=Object(c.u)((()=>Object(c.e)({rubricEvaluationInline:{}})),{name:"rubricEvaluationInline"})(Ze);a.d(t,"c",(function(){return ee})),a.d(t,"d",(function(){return ce})),a.d(t,"a",(function(){return _e})),a.d(t,"b",(function(){return qe}))}}]);