(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{"+1G9":function(e,t,s){"use strict";s.d(t,"a",(function(){return a}));var n=s("ERkP");const a=e=>{const{answers:t,addHotspots:s,shouldDrawLabels:a,shouldDrawHotspots:i}=e,[o,r]=Object(n.useState)(!1);Object(n.useEffect)((()=>{i&&!o&&(s(t.map(((e,t)=>({hotspotId:e.id,type:e.areaType,coordinates:e.coordinates,...a?{hotspotNumber:t+1}:{}})))),r(!0))}),[s,t,o,i,a])}},"+F4g":function(e,t,s){"use strict";var n=s("ERkP"),a=s.n(n),i=s("HuI8"),o=s("Agfx"),r=s("DRH8");const l=Object(o.makeStyles)((e=>Object(o.createStyles)({answerContainer:t=>({backgroundColor:e.palette.background.paper,border:`1px solid ${e.palette.border.main}`,borderRadius:"2px",color:e.palette.text.secondary,display:"flex",minHeight:"36px",padding:"7px 10px",textAlign:"left",width:"260px",justifyContent:Object(r.e)(t.currentLocale,!0)?"flex-end":"flex-start"}),toleranceContainer:{marginTop:"12px"}})));var c=s("M0dR"),u=s("IIIX"),d=s("7O4Y"),p=s("G52d");t.a=e=>{const{pluginsConfig:t,question:s}=e,{locale:n,babelfishFormat:o,translate:h}=Object(i.a)(),m=l({currentLocale:n}),b=`calculated-numeric-question-read-tolerance-title_${s.id}`,g=Object(p.a)(n,s.answerValue,o),f=Object(p.a)(n,s.toleranceValue,o);return a.a.createElement("div",{className:"js-calculated-numeric-question-read"},a.a.createElement(c.a,{dir:Object(r.b)(n,!0),component:"div",className:Object(d.a)(m.answerContainer,"js-answer-value")},g),Object(p.b)(s)?a.a.createElement("div",{className:Object(d.a)(m.toleranceContainer,"js-tolerance-container")},a.a.createElement(c.a,{id:b,component:"label",variant:"h4"},h("assessments.canvas.question.calculatedNumeric.tolerance.label")),a.a.createElement(c.a,{className:"js-tolerance-value",component:"div",variant:"body1","aria-labelledby":b},h("assessments.canvas.question.calculatedNumeric.tolerance.value",{toleranceValue:f}))):null,a.a.createElement(u.a,{question:s,pluginsConfig:t}))}},"+VgB":function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));const n=e=>{const t="assessments.canvas.question.placeholder.htmlTags";return[{tag:"table",replacementText:e(`${t}.table`)},{tag:"math",replacementText:e(`${t}.math`),replacementTextPlural:e(`${t}.math.plural`)}]}},"+phe":function(e,t,s){"use strict";var n=s("nsO7"),a=s("ERkP"),i=s.n(a),o=s("MC1S"),r=s("WBPx"),l=s("0x+l"),c=s("IbyE"),u=s("zGdY"),d=s("caKH"),p=s("EGyI"),h=s("H+fs"),m=s("l4Sq"),b=s("+VgB");function g(e){switch(e){case u.Qb.CalculatedFormula:case u.Qb.CalculatedNumeric:case u.Qb.Either:case u.Qb.Essay:case u.Qb.FIMB:case u.Qb.Hotspot:case u.Qb.Matching:case u.Qb.Multiple:case u.Qb.QuestionBlock:return!0;default:return!1}}s.d(t,"b",(function(){return v}));class f extends a.Component{constructor(e){super(e),this.dropDownMenuButton=i.a.createRef(),this.onDeleteClick=()=>{this.setState({isConfirmationDialogOpen:!0})},this.onAlignWithGoal=()=>{this.props.openGoals()},this.onConfirmationDismiss=()=>{this.setState({isConfirmationDialogOpen:!1})},this.onCancelDelete=()=>{this.onConfirmationDismiss(),this.dropDownMenuButton.current.firstChild.focus()},this.onMenuOpen=()=>{this.props.updateDropdownMenuOptions&&this.props.updateDropdownMenuOptions(),this.state.isConfirmationDialogOpen&&this.onConfirmationDismiss()},this.getDropDownMenuOptions=()=>{const e=this.mergeDefaultMenuOptionsWithOverrides(),{hasQuestionDeletePermissions:t,hasQuestionEditPermissions:s,hasAlignToGoalPermissions:n,hasSubmissions:a,question:i}=this.props,o=!!i.usageCount&&i.usageCount>0;return e.filter((e=>{switch(e.key){case"alignWithGoal":return n;case"regrade":return s&&a;case"delete":return t&&!a&&!o;case"edit":{const e=s;return g(i.questionType)?e&&!a:e}default:return!0}}))},this.getDefaultMenuOptions=()=>{const{t:e,question:t,startEditMode:s}=this.props,n=[{key:"edit",icon:i.a.createElement(l.Edit,null),name:e("assessments.canvas.question.overflowOptions.edit"),onClick:()=>s()},{key:"delete",icon:i.a.createElement(l.Trash,null),name:e("assessments.canvas.question.overflowOptions.delete"),onClick:()=>this.onDeleteClick()}];if(g(t.questionType)&&n.unshift({key:"regrade",icon:i.a.createElement(l.Edit,null),name:e("assessments.canvas.question.overflowOptions.regrade"),onClick:()=>s()}),!c.N.isPresentationOnly(t)&&!c.N.isQuestionBlock(t)){const t={key:"alignWithGoal",icon:i.a.createElement(l.Goal,null),name:e("assessments.canvas.question.overflowOptions.alignWithGoal"),onClick:()=>this.onAlignWithGoal()};n.splice(n.length-1,0,t)}return n},this.mergeDefaultMenuOptionsWithOverrides=()=>{const{dropDownMenuOptionsOverrides:e}=this.props,t=this.getDefaultMenuOptions(),s=t.map((t=>{const s=n.find(e,{key:t.key});return void 0===s?t:s})),a=n.differenceWith(e,t,((e,t)=>e.key===t.key));return s.concat(a)},this.state={isConfirmationDialogOpen:!1}}render(){const{deleteQuestion:e,dragButtonAriaLabel:t,dragPointRef:s,disableInteraction:n,hasAssessmentModifyPermissions:a,hasSubmissions:l,t:u,question:p,questionTitle:g,showQuestionControls:f}=this.props;if(!f)return null;let v="question";c.N.isPresentationOnly(p)&&(v=c.N.isFileAttachment(p)?"file":"text");const w={onDismiss:()=>this.onConfirmationDismiss(),showAsCallout:!0,target:this.dropDownMenuButton.current,calloutProps:{setInitialFocus:!0},dialogContentProps:{type:o.DialogType.actionConfirmation,showCloseButton:!1,title:u(`assessments.canvas.question.deleteConfirmation.title.${v}`),subText:u(`assessments.canvas.question.deleteConfirmation.subText.${v}`),isAlert:!0},analyticsId:"analytics - TODO figure out analytics"},y=Object(m.a)("overflow",p,g,Object(b.a)(u)),E=this.getDropDownMenuOptions();return i.a.createElement("div",{className:"question-controls"},i.a.createElement("div",{className:"question-controls__actions"},i.a.createElement("div",{ref:this.dropDownMenuButton,className:"question-controls__menu-icon"},!!E.length&&i.a.createElement(o.ActionMenu,{maintainExpandedProperties:this.state.isConfirmationDialogOpen,menuProps:{directionalHint:6,items:E,onMenuOpened:()=>this.onMenuOpen()},ariaLabel:u(y.string,{relatedContent:y.relation}),"aria-hidden":n?"true":void 0,removedFromTabOrder:n,analyticsId:"assessments.canvas.question.controls.menu"}),this.state.isConfirmationDialogOpen?i.a.createElement(d.c,{...w},i.a.createElement(o.DialogFooter,null,i.a.createElement(r.AnalyticsDefaultButton,{onClick:()=>this.onCancelDelete(),analyticsId:"assessments.canvas.question.deleteConfirmation.cancel"},u("assessments.canvas.question.deleteConfirmation.cancel")),i.a.createElement(r.AnalyticsPrimaryButton,{onClick:e,analyticsId:"assessments.canvas.question.deleteConfirmation.delete"},u("assessments.canvas.question.deleteConfirmation.delete")))):null),!l&&a&&i.a.createElement(h.a,{ariaLabel:t,className:"question-controls__dnd",dragPointRef:s,title:u("assessments.canvas.drag.instructions"),removedFromTabOrder:n})))}}const v=e=>({deleteQuestion:e.deleteQuestion,dragButtonAriaLabel:e.dragButtonAriaLabel,dragPointRef:e.dragPointRef,editMode:e.editMode,hasQuestionEditPermissions:e.hasQuestionEditPermissions,hasQuestionDeletePermissions:e.hasQuestionDeletePermissions,hasAlignToGoalPermissions:e.hasAlignToGoalPermissions,hasSubmissions:e.hasSubmissions,hasAssessmentModifyPermissions:e.hasAssessmentModifyPermissions,openGoals:e.openGoals,question:e.question,questionTitle:e.questionTitle,showQuestionControls:e.showQuestionControls,startEditMode:e.startEditMode});t.a=Object(p.a)(f)},"0Ljr":function(e,t,s){"use strict";var n=s("ERkP"),a=s.n(n),i=s("MC1S"),o=s("K9sL"),r=s("g27D"),l=s("UJ5P"),c=s("AoSC"),u=s("7k4i"),d=s("sptZ"),p=s("NH8g"),h=s("+phe"),m=s("bJi+"),b=s("4raK"),g=s("EGyI"),f=s("6Nff");const v="true",w="false";class y extends n.Component{constructor(){super(...arguments),this.onQuestionChange=e=>{this.props.onQuestionChange(e,((e,t)=>Object(c.o)(e,t)))},this.onAnswerChange=(e,t)=>{const{onQuestionChange:s,question:n}=this.props;s({...n,answer:(null==t?void 0:t.key)===v},((e,t)=>Object(c.o)(e,t)))},this.getReadModeSection=e=>{const{t,question:s}=this.props;return a.a.createElement("ol",{className:"true-false__list"},a.a.createElement("li",{className:"true-false__li"},a.a.createElement("span",{className:"true-false__text"},t(`${e}.${s.answerType}.true`)),s.answer&&a.a.createElement("span",{className:"true-false__correct"},t(`${e}.correctAnswer`))),a.a.createElement("li",{className:"true-false__li"},a.a.createElement("span",{className:"true-false__text"},t(`${e}.${s.answerType}.false`)),!s.answer&&a.a.createElement("span",{className:"true-false__correct"},t(`${e}.correctAnswer`))))},this.getEditModeSection=e=>{const{t,question:s}=this.props;return a.a.createElement("div",{className:"true-false__options"},a.a.createElement(i.ChoiceGroup,{onChange:this.onAnswerChange,options:[{key:v,text:t(`${e}.${s.answerType}.true`)},{key:w,text:t(`${e}.${s.answerType}.false`)}],selectedKey:s.answer?v:w,analyticsId:"assessments.questions.truefalse.choice"}))}}render(){const{assessmentId:e,editMode:t,localizationPrefix:s,question:n,setActiveEditorId:i,pluginsConfig:u,activeEditorId:g,detailsHidden:v,questionTitle:w,assessmentType:y,t:E,extraCreditVisibility:C}=this.props,x=l.a.ACTIVE===t,O=x&&Object(c.i)(n),T=`${s}.canvas.question.trueFalse`,k=!v||x;return a.a.createElement("div",{className:"true-false"},a.a.createElement(r.a,{editMode:t,question:n},k?a.a.createElement(a.a.Fragment,null,a.a.createElement(p.a,{...Object(p.b)(Object(f.c)(this.props,E),this.onQuestionChange)}),a.a.createElement(d.a,{show:O,question:n})):a.a.createElement(b.a,{question:n,questionTitle:w,readonlyPoints:this.props.readonlyPoints,extraCreditVisibility:C}),a.a.createElement(h.a,{...Object(h.b)(this.props)}),k&&a.a.createElement(m.a,{...Object(m.b)({...this.props,localize:{translate:E}},this.onQuestionChange)})),!x&&!v&&this.getReadModeSection(T),x&&this.getEditModeSection(T),k&&a.a.createElement(o.a,{assessmentId:e,editMode:t,onQuestionChange:this.onQuestionChange,question:n,setActiveEditorId:i,pluginsConfig:u,activeEditorId:g,assessmentType:y}))}}y.defaultProps={activeEditorId:null,alignedGoals:null,canEnterEditMode:!1,customQuestionHeader:null,disableEditor:!1,disableFocus:!1,disableInteraction:!1,editorPlugins:null,focusTitle:!1,hasQuestionEditPermissions:!1,openGoals:null};const E=Object(u.a)(Object(g.a)(y));t.a=E},"1mOI":function(e,t,s){"use strict";var n=s("ERkP"),a=s.n(n),i=s("GR+8"),o=s("M0dR"),r=s("tN4z"),l=s("0x+l"),c=s("zGdY"),u=s("N8vG"),d=s("K9sL"),p=s("65tE"),h=s("a6r6"),m=s("IbyE"),b=s("bJi+");const g="calculated-formula-question-read",f="assessments.canvas.question.calculatedFormula.readOnly";class v extends n.Component{constructor(e){super(e),this.getAnswerToleranceDisplayInfo=()=>{const{localize:{translate:e}}=this.props,{correctAnswerTolerance:t}=this.props.question,s=t.type===c.o.Numeric?"answerToleranceDisplayInfoNumeric":"answerToleranceDisplayInfoPercent";return a.a.createElement("div",{className:Object(p.a)(`\n                    ${g}__precision-scoring-display-info\n                    ${g}__precision-scoring-display-info--full-credit\n                `)},e(`${f}.${s}`,{answerToleranceValue:t.value}))},this.getPartialCreditDisplayInfo=()=>{const{localize:{translate:e}}=this.props,{partialCreditTolerance:t,partialCreditPointsPercent:s}=this.props.question,n=t.type===c.o.Numeric?"partialCreditDisplayInfoNumeric":"partialCreditDisplayInfoPercent";return a.a.createElement("div",{className:Object(p.a)(`\n                    ${g}__precision-scoring-display-info\n                    ${g}__precision-scoring-display-info--partial-credit\n                `)},a.a.createElement("span",null,e(`${f}.${n}`,{answerToleranceValue:t.value})),a.a.createElement("span",{className:`${g}__precision-scoring-display-info--partial-credit-points-percent`},e(`${f}.partialCreditDisplayInfoPointsPercent`,{partialCreditPointsPercent:s})))},this.getVariablesRange=()=>{const{question:e,localize:{translate:t}}=this.props;return a.a.createElement("div",{className:`${g}__variables-range`},e.variableDefinitions.map((e=>{const s=t(`${f}.variableRangeRow`,{name:e.name,min:e.minValue,max:e.maxValue});return a.a.createElement("div",{key:e.name,className:`${g}__variables-range--row`,dangerouslySetInnerHTML:{__html:s}})})))},this.getAnswerSettingsSection=(e,t)=>{const{localize:{translate:s}}=this.props;return a.a.createElement("div",{className:`${g}__answer-settings-section`},a.a.createElement(o.a,{component:"h5",variant:"h4"},s(e)),t)},this.getAnswerSettingsContent=e=>{const{question:t,localize:{translate:s}}=this.props;return a.a.createElement("div",{className:`${g}__answer-settings-content`,id:e},this.getAnswerSettingsSection(`${f}.answerFormatLabel`,a.a.createElement("div",{className:`${g}__answer-format`},t.correctAnswerFormat===c.m.Normal?s("assessments.canvas.question.calculatedFormula.stepTwo.answerFormat.normalOption"):s("assessments.canvas.question.calculatedFormula.stepTwo.answerFormat.exponentialOption"))),this.getAnswerSettingsSection(`${f}.roundingLabel`,a.a.createElement("div",{className:`${g}__rounding`},t.correctAnswerPrecision===c.n.Decimal?s(`${f}.roundingDecimalPlaces`,{roundingCount:t.answerScale}):s(`${f}.roundingSignificantFigures`,{roundingCount:t.answerScale}))),this.getAnswerSettingsSection(`${f}.precisionScoringOptionsLabel`,a.a.createElement(a.a.Fragment,null,a.a.createElement(r.AnalyticsFormControlLabel,{label:s("assessments.canvas.question.calculatedFormula.stepTwo.precisionScoring.fullCreditLabel"),htmlFor:"read-correct-answer-tolerance-checkbox",className:`${g}__precision-scoring__full-credit-checkbox answer-tolerance-checkbox`,control:a.a.createElement(r.AnalyticsCheckbox,{id:"read-correct-answer-tolerance-checkbox",disabled:!0,checked:t.correctAnswerTolerance&&t.correctAnswerTolerance.value>0,analyticsId:`${u.a}.read.correctAnswerTolerance.checkbox`}),analyticsId:`${u.a}.read.correctAnswerTolerance.label`}),t.correctAnswerTolerance&&t.correctAnswerTolerance.value>0&&this.getAnswerToleranceDisplayInfo(),a.a.createElement(r.AnalyticsFormControlLabel,{label:s("assessments.canvas.question.calculatedFormula.stepTwo.precisionScoring.partialCreditLabel"),htmlFor:"read-correct-answer-tolerance-checkbox",className:`${g}__precision-scoring__partial-credit-checkbox answer-tolerance-checkbox`,control:a.a.createElement(r.AnalyticsCheckbox,{id:"read-correct-answer-tolerance-checkbox",disabled:!0,checked:t.allowPartialCredit,analyticsId:`${u.a}.read.partialAnswerTolerance.checkbox`}),analyticsId:`${u.a}.read.partialAnswerTolerance.label`}),t.allowPartialCredit&&this.getPartialCreditDisplayInfo())),t.variableDefinitions&&this.getAnswerSettingsSection("assessments.canvas.question.calculatedFormula.stepTwo.variableRanges.title",this.getVariablesRange()),this.getAnswerSettingsSection("assessments.canvas.question.calculatedFormula.stepTwo.variableSetCount.title",a.a.createElement("div",{className:`${g}__answer-set-count`},t.variableSetCount)))},this.state={isAnswerSettingsExpanded:!1,isImageLoaded:!1}}componentDidMount(){this.convertMathToImage()}componentDidUpdate(e,t){e.question.answerFormula!==this.props.question.answerFormula&&this.convertMathToImage()}convertMathToImage(){const{question:e,localize:t}=this.props;if(e.answerFormula){this.setState({isImageLoaded:!1});new h.c({...m.kb,locale:t.locale}).getImageMetadataFromMathML(e.answerFormula).then((({src:e,alt:t})=>{this.setState({isImageLoaded:!0,mathMLImageURL:e,mathMLImageAltText:t})}))}}render(){const{question:e,localize:{translate:t},pluginsConfig:s}=this.props,{isAnswerSettingsExpanded:n,isImageLoaded:i,mathMLImageURL:r,mathMLImageAltText:c}=this.state,u=`calculated-question-readonly-answer-settings-toggle_${e.id}`,p=n?"hideSettingsText":"showSettingsText";return a.a.createElement("div",{className:g},a.a.createElement(b.a,{...Object(b.b)({...this.props,localize:{translate:t}},(()=>{}))}),i&&a.a.createElement("img",{className:`${g}__formula-image`,src:r,alt:c}),a.a.createElement(o.a,{component:"h4",variant:"h4"},a.a.createElement("button",{className:`${g}__answer-settings-toggle-button`,onClick:()=>{this.setState((e=>({isAnswerSettingsExpanded:!e.isAnswerSettingsExpanded})))},type:"button","aria-label":t(`${f}.answerSettingsToggleButton.ariaLabel`),"aria-expanded":n,"aria-controls":n?u:void 0},a.a.createElement("span",null,t(`${f}.answerSettingsToggleButton.${p}`)),n?a.a.createElement(l.ArrowUp,null):a.a.createElement(l.ArrowDown,null))),this.state.isAnswerSettingsExpanded&&this.getAnswerSettingsContent(u),a.a.createElement(d.d,{className:`${g}__automated-feedback`,question:e,pluginsConfig:s}))}}t.a=Object(i.a)(v)},"2/w5":function(e,t,s){"use strict";var n=s("ERkP"),a=s.n(n),i=s("EGyI"),o=s("Begd"),r=s("0x+l"),l=s("WDMa"),c=s("E1pj"),u=s("myse"),d=s("tN4z"),p=s("MC1S"),h=s("nsO7");const m=h.memoize((e=>{const t=h.transform(e.blocks,((e=[],t)=>(h.each(t.groups,(t=>{const s=h.filter(t.items,(e=>e.selected));e.push(s)})),e)));return h.flatten(t)}),(e=>JSON.stringify(e))),b="keyword";class g extends a.a.Component{constructor(e){super(e),this.focusPanelHeader=()=>{var e;null===(e=this.mainHeadingRef.current)||void 0===e||e.focus()},this.keywordPickerOnRenderItem=e=>a.a.createElement(p.TagItem,{...e},e.item.name),this.keywordPickerOnChange=e=>{this.props.criteriaConfig.onSetKeywords(e.map((e=>e.key)))},this.toggleBlockContentVisibility=e=>{const{blockStateMap:t}=this.state,s=t[e];s.expanded=!s.expanded,this.setState((()=>({blockStateMap:t})))},this.keywordPickerRemoveButtonAriaLabel=e=>{const{t}=this.props;return t("questionPicker.filterPanel.keywordSearch.removeButtonAriaLabel",{item:e.name})},this.getItemAddedStatusMessage=e=>{const{t}=this.props;return t("questionPicker.filterPanel.keywordSearch.addedToList",{text:e})},this.renderFilterPanel=()=>{var e;const{criteriaConfig:t,t:s,onClearCriteria:n}=this.props,{blockStateMap:i}=this.state,o=t.selectedKeywords&&t.selectedKeywords.length,l=0===m(t).length&&!o,c=s("questionPicker.filterPanel.keywordSearch.heading"),u=o?t.selectedKeywords.map((e=>({key:e,name:e}))):[],h=i.keyword&&i.keyword.expanded,g=h?"open":"close";return a.a.createElement("div",{className:"filter-panel__container"},a.a.createElement("div",{className:"filter-panel__header"},a.a.createElement("div",{className:"filter-panel__title-wrapper"},a.a.createElement("h2",{className:"filter-panel__title",ref:this.mainHeadingRef},s("questionPicker.filterPanel.header"))),a.a.createElement(p.Link,{className:"filter-panel__clear-all",disabled:l,onClick:n,analyticsId:"questionPicker.filterPanel.clearAll.link"},s("questionPicker.filterPanel.clearAll"))),t?a.a.createElement("div",{className:"filter-panel__block",id:"keyword-block"},a.a.createElement("div",{className:"filter-panel__block-header"},a.a.createElement("h2",{className:"filter-panel__block-title"},c),a.a.createElement(p.IconButton,{className:`filter-panel__block-toggle js-block-toggle\n                      filter-panel__block-toggle--${g}`,onClick:()=>this.toggleBlockContentVisibility(b),ariaLabel:c,"aria-expanded":h,"data-is-visible":!0,icon:a.a.createElement(r.ChevronUp,null),analyticsId:"questionPicker.filterPanel.blockToggle"})),(null===(e=i.keyword)||void 0===e?void 0:e.expanded)?a.a.createElement(p.KeywordPicker,{selectedItems:u,onChange:this.keywordPickerOnChange,removeButtonAriaLabel:this.keywordPickerRemoveButtonAriaLabel,inputLabel:s("questionPicker.filterPanel.keywordSearch.placeholderText"),onRenderItem:this.keywordPickerOnRenderItem,getItemAddedStatusMessage:this.getItemAddedStatusMessage,analyticsId:"questionPicker.filterPanel.keywordPicker"}):null):null,(null==t?void 0:t.blocks)?t.blocks.map((e=>{var t;const s=null===(t=i[e.id])||void 0===t?void 0:t.expanded,n=s?"open":"close";return a.a.createElement("div",{key:e.id,className:"filter-panel__block",id:`${e.id}-block`},a.a.createElement("div",{className:"filter-panel__block-header"},e.name?a.a.createElement("h2",{className:"filter-panel__block-title"},e.name):null,a.a.createElement(p.IconButton,{className:`filter-panel__block-toggle js-block-toggle\n                            filter-panel__block-toggle--${n}`,onClick:()=>this.toggleBlockContentVisibility(e.id),ariaLabel:e.name,"aria-expanded":s,"data-is-visible":!0,icon:a.a.createElement(r.ChevronUp,null),analyticsId:"quesitonPicker.filterPanel."+(s?"collapse":"expand")})),s?a.a.createElement("div",{className:"filter-panel__groups"},e.groups.map((e=>a.a.createElement("fieldset",{key:e.id,className:"filter-panel__group"},a.a.createElement("legend",{className:"filter-panel__group-title"},e.name||""),e.items.map((t=>a.a.createElement("div",{key:t.id,className:"filter-panel__item"},a.a.createElement(d.AnalyticsFormControlLabel,{label:t.name,htmlFor:t.id,className:"filter-panel__item-checkbox",control:a.a.createElement(d.AnalyticsCheckbox,{id:t.id,onChange:(s,n)=>e.onSelect(t.id,n||!1),checked:t.selected,analyticsId:"questionPicker.filterPanel"}),analyticsId:"questionPicker.filterPanel.label"})))))))):null)})):null)},this.state={blockStateMap:null},this.mainHeadingRef=a.a.createRef()}componentDidUpdate(e){!e.isOpen&&this.props.isOpen&&this.focusPanelHeader()}static getDerivedStateFromProps(e,t){const{criteriaConfig:s}=e,{blockStateMap:n}=t;return g.shouldUpdateBlockStateMap(s,n)?g.initBlockStateMap(s):null}render(){return this.props.isOpen?this.renderFilterPanel():null}}g.shouldUpdateBlockStateMap=(e,t)=>{if(null===t)return!0;const s=e.blocks.map((e=>e.id)),n=Object.keys(t).filter((e=>e!==b));return s.length!==n.length},g.initBlockStateMap=e=>{const t=Object.create({});return e.blocks.forEach((e=>{const s=e.expanded,n=e.id;t[n]={expanded:s}})),t.keyword={expanded:e.isKeywordExpanded},{blockStateMap:t}};var f=Object(i.a)(g),v=s("9OUN"),w=s("IbyE"),y=s("uDfI"),E=s("TUnR");class C extends a.a.Component{constructor(e){super(e),this.onFtueDismiss=()=>{const{ftueKey:e,ftuePreference:t,persistUserPreference:s}=this.props;s({key:e,value:(t||{key:e,value:0}).value+1})},this.state={isShowingFtue:!1}}UNSAFE_componentWillMount(){const{ftueKey:e,loadUserPreference:t}=this.props;t({key:e})}UNSAFE_componentWillReceiveProps(e){const t=!(e.isLoading||e.ftuePreference&&0!==e.ftuePreference.value);this.setState((()=>({isShowingFtue:t})))}render(){const{ftueElement:e,ftueMessageKey:t,t:s}=this.props;if(this.state.isShowingFtue){const n=s("assessments.common.button.close");return a.a.createElement(E.c,{componentKey:t,targetElement:e,onDismiss:this.onFtueDismiss,closeButtonAriaLabel:n,analyticsId:"assessments.common.button.close"},s(t))}return null}}const x=Object(y.b)(((e,t)=>({ftuePreference:w.gc.userPreference.getUserPreferenceByKey(e,t.ftueKey),isLoading:w.gc.userPreference.isUserPreferenceLoading(e)})),(e=>Object(v.b)({loadUserPreference:w.X.userPreference.loadUserPreference,persistUserPreference:w.X.userPreference.persistUserPreference},e)))(C);var O=Object(i.a)(x),T=s("iHhY");class k extends n.Component{constructor(e){var t;super(e),this.toggleFilterPanel=()=>{this.setState((e=>({isShowingFilterPanel:!e.isShowingFilterPanel})))},this.state={isShowingFilterPanel:!(null===(t=e.UltraWindowSize)||void 0===t?void 0:t.isSmallBreakpoint())},this.filterButtonRef=a.a.createRef()}render(){const{children:e,criteriaConfig:t,zeroResultsEmptyStateProps:s,id:n,isLoading:i,t:c,onClearCriteria:d,resultsCount:p,analyticsEventAugmentor:h,onScrollList:b,hideEmptyState:g,emptyState:v}=this.props,{isShowingFilterPanel:w}=this.state,y=0===p&&!g,E=w?"--on":"--off",C=c("questionPicker.componentHeader.filterButton",{criteriaCount:m(t).length}),x=`${n}-filter-list-criteria`,k="questionPicker.componentHeader.filterButton.toggleFilterPanel.button",S=h(u.AnalyticsEventTypes.CLICK_EVENT,this.toggleFilterPanel,k),q=c("questionPicker.componentHeader.results",{count:p});return a.a.createElement("div",{className:`filter-list filter-list${E}`},a.a.createElement("div",{className:"filter-list__header"},a.a.createElement("button",{className:`filter-list__filter-button js-filter-button filter-list__filter-button${E}`,onClick:S,"data-analytics-id":k,ref:this.filterButtonRef,"aria-expanded":w,"aria-controls":x},a.a.createElement(r.FilterOptions,{className:`filter-list__filter-icon filter-list__filter-icon${E}`}),a.a.createElement("span",{dangerouslySetInnerHTML:{__html:C}})),a.a.createElement("span",{className:"filter-list__filter-results"},q),w?null:a.a.createElement(O,{ftueKey:`ftue.${n}.filterPanel.visited`,ftueElement:this.filterButtonRef.current,ftueMessageKey:"questionPicker.filterPanel.FTUE"})),a.a.createElement("div",{className:"filter-list__content"},a.a.createElement("div",{id:x,className:"filter-list__criteria"},a.a.createElement(f,{criteriaConfig:t,onClearCriteria:d,isOpen:w})),a.a.createElement("div",{className:"filter-list__items-container"},i&&a.a.createElement(l.Overlay,{className:"filter-list__overlay"},a.a.createElement(o.Spinner,{className:"filter-list__spinner",size:o.SpinnerSize.large})),a.a.createElement("div",{className:"filter-list__items",onScroll:b},!y&&a.a.isValidElement(e)?a.a.cloneElement(a.a.Children.only(e),{isShowingFilterPanel:w}):null,y&&!i?a.a.createElement(a.a.Fragment,null,v?a.a.createElement(a.a.Fragment,null,v):null,a.a.createElement(T.a,{...s,showFilterPanelButton:!w,onFilterPanelToggle:this.toggleFilterPanel})):null))),!y&&a.a.createElement("span",{role:"status",className:"sr-only"},q))}}t.a=Object(u.withAnalytics)(Object(c.windowResizingResponsiveComponentWrapper)(Object(i.a)(k)))},"2GUQ":function(e,t,s){"use strict";var n=s("ERkP"),a=s.n(n),i=s("VQ4P"),o=s("tN4z"),r=s("Agfx");const l=Object(r.makeStyles)((()=>Object(r.createStyles)({root:{display:"flex",flexDirection:"column",alignItems:"center"}})));s.d(t,"a",(function(){return c}));const c=e=>{const{analyticsIdPrefix:t,descriptionLocaleKey:s,commandLocaleKey:n,children:r}=e,c=l(),u=Object(i.a)(),d=a.a.createElement("span",null,u(s)),p=a.a.createElement("span",null,u(n)),h=a.a.createElement("div",{className:c.root},u("assessments.canvas.question.hotspot.toolbar.keyboardCommandTooltip.tooltipContent",{description:d,command:p}));return a.a.createElement(o.AnalyticsTooltip,{analyticsId:`${t}.control.info.tooltip`,title:h,placement:"bottom"},r)}},"33wY":function(e,t,s){"use strict";s.d(t,"a",(function(){return r})),s.d(t,"b",(function(){return l}));var n=s("ERkP"),a=s.n(n);const i={service:{getXythosIdFromContentFileUrl:e=>null,update:()=>{},isAvailable:()=>Promise.resolve(!1),getIndexMapFromBbML:e=>null},contentId:null,isAvailable:!1},o=a.a.createContext(i),r=({allyService:e,contentId:t,children:s})=>{const[r,l]=Object(n.useState)({service:e||i.service,contentId:t,isAvailable:i.isAvailable});return Object(n.useEffect)((()=>{e.isAvailable().then((e=>{l((t=>({...t,isAvailable:e})))}))}),[e,t]),a.a.createElement(o.Provider,{value:r},s)},l=e=>a.a.forwardRef(((t,s)=>a.a.createElement(o.Consumer,null,(({service:n,contentId:i,isAvailable:o})=>a.a.createElement(e,{...t,ref:s,ally:{contentId:i,isAvailable:o,service:n}})))))},"3le2":function(e,t,s){"use strict";s.d(t,"a",(function(){return n})),s.d(t,"c",(function(){return a})),s.d(t,"b",(function(){return i})),s.d(t,"d",(function(){return o}));const n=600,a=e=>{var t;return(null===(t=null==e?void 0:e.answers)||void 0===t?void 0:t.length)>1},i=e=>{const{fileLocation:t,fileName:s,permanentUrl:n}=(null==e?void 0:e.hotSpotImage)||{};return!!(t&&s||n)},o=({canvasWrapper:e,answers:t,coordinates:s})=>Boolean(e)&&Boolean(null==s?void 0:s.length)&&(s||[]).length!==(t||[]).length},4:function(e,t){},"4raK":function(e,t,s){"use strict";var n=s("ERkP"),a=s.n(n),i=s("nsO7"),o=s("VQ4P"),r=s("4yoV"),l=s("YSVG"),c=s("+VgB"),u=s("Agfx"),d=s("pO+K");const p=a.a.memo((e=>{var t;const{question:s,questionTitle:n,readonlyPoints:p,extraCreditVisibility:h}=e,m=Object(o.a)(),b=s.alignedGoals&&s.alignedGoals.length>0,g=Object(u.useTheme)(),f=Object(u.useMediaQuery)(g.breakpoints.up("md"))?d.a.Large:d.a.Small;return a.a.createElement("div",{className:"question-preview"},n&&a.a.createElement(l.b,{id:s.id,canEnterEditMode:!1,editMode:0,onQuestionChange:i.noop,points:s.points,question:s,questionTitle:n,onPointsClick:i.noop,hasSubmissions:!1,hasQuestionEditPermissions:!1,hasAlignedGoals:b,openGoals:i.noop,goalAriaLabel:"",disableFocus:!0,extraCreditVisibility:h,analyticsId:"questionPreview.questionText",readonlyPoints:p}),a.a.createElement("div",{className:"question-preview__question-text",id:`bb-editor${s.id}`},Object(r.a)(null===(t=s.questionText)||void 0===t?void 0:t.rawText,Object(c.a)(m),f)))}));t.a=p},"4yoV":function(e,t,s){"use strict";s.d(t,"c",(function(){return i})),s.d(t,"b",(function(){return o})),s.d(t,"a",(function(){return r}));var n=s("65tE"),a=s("RPob");function i(e){const t=[],s=document.createElement("div");return s.innerHTML=null!=e?e:"",s.querySelectorAll("a[data-bbfile]").forEach((e=>{var s;const n=e,a=n.href,i=JSON.parse(null!==(s=e.getAttribute("data-bbfile"))&&void 0!==s?s:"{}");t.push({node:n,href:a,bbfile:i})})),t}function o(e){const t=JSON.parse(e.bbfile),s=e.href,n=e.bbtype,a=e.bbfile.replace(/&/g,"&amp;").replace(/"/g,"&quot;");return`<a href="${s}" data-bbtype="${n}" data-bbfile="${a}">${t.linkName||a.alternativeText}</a> \n`}function r(e,t,s=300){if(!e)return"";const i=Object(a.q)(e,t);return i.length<=s?i:Object(n.b)(i,s)}},5:function(e,t){},"5O/A":function(e,t,s){"use strict";var n=s("ERkP"),a=s.n(n),i=s("EGyI"),o=s("tN4z"),r=s("MC1S"),l=s("WBPx");var c=e=>{const{disabled:t,editable:s,inputDescriptionText:n,inputLabelText:i,inputText:o,onInputChange:l}=e;return s?a.a.createElement("div",{className:"fimb-question-answer-input fimb-question-answer-input--edit"},a.a.createElement(r.TextField,{value:o,disabled:t,label:i,onChanged:l,analyticsId:"fimbQuestionAnswerInput.edit.textField"})):a.a.createElement("div",{className:"fimb-question-answer-input fimb-question-answer-input--read"},a.a.createElement("div",{className:"fimb-question-answer-input__label"},i),a.a.createElement("div",{className:"fimb-question-answer-input__input-wrapper"},a.a.createElement("div",{className:"fimb-question-answer-input__answer"},o),a.a.createElement("div",{className:"fimb-question-answer-input__description"},n)))},u=s("GR+8"),d=s("IbyE"),p=s("caKH");class h extends n.Component{constructor(e){super(e),this.onPatternChange=e=>{this.state.patternHasBeenTested&&this.setState({answerValue:"",answerHasBeenTested:!1,patternHasBeenTested:!1,answerMatchesPattern:!1,patternIsValid:!1}),this.setState({patternValue:e})},this.onAnswerChange=e=>{this.setState({answerMatchesPattern:!1,answerHasBeenTested:!1,answerValue:e})},this.getPatternErrorMessage=()=>{const{localize:{translate:e}}=this.props;return this.state.patternHasBeenTested&&!this.state.patternIsValid?e("assessments.canvas.question.fimb.patternMatchHelper.patternError"):""},this.getAnswerErrorMessage=()=>{const{localize:{translate:e}}=this.props;return this.state.answerHasBeenTested&&!this.state.answerMatchesPattern?e("assessments.canvas.question.fimb.patternMatchHelper.answerError"):""},this.cancel=()=>{var e,t;null===(t=(e=this.props).onClose)||void 0===t||t.call(e)},this.save=()=>{var e,t,s,n;null===(t=(e=this.props).onSave)||void 0===t||t.call(e,this.state.patternValue),null===(n=(s=this.props).onClose)||void 0===n||n.call(s)},this.testPattern=()=>{var e,t;Object(d.ib)(null!==(e=this.props.courseId)&&void 0!==e?e:"",null!==(t=this.props.assessmentId)&&void 0!==t?t:"",this.state.patternValue).then((e=>{this.setState({patternIsValid:e.result,patternHasBeenTested:!0})}))},this.testAnswer=()=>{var e,t;Object(d.jb)(null!==(e=this.props.courseId)&&void 0!==e?e:"",null!==(t=this.props.assessmentId)&&void 0!==t?t:"",this.state.patternValue,this.state.answerValue).then((e=>{this.setState({answerMatchesPattern:e.result,answerHasBeenTested:!0})}))},this.getHelpLinkElement=()=>{const{localize:{locale:e,translate:t}}=this.props,s=`https://help.blackboard.com/001_569${e&&"en"!==e?e.replace("-","_"):"en_US"}`;return a.a.createElement(r.Link,{href:s,"aria-label":t("assessments.canvas.question.fimb.patternMatchHelper.helpLinkAriaLabel"),target:"_blank",analyticsId:"assessments.canvas.question.fimb.patternMatchHelper.helpLink"},t("assessments.canvas.question.fimb.patternMatchHelper.helpLink"))},this.state={patternValue:this.props.initialPatternValue||"",answerValue:"",patternIsValid:!1,answerMatchesPattern:!1,patternHasBeenTested:!1,answerHasBeenTested:!1}}render(){const{localize:{translate:e}}=this.props;return a.a.createElement(p.c,{hidden:!1,className:"test-pattern",analyticsId:"assessments.canvas.question.fimb.patternMatchHelper.dialog",dialogContentProps:{type:r.DialogType.fullHeaderFooter,title:e("assessments.canvas.question.fimb.patternMatchHelper.title"),showCloseButton:!1}},a.a.createElement("div",{className:"test-pattern__section-wrapper test-pattern__section-wrapper--first"},a.a.createElement("div",{className:"test-pattern__text-field"},a.a.createElement(r.TextField,{label:e("assessments.canvas.question.fimb.patternMatchHelper.patternLabel"),value:this.state.patternValue||"",required:!0,valid:this.state.patternHasBeenTested&&this.state.patternIsValid,onChanged:this.onPatternChange,errorMessage:this.getPatternErrorMessage(),analyticsId:"assessments.canvas.question.fimb.patternMatchHelper.patternLabel"})),a.a.createElement("div",{className:"test-pattern__button"},a.a.createElement(l.AnalyticsDefaultButton,{disabled:0===this.state.patternValue.length||this.state.patternHasBeenTested,onClick:this.testPattern,analyticsId:"assessments.canvas.question.fimb.patternMatchHelper.testButton"},e("assessments.canvas.question.fimb.patternMatchHelper.testButton")))),this.state.patternHasBeenTested&&this.state.patternIsValid&&a.a.createElement("div",{className:"test-pattern__section-wrapper"},a.a.createElement("div",{className:"test-pattern__text-field"},a.a.createElement(r.TextField,{label:e("assessments.canvas.question.fimb.patternMatchHelper.answerLabel"),valid:this.state.answerMatchesPattern,required:!0,onChanged:this.onAnswerChange,errorMessage:this.getAnswerErrorMessage(),analyticsId:"assessments.canvas.question.fimb.patternMatchHelper.answerLabel"})),a.a.createElement("div",{className:"test-pattern__button"},a.a.createElement(l.AnalyticsDefaultButton,{disabled:0===this.state.answerValue.length||this.state.answerHasBeenTested,onClick:this.testAnswer,analyticsId:"assessments.canvas.question.fimb.patternMatchHelper.patternHasBeenTested.testButton"},e("assessments.canvas.question.fimb.patternMatchHelper.testButton")))),a.a.createElement(r.DialogFooter,{helpLink:this.getHelpLinkElement()},a.a.createElement(l.AnalyticsDefaultButton,{onClick:this.cancel,analyticsId:"assessments.canvas.question.fimb.patternMatchHelper.cancelButton"},e("assessments.canvas.question.fimb.patternMatchHelper.cancelButton")),a.a.createElement(l.AnalyticsPrimaryButton,{disabled:!this.state.patternHasBeenTested||!this.state.patternIsValid,onClick:this.save,analyticsId:"assessments.canvas.question.fimb.patternMatchHelper.saveButton"},e("assessments.canvas.question.fimb.patternMatchHelper.saveButton"))))}}var m=Object(u.a)(h);s.d(t,"a",(function(){return b})),s.d(t,"b",(function(){return g}));const b=";",g={EXACT:{locKey:"assessments.canvas.question.fimb.responseType.exact"},CONTAINS:{locKey:"assessments.canvas.question.fimb.responseType.contains"},MATCHES:{locKey:"assessments.canvas.question.fimb.responseType.matches"}},f=e=>{const{evaluationType:t,caseSensitive:s}=e.answer.answerValues[0];return{text:e.answer.answerValues.map((e=>e.value)).join(b),evaluationType:t,caseSensitive:s,testPatternDialogOpen:!1}};class v extends n.Component{constructor(e){super(e),this.openTestPatternDialog=()=>{this.setState({testPatternDialogOpen:!0})},this.hideTestPatternDialog=()=>{this.setState({testPatternDialogOpen:!1})},this.updateInputValue=e=>{const t={...this.props.answer,answerValues:this.parseAnswerText(e)};this.props.onAnswerChange(t)},this.parseAnswerText=e=>e.split(b).map((e=>({value:e,evaluationType:this.state.evaluationType,caseSensitive:this.state.caseSensitive}))),this.onAnswerChange=()=>{this.updateInputValue(this.state.text)},this.setText=e=>{this.setState((()=>({text:e})),this.onAnswerChange)},this.setEvaluationType=e=>{this.setState((()=>({evaluationType:e.key})),this.onAnswerChange)},this.setCaseSensitive=()=>{this.setState((e=>({caseSensitive:!e.caseSensitive})),this.onAnswerChange)},this.state=f(e)}UNSAFE_componentWillReceiveProps(e){this.setState(f(e))}render(){const{t:e}=this.props,t=Object.keys(g).map((t=>({key:t,text:e(`${g[t].locKey}.edit`)}))),s=this.props.answer.answerValues[0],n=e(`${g[s.evaluationType].locKey}.${s.caseSensitive?"readOnlyCaseSensitive":"readOnly"}`);return a.a.createElement("div",{className:"fimb-question-answer fimb-question-answer--"+(this.props.readOnly?"read":"edit")},a.a.createElement(c,{disabled:this.props.disabled,editable:!this.props.readOnly,inputDescriptionText:n,inputLabelText:this.props.inputLabel,inputText:this.state.text,onInputChange:this.setText}),!this.props.readOnly&&a.a.createElement("div",{className:"fimb-question-answer__options"},a.a.createElement("div",{className:"fimb-question-answer__match-selector"},a.a.createElement(r.Dropdown,{label:e("assessments.canvas.question.fimb.responseType.label"),options:t,selectedKey:this.state.evaluationType,onChanged:this.setEvaluationType,disabled:this.props.disabled,inlineLabel:!0,analyticsId:"assessments.canvas.question.fimb.responseType.dropdown"})),"MATCHES"!==this.state.evaluationType&&a.a.createElement(o.AnalyticsFormControlLabel,{label:e("assessments.canvas.question.fimb.caseSensitive"),className:"fimb-question-answer__checkbox",htmlFor:"question-fimb-full-case-sensitive",control:a.a.createElement(o.AnalyticsCheckbox,{id:"question-fimb-full-case-sensitive",onChange:this.setCaseSensitive,checked:this.state.caseSensitive,disabled:this.props.disabled,analyticsId:"assessments.canvas.question.fimb.caseSensitive"}),analyticsId:"assessments.canvas.question.fimb.caseSensitive.label"}),"MATCHES"===this.state.evaluationType&&a.a.createElement(l.AnalyticsDefaultButton,{className:"fimb-question-answer__test-pattern-button",onClick:this.openTestPatternDialog,disabled:this.props.disabled,analyticsId:"assessments.canvas.question.fimb.testPattern"},e("assessments.canvas.question.fimb.testPatternButton")),this.state.testPatternDialogOpen&&a.a.createElement(m,{initialPatternValue:this.state.text,onClose:this.hideTestPatternDialog,onSave:this.updateInputValue,assessmentId:this.props.assessmentId,courseId:this.props.courseId})))}}const w=Object(i.a)(v);t.c=w},6:function(e,t){},"65tE":function(e,t,s){"use strict";s.d(t,"b",(function(){return n})),s.d(t,"a",(function(){return a}));function n(e,t){return null==e||0===e.length?e:`${e.substr(0,t)}...`}function a(e){return e.trim().replace(/\s+/g," ")}},"6Nff":function(e,t,s){"use strict";var n=s("ERkP"),a=s.n(n),i=s("g27D"),o=s("EGyI"),r=s("IbyE"),l=s("ALQB"),c=s("oFES"),u=s("N8vG"),d=s("AoSC"),p=s("K9sL"),h=s("GR+8"),m=s("M0dR"),b=s("tN4z"),g=s("a6r6"),f=s("65tE"),v=s("ekqz"),w=s("YSVG"),y=s("VQ4P"),E=s("np6O"),C=s("ks7T"),x=s("5HEc");const O="calculated-formula-question__step-button",T="assessments.canvas.question.calculatedFormula";var k=({analyticsId:e,showBack:t,onBackClick:s,showNext:n,isNextDisabled:i,onNextClick:o})=>{const r=Object(y.a)();return a.a.createElement("div",{className:O},t&&a.a.createElement(E.AnalyticsIconButton,{analyticsId:`${e}.back.iconButton`,"aria-label":r(`${T}.backAriaLabel`),className:`${O}--back`,onClick:s},a.a.createElement(C.a,null),a.a.createElement(m.a,{component:"span",variant:"inherit"},r(`${T}.back`))),n&&a.a.createElement(E.AnalyticsIconButton,{analyticsId:`${e}.next.iconButton`,"aria-label":r(`${T}.nextAriaLabel`),className:`${O}--next`,disabled:i,onClick:o},a.a.createElement(m.a,{component:"span",variant:"inherit"},r(`${T}.next`)),a.a.createElement(x.a,null)))},S=s("nsO7"),q=s.n(S),A=s("8jLo");function P(e){return null==e.answerFormulaErrorKey}function I(e){return null==e.questionTextErrorKey}function j(e){return I(e)&&P(e)}class F extends a.a.Component{constructor(e){var t;super(e),this.originalAnswerFormula="",this.getFullLocalizationKey=e=>`assessments.canvas.question.calculatedFormula.stepOne.${e}`,this.getQuestionTextErrorKey=()=>{var e,t;const s=null===(e=this.props.question.questionText)||void 0===e?void 0:e.rawText;if(!s)return this.getFullLocalizationKey("questionTextEmpty");if(Object(u.o)(s))return this.getFullLocalizationKey("questionTextUnclosedBracketError");const n=Object(u.d)(s);if(n.some((e=>Object(u.n)(e))))return this.getFullLocalizationKey("questionTextReservedVariableNameError");if(n.some((e=>Object(u.q)(e))))return this.getFullLocalizationKey("questionTextInvalidVariableNameError");const a=Object(u.d)(null!==(t=this.originalQuestionText)&&void 0!==t?t:"");return this.props.hasSubmissions&&!q.a.isEqual(a,n)?this.getFullLocalizationKey("questionTextVariablesUneditableError"):null},this.handleNextStepClick=()=>{const e=this.getQuestionTextErrorKey();I({questionTextErrorKey:e})?this.doesAnswerFormulaHaveVariablesWithoutDefinitions()?this.setUnrecognizedVariablesInAnswerFormulaState():this.isAnswerFormulaValidPromise().then((e=>{e?(this.setAnswerFormulaValidState(),this.setVariableSetCountIfNoVariables(),this.handleGoToNextStep()):this.setAnswerFormulaInvalidState()})):this.setState({questionTextErrorKey:e})},this.doesAnswerFormulaHaveVariablesWithoutDefinitions=()=>{const{question:e}=this.props;return Object(u.j)(e.answerFormula,e.variableDefinitions).length>0},this.setUnrecognizedVariablesInAnswerFormulaState=()=>{const{question:e}=this.props,t=Object(u.j)(e.answerFormula,e.variableDefinitions);this.setState({answerFormulaErrorKey:this.getFullLocalizationKey("unrecognizedVariablesInFormula"),answerFormulaErrorKeyParams:{variablesCount:t.length,variables:t}})},this.setVariableSetCountIfNoVariables=()=>{Object(u.c)(this.props.question)||this.props.onQuestionChange({variableSetCount:r.g})},this.setAnswerFormulaValidState=()=>{this.setState({answerFormulaErrorKey:null,answerFormulaErrorKeyParams:null})},this.setAnswerFormulaInvalidState=()=>{this.setState({answerFormulaErrorKey:this.getFullLocalizationKey("invalidFormula"),answerFormulaErrorKeyParams:{}})},this.isAnswerFormulaValidPromise=()=>{const{courseId:e,question:t}=this.props,s=Object(u.c)(t)?Object(u.f)(t.variableDefinitions):{};return Object(r.sb)(e,t.answerFormula,s).then((()=>!0),(()=>!1))},this.handleGoToNextStep=()=>{this.applyAsyncPlugins(),this.generateNewMathMLImage(),this.props.onGoToNextStep()},this.applyAsyncPlugins=()=>{Object(A.a)(this.props.question).then((e=>{this.setState({refreshBbml:!0},(()=>{var t;this.props.onQuestionChange({questionText:{rawText:null===(t=e.questionText)||void 0===t?void 0:t.rawText},applyAsyncPlugins:void 0}),this.setState({refreshBbml:!1})}))}))},this.generateNewMathMLImage=()=>{const{onQuestionChange:e,question:t,localize:{locale:s}}=this.props;if(null!=t.mathMLImageURL&&t.answerFormula===this.originalAnswerFormula)return;this.originalAnswerFormula=t.answerFormula;new g.c({...r.kb,locale:s}).getImageMetadataFromMathML(t.answerFormula).then((({src:t,alt:s})=>{e({mathMLImageURL:t,mathMLImageAltText:s})}))},this.handleQuestionTextChange=e=>{this.props.onQuestionChange({questionText:{rawText:e.toBbML()},applyAsyncPlugins:{...this.props.question.applyAsyncPlugins,calculatedFormula:async()=>({questionText:{rawText:await e.toBbML(!0)}})}})},this.handleQuestionTextBlur=()=>{const e=this.getQuestionTextErrorKey();this.setState({questionTextErrorKey:e}),I({questionTextErrorKey:e})&&this.updateVariableDefinitionsFromQuestionText()},this.updateVariableDefinitionsFromQuestionText=()=>{var e,t;const{onQuestionChange:s,question:n}=this.props;s({variableDefinitions:Object(u.d)(null!==(t=null===(e=n.questionText)||void 0===e?void 0:e.rawText)&&void 0!==t?t:"").map((e=>{const t=n.variableDefinitions.findIndex((t=>t.name===e));return t>-1?{...n.variableDefinitions[t]}:Object(u.k)(e)}))})},this.handleMathEditorLoad=e=>{this.wirisEditorInstance=e,g.b.attachContentChangeListener(e,this.handleMathEditorChange),g.b.enableReservedWords(e),this.updateReservedWordsInMathEditor()},this.handleMathEditorChange=e=>{!this.hasMathEditorSetInitialValue&&this.originalAnswerFormula||this.props.onQuestionChange({answerFormula:e}),e===this.originalAnswerFormula&&(this.hasMathEditorSetInitialValue=!0)},this.updateReservedWordsInMathEditor=()=>{if(!this.wirisEditorInstance)return;const{question:e}=this.props;g.b.setReservedWords(this.wirisEditorInstance,Object(u.l)(e.variableDefinitions))},this.handleMathEditorError=e=>{console.error(e)},this.toggleDisplayFormulaToStudent=e=>{this.props.onQuestionChange({displayFormulaToStudent:e.target.checked})},this.originalAnswerFormula=e.question.answerFormula,this.originalQuestionText=null===(t=e.question.questionText)||void 0===t?void 0:t.rawText,this.hasMathEditorSetInitialValue=!1,this.state={answerFormulaDirty:!1,answerFormulaErrorKey:null,answerFormulaErrorKeyParams:null,questionTextDirty:!1,questionTextErrorKey:null,refreshBbml:!1}}componentDidMount(){this.props.onValidate(j(this.state))}componentDidUpdate(e,t){var s,n;const{question:a}=e,{question:i}=this.props;if(this.wirisEditorInstance&&Object(u.m)(a.variableDefinitions,i.variableDefinitions)&&(this.updateReservedWordsInMathEditor(),this.setState({questionTextDirty:!0})),(null===(s=a.questionText)||void 0===s?void 0:s.rawText)!==(null===(n=i.questionText)||void 0===n?void 0:n.rawText)){I({questionTextErrorKey:this.getQuestionTextErrorKey()})||this.setState({questionTextDirty:!0})}a.answerFormula!==i.answerFormula&&this.setState({answerFormulaDirty:i.answerFormula!==this.originalAnswerFormula}),t.answerFormulaDirty===this.state.answerFormulaDirty&&t.questionTextDirty===this.state.questionTextDirty||this.props.onAnswerSetsRelatedFieldDirty(this.state.answerFormulaDirty||this.state.questionTextDirty),j(t)!==j(this.state)&&this.props.onValidate(j(this.state))}render(){var e;const{activeEditorId:t,disableFocus:s,editorPlugins:n,localize:{translate:i,isRtl:o,locale:l},pluginsConfig:c,question:d,questionTitle:p,setActiveEditorId:h,fileUploadSettings:y}=this.props,{answerFormulaErrorKey:E,answerFormulaErrorKeyParams:C,questionTextErrorKey:x}=this.state,O=i("assessments.canvas.question.placeholder.question",{questionTitle:p||""}),T=`${w.a}${d.id}`,S=`math-editor${d.id}`;return a.a.createElement("div",{className:"calculated-formula-question__step-1"},a.a.createElement("div",{className:"calculated-formula-question__step-1__question-text-heading"},a.a.createElement(m.a,{component:"label",variant:"h4",required:!0,htmlFor:`bb-editor${d.id}`},i("assessments.canvas.question.calculatedFormula.stepOne.questionTextTitle")),a.a.createElement(m.a,{component:"div",variant:"body1",className:"calculated-formula-question__step-1__question-field-instructions"},i("assessments.canvas.question.calculatedFormula.stepOne.questionTextInstructions"))),a.a.createElement("div",{className:"calculated-formula-question__step-1__question-text-container"},a.a.createElement(v.b,{activeEditorId:t,ariaLabelledBy:T,ariaRequired:!0,bbml:null===(e=d.questionText)||void 0===e?void 0:e.rawText,disableFocus:s,id:d.id,isReadOnly:!1,keepToolbarVisible:!1,onChange:this.handleQuestionTextChange,placeholder:O,plugins:n,pluginsConfig:c,refreshBbml:this.props.refreshBbml||this.state.refreshBbml,setActiveEditorId:h,onBlur:this.handleQuestionTextBlur,errorMessage:x?i(x):void 0,supportsInlineDocumentRender:this.props.supportsInlineDocumentRender,fileUploadSettings:y})),a.a.createElement("div",{className:"calculated-formula-question__step-1__question-formula-heading"},a.a.createElement(m.a,{component:"label",variant:"h4",required:!0,htmlFor:S},i("assessments.canvas.question.calculatedFormula.stepOne.questionFormulaTitle")),a.a.createElement(m.a,{component:"div",variant:"body1",className:"calculated-formula-question__step-1__question-field-instructions"},i("assessments.canvas.question.calculatedFormula.stepOne.questionFormulaInstructions"))),a.a.createElement("div",{className:"calculated-formula-question__step-1__formula-editor-container",id:S},a.a.createElement(g.a,{apiBasePath:Object(r.Db)(),className:Object(f.a)(`\n                            calculated-formula-question__step-1__formula-editor\n                            ${P(this.state)?"":"calculated-formula-question__step-1__formula-editor--error"}\n                        `),initialMathML:d.answerFormula,locale:l,isRtl:o(),onLoad:this.handleMathEditorLoad,onError:this.handleMathEditorError}),!P(this.state)&&a.a.createElement("span",{className:"calculated-formula-question__step-1__formula-error"},E?i(E,null!=C?C:{},{noWrap:!0}):null)),a.a.createElement(b.AnalyticsFormControlLabel,{label:i("assessments.canvas.question.calculatedFormula.stepOne.displayFormulaLabel"),htmlFor:"display-formula-to-students-checkbox",className:"display-formula-checkbox",control:a.a.createElement(b.AnalyticsCheckbox,{id:"display-formula-to-students-checkbox",onChange:this.toggleDisplayFormulaToStudent,checked:d.displayFormulaToStudent,analyticsId:`${u.a}.displayFormulaToStudents`}),analyticsId:`${u.a}.displayFormulaToStudents.label`}),a.a.createElement(k,{analyticsId:`${u.a}.stepOne`,showBack:!1,showNext:!0,isNextDisabled:!I(this.state),onNextClick:this.handleNextStepClick}),a.a.createElement(b.AnalyticsOffScreenAnnouncement,{type:"polite",analyticsId:"assessments.canvas.calculatedFormulaStep1.offScreenAnnouncement",message:i("assessments.canvas.question.calculatedFormula.stepOne.stepNumber"),changeTrigger:1}))}}var N=Object(h.a)(F),D=s("zGdY"),_=s("AuQm"),R=s("6GoY"),M=s("FgpP"),L=s("E1pj");function B(e,t,s){return function(e){return e===D.o.Numeric}(e)?t/s:t/100}function Q(e){return e>=0&&e<=100}function V(e){return D.n.SignificantFigures===e?1:0}function $({answerScale:e,correctAnswerPrecision:t}){const s=V(t);return Number.isFinite(e)&&function(e,t){return e>=t&&e<=50}(e,s)}function H({correctAnswerTolerance:e}){return Number.isFinite(e.value)}function z({allowPartialCredit:e,partialCreditPointsPercent:t}){return!e||Number.isFinite(t)&&Q(t)}function K({allowPartialCredit:e,partialCreditTolerance:t}){return!e||Number.isFinite(t.value)}function U({allowPartialCredit:e,correctAnswerTolerance:t,partialCreditTolerance:s,points:n}){const a=t&&B(t.type,t.value,n),i=s&&B(s.type,s.value,n);return 0===a||!e||i>=a}function G({allowPartialCredit:e,partialCreditPointsPercent:t,units:s}){return!e||!s.unitsRequired||t>s.unitPointsPercent}function W({units:e}){return e&&(!e.unitsRequired||Number.isFinite(e.unitPointsPercent)&&Q(e.unitPointsPercent))}function Y({units:e}){return e&&(!e.unitsRequired||!!e.unitValue)}function Z(e){const{maxValue:t,minValue:s,scale:n}=e;return Number.isFinite(t)&&Number.isFinite(s)&&Number.isFinite(n)&&function({maxValue:e,minValue:t}){return e>=t}(e)&&function({maxValue:e,minValue:t}){return t<=e}(e)&&function({scale:e}){return e>=0&&e<=50}(e)}function X(e){return function({answer:e}){return Number.isFinite(e)}(e)&&function({variableValues:e}){return Object.values(e).every((e=>Number.isFinite(e)))}(e)}const J="calculated-formula-question__step-2__variable-range-table",ee="assessments.canvas.question.calculatedFormula.stepTwo.variableRanges",te=`${ee}.table.input`,se=(e,t,s)=>{let n=null;return null!=t&&s<t?n=`${te}.error.lessThanMinimum`:null!=e&&s>e?n=`${te}.error.greaterThanMaximum`:null==s&&(n=`${te}.error.NaN`),n},ne=({analyticsId:e,ariaLabel:t,disabled:s,max:n,min:i,numberFormatOptions:o,onChange:r,onValidate:l,value:c})=>{const u=Object(y.a)(),d=se(n,i,c),p=null!=d&&u(d,{max:n,min:i});return a.a.useEffect((()=>{l(null==d)}),[d,l]),a.a.createElement(_.G,{analyticsId:`${e}.textField`,ariaLabel:t,className:`${J}__input`,disabled:s,helperText:p,max:n,min:i,numberFormatOptions:o,onChange:r,validate:e=>!se(n,i,e),value:null!=c?c:null})},ae=({disabled:e,maxValue:t,minValue:s,name:i,onChange:o,onValidate:r,scale:l})=>{const c=Object(y.a)(),[d,p]=Object(n.useState)(!0),[h,m]=Object(n.useState)(!0),[b,g]=Object(n.useState)(!0),f=d&&h&&b;a.a.useEffect((()=>{r(f)}),[f]);return a.a.createElement("tr",{className:`${J}__row`},a.a.createElement("th",{className:`${J}__header ${J}__header--row`,scope:"row"},i),a.a.createElement("td",{className:`${J}__cell ${J}__cell--min`},a.a.createElement(ne,{analyticsId:`${u.a}.variableRange.minimum`,ariaLabel:c(`${te}.ariaLabel.minimum`,{name:i}),disabled:e,max:t,onChange:e=>{o({minValue:e})},onValidate:m,value:s})),a.a.createElement("td",{className:`${J}__cell ${J}__cell--max`},a.a.createElement(ne,{analyticsId:`${u.a}.variableRange.maximum`,ariaLabel:c(`${te}.ariaLabel.maximum`,{name:i}),disabled:e,min:s,onChange:e=>{o({maxValue:e})},onValidate:p,value:t})),a.a.createElement("td",{className:`${J}__cell ${J}__cell--scale`},a.a.createElement(ne,{analyticsId:`${u.a}.variableRange.scale`,ariaLabel:c(`${te}.ariaLabel.decimalPlaces`,{name:i}),disabled:e,max:50,min:0,numberFormatOptions:{maximumFractionDigits:0},onChange:e=>{o({scale:e})},onValidate:g,value:l})))};function ie(e,t,s){return{...e,[t]:s}}function oe(e){return Object.values(e).every((e=>e))}const re=({disabled:e,onValidate:t,onVariableDefinitionChange:s,titleId:i,variableDefinitions:o})=>{const[r,l]=Object(n.useState)(function(e){return e.reduce(((e,t)=>ie(e,t.name,!0)),{})}(o)),c=Object(y.a)();Object(n.useEffect)((()=>{t(oe(r))}),[oe(r),t]);return a.a.createElement("table",{"aria-describedby":i,className:`${J}`},a.a.createElement("tbody",{className:`${J}__body`},a.a.createElement("tr",{className:`${J}__row`},a.a.createElement("td",null),a.a.createElement("th",{className:`${J}__header ${J}__header--column`,scope:"col"},c(`${ee}.table.headers.minimum`)),a.a.createElement("th",{className:`${J}__header ${J}__header--column`,scope:"col"},c(`${ee}.table.headers.maximum`)),a.a.createElement("th",{className:`${J}__header ${J}__header--column`,scope:"col"},c(`${ee}.table.headers.decimalPlaces`))),o&&o.map((t=>{if(!t)return null;const{maxValue:n,minValue:i,name:o,scale:c}=t;return a.a.createElement(ae,{disabled:e,key:o,maxValue:n,minValue:i,name:o,onChange:e=>{s({...t,...e})},onValidate:e=>{l(ie(r,o,e))},scale:c})}))))};var le=({disabled:e,onValidate:t,onVariableDefinitionChange:s,variableDefinitions:i})=>{const o=Object(y.a)(),[r]=Object(n.useState)(Object(L.getId)("calculated-question-variable-ranges-table-title-")),l=i&&i.length>0;return a.a.createElement("div",{className:`${J}__container`},a.a.createElement("h4",{className:`${J}__title`,id:r},o(`${ee}.title`)),l?a.a.createElement(re,{disabled:e,onValidate:t,onVariableDefinitionChange:s,titleId:r,variableDefinitions:i}):a.a.createElement("span",{className:`${J}__no-variables`},o(`${ee}.noVariables`)))},ce=s("8h7I");const ue="calculated-formula-question__step-2__answer-units",de="assessments.canvas.question.calculatedFormula.stepTwo.answerUnits";var pe=({onUnitPointsPercentChange:e,onUnitsRequiredChange:t,onUnitValueChange:s,onUnitPointsPercentBlur:i,onUnitValueBlur:o,unitPointsPercent:r,unitsRequired:l,unitValue:c,hasUnitValueEmptyError:d,hasUnitPointsPercentRangeError:p,hasUnitsGreaterThanPartialError:h})=>{const[m]=Object(n.useState)(Object(L.getId)("calculated-formula-question-instructions-")),g=Object(y.a)(),v=d?g(`${de}.error.empty`):null;let w=null;if(p)w=g(`${de}.error.outOfRange`);else if(h){w=g(`${"assessments.canvas.question.calculatedFormula.stepTwo.precisionScoring"}.partialCreditLessThanUnitsCreditError`)}return a.a.createElement("fieldset",{className:Object(f.a)(`\n                calculated-formula-question__step-2__fieldset\n                ${ue}__fieldset\n            `)},a.a.createElement("legend",{className:Object(f.a)(`\n                    calculated-formula-question__step-2__fieldset__legend\n                    ${ue}__legend\n                `)},g(`${de}.title`)),a.a.createElement(b.AnalyticsFormControlLabel,{label:g(`${de}.required`),htmlFor:"answer-units-required-checkbox",className:`${ue}__required-checkbox answer-units-required-checkbox`,control:a.a.createElement(b.AnalyticsCheckbox,{id:"answer-units-required-checkbox",onChange:t,checked:l,analyticsId:`${u.a}.answerUnits.required`}),analyticsId:`${u.a}.answerUnits.required.label`}),l&&a.a.createElement("div",{className:`${ue}__fields-container`},a.a.createElement("div",{className:`${ue}__units-container`},a.a.createElement(ce.TextField,{analyticsId:`${u.a}.answerUnits`,"aria-describedby":m,ariaLabel:g(`${de}.title`),className:`${ue}__units-input`,errorMessage:v,onBlur:o,onChanged:s,value:null!=c?c:""})),a.a.createElement("div",{className:`${ue}__units-input-instructions`,id:m},g(`${de}.instructions`)),a.a.createElement(_.G,{analyticsId:`${u.a}.answerUnits.pointsPercentage`,className:`${ue}__points-percentage-input`,helperText:w,label:g(`${de}.percentageLabel`),max:100,min:0,onBlur:i,onChange:e,validate:()=>!w,value:null!=r?r:null})))};const he="calculated-formula-question__step-2",me={correctAnswerTolerance:{type:D.o.Numeric,value:0}},be={partialCreditPointsPercent:0,partialCreditTolerance:{type:D.o.Numeric,value:0}},ge={unitValue:"",unitPointsPercent:0};function fe(e){return $(e)&&H(e)&&z(e)&&K(e)&&U(e)&&W(e)&&Y(e)&&function({variableDefinitions:e}){return null==e||e.every(Z)}(e)&&function({variableSetCount:e}){return Number.isFinite(e)&&e>=0}(e)}function ve(e){return e.hasFullGreaterThanPartialError||e.hasPartialCreditPointsRangeError||e.hasAnswerToleranceNaNError||e.hasPartialCreditToleranceNaNError||e.hasRoundingValueError||e.hasUnitPointsPercentRangeError||e.hasUnitsGreaterThanPartialError||e.hasUnitValueEmptyError||e.hasVariableRangeError||e.hasVariableSetCountNaNError||e.hasVariableSetCountLessThanOneError}class we extends n.Component{constructor(e){super(e),this.onFloatTextFieldChangeFactory=(e,t,s)=>n=>t?this.props.onQuestionChange({[t]:{...s,[e]:n}}):this.props.onQuestionChange({[e]:n}),this.onIntegerTextFieldChangeFactory=e=>t=>{this.props.onQuestionChange({[e]:t})},this.onTextFieldChangeFactory=(e,t,s)=>n=>{this.props.onQuestionChange({[t]:{...s,[e]:n}})},this.onDropdownChangedFactory=(e,t,s)=>n=>{this.props.onQuestionChange({[t]:{...s,[e]:n.key}})},this.onCheckboxChangeFactory=e=>t=>{this.props.onQuestionChange({[e]:t.target.checked})},this.updateCorrectAnswerFormat=(e,t)=>{this.props.onQuestionChange({correctAnswerFormat:null==t?void 0:t.key})},this.updateCorrectAnswerPrecision=e=>{const t={correctAnswerPrecision:e.key};e.key===D.n.SignificantFigures&&this.props.question.answerScale<1&&(t.answerScale=1),this.props.onQuestionChange(t)},this.handleVariableRangeError=e=>{this.setState({hasVariableRangeError:!e})},this.updateVariableDefinition=e=>{const{onAnswerSetsRelatedFieldDirty:t,onQuestionChange:s,question:n}=this.props,a=n.variableDefinitions.map((t=>t.name===e.name?{...t,...e}:t));t(!0),s({variableDefinitions:a})},this.getFullCreditRangeError=()=>{const{translateKey:e}=this.props,{hasFullGreaterThanPartialError:t,hasAnswerToleranceNaNError:s}=this.state;return s?e("stepTwo.variableSetCount.error.NaN"):t?e("stepTwo.precisionScoring.fullCreditRangeOverlapError"):""},this.getPartialCreditRangeError=()=>{const{translateKey:e}=this.props,{hasFullGreaterThanPartialError:t,hasPartialCreditToleranceNaNError:s}=this.state;return s?e("stepTwo.variableSetCount.error.NaN"):t?e("stepTwo.precisionScoring.partialCreditRangeOverlapError"):""},this.getPartialCreditPointsRangeError=()=>this.state.hasPartialCreditPointsRangeError?this.props.translateKey("stepTwo.precisionScoring.rangeError"):"",this.getVariableSetCountError=()=>{const{hasVariableSetCountNaNError:e,hasVariableSetCountLessThanOneError:t}=this.state,{translateKey:s}=this.props;return e?s("stepTwo.variableSetCount.error.NaN"):t?s("stepTwo.variableSetCount.error.negative"):""},this.getRoundingValueError=()=>{const{question:e,translateKey:t}=this.props,s=V(e.correctAnswerPrecision);return this.state.hasRoundingValueError?t("stepTwo.rounding.invalidInputError",{min:s,max:50}):""},this.handleGoToNextStep=()=>{const{question:e}=this.props;ve(this.state)||(fe(e)?this.props.onGoToNextStep():this.checkForErrors())},this.checkForErrors=()=>{this.setState(this.getErrorStateFromQuestion())},this.getErrorStateFromQuestion=()=>({...this.getPrecisionScoringErrorStateFromQuestion(),...this.getRoundingValueErrorStateFromQuestion(),...this.getUnitPointsPercentErrorStateFromQuestion(),...this.getUnitValueErrorStateFromQuestion(),...this.getVariableSetCountErrorStateFromQuestion()}),this.getPrecisionScoringErrorStateFromQuestion=()=>({hasFullGreaterThanPartialError:!U(this.props.question),hasPartialCreditPointsRangeError:!z(this.props.question),hasAnswerToleranceNaNError:!H(this.props.question),hasPartialCreditToleranceNaNError:!K(this.props.question),hasUnitsGreaterThanPartialError:!G(this.props.question)}),this.checkForPrecisionScoringErrors=()=>{this.setState(this.getPrecisionScoringErrorStateFromQuestion())},this.getRoundingValueErrorStateFromQuestion=()=>({hasRoundingValueError:!$(this.props.question)}),this.checkForRoundingValueError=()=>{this.setState(this.getRoundingValueErrorStateFromQuestion())},this.getUnitPointsPercentErrorStateFromQuestion=()=>({hasUnitPointsPercentRangeError:!W(this.props.question),hasUnitsGreaterThanPartialError:!G(this.props.question)}),this.checkForUnitPointsPercentErrors=()=>{this.setState(this.getUnitPointsPercentErrorStateFromQuestion())},this.getUnitValueErrorStateFromQuestion=()=>({hasUnitValueEmptyError:!Y(this.props.question)}),this.checkForUnitValueErrors=()=>{this.setState(this.getUnitValueErrorStateFromQuestion())},this.getVariableSetCountErrorStateFromQuestion=()=>{const{variableSetCount:e}=this.props.question;return{hasVariableSetCountNaNError:null==e,hasVariableSetCountLessThanOneError:null!=e&&e<1}},this.checkForVariableSetCountErrors=()=>{this.setState(this.getVariableSetCountErrorStateFromQuestion())},this.getToleranceTypeDropdown=(e,t,s,n)=>{const{translateKey:i}=this.props,o=[{key:D.o.Numeric,className:"calculated-formula-question__step-2__precision-type--numeric",text:i("stepTwo.precisionScoring.numberOption"),index:0,ariaLabel:i("stepTwo.precisionScoring.numberOption"),selected:e===D.o.Numeric},{key:D.o.Percent,className:"calculated-formula-question__step-2__precision-type--percent",text:i("stepTwo.precisionScoring.percentageOption"),index:1,ariaLabel:i("stepTwo.precisionScoring.percentageOption"),selected:e===D.o.Percent}];return a.a.createElement("div",{className:n},a.a.createElement(M.Dropdown,{analyticsId:`${s}.dropdown`,options:o,onChanged:t,selectedKey:e}))},this.getRoundingValueLabel=e=>{const{translateKey:t}=this.props;return e===D.n.Decimal?t("stepTwo.rounding.valueArialLabel.decimal"):t("stepTwo.rounding.valueArialLabel.significantFigure")},this.toggleAnswerToleranceOptionsVisibility=e=>{this.props.onQuestionChange({...me}),this.setState({areAnswerToleranceOptionsVisible:e.target.checked,hasFullGreaterThanPartialError:!1})},this.toggleAllowPartialCredit=e=>{const t=e.target.checked;this.props.onQuestionChange({...be,allowPartialCredit:t}),this.setState({hasPartialCreditPointsRangeError:!1,hasFullGreaterThanPartialError:!1,hasUnitsGreaterThanPartialError:!G({...this.props.question,allowPartialCredit:t})})},this.toggleUnitsRequired=e=>{const t=e.target.checked;this.props.onQuestionChange({units:{...ge,unitsRequired:t}}),this.setState({hasUnitPointsPercentRangeError:!1,hasUnitsGreaterThanPartialError:!1,hasUnitValueEmptyError:!1})};const{correctAnswerTolerance:t}=e.question;this.state={areAnswerToleranceOptionsVisible:t&&t.value>0,hasFullGreaterThanPartialError:!1,hasAnswerToleranceNaNError:!1,hasPartialCreditToleranceNaNError:!1,hasPartialCreditPointsRangeError:!1,hasRoundingValueError:!1,hasUnitPointsPercentRangeError:!1,hasUnitsGreaterThanPartialError:!1,hasUnitValueEmptyError:!1,hasVariableRangeError:!1,hasVariableSetCountNaNError:!1,hasVariableSetCountLessThanOneError:!1}}componentDidMount(){this.checkForErrors()}componentDidUpdate(e,t){const s=ve(t),n=ve(this.state);s!==n&&this.props.onValidate(!n),e.question.variableSetCount!==this.props.question.variableSetCount&&this.props.onAnswerSetsRelatedFieldDirty(!0)}render(){var e;const{areAnswerToleranceOptionsVisible:t,hasRoundingValueError:s,hasUnitPointsPercentRangeError:n,hasUnitsGreaterThanPartialError:i,hasUnitValueEmptyError:o}=this.state,{hasSubmissions:r,onGoBackStep:l,question:c,translateKey:d}=this.props,{answerScale:p,allowPartialCredit:h,correctAnswerFormat:m,correctAnswerPrecision:g,correctAnswerTolerance:v,displayRoundingSettingsToStudent:w,partialCreditPointsPercent:y,partialCreditTolerance:E,units:C,variableDefinitions:x,variableSetCount:O}=c,T=this.getRoundingValueLabel(g),S=this.getFullCreditRangeError(),q=this.getPartialCreditRangeError(),A=this.getPartialCreditPointsRangeError(),P=this.getVariableSetCountError();return a.a.createElement("div",{className:he},a.a.createElement("div",{className:"calculated-formula-question__step-2__answer-format"},a.a.createElement(R.ChoiceGroup,{analyticsId:`${u.a}.answerFormat.choiceGroup`,legendLabel:d("stepTwo.answerFormat.title"),defaultSelectedKey:m,options:[{key:D.m.Normal,text:d("stepTwo.answerFormat.normalOption"),checked:m===D.m.Normal},{key:D.m.Exponential,text:d("stepTwo.answerFormat.exponentialOption"),checked:m===D.m.Exponential}],onChange:this.updateCorrectAnswerFormat,disabled:r})),a.a.createElement("div",{className:"calculated-formula-question__step-2__rounding-inputs"},a.a.createElement(M.Dropdown,{analyticsId:`${u.a}.roundingType.dropdown`,selectedKey:g,label:d("stepTwo.rounding.title"),options:[{key:D.n.Decimal,text:d("stepTwo.rounding.decimalOption"),index:0,ariaLabel:d("stepTwo.rounding.decimalOption"),selected:g===D.n.Decimal},{key:D.n.SignificantFigures,text:d("stepTwo.rounding.significantFigureOption"),index:1,ariaLabel:d("stepTwo.rounding.significantFigureOption"),selected:g===D.n.SignificantFigures}],onChanged:this.updateCorrectAnswerPrecision,disabled:r}),a.a.createElement("div",{className:Object(f.a)(`\n                            calculated-formula-question__step-2__rounding-inputs__text-field\n                            ${s?"calculated-formula-question__step-2__rounding-inputs__text-field--has-error":""}\n                        `)},a.a.createElement(_.G,{analyticsId:`${u.a}.precisionScoring.rounding.textField`,ariaLabel:T,className:s?"has-error":"",disabled:r,helperText:this.getRoundingValueError(),onBlur:this.checkForRoundingValueError,onChange:this.onIntegerTextFieldChangeFactory("answerScale"),max:50,min:V(g),numberFormatOptions:{maximumFractionDigits:0},validate:()=>!this.getRoundingValueError(),value:p}))),a.a.createElement(b.AnalyticsFormControlLabel,{label:d("stepTwo.rounding.displayRoundingSettingsToStudent"),htmlFor:"display-rounding-settings-checkbox",className:"calculated-formula-question__step-2__display-rounding-settings__checkbox display-settings-checkbox",control:a.a.createElement(b.AnalyticsCheckbox,{id:"display-rounding-settings-checkbox",onChange:this.onCheckboxChangeFactory("displayRoundingSettingsToStudent"),checked:w,analyticsId:`${u.a}.displayRoundingSettings.checkbox`}),analyticsId:`${u.a}.displayRoundingSettings.label`}),a.a.createElement("fieldset",{className:"calculated-formula-question__step-2__fieldset calculated-formula-question__step-2__precision-scoring"},a.a.createElement("legend",{className:"calculated-formula-question__step-2__fieldset__legend"},d("stepTwo.precisionScoring.title")),a.a.createElement(b.AnalyticsFormControlLabel,{label:d("stepTwo.precisionScoring.fullCreditLabel"),htmlFor:"precision-scoring-full-credit-checkbox",className:"calculated-formula-question__step-2__full-credit-precision__checkbox display-settings-checkbox",control:a.a.createElement(b.AnalyticsCheckbox,{id:"precision-scoring-full-credit-checkbox",onChange:this.toggleAnswerToleranceOptionsVisibility,checked:t,analyticsId:`${u.a}.precisionScoring.fullCredit.checkbox`}),analyticsId:`${u.a}.precisionScoring.fullCredit.label`}),t&&a.a.createElement("div",{className:"calculated-formula-question__step-2__precision-scoring-input-group"},this.getToleranceTypeDropdown(v&&v.type,this.onDropdownChangedFactory("type","correctAnswerTolerance",v),`${u.a}.precisionScoring.fullCredit.toleranceType`,"calculated-formula-question__step-2__full-credit-precision__type-dropdown"),a.a.createElement(_.G,{analyticsId:`${u.a}.precisionScoring.fullCreditTolerance.textField`,className:"calculated-formula-question__step-2__full-credit-precision__value-input"+(S?" has-error":""),label:d("stepTwo.precisionScoring.positiveNegativeIndicator"),onBlur:this.checkForPrecisionScoringErrors,onChange:this.onFloatTextFieldChangeFactory("value","correctAnswerTolerance",v),helperText:S,validate:()=>!S,value:v.value})),a.a.createElement(b.AnalyticsFormControlLabel,{label:d("stepTwo.precisionScoring.partialCreditLabel"),htmlFor:"precision-scoring-partial-credit-checkbox",className:"calculated-formula-question__step-2__partial-credit-precision__checkbox precision-scoring-checkbox",control:a.a.createElement(b.AnalyticsCheckbox,{id:"precision-scoring-partial-credit-checkbox",onChange:this.toggleAllowPartialCredit,checked:h,analyticsId:`${u.a}.precisionScoring.partialCredit.checkbox`}),analyticsId:`${u.a}.precisionScoring.partialCredit.label`}),h&&a.a.createElement("div",null,a.a.createElement("div",{className:"calculated-formula-question__step-2__precision-scoring-input-group"},this.getToleranceTypeDropdown(E&&E.type,this.onDropdownChangedFactory("type","partialCreditTolerance",E),`${u.a}.precisionScoring.partialCredit.toleranceType`,"calculated-formula-question__step-2__partial-credit-precision__type-dropdown"),a.a.createElement(_.G,{analyticsId:`${u.a}.precisionScoring.partialCreditTolerance.textField`,className:"calculated-formula-question__step-2__partial-credit-precision-value-input"+(q?" has-error":""),helperText:q,label:d("stepTwo.precisionScoring.positiveNegativeIndicator"),onBlur:this.checkForPrecisionScoringErrors,onChange:this.onFloatTextFieldChangeFactory("value","partialCreditTolerance",E),validate:()=>!q,value:E.value})),a.a.createElement(_.G,{analyticsId:`${u.a}.precisionScoring.partialCredit.creditToAward.textField`,className:"calculated-formula-question__step-2__precision-scoring-partial-credit-percentage"+(A?" has-error":""),helperText:A,label:d("stepTwo.precisionScoring.creditToAwardLabel"),onChange:this.onFloatTextFieldChangeFactory("partialCreditPointsPercent"),onBlur:this.checkForPrecisionScoringErrors,max:100,min:0,validate:()=>!A,value:y}))),a.a.createElement(pe,{hasUnitPointsPercentRangeError:n,hasUnitsGreaterThanPartialError:i,hasUnitValueEmptyError:o,onUnitPointsPercentChange:this.onFloatTextFieldChangeFactory("unitPointsPercent","units",C),onUnitPointsPercentBlur:this.checkForUnitPointsPercentErrors,onUnitsRequiredChange:this.toggleUnitsRequired,onUnitValueBlur:this.checkForUnitValueErrors,onUnitValueChange:this.onTextFieldChangeFactory("unitValue","units",C),unitPointsPercent:C.unitPointsPercent,unitsRequired:null!==(e=C.unitsRequired)&&void 0!==e&&e,unitValue:C.unitValue}),a.a.createElement(le,{disabled:r,onValidate:this.handleVariableRangeError,onVariableDefinitionChange:this.updateVariableDefinition,variableDefinitions:x}),a.a.createElement(_.G,{analyticsId:`${u.a}.answerSetCount.textField`,className:"calculated-formula-question__step-2__variable-answer-sets-input"+(P?" has-error":""),disabled:r||!Object(u.c)(this.props.question),helperText:P,label:d("stepTwo.variableSetCount.title"),numberFormatOptions:{maximumFractionDigits:0},min:1,onBlur:this.checkForVariableSetCountErrors,onChange:this.onIntegerTextFieldChangeFactory("variableSetCount"),required:!0,validate:()=>!P,value:O,id:"calculated_formula_question_sets"}),a.a.createElement(k,{analyticsId:`${u.a}.stepTwo`,showBack:!0,onBackClick:l,showNext:!0,isNextDisabled:ve(this.state),onNextClick:this.handleGoToNextStep}),a.a.createElement(b.AnalyticsOffScreenAnnouncement,{analyticsId:"assessments.canvas.calculatedFormulaStep2.offScreenAnnouncement",type:"polite",message:d("stepTwo.stepNumber"),changeTrigger:1}))}}var ye=we,Ee=s("+oLC"),Ce=s("WBPx"),xe=s("Begd"),Oe=s("XBaz"),Te=s("C+e0");const ke="calculated-formula-question__step-3__variable-value-table",Se="assessments.canvas.question.calculatedFormula.stepThree.variableValueTable",qe=Object(Te.a)((({disabled:e,localize:t,result:s,rowNumber:n,ident:i,calculateRow:o,isDirty:r,isRecalculatingVariableSets:l,isExponential:c,scale:d,currentLocale:p,roundToSignificantFigures:h,hasError:m,resultId:b})=>{const g=!(null!=s&&Number.isFinite(s))||m,v=g?t.translate(`${Se}.resultError`,{row:n}):((e,t,s,n,a,i)=>{var o,r,l,c;const d=null!==(c=null===(l=null===(r=null===(o=null==e?void 0:e.babelfishFormat)||void 0===o?void 0:o.number)||void 0===r?void 0:r.getDecimalStringSync)||void 0===l?void 0:l.call(r,t))&&void 0!==c?c:".",{SignificantFigures:p,Decimal:h}=D.n,{Normal:m,Exponential:b}=D.m,g=Object(u.p)(s,n,a?b:m,i?p:h);return a&&null!=g?g.toExponential().replace(".",d):e.formatNumber(g,{maximumFractionDigits:n})})(t,p,s,d,c,h);return a.a.createElement("td",{className:`${ke}__cell--result`},a.a.createElement("span",{className:`${ke}__result-flex-wrapper`},a.a.createElement("span",{id:b,className:Object(f.a)(`\n                        ${ke}__result\n                        ${g?`${ke}__result--error`:""}\n                    `)},l?"":v),!l&&r&&!m&&a.a.createElement(E.AnalyticsIconButton,{analyticsId:`${u.a}.stepThree.variableValueTable.refresh`,"aria-label":t.translate(`${Se}.refresh.ariaLabel`,{row:n}),disabled:e,onClick:()=>null==o?void 0:o(i)},a.a.createElement(Oe.a,null))))})),Ae=({ariaDescribedBy:e,ariaLabel:t,disabled:s,hasError:n,value:i,isRecalculatingVariableSets:o,updateVariableValue:r,ident:l,variableName:c,onFocus:d,scale:p})=>a.a.createElement(_.G,{analyticsId:`${u.a}.stepThree.variableValueTable.textField`,ariaDescribedBy:n?e:void 0,ariaLabel:t,className:`${ke}__input`,disabled:o||s,numberFormatOptions:{maximumFractionDigits:20,minimumFractionDigits:p},onChange:e=>null==r?void 0:r(l,c,e),onFocus:d,validate:()=>!n,value:null!=i?i:null,maintainInputValueOnBlur:!0,hideErrorMessage:!0}),Pe=Object(Te.a)((({disabled:e,localize:t,rowNumber:s,variableSet:n,isRecalculatingVariableSets:i,calculateRow:o,updateVariableValue:r,isDirty:l,onInputFocus:c,isExponential:u,scale:d,roundToSignificantFigures:p,scaleMap:h})=>{var m;const b=`variable-value-set-result-${n.ident}`;return a.a.createElement("tr",{className:`${ke}__row--data`},a.a.createElement("th",{className:`${ke}__header ${ke}__header--row`,scope:"row"},t.formatNumber(s)),Object.keys(n.variableValues).map((o=>{var l;return a.a.createElement("td",{className:`${ke}__cell`,key:`${n.ident}-${o}`},a.a.createElement(Ae,{ariaDescribedBy:b,ariaLabel:t.translate(`${Se}.input.ariaLabel`,{variable:o,row:s}),disabled:e,hasError:!Number.isFinite(n.variableValues[o]),value:null!==(l=n.variableValues[o])&&void 0!==l?l:void 0,isRecalculatingVariableSets:i,updateVariableValue:r,variableName:o,ident:n.ident,onFocus:c,scale:h[o]}))})),a.a.createElement(qe,{calculateRow:o,disabled:e,hasError:!X(n),ident:n.ident,isDirty:l,isExponential:u,isRecalculatingVariableSets:i,result:null!==(m=n.answer)&&void 0!==m?m:void 0,resultId:b,roundToSignificantFigures:p,rowNumber:s,scale:d}))}));var Ie=Object(Te.a)((({disabled:e,localize:t,variableSets:s,isRecalculatingVariableSets:i,calculateRow:o,updateVariableValue:r,dirtyRowMap:l,correctAnswerTolerance:c,unitsText:d,isExponential:p,scale:h,roundToSignificantFigures:m,scaleMap:b})=>{if(!s)return null;const g=Object(n.useRef)(),v=Object(n.useRef)(),w=e=>{((e,t,s)=>{if(!s||!t)return;const n=(e=>{const t=e.getBoundingClientRect();return{left:t.left-2,right:t.right+2}})(e),a=((e,t)=>{var s;const n=null===(s=e.getBoundingClientRect())||void 0===s?void 0:s.width,a=t.offsetWidth-t.clientWidth,i=t.getBoundingClientRect(),o=i.right-n-a;return{left:i.left,right:o}})(t,s),i=n.right-a.right,o=n.left-a.left;n.right>a.right&&(s.scrollLeft+=i),n.left<a.left&&(s.scrollLeft+=o)})(e.target,g.current,v.current)},y=((e,t,s)=>{const n=Object(u.h)(t),a=Object(u.i)(t),i=`${Se}.resultColumnHeader`,o=Object(u.g)(i,n,a,s);return o?e.translate(o,{unitsText:s,answerToleranceValue:a}):null})(t,c,d);return a.a.createElement("table",{"aria-label":t.translate(`${Se}.title`),className:`${ke}`,ref:v},a.a.createElement("tbody",{className:`${ke}__body`},a.a.createElement("tr",{className:`${ke}__row--header`},a.a.createElement("td",{className:`${ke}__header ${ke}__header--column`}),Object.keys(s[0].variableValues).map((e=>a.a.createElement("th",{className:`${ke}__header ${ke}__header--column`,key:e,scope:"col"},e))),a.a.createElement("th",{className:`${ke}__header ${ke}__header--column--result`,scope:"col",ref:g},a.a.createElement("span",{className:Object(f.a)(`\n                                ${ke}__header--column--result--contents\n                            `)},a.a.createElement("span",null,t.translate(`${Se}.answer`)),y&&a.a.createElement("span",{className:`${ke}__header--column--result--contents--info`},y)))),s&&s.map(((t,s)=>{var n;return a.a.createElement(Pe,{calculateRow:o,disabled:e,isDirty:null!==(n=null==l?void 0:l[t.ident])&&void 0!==n&&n,isExponential:p,isRecalculatingVariableSets:i,key:t.ident,onInputFocus:w,roundToSignificantFigures:m,rowNumber:s+1,scale:h,updateVariableValue:r,variableSet:t,scaleMap:b})}))))}));const je="calculated-formula-question__step-3";function Fe({question:e}){return function({variableSets:e}){return e.every((e=>X(e)))}(e)}class Ne extends n.Component{constructor(e){super(e),this.closeTablePanel=()=>{this.setState({isTablePanelOpen:!1})},this.renderRecalculateButton=()=>{const{hasSubmissions:e,t,isRecalculatingVariableSets:s}=this.props,n={};return s?a.a.createElement(Ce.AnalyticsOutlineButton,{className:"calculated-formula-question__step-3__calculate-button",disabled:!0,style:n,analyticsId:`${u.a}.stepThree.calculateButton.outlineButton`},a.a.createElement(xe.Spinner,{size:xe.SpinnerSize.small}),a.a.createElement("span",{className:"calculated-formula-question__step-3__calculate-button-label calculated-formula-question__step-3__calculate-button-label--loading"},t("assessments.canvas.question.calculatedFormula.stepThree.calculateButtonLoadingState"))):a.a.createElement(Ce.AnalyticsOutlineButton,{className:"calculated-formula-question__step-3__calculate-button",disabled:e,onClick:this.calculateMultipleRows,style:n,analyticsId:`${u.a}.stepThree.calculateButton.outlineButton`},a.a.createElement(Oe.a,null),a.a.createElement("span",{className:"calculated-formula-question__step-3__calculate-button-label"},t("assessments.canvas.question.calculatedFormula.stepThree.calculateButton")))},this.calculateMultipleRows=()=>{const{calculateMultipleRows:e,question:t}=this.props;e(t.variableSets),this.props.resetDirtyRowMap()},this.renderTable=()=>{const{hasSubmissions:e,t,question:s,isRecalculatingVariableSets:n,repopulateTable:i}=this.props;return a.a.createElement("div",{className:"calculated-formula-question__step-3__table-wrapper"},a.a.createElement("div",{className:"calculated-formula-question__step-3__table-buttons"},a.a.createElement(Ce.AnalyticsDefaultButton,{analyticsId:`${u.a}.stepThree.repopulateAnswers.defaultButton`,className:"calculated-formula-question__step-3__repopulate-button",disabled:n||e,onClick:i},t("assessments.canvas.question.calculatedFormula.stepThree.repopulateButton")),this.renderRecalculateButton()),a.a.createElement(Ie,{correctAnswerTolerance:s.correctAnswerTolerance,calculateRow:this.calculateRow,dirtyRowMap:this.props.dirtyRowMap,disabled:e,isExponential:s.correctAnswerFormat===D.m.Exponential,isRecalculatingVariableSets:n,roundToSignificantFigures:s.correctAnswerPrecision===D.n.SignificantFigures,scale:s.answerScale,unitsText:s.units&&s.units.unitsRequired?s.units.unitValue:void 0,updateVariableValue:this.updateVariableValue,variableSets:s.variableSets,scaleMap:Object(u.e)(s.variableDefinitions)}))},this.renderOpenTablePanelButton=()=>{const{t:e}=this.props;return a.a.createElement("div",{className:"calculated-formula-question__step-3__preview-answer-sets-button-container"},a.a.createElement(Ce.AnalyticsDefaultButton,{analyticsId:`${u.a}.stepThree.mobile.previewAnswerSets.defaultButton`,onClick:()=>{this.setState({isTablePanelOpen:!0})}},e("assessments.canvas.question.calculatedFormula.stepThree.previewAnswerSets")))},this.renderNoVariableAnswer=()=>{const{t:e,question:t}=this.props,{correctAnswerTolerance:s,units:n,variableSets:i}=t,o=Object(u.h)(s),r=Object(u.i)(s),l="assessments.canvas.question.calculatedFormula.stepThree.answer";let c=Object(u.g)(l,o,r,n.unitValue);c=null==c?`${l}.plain`:c;const d=e(c,{answer:i[0].answer,unitValue:n.unitValue,answerToleranceValue:r});return a.a.createElement(a.a.Fragment,null,a.a.createElement(m.a,{component:"h4",variant:"h4"},e("assessments.canvas.question.calculatedFormula.stepThree.variableValueTable.answer")),a.a.createElement("div",{className:"calculated-formula-question__step-3__answer"},d))},this.renderAnswerData=()=>{var e;const{UltraWindowSize:t}=this.props,s=null!==(e=null==t?void 0:t.isSmallBreakpoint())&&void 0!==e&&e;return Object(u.c)(this.props.question)?s?this.renderOpenTablePanelButton():this.renderTable():this.renderNoVariableAnswer()},this.renderTablePanel=()=>{var e;const{t,UltraWindowSize:s}=this.props,{isTablePanelOpen:n}=this.state;if(!Object(u.c)(this.props.question))return null;const i=null!==(e=null==s?void 0:s.isSmallBreakpoint())&&void 0!==e&&e;return a.a.createElement(Ee.BbPanel,{analyticsId:`${u.a}.mobile.previewAnswerSetsPanel.bbPanel`,className:"calculated-formula-question__step-3__answerSetsPanel",excludeContentPadding:!0,isOpen:n&&i,onDismiss:this.closeTablePanel,type:Ee.BbPanelType.peek},a.a.createElement(Ee.BbPanelHeader,{analyticsId:`${u.a}.mobile.previewAnswerSetPanel.header`,title:t("assessments.canvas.question.calculatedFormula.stepThree.previewAnswerSetsPanel.title"),navMenuAriaLabel:t("global.navigationMenu")}),this.renderTable(),a.a.createElement(Ee.BbPanelFooter,{analyticsId:`${u.a}.mobile.previewAnswerSetPanel.bbPanelFooter`,primaryButtonProps:{text:t("assessments.canvas.question.calculatedFormula.stepThree.previewAnswerSetsPanel.saveAndClose"),onClick:this.closeTablePanel}}))},this.calculateRow=e=>{var t;const{courseId:s,question:n}=this.props,a=q.a.find(n.variableSets,(t=>t.ident===e));Object(r.sb)(s,n.answerFormula,null!==(t=null==a?void 0:a.variableValues)&&void 0!==t?t:{}).then((t=>{this.updateCalculatedRow(e,t.result)}),(()=>{this.updateCalculatedRow(e,null)}))},this.updateCalculatedRow=(e,t)=>{const{onQuestionChange:s,question:n}=this.props,a=n.variableSets.map((s=>s.ident===e?{...s,answer:Object(u.p)(t,n.answerScale,n.correctAnswerFormat,n.correctAnswerPrecision)}:s));this.props.updateDirtyRowMapValue(e,!1),s({variableSets:a})},this.updateVariableValue=(e,t,s)=>{const{question:n,onQuestionChange:a}=this.props,i=n.variableSets.map((n=>n.ident===e&&t?{...n,variableValues:{...n.variableValues,[t]:s}}:n));this.props.updateDirtyRowMapValue(e,!0),a({variableSets:i})},this.state={isTablePanelOpen:!1}}componentDidUpdate(e){Fe(e)!==Fe(this.props)&&this.props.onValidate(Fe(this.props))}render(){var e;const{t,question:s}=this.props;return a.a.createElement("div",{className:je},this.renderTablePanel(),a.a.createElement("div",{className:"calculated-formula-question__step-3__preview-question"},a.a.createElement(m.a,{component:"h4",variant:"h4"},t("assessments.canvas.question.calculatedFormula.stepThree.previewQuestion.questionTextTitle")),a.a.createElement(v.b,{bbml:null===(e=s.questionText)||void 0===e?void 0:e.rawText,id:`${s.id}-preview`,isReadOnly:!0}),a.a.createElement(m.a,{component:"h4",variant:"h4"},t("assessments.canvas.question.calculatedFormula.stepThree.previewQuestion.answerFormulaTitle")),a.a.createElement("img",{className:"calculated-formula-question__step-3__formula-image",src:s.mathMLImageURL,alt:s.mathMLImageAltText})),this.renderAnswerData(),a.a.createElement(k,{analyticsId:`${u.a}.stepThree`,showBack:!0,onBackClick:this.props.onGoBackStep,showNext:!1}),a.a.createElement(b.AnalyticsOffScreenAnnouncement,{analyticsId:"assessments.canvas.calculatedFormulaStep3.offScreenAnnouncement",type:"polite",message:t("assessments.canvas.question.calculatedFormula.stepThree.stepNumber"),changeTrigger:1}))}}const De=Object(L.windowResizingResponsiveComponentWrapper)(Ne);var _e=Object(o.a)(De);function Re(e){return q.a.keys(e).some((t=>!0===e[t]))}class Me extends n.Component{constructor(e){super(e),this.onQuestionChange=e=>{const{onQuestionChange:t,question:s}=this.props,n={...s,...e};Object(d.d)(s,n)&&t(n,this.shouldEnableSaveButton)},this.goToStep1=()=>{this.setState({activeStep:u.b.ONE})},this.goToStep2=()=>{this.setState({activeStep:u.b.TWO})},this.goToStep3=()=>{const{needAllNewVariableSets:e,needToRecalculateExistingVariableSets:t}=this.state,{question:s}=this.props,n=s.variableSetCount-s.variableSets.length;let a;e?a=this.generateVariableSets(s.variableSetCount):n>0?a=s.variableSets.concat(this.generateVariableSets(n,s.variableSets.length)):n<0&&(a=s.variableSets.slice(0,s.variableSetCount)),e||n>0?this.calculateMultipleRows(a):t&&this.calculateMultipleRows(s.variableSets),a&&this.onQuestionChange({variableSets:a}),this.setState({activeStep:u.b.THREE,isStepOneAnswerSetsRelatedFieldDirty:!1,isStepTwoAnswerSetsRelatedFieldDirty:!1,needAllNewVariableSets:!1,needToRecalculateExistingVariableSets:!1})},this.isEveryStepValidAndClean=(e,t)=>{const{isStepOneAnswerSetsRelatedFieldDirty:s,isStepTwoAnswerSetsRelatedFieldDirty:n,isStepThreeAnswerSetsRelatedFieldDirty:a,isStepOneValid:i,isStepTwoValid:o,isStepThreeValid:r}=this.state,l=t.units&&t.units.unitsRequired&&t.units.unitValue.length<1;return i&&o&&r&&!s&&!n&&!a&&!l},this.shouldEnableSaveButton=(e,t)=>Object(d.d)(this.originalQuestion,t)&&this.isEveryStepValidAndClean(e,t),this.handleValidateStepOne=e=>{this.setState({isStepOneValid:e})},this.handleValidateStepTwo=e=>{this.setState({isStepTwoValid:e})},this.handleValidateStepThree=e=>{this.setState({isStepThreeValid:e})},this.handleStepOneAnswerSetsRelatedFieldDirty=e=>{this.setState({isStepOneAnswerSetsRelatedFieldDirty:e})},this.handleStepTwoAnswerSetsRelatedFieldDirty=e=>{this.setState({isStepTwoAnswerSetsRelatedFieldDirty:e})},this.getFullLocalizationKey=e=>`assessments.canvas.question.calculatedFormula.${e}`,this.translateKey=(e,t)=>{const{t:s}=this.props;return s(this.getFullLocalizationKey(e),t)},this.buildMathMLEvaluation=(e,t,s)=>({mathML:e,variables:t,ident:s}),this.generateVariableSets=(e,t=0)=>{const{question:s}=this.props,n=[];for(let a=0;a<e;a+=1)n.push({ident:`ident-${a+t}`,variableValues:Object(u.f)(s.variableDefinitions),answer:null});return n},this.calculateMultipleRows=e=>{const{courseId:t,question:s}=this.props,n=this.generateMathMLEvaluationsFromVariableSets(e);return this.setState({isRecalculatingVariableSets:!0}),Object(r.Y)(t,n).then((e=>{const t=[...s.variableSets];e.forEach(((e,a)=>{const i=n[a],o=q.a.findIndex(t,(e=>e.ident===i.ident)),r={answer:Object(u.p)(e.result,s.answerScale,s.correctAnswerFormat,s.correctAnswerPrecision),variableValues:{...i.variables},ident:i.ident};o>-1?t[o]=r:t.push(r)})),this.setState({isRecalculatingVariableSets:!1}),this.resetAnswerSetDirtyRowMap(),this.onQuestionChange({variableSets:t})}))},this.repopulateTable=()=>{this.calculateMultipleRows(this.generateVariableSets(this.props.question.variableSetCount)),this.setState({needToRecalculateExistingVariableSets:!1,needAllNewVariableSets:!1,isStepThreeAnswerSetsRelatedFieldDirty:!1})},this.generateMathMLEvaluationsFromVariableSets=e=>{const{question:t}=this.props,s=[];return e.forEach((e=>{s.push(this.buildMathMLEvaluation(t.answerFormula,e.variableValues,e.ident))})),s},this.updateAnswerSetDirtyRowMapValue=(e,t)=>{this.setState((s=>{const n={...s.answerSetTableDirtyRowMap};return e&&(n[e]=t),{answerSetTableDirtyRowMap:n}}))},this.resetAnswerSetDirtyRowMap=()=>{this.setState((e=>{const t={...e.answerSetTableDirtyRowMap};return q.a.keys(t).forEach((e=>{t[e]=!1})),{answerSetTableDirtyRowMap:t}}))},this.generateAnalyticsLinearProgressElement=e=>{var t;const{UltraWindowSize:s}=this.props;return null!==(t=null==s?void 0:s.isSmallBreakpoint())&&void 0!==t&&t&&window.Modernizr.touch?a.a.createElement(l.a,{ariaLabel:this.translateKey("progressBarAriaLabel"),variant:"determinate",value:(n=e,(n+1)/Object.keys(u.b).length*100)}):null;var n},this.originalQuestion=e.question,this.state={activeStep:u.b.ONE,answerSetTableDirtyRowMap:{},isRecalculatingVariableSets:!1,isStepOneAnswerSetsRelatedFieldDirty:!1,isStepTwoAnswerSetsRelatedFieldDirty:!1,isStepThreeAnswerSetsRelatedFieldDirty:!1,isStepOneValid:!0,isStepTwoValid:!0,isStepThreeValid:!0,needAllNewVariableSets:!e.question.variableSets||0===e.question.variableSets.length,needToRecalculateExistingVariableSets:!1}}componentDidUpdate(e,t){const{question:s}=e,{question:n}=this.props,{isStepOneAnswerSetsRelatedFieldDirty:a,isStepTwoAnswerSetsRelatedFieldDirty:i,isStepThreeAnswerSetsRelatedFieldDirty:o,isStepOneValid:r,isStepTwoValid:l,isStepThreeValid:c}=this.state,d=Object(u.m)(s.variableDefinitions,n.variableDefinitions),p=s.answerFormula!==n.answerFormula,h=Re(this.state.answerSetTableDirtyRowMap),m=Re(t.answerSetTableDirtyRowMap)!==h;(d||p||m)&&this.setState({needAllNewVariableSets:d||t.needAllNewVariableSets,needToRecalculateExistingVariableSets:p||t.needToRecalculateExistingVariableSets,isStepThreeAnswerSetsRelatedFieldDirty:m?h:t.isStepThreeAnswerSetsRelatedFieldDirty}),a===t.isStepOneAnswerSetsRelatedFieldDirty&&i===t.isStepTwoAnswerSetsRelatedFieldDirty&&o===t.isStepThreeAnswerSetsRelatedFieldDirty&&r===t.isStepOneValid&&l===t.isStepTwoValid&&c===t.isStepThreeValid&&(n.units&&n.units.unitValue)===(s.units&&s.units.unitValue)&&(n.units&&n.units.unitsRequired)===(s.units&&s.units.unitsRequired)||this.props.onQuestionChange(n,this.shouldEnableSaveButton)}render(){const{activeEditorId:e,courseId:t,hasSubmissions:s,question:n,setActiveEditorId:i,pluginsConfig:o,assessmentType:r,assessmentId:l}=this.props,{activeStep:d,answerSetTableDirtyRowMap:h,isRecalculatingVariableSets:m,isStepOneValid:b,isStepTwoValid:g,isStepThreeValid:f}=this.state,v=this.translateKey("iconLabel.active"),w=this.translateKey("iconLabel.completed"),y=this.translateKey("iconLabel.error"),E=this.translateKey("iconLabel.incomplete");return a.a.createElement("div",{className:"calculated-formula-question-edit"},this.generateAnalyticsLinearProgressElement(d),a.a.createElement(c.d,{activeStep:d,orientation:"vertical"},a.a.createElement(c.a,{key:"step1"},a.a.createElement(c.c,{analyticsId:`${u.a}.stepOne.stepLabel`,disabled:d<=u.b.ONE,error:!b,onClick:this.goToStep1,iconId:"step1Icon",activeLabel:v,completedLabel:w,errorLabel:y,inCompleteLabel:E,stepNumber:this.translateKey("stepOne.stepNumber"),stepDescription:this.translateKey("stepOne.stepDescription")}),a.a.createElement(c.b,null,a.a.createElement(N,{...this.props,courseId:t,onAnswerSetsRelatedFieldDirty:this.handleStepOneAnswerSetsRelatedFieldDirty,onGoToNextStep:this.goToStep2,onQuestionChange:this.onQuestionChange,onValidate:this.handleValidateStepOne,question:n}))),a.a.createElement(c.a,{key:"step2"},a.a.createElement(c.c,{analyticsId:`${u.a}.stepTwo.stepLabel`,disabled:d<=u.b.TWO,error:!g,onClick:this.goToStep2,iconId:"step2Icon",activeLabel:v,completedLabel:w,errorLabel:y,inCompleteLabel:E,stepNumber:this.translateKey("stepTwo.stepNumber"),stepDescription:this.translateKey("stepTwo.stepDescription")}),a.a.createElement(c.b,null,a.a.createElement(ye,{hasSubmissions:s,onAnswerSetsRelatedFieldDirty:this.handleStepTwoAnswerSetsRelatedFieldDirty,onGoBackStep:this.goToStep1,onGoToNextStep:this.goToStep3,onQuestionChange:this.onQuestionChange,onValidate:this.handleValidateStepTwo,question:n,translateKey:this.translateKey}))),a.a.createElement(c.a,{key:"step3"},a.a.createElement(c.c,{disabled:d<=u.b.THREE,error:!f,onClick:this.goToStep3,iconId:"step3Icon",activeLabel:v,completedLabel:w,errorLabel:y,inCompleteLabel:E,stepNumber:this.translateKey("stepThree.stepNumber"),stepDescription:this.translateKey("stepThree.stepDescription"),analyticsId:`${u.a}.stepThree.stepLabel`}),a.a.createElement(c.b,null,a.a.createElement(_e,{calculateMultipleRows:this.calculateMultipleRows,courseId:t,dirtyRowMap:h,hasSubmissions:s,isRecalculatingVariableSets:m,onGoBackStep:this.goToStep2,onQuestionChange:this.onQuestionChange,onValidate:this.handleValidateStepThree,question:n,repopulateTable:this.repopulateTable,resetDirtyRowMap:this.resetAnswerSetDirtyRowMap,updateDirtyRowMapValue:this.updateAnswerSetDirtyRowMapValue})))),a.a.createElement(p.c,{assessmentId:l,activeEditorId:e,onQuestionChange:this.onQuestionChange,question:n,setActiveEditorId:i,pluginsConfig:o,assessmentType:r}))}}const Le=Object(o.a)(Me);var Be=Object(L.windowResizingResponsiveComponentWrapper)(Le),Qe=s("1mOI"),Ve=s("UJ5P"),$e=s("NH8g"),He=s("+phe"),ze=s("7k4i"),Ke=s("4raK"),Ue=s("sptZ");var Ge=Object(ze.a)((e=>{const{editMode:t,question:s,detailsHidden:n,questionTitle:o,readonlyPoints:r,extraCreditVisibility:l}=e,c=Object(y.a)(),u=Ve.a.ACTIVE===t,p=!n||u,h=u&&Object(d.i)(s);return a.a.createElement("div",null,a.a.createElement(i.a,{editMode:t,question:s},p?a.a.createElement(a.a.Fragment,null,a.a.createElement($e.a,{...Object($e.b)(Vs(e,c),(t=>{const n={...s,...t};e.onQuestionChange(n,d.c)}))}),a.a.createElement(Ue.a,{show:h,question:s})):a.a.createElement(Ke.a,{question:e.question,questionTitle:o,readonlyPoints:r,extraCreditVisibility:l}),a.a.createElement(He.a,{...Object(He.b)(e)}),u?a.a.createElement(Be,{...e,question:s}):null,u||n?null:a.a.createElement(Qe.a,{...e,question:s})))})),We=s("7O4Y"),Ye=s("RxZr"),Ze=s("ufrm"),Xe=s("Rb2q"),Je=s("Agfx");const et=Object(Je.makeStyles)((e=>Object(Je.createStyles)({root:{backgroundColor:e.palette.background.paper,border:`1px solid ${e.palette.border.main}`,borderTop:"none",padding:"20px"},answerLabelTooltip:{minWidth:"30px",minHeight:"0px"},textFieldContainer:{maxWidth:"300px",display:"block"},textField:{width:"100%",'& input[type="text"]':{margin:0,border:"none"}},checkboxLabel:{marginBottom:"-3px",marginLeft:"-8px"},checkboxLabelDescription:{color:e.palette.text.secondary,marginLeft:"24px"},toleranceTextFieldContainer:{marginLeft:"24px",marginTop:"6px"},toleranceTextField:{marginTop:"15px"},helperText:{display:"block"}})));var tt=s("G52d"),st=s("ECG1");var nt=e=>{const t=et(),s=Object(y.a)(),{question:n,assessmentType:i,assessmentId:o}=e,[r,l]=a.a.useState(Object(tt.b)(e.question)),c=()=>a.a.createElement(a.a.Fragment,null,a.a.createElement("span",{className:t.helperText},s("assessments.canvas.question.calculatedNumeric.inputHelperText.allowedValues")),a.a.createElement("span",{className:t.helperText},s("assessments.canvas.question.calculatedNumeric.inputHelperText.maxDigits"))),u=t=>{const s={...e.question,...t};e.onQuestionChange(s,d.e)},h=e=>t=>{u({[e]:t})};return a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:Object(We.a)(t.root,"js-calculated-numeric-question-edit")},a.a.createElement("div",{className:Object(We.a)(t.textFieldContainer,"js-calculated-numeric-question-edit-answer-text-field")},a.a.createElement(Ye.b,{className:t.textField,id:"calculated-numeric-answer-input",label:a.a.createElement(a.a.Fragment,null,s("assessments.canvas.question.calculatedNumeric.answer.label"),a.a.createElement(b.AnalyticsTooltip,{className:t.answerLabelTooltip,analyticsId:"assessments.canvas.question.calculatedNumeric.answerLabel.tooltip",title:s("assessments.canvas.question.calculatedNumeric.answer.tooltip.content"),placement:"top"},a.a.createElement(b.AnalyticsIconButton,{analyticsId:"assessments.canvas.question.calculatedNumeric.answerLabel.tooltip.icon","aria-label":s("assessments.canvas.question.calculatedNumeric.answer.tooltip.ariaLabel")},a.a.createElement(st.a,null)))),analyticsId:"assessments.canvas.question.calculatedNumeric.answer.input",value:n.answerValue,onChange:h("answerValue"),helperText:c(),numberFormatOptions:{maximumFractionDigits:Ye.c},maintainInputValueOnBlur:!0,required:!0,displayWesternNumbers:!0})),a.a.createElement("hr",null),a.a.createElement(Xe.a,{label:s("assessments.canvas.question.calculatedNumeric.tolerance.checkbox.label"),className:Object(We.a)(t.checkboxLabel,"js-calculated-numeric-tolerance-checkbox-label"),htmlFor:"calculated-numeric-tolerance-checkbox",analyticsId:"assessments.canvas.question.calculatedNumeric.tolerance.checkbox.label",control:a.a.createElement(Ze.a,{id:"calculated-numeric-tolerance-checkbox",analyticsId:"assessments.canvas.question.calculatedNumeric.tolerance.checkbox",onChange:e=>{l(e.target.checked),e.target.checked||u({toleranceValue:0})},checked:r})}),a.a.createElement(b.AnalyticsTypography,{component:"div",variant:"body1",className:t.checkboxLabelDescription},s("assessments.canvas.question.calculatedNumeric.tolerance.checkbox.description")),r?a.a.createElement("div",{className:Object(We.a)(t.textFieldContainer,t.toleranceTextFieldContainer,"js-calculated-numeric-tolerance-section")},a.a.createElement(Ye.b,{className:Object(We.a)(t.textField,t.toleranceTextField),id:"calculated-numeric-tolerance-input",label:s("assessments.canvas.question.calculatedNumeric.tolerance.label"),analyticsId:"assessments.canvas.question.calculatedNumeric.tolerance.input",value:n.toleranceValue,onChange:h("toleranceValue"),helperText:c(),numberFormatOptions:{maximumFractionDigits:Ye.c},maintainInputValueOnBlur:!0,required:r,displayWesternNumbers:!0,min:0})):null),a.a.createElement(p.c,{...e,assessmentId:o,onQuestionChange:u,assessmentType:i}))},at=s("+F4g"),it=s("bJi+");const ot=Object(Je.makeStyles)((e=>Object(Je.createStyles)({questionLabel:{"&::before":{color:e.palette.error.main,content:'"*"',paddingRight:"5px"}}})));var rt=Object(ze.a)((e=>{const{editMode:t,question:s,detailsHidden:n,questionTitle:o,readonlyPoints:r,extraCreditVisibility:l}=e,c=Object(y.a)(),u=ot(e),p=t=>{e.onQuestionChange(t,d.e)},h=Ve.a.ACTIVE===t,m=h&&Object(d.i)(s),g=!n||h;return a.a.createElement(a.a.Fragment,null,a.a.createElement(i.a,{editMode:t,question:s},g?a.a.createElement(a.a.Fragment,null,a.a.createElement($e.a,{...Object($e.b)(Vs(e,c),p)}),a.a.createElement(Ue.a,{show:m,question:s})):a.a.createElement(Ke.a,{question:s,questionTitle:o,readonlyPoints:r,extraCreditVisibility:l}),a.a.createElement(He.a,{...Object(He.b)(e)}),a.a.createElement(a.a.Fragment,null,h&&a.a.createElement(b.AnalyticsTypography,{className:u.questionLabel,component:"label",variant:"h4",required:!0,htmlFor:`bb-editor${s.id}`},c("assessments.canvas.question.label")),g&&a.a.createElement(it.a,{...Object(it.b)({...e,localize:{translate:c}},p)}))),h?a.a.createElement(nt,{...e}):null,h||n?null:a.a.createElement(at.a,{...e}))})),lt=s("mZt7"),ct=s("hLhy"),ut=s("HuI8"),dt=s("ERsv");const pt=e=>{const{onFileUploaded:t}=e,{translate:s,getLocalePropsForClone:i}=Object(ut.a)(),o=s("assessments.canvas.common.dndUpload.defaultErrorUploadMessage"),l=s("assessments.canvas.question.hotspot.invalidFileTypeErrorMessage")||o,[c,u]=Object(n.useState)(""),d=function(e,t,s,n,a){return i=>{const o={apiBasePath:r.kb.apiBasePath,xsrfToken:r.kb.xsrf,localeProps:e(),allowedFileTypes:n,resizeImageWidth:1e3,onWrongFileType:()=>t(s)};Object(dt.uploadWorkflow)(o,i).then((e=>{const t=e[0],{originalFile:s}=t||{};a(s)}))}}(i,u,l,[".png",".gif",".jpg",".jpeg",".bmp"],t);return a.a.createElement(_.k,{analyticsIdPrefix:"assessments.hotspotQuestionAdd",instructions:s("assessments.canvas.question.hotspot.instructions"),onUploadFiles:d,errorMessage:c})},ht=Object(Je.makeStyles)((e=>Object(Je.createStyles)({spinner:{padding:"20px"},optionsContainer:{padding:"7px 17px",backgroundColor:e.palette.background.paper,border:`1px solid ${e.palette.border.main}`,borderTop:"none"}})));var mt=s("eqO1");const bt=e=>Object(mt.e)({"&::before":{color:e.palette.error.main,content:'"*"',paddingRight:"5px"}}),gt=Object(Je.makeStyles)((e=>Object(Je.createStyles)({root:{marginTop:"11px",marginBottom:"2px"},answerOptionsLabel:{...bt(e),marginRight:"1px"},answerOptionsHeader:{display:"flex",flexDirection:"row",alignItems:"center"},answerOptionsListContainer:{paddingTop:"12px"},answerOptionsList:{listStyle:"none",marginLeft:"0",marginBottom:"0"},answerOptionItem:{position:"relative",display:"flex",alignItems:"center"},answerOptionContainer:{flex:1,display:"flex",alignItems:"center"},answerDesc:{margin:"3px","& input":{border:"none",margin:"0"}},hotspotNumber:{display:"inline-flex",height:"32px",alignItems:"center",marginRight:"0","& span":{fontWeight:e.typography.fontWeightSemiBold}},hotspotDescription:{marginLeft:"8px",flex:1},answerOptionsButton:{borderRadius:"2px",marginLeft:"1px"}})));var ft=s("3le2");const vt=e=>{var t,s;const i=gt(),o=Object(y.a)(),{question:r,questionTitle:l,onQuestionChange:c}=e,[u,p]=Object(n.useState)(!1),h=(e,t,s)=>{const n=q.a.cloneDeep(r.answers);n[e]={...n[e],[t]:s};const a={...r,answers:n};c(a,d.h)};Object(n.useEffect)((()=>{var e;1===(null===(e=r.answers)||void 0===e?void 0:e.length)?p(!0):u&&Object(ft.c)(r)&&p(!1)}),[r,null===(t=r.answers)||void 0===t?void 0:t.length,u]);return(null===(s=r.answers)||void 0===s?void 0:s.length)?a.a.createElement("div",{className:i.root},a.a.createElement("div",{className:i.answerOptionsHeader},a.a.createElement(b.AnalyticsTypography,{className:i.answerOptionsLabel,component:"div",variant:"h4"},o("assessments.canvas.question.hotspot.answerOptions.title")),Object(ft.c)(r)&&a.a.createElement(b.AnalyticsTooltip,{analyticsId:"assessments.canvas.question.hotspot.answerOptions.tooltip",title:o("assessments.canvas.question.hotspot.answerOptions.tooltip.content"),placement:"right"},a.a.createElement(b.AnalyticsIconButton,{analyticsId:"assessments.canvas.question.hotspot.answerOptions.tooltip.icon","aria-label":o("assessments.canvas.question.hotspot.answerOptions.tooltip.ariaLabel"),className:i.answerOptionsButton},a.a.createElement(st.a,null)))),a.a.createElement("div",{className:i.answerOptionsListContainer},a.a.createElement("ol",{className:i.answerOptionsList},r.answers.map(((e,t)=>a.a.createElement("li",{key:t,className:i.answerOptionItem},((e,t)=>{var s;const n=t+1,c=o("assessments.canvas.question.hotspot.answerOptions.checkboxAriaLabel",{questionTitle:l,hotspotNumber:n}),d=`hotspot-desc-header-${r.id}-${n}`,p=`hotspot-correct-ans-${r.id}-${n}`,m=`hotspot-desc-text-${r.id}-${n}`,g=`${w.a}${r.id} ${d}`,f=o("assessments.canvas.question.hotspot.answerOptions.hotspotNumber",{hotspotNumber:n});return a.a.createElement("div",{className:i.answerOptionContainer},1===(null===(s=r.answers)||void 0===s?void 0:s.length)&&a.a.createElement(b.AnalyticsTypography,{component:"div",variant:"h4"},f),Object(ft.c)(r)&&!u&&a.a.createElement(b.AnalyticsFormControlLabel,{label:f,className:i.hotspotNumber,htmlFor:p,control:a.a.createElement(b.AnalyticsCheckbox,{id:p,value:e.correctAnswer,checked:e.correctAnswer,analyticsId:"assessments.canvas.question.hotspot.correctAnswerCheckbox","aria-label":c,inputProps:{"aria-describedby":m}}),analyticsId:"assessments.canvas.question.hotspot.correctAnswerLabel",key:n,onChange:(e,s)=>{h(t,"correctAnswer",s)}}),a.a.createElement("div",{className:i.hotspotDescription},a.a.createElement("div",{id:d,className:"sr-only"},o("assessments.canvas.question.hotspot.answerOptions.hotspotDescriptionHeader",{hotspotNumber:n})),a.a.createElement(b.AnalyticsTextField,{id:m,"aria-labelledby":g,className:Object(We.a)("js-hotspot-question-edit-answer-text-field",i.answerDesc),placeholder:o("assessments.canvas.question.hotspot.answerOptions.hotspotDescriptionPlaceholder"),value:e.answerText,onChange:e=>{h(t,"answerText",e.target.value)},analyticsId:"assessments.canvas.question.hotspot.answerOptions.hotspotDescription.textField",fullWidth:!0})))})(e,t))))))):null};var wt=s("CppI");const yt=e=>{const t=Object(y.a)(),{question:s,hasSubmissions:n,onQuestionChange:i}=e,{displayShapesToStudents:o}=s;return a.a.createElement(Xe.a,{control:a.a.createElement(wt.a,{analyticsId:"assessments.canvas.question.hotspot.displayOptions.displayHotspotsToggleLabel"}),checked:o,label:t("assessments.canvas.question.hotspot.displayOptions.displayHotspotsToggleLabel"),onChange:(e,t)=>{const n={...s,displayShapesToStudents:t};i(n,d.h)},disabled:!Object(ft.c)(s)||n,analyticsId:"assessments.canvas.question.hotspot.displayOptions.displayHotspotsToggleLabel"})};var Et=s("Rco2");const Ct=Object(Je.makeStyles)((e=>Object(Je.createStyles)({canvasDiv:{backgroundColor:e.palette.background.b6,paddingLeft:"20px",paddingRight:"20px",border:`1px solid ${e.palette.border.main}`,position:"relative",borderTop:"none"},spinner:{top:"50%",left:"50%",position:"absolute",marginLeft:"-19px",marginTop:"-19px"},label:{...bt(e),margin:"8px 0px"},canvasInfo:{display:"flex",alignItems:"flex-start",flexDirection:"column",justifyContent:"space-between",[e.breakpoints.up("sm")]:{flexDirection:"row",alignItems:"center"}}})));var xt=s("ApVX"),Ot=s("7N5c"),Tt=s("oZkQ"),kt=s("NzVS"),St=s("0x+l"),qt=s("yJL7");const At=Object(Je.makeStyles)((e=>Object(Je.createStyles)({primaryInstructionsText:{fontWeight:e.typography.fontWeightSemiBold}})));var Pt=s("o1iR"),It=s("EBQB"),jt=s("CD3w"),Ft=s("i9xO"),Nt=s("Zbp7"),Dt=s("caKH"),_t=s("MC1S"),Rt=s("Oa+x"),Mt=s("NdLt");const Lt=e=>{const{deleteHotspotImage:t,isOpen:s,onClose:n}=e,i=Object(y.a)();return a.a.createElement(Dt.c,{hidden:!s,onDismiss:n,analyticsId:"assessments.canvas.question.hotspot.delete.hotspot.image.dialog",dialogContentProps:{type:_t.DialogType.normal,title:i("assessments.canvas.question.hotspot.toolbar.deleteHotspotImageDialog.title"),subText:i("assessments.canvas.question.hotspot.toolbar.deleteHotspotImageDialog.content"),showCloseButton:!0,isAlert:!0}},a.a.createElement(_t.DialogFooter,null,a.a.createElement(Rt.a,{onClick:n,analyticsId:"questionReuse.cancelDialog.cancel"},i("assessments.canvas.question.hotspot.toolbar.deleteHotspotImageDialog.cancel")),a.a.createElement(Mt.AnalyticsPrimaryButton,{onClick:t,analyticsId:"questionReuse.cancelDialog.ok"},i("assessments.canvas.question.hotspot.toolbar.deleteHotspotImageDialog.confirm"))))};var Bt=s("ADD6"),Qt=s("2GUQ");const Vt=Object(Je.makeStyles)((e=>Object(Je.createStyles)({root:{margin:"0 4px",backgroundColor:e.palette.background.b2,alignItems:"center",alignSelf:"stretch"}}))),$t=e=>{const t=Vt(),{icon:s,ariaLabel:n,analyticsId:i,endDrawingMode:o,isDrawingModeOn:r,startDrawingMode:l,polygonToggleButtonRef:c}=e;return a.a.createElement(Qt.a,{analyticsIdPrefix:i,descriptionLocaleKey:"assessments.canvas.question.hotspot.toolbar.keyboardCommandTooltip.addPolygonHotspot.description",commandLocaleKey:"assessments.canvas.question.hotspot.toolbar.keyboardCommandTooltip.addPolygonHotspot.command"},a.a.createElement(Bt.a,{analyticsId:i,buttonRef:c,onChange:e=>{if(r)o();else{const t=!e.detail;l(t)}},"aria-label":n,value:r,selected:r,variant:"standalone",className:t.root},s))},Ht=e=>{const{question:t,addNewHotspot:s,hasSubmissions:i,onQuestionChange:o,endPolygonDrawingMode:r,deleteSelectedHotspots:l,isPolygonDrawingModeOn:c,startPolygonDrawingMode:u,polygonToggleButtonRef:p,hasActiveHotspotSelection:h}=e,[m,b]=Object(n.useState)(!1),g=Object(n.useCallback)((()=>b(!0)),[b]),f=Object(n.useCallback)((()=>b(!1)),[b]),v=Object(y.a)(),w=At(),E=Object(n.useCallback)((()=>{o({...t,answers:null,hotSpotImage:null,displayShapesToStudents:!1},d.h)}),[t]),C=Object(n.useCallback)((()=>{s({type:D.Q.Rectangle})}),[s]),x=Object(n.useCallback)((()=>{s({type:D.Q.Circle})}),[s]);return a.a.createElement(a.a.Fragment,null,a.a.createElement(qt.a,null,a.a.createElement(jt.a,null,a.a.createElement(It.a,null,a.a.createElement("span",{className:w.primaryInstructionsText},v("assessments.canvas.question.hotspot.toolbar.addHotspot"))),a.a.createElement(Pt.a,{icon:a.a.createElement(Tt.a,{color:"primary"}),onClick:C,ariaLabel:v("assessments.canvas.question.hotspot.toolbar.addRectangleHotspotAriaLabel"),analyticsId:"assessments.canvas.question.hotspot.add.rectangle.hotspot.button",controlInfoDescriptionLocaleKey:"assessments.canvas.question.hotspot.toolbar.keyboardCommandTooltip.addRectangleHotspot.description",controlInfoCommandLocaleKey:"assessments.canvas.question.hotspot.toolbar.keyboardCommandTooltip.addRectangleHotspot.command"}),a.a.createElement(Pt.a,{icon:a.a.createElement(kt.a,{color:"primary"}),onClick:x,ariaLabel:v("assessments.canvas.question.hotspot.toolbar.addCircleHotspotAriaLabel"),analyticsId:"assessments.canvas.question.hotspot.add.circle.hotspot.button",controlInfoDescriptionLocaleKey:"assessments.canvas.question.hotspot.toolbar.keyboardCommandTooltip.addCircleHotspot.description",controlInfoCommandLocaleKey:"assessments.canvas.question.hotspot.toolbar.keyboardCommandTooltip.addCircleHotspot.command"}),a.a.createElement($t,{icon:a.a.createElement(St.ShapeCustom,{color:"primary"}),endDrawingMode:r,isDrawingModeOn:c,startDrawingMode:u,polygonToggleButtonRef:p,ariaLabel:v("assessments.canvas.question.hotspot.toolbar.drawPolygonHotspotAriaLabel"),analyticsId:"assessments.canvas.question.hotspot.add.polygon.toggle.button"})),a.a.createElement(Nt.a,null,a.a.createElement(Ft.a,{onClick:l,disabled:!h,icon:xt.a,text:v("assessments.canvas.question.hotspot.toolbar.eraseHotspots"),analyticsId:"assessments.canvas.question.hotspot.erase.hotspot.button"}),a.a.createElement(Ft.a,{onClick:i?()=>{}:g,icon:Ot.Trash,text:v("assessments.canvas.question.hotspot.toolbar.deleteHotspotImage"),analyticsId:"assessments.canvas.question.hotspot.delete.hotspot.image.button",disabled:i}))),a.a.createElement(Lt,{onClose:f,isOpen:m,deleteHotspotImage:E}))};var zt=s("PxJx"),Kt=s("+1G9"),Ut=s("B/aE"),Gt=s("YUDX"),Wt=s("Pu34"),Yt=s("lqgZ"),Zt=s("E0B1");const Xt=[{title:"assessments.canvas.question.hotspot.instructorEditKeyboardInfo.content.generalControls.title",items:["assessments.canvas.question.hotspot.instructorEditKeyboardInfo.content.generalControls.tab","assessments.canvas.question.hotspot.instructorEditKeyboardInfo.content.generalControls.move","assessments.canvas.question.hotspot.instructorEditKeyboardInfo.content.generalControls.precision","assessments.canvas.question.hotspot.instructorEditKeyboardInfo.content.generalControls.delete"]},{title:"assessments.canvas.question.hotspot.instructorEditKeyboardInfo.content.rectangleAndCircleControls.title",items:["assessments.canvas.question.hotspot.instructorEditKeyboardInfo.content.rectangleAndCircleControls.resize","assessments.canvas.question.hotspot.instructorEditKeyboardInfo.content.rectangleAndCircleControls.addNewRectangleShortcut","assessments.canvas.question.hotspot.instructorEditKeyboardInfo.content.rectangleAndCircleControls.addNewCircleShortcut"]},{title:"assessments.canvas.question.hotspot.instructorEditKeyboardInfo.content.polygonControls.title",items:["assessments.canvas.question.hotspot.instructorEditKeyboardInfo.content.polygonControls.addNewShortcut","assessments.canvas.question.hotspot.instructorEditKeyboardInfo.content.polygonControls.move","assessments.canvas.question.hotspot.instructorEditKeyboardInfo.content.polygonControls.precision","assessments.canvas.question.hotspot.instructorEditKeyboardInfo.content.polygonControls.enter","assessments.canvas.question.hotspot.instructorEditKeyboardInfo.content.polygonControls.delete","assessments.canvas.question.hotspot.instructorEditKeyboardInfo.content.polygonControls.escape"]}],Jt=e=>{const t=Ct(),s=Object(mt.t)(),i=Object(n.useRef)(null),o=Object(n.useRef)(null),[r,l]=Object(n.useState)(!1),c=Object(y.a)(),{question:u,onQuestionChange:p}=e,h=Object(n.useCallback)((e=>{var t,s;const n=e.map((e=>{var t;const s=null===(t=u.answers)||void 0===t?void 0:t.find((t=>t.id===e.hotspotId));return{id:(null==s?void 0:s.id)||e.hotspotId,answerText:(null==s?void 0:s.answerText)||"",correctAnswer:(null==s?void 0:s.correctAnswer)||!1,areaType:e.type,coordinates:e.coordinates}}));1===n.length?n[0].correctAnswer=!0:n.length>1&&1===(null===(t=u.answers)||void 0===t?void 0:t.length)&&(n[0].correctAnswer=!1),Object(ft.d)({canvasWrapper:null==i?void 0:i.current,answers:u.answers,coordinates:e})&&(null===(s=i.current)||void 0===s||s.focus()),p({...u,answers:n},d.h)}),[u]),m=Object(Yt.a)(u,s),g=Object(Wt.a)({canvasBackgroundOptions:m,onHotspotImageLoaded:()=>{l(!0)},onUpdate:h});Object(Kt.a)({shouldDrawLabels:!0,answers:u.answers||[],addHotspots:g.addExistingHotspots,shouldDrawHotspots:r});const{handleCanvasFocus:f,handleCanvasKeydown:v}=Object(Ut.a)({...g,polygonToggleButton:o,deleteSelectedHotspotObjects:g.deleteSelectedHotspots,modifyHotspotObject:g.isPolygonDrawingModeOn?g.movePolygonModeCursor:g.modifyHotspot,getArrowKeyChanges:g.isPolygonDrawingModeOn?Gt.c:Gt.a}),w=Object(n.useCallback)((e=>{g.isPolygonDrawingModeOn&&e.target===i.current&&e.relatedTarget!==o.current&&g.endPolygonDrawingMode()}),[g]);return Object(n.useEffect)((()=>(document.addEventListener("focusout",w),()=>{document.removeEventListener("focusout",w)})),[w]),Object(n.useEffect)((()=>{g.isPolygonDrawingModeOn&&i.current.focus()}),[g.isPolygonDrawingModeOn]),a.a.createElement("div",null,a.a.createElement("div",{className:t.canvasInfo},a.a.createElement(b.AnalyticsTypography,{className:t.label,component:"div",variant:"h4"},c("assessments.canvas.question.hotspot.label.editCanvasText")),a.a.createElement(zt.a,{infoLocaleKeys:Xt,analyticsIdPrefix:"assessments.canvas.question.hotspot.edit"})),r&&a.a.createElement(Ht,{...e,addNewHotspot:g.addNewHotspot,polygonToggleButtonRef:o,endPolygonDrawingMode:g.endPolygonDrawingMode,isPolygonDrawingModeOn:g.isPolygonDrawingModeOn,deleteSelectedHotspots:g.deleteSelectedHotspots,startPolygonDrawingMode:g.startPolygonDrawingMode,hasActiveHotspotSelection:g.hasActiveHotspotObjSelection}),a.a.createElement("div",{ref:i,className:Object(We.a)(t.canvasDiv,"no-outline"),tabIndex:0,role:"region","aria-label":c("assessments.canvas.question.hotspot.canvasAriaLabel"),onFocus:f,onKeyDown:v,"data-testid":"canvas-wrapper"},a.a.createElement(Et.a,{onReady:g.onReady,onResizeCanvas:g.onResizeCanvas,canvasOptions:{...Zt.a}}),!r&&a.a.createElement("div",{className:t.spinner},a.a.createElement(b.AnalyticsCircularProgress,{ariaLabel:c("assessments.canvas.question.hotspot.image.loading"),size:"medium"}))))},es=e=>{const t=ht();return a.a.createElement(a.a.Fragment,null,a.a.createElement(Jt,{...e}),a.a.createElement("div",{className:t.optionsContainer},a.a.createElement(yt,{...e}),a.a.createElement(vt,{...e})))},ts=e=>{const{onQuestionChange:t,question:s,assessmentType:i,assessmentId:o}=e,r=Object(n.useCallback)((e=>{const n={...s,...e};Object(ft.c)(e)||(n.displayShapesToStudents=!1),t(n,d.h)}),[s]),l=Object(n.useCallback)((e=>{const{fileLocation:t,fileName:n,webLocation:a}=e;r({hotSpotImage:{...s.hotSpotImage,webLocation:a,fileLocation:t,fileName:n}})}),[r,null==s?void 0:s.hotSpotImage]);return a.a.createElement(a.a.Fragment,null,Object(ft.b)(s)?a.a.createElement(a.a.Fragment,null,a.a.createElement(es,{...e,onQuestionChange:r}),a.a.createElement(p.c,{...e,assessmentId:o,onQuestionChange:r,assessmentType:i})):a.a.createElement(pt,{onFileUploaded:l}))};var ss=s("zTL+");const ns=Object(Je.makeStyles)((e=>Object(Je.createStyles)({label:{...bt(e),margin:"8px 0px"},bannerHotspot:{marginBottom:"12px"}})));var as=s("rQu3");var is=Object(ze.a)((e=>{const{editMode:t,question:s,openGoals:o,detailsHidden:r,questionTitle:l,readonlyPoints:c,deleteQuestion:u,onQuestionChange:p,extraCreditVisibility:h}=e,m=Ve.a.ACTIVE===t,g=m&&Object(d.i)(s),f=!r||m,v=Object(y.a)(),w=ns(),E=Object(n.useCallback)((e=>{p(e,d.h)}),[p]),C=a.a.createElement(b.AnalyticsLink,{href:v("assessments.canvas.question.hotspot.banner.link"),analyticsId:"assessments.canvas.helpHotspotLink",target:"_blank"},v("assessments.canvas.question.hotspot.banner.linkText")),x=Object(n.useMemo)((()=>m?a.a.createElement(ts,{...e}):r?null:a.a.createElement(as.a,{...e})),[e,m,r]);return a.a.createElement(a.a.Fragment,null,m&&a.a.createElement(ss.a,{severity:"info",icon:a.a.createElement(St.Information,null),className:w.bannerHotspot},v("assessments.canvas.question.hotspot.banner.text",{helpHotspotLink:C})),a.a.createElement(i.a,{editMode:t,question:s},f?a.a.createElement(a.a.Fragment,null,a.a.createElement($e.a,{...Object($e.b)(Vs(e,v),E)}),a.a.createElement(Ue.a,{show:g,question:s})):a.a.createElement(Ke.a,{question:s,questionTitle:l,readonlyPoints:c,extraCreditVisibility:h}),a.a.createElement(He.a,{...Object(He.b)({...e,deleteQuestion:()=>u(s),openGoals:()=>o(s),questionTitle:l})}),m&&a.a.createElement(b.AnalyticsTypography,{className:w.label,component:"label",variant:"h4",required:!0,htmlFor:`bb-editor${s.id}`},v("assessments.canvas.question.label")),f&&a.a.createElement(it.a,{...Object(it.b)({...e,localize:{translate:v}},E)})),x)})),os=s("cw3y");class rs extends n.Component{constructor(){super(...arguments),this.onAnswerChange=e=>{const{answer:t}=this.props,s={...t,answerText:{rawText:e.toBbML()},applyAsyncPlugins:{...t.applyAsyncPlugins,answerText:async()=>({answerText:{rawText:await e.toBbML(!0)}})}};this.props.onAnswerChange(s)},this.onDelete=()=>{this.props.onDistractorDeletion(this.props.answer.ui.id)}}render(){const{answer:e,canDeleteDistractor:t,editMode:s,hasRemoveAnswerPermissions:n,index:i,localize:o,question:r,questionTitle:l,setEditor:c}=this.props,u=Ve.a.INACTIVE===s,d=i+1,p=`distractor-header-${r.id}-${i}`,h=`${w.a}${r.id} ${p}`,m=o.translate("assessments.canvas.question.matching.deleteDistractorAriaLabel",{questionTitle:l,distractorNumber:d});return a.a.createElement("div",{className:"matching-distractor\n                "+(u?"matching-distractor--read":"matching-distractor--edit")},a.a.createElement("div",{className:"matching-distractor__answer"},a.a.createElement("div",{className:"matching-distractor__text"},a.a.createElement("div",{id:p,className:"sr-only"},o.translate("assessments.canvas.question.matching.headers.distractor",{distractorNumber:d})),a.a.createElement(v.b,{...this.props,ariaLabelledBy:h,bbml:e.answerText.rawText,id:`distractor-${e.ui.id}`,isReadOnly:u,onChange:this.onAnswerChange,placeholder:o.translate("assessments.canvas.question.matching.placeholders.distractor",{distractorNumber:d}),toolbarSet:"minimal",ariaRequired:!0,supportsInlineDocumentRender:!1,ref:t=>null==c?void 0:c(os.b(e.ui.id),t)}))),!u&&n&&a.a.createElement("div",{className:"matching-distractor__delete"},a.a.createElement(E.AnalyticsIconButton,{onClick:this.onDelete,className:"matching-distractor__delete-button",disabled:!t(),"aria-label":m,"aria-describedby":`bb-editor${e.ui.id}`,analyticsId:"assessments.canvas.question.matching.deleteDistractor"},a.a.createElement(St.Trash,null))))}}var ls=Object(Te.a)(rs);const cs=e=>{const{localize:t,onRemove:s,pairNumber:n,isReadOnly:i}=e;return a.a.createElement("div",{className:"matching-prompt-reused-answer "+(i?"":" matching-prompt-reused-answer--edit")},a.a.createElement(St.Reuse,{className:"matching-prompt-reused-answer__icon"}),a.a.createElement("span",null,t.translate("assessments.canvas.question.matching.reusedAnswer",{pairNumber:n})),!i&&a.a.createElement(E.AnalyticsIconButton,{className:"matching-prompt-reused-answer__remove-button",onClick:()=>s,title:t.translate("assessments.canvas.question.matching.removeReusedAnswer",{pairNumber:n}),analyticsId:"assessments.canvas.question.matching.removeReUsedAnswer"},a.a.createElement(St.Clear,null)))};var us=Object(Te.a)(cs);class ds extends a.a.Component{constructor(e){super(e),this.onBlur=()=>{this.setState({editorFocused:!1})},this.onFocus=()=>{this.setState({editorFocused:!0})},this.state={editorFocused:!1}}render(){const{isReadOnly:e,localize:t,onEditorTextChange:s,onRemoveReusedAnswer:n,pairNumber:i,prompt:o,question:r,reusedElsewherePair:l,text:c,setEditor:u}=this.props,d=`answer-header-${r.id}-${i}`,p=`${w.a}${r.id} ${d}`;return a.a.createElement("div",{className:"matching-answer "+(e?"matching-answer--read-only":"")},o.reusesAnswer?a.a.createElement(us,{isReadOnly:e,pairNumber:i,onRemove:n}):a.a.createElement("div",{className:"matching-answer__text"},a.a.createElement("div",{id:d,className:"sr-only"},t.translate("assessments.canvas.question.matching.headers.answer",{pairNumber:i})),a.a.createElement(v.b,{...this.props,ariaLabelledBy:p,bbml:c,id:os.b(this.props.prompt.id),isReadOnly:e,onBlur:this.onBlur,onChange:s,onFocus:this.onFocus,placeholder:t.translate("assessments.canvas.question.matching.placeholders.answer",{pairNumber:i}),toolbarSet:"minimal",ariaRequired:!0,supportsInlineDocumentRender:!1,ref:e=>null==u?void 0:u(os.b(this.props.answer.ui.id),e)})),l&&this.state.editorFocused&&a.a.createElement("div",{className:"matching-answer-notice",role:"alert"},a.a.createElement(St.Attention,{className:"matching-answer-notice__icon"}),a.a.createElement("span",{className:"matching-answer-notice__text"},t.translate("assessments.canvas.question.matching.editingReusedAnswerNotice"))))}}var ps=Object(Te.a)(ds),hs=s("7x0g");const ms=e=>{const{localize:t,pairNumber:s}=e,n=(e=>{const{answerIdToPromptIndexMap:t,localize:s,onReuse:n,reusableAnswers:i}=e;return i.map((i=>{const o=t[i.ui.id],r=`reuse-answer-${o}`;return{key:o,name:a.a.createElement("div",{className:"assessments-reuse-answer-menu-item"},a.a.createElement("div",{className:"assessments-reuse-answer-menu-item__pair-number","aria-hidden":"true"},o+1),a.a.createElement(v.b,{...e,id:r,isReadOnly:!0,bbml:i.answerText.rawText,supportsInlineDocumentRender:!1})),onClick:n,ariaLabel:s.translate("assessments.canvas.question.matching.reuseAnswerItemAriaLabel",{pairNumber:o+1})}}))})(e);return{key:"reuseAnswer",icon:a.a.createElement(St.Reuse,null),name:t.translate("assessments.canvas.question.matching.reuseAnswer"),ariaLabel:t.translate("assessments.canvas.question.matching.reuseAnswerAriaLabel",{pairNumber:s}),subMenuProps:{shouldFocusOnMount:!0,items:n,calloutProps:{preventDismissOnScroll:!0}},disabled:0===n.length,className:"js-reuse-answer"}},bs=e=>{const{answerIsReused:t,showDeletePair:s,showReuseAnswer:n}=e,i=[];return n&&(t?i.push((e=>{const{localize:t,pairNumber:s}=e;return{key:"reuseAnswer",icon:a.a.createElement(St.Reuse,null),name:t.translate("assessments.canvas.question.matching.reuseAnswerAlreadyReused"),ariaLabel:t.translate("assessments.canvas.question.matching.reuseAnswerAlreadyReusedAriaLabel",{pairNumber:s}),disabled:!0}})(e)):i.push(ms(e))),s&&i.push((e=>{const{canDeletePair:t,localize:s,onDelete:n,pairNumber:i,questionTitle:o}=e;return{key:"deletePair",icon:a.a.createElement(St.Trash,null),name:s.translate("assessments.canvas.question.matching.deletePair"),ariaLabel:s.translate("assessments.canvas.question.matching.deletePairAriaLabel",{questionTitle:o,pairNumber:i}),onClick:n,disabled:!t,className:"js-delete-pair"}})(e)),i},gs=e=>{const{componentRef:t,localize:s,pairNumber:n,questionTitle:i}=e,o=bs(e);return 0===o.length?null:a.a.createElement("div",{className:"matching-prompt-answer-pair__menu"},a.a.createElement(_t.ActionMenu,{analyticsId:"assessments.canvas.question.matching.actionMenu",ariaLabel:s.translate("assessments.canvas.question.matching.moreOptionsAriaLabel",{questionTitle:i,pairNumber:n}),componentRef:t,menuProps:{items:o,calloutProps:{preventDismissOnScroll:!0}}}))};var fs=Object(Te.a)(gs);class vs extends n.Component{constructor(e){super(e),this.overflowMenuRef=null,this.getReusableAnswers=()=>this.props.reusableAnswers.filter((e=>this.props.answer!==e)),this.focusOverflowMenu=()=>{var e;null!=this.overflowMenuRef&&(null===(e=this.overflowMenuRef)||void 0===e||e.focus())},this.onPromptChange=e=>{const{prompt:t}=this.props,s={...t,promptText:{rawText:e.toBbML()},applyAsyncPlugins:{...t.applyAsyncPlugins,promptText:async()=>({promptText:{rawText:await e.toBbML(!0)}})}};this.props.onPromptChange(s)},this.onAnswerChange=e=>{const{answer:t}=this.props,s={...t,answerText:{rawText:e.toBbML()},applyAsyncPlugins:{...t.applyAsyncPlugins,answerText:async()=>({answerText:{rawText:await e.toBbML(!0)}})}};this.props.onAnswerChange(s)},this.onDeleteReused=()=>{this.setState({deleteReusedDialogHidden:!1})},this.onDeleteCanceled=()=>{this.setState({deleteReusedDialogHidden:!0})},this.onDelete=()=>{this.focusOverflowMenu(),this.props.onPromptAnswerPairDeletion(this.props.prompt.id)},this.getOnDeleteCallback=()=>this.props.reusedElsewherePair?this.onDeleteReused:this.onDelete,this.onReuseAnswer=(e,t)=>{const{onPromptAnswerReuse:s,prompt:n}=this.props,a=t.key;s(n.id,a),this.focusOverflowMenu()},this.onRemoveReusedAnswer=()=>{const{onPromptRemoveReusedAnswer:e,prompt:t}=this.props;e(t.id)},this.storeOverflowMenuRef=e=>{this.overflowMenuRef=e},this.state={deleteReusedDialogHidden:!0}}render(){const{answer:e,answerIdToPromptIndexMap:t,answerIsReused:s,editMode:n,index:i,localize:o,prompt:r,question:l,questionTitle:c,reusedElsewherePair:u,UltraWindowSize:d,setEditor:p}=this.props,h=Ve.a.INACTIVE===n,m=i+1,b=`prompt-header-${l.id}-${i}`,g=`${w.a}${l.id} ${b}`,f=(null==d?void 0:d.isSmallBreakpoint())?o.translate("assessments.canvas.question.matching.indexMobile",{pairNumber:m}):o.translate("assessments.canvas.question.matching.index",{pairNumber:m}),y=a.a.createElement(fs,{answerIsReused:s,answerIdToPromptIndexMap:t,canDeletePair:this.props.canDeletePromptAnswerPair(r.reusesAnswer),componentRef:this.storeOverflowMenuRef,onDelete:this.getOnDeleteCallback(),onReuse:this.onReuseAnswer,pairNumber:m,questionTitle:c,reusableAnswers:this.getReusableAnswers(),showDeletePair:this.props.hasRemovePromptAnswerPairPermissions,showReuseAnswer:this.props.hasReuseAnswerPermissions});return a.a.createElement("div",{className:"matching-prompt-answer-pair\n                "+(h?"matching-prompt-answer-pair--read":"matching-prompt-answer-pair--edit")},!h&&(null==d?void 0:d.isSmallBreakpoint())&&y,a.a.createElement("div",{className:"matching-prompt-answer-pair__element matching-prompt-answer-pair__element-index "+(!h&&(null==d?void 0:d.isSmallBreakpoint())?"field-required":"")},f),a.a.createElement("div",{className:"matching-prompt-answer-pair__prompt-answer-wrapper"},a.a.createElement("div",{className:"matching-prompt-answer-pair__element matching-prompt-answer-pair__element-prompt"},a.a.createElement("div",{className:"matching-prompt-answer-pair__text"},a.a.createElement("div",{id:b,className:"sr-only"},o.translate("assessments.canvas.question.matching.headers.prompt",{pairNumber:m})),a.a.createElement(v.b,{...this.props,ariaLabelledBy:g,bbml:r.promptText.rawText,id:`prompt-${r.id}`,isReadOnly:h,onChange:this.onPromptChange,placeholder:o.translate("assessments.canvas.question.matching.placeholders.prompt",{pairNumber:m}),toolbarSet:"minimal",ariaRequired:!0,supportsInlineDocumentRender:!1,ref:e=>null==p?void 0:p(os.c(this.props.prompt.id),e)}))),(null==d?void 0:d.isSmallBreakpoint())&&a.a.createElement("div",{className:"matching-prompt-answer-pair__element matching-prompt-answer-pair__element-answer-label "+(h?"":"field-required")},o.translate("assessments.canvas.question.matching.answerLabel")),a.a.createElement(ps,{...this.props,isReadOnly:h,onEditorTextChange:this.onAnswerChange,onRemoveReusedAnswer:this.onRemoveReusedAnswer,pairNumber:t[e.ui.id]+1,prompt:r,reusedElsewherePair:u,text:e.answerText.rawText})),!h&&!(null==d?void 0:d.isSmallBreakpoint())&&y,u&&a.a.createElement(hs.a,{hidden:this.state.deleteReusedDialogHidden,onCancel:this.onDeleteCanceled,onContinue:this.onDelete,titleKey:"assessments.canvas.question.matching.dialogs.deleteReusedAnswer.title",textKey:"assessments.canvas.question.matching.dialogs.deleteReusedAnswer.text",cancelKey:"assessments.canvas.question.matching.dialogs.deleteReusedAnswer.button.cancel",continueKey:"assessments.canvas.question.matching.dialogs.deleteReusedAnswer.button.delete",analyticsId:"assessments.canvas.question.matching.dialogs.deleteReusedAnswer"}))}}const ws=vs;var ys=Object(L.windowResizingResponsiveComponentWrapper)(Object(Te.a)(ws)),Es=s("ym5S"),Cs=s("ZQN4"),xs=s("FKP/");var Os=Object(L.windowResizingResponsiveComponentWrapper)((e=>{const t=Object(n.useRef)({}),{assessmentId:s,activeEditorId:o,canDeleteDistractor:l,canDeletePromptAnswerPair:c,editMode:u,onDistractorAddition:h,onDistractorDeletion:m,onPromptAnswerPairAddition:b,onPromptAnswerPairDeletion:g,onQuestionChange:f,onScoringOptionsChange:v,question:w,setActiveEditorId:E,startEditMode:C,UltraWindowSize:x,pluginsConfig:O,detailsHidden:T,questionTitle:k,readonlyPoints:q,assessmentType:A,duplicateAnswerIdToFocus:P,setDuplicationOptionIdToNull:I,extraCreditVisibility:j}=e,F=Object(y.a)();Object(n.useEffect)((()=>{var e;if(null!=P){let s=P;void 0===t.current[s]&&(s=s.replace("new_","")),null===(e=t.current[s])||void 0===e||e.focusEditor(),null==I||I()}}),[P,I]);const N=(e,s)=>{t.current[e]=s},D=w.answers.filter((e=>e.isDistractor)),_=os.g(w),R=os.a(w),M=Ve.a.INACTIVE===u,L=!M&&Object(d.i)(w),B=!T||!M,Q=w.prompts.length>=r.G,V=Q?F("assessments.canvas.question.matching.addPairMaxReached",{maxCount:r.G}):F("assessments.canvas.question.matching.addPair"),$=D.length>=r.F,H=$?F("assessments.canvas.question.matching.addDistractorMaxReached",{maxCount:r.F}):F("assessments.canvas.question.matching.addDistractor"),z=Object(d.z)(e.question),K=()=>!0===S.get(e,"question.permissions.addOrRemoveAnswer")&&!0===S.get(e,"question.permissions.changeMatchingAnswerIndex")||z,U=e=>{e.preventDefault()},G=[{key:Cs.c},{key:Cs.b},{key:Cs.e},{key:Cs.d}];return a.a.createElement("div",{className:"matching "+(u?"matching--edit":"matching--read")},a.a.createElement(i.a,{editMode:u,question:w},B?a.a.createElement(a.a.Fragment,null,a.a.createElement($e.a,{...Object($e.b)(Vs(e,F),f)}),a.a.createElement(Ue.a,{show:L,question:w})):a.a.createElement(Ke.a,{question:w,questionTitle:k,readonlyPoints:q,extraCreditVisibility:j}),a.a.createElement(He.a,{...Object(He.b)(e)}),B?a.a.createElement(a.a.Fragment,null,a.a.createElement(Es.a,{instructions:F("assessments.canvas.question.matching.instructions"),show:!M}),a.a.createElement(it.a,{...Object(it.b)(e,f)})):null),B?a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:"matching__container"},a.a.createElement("div",{className:"matching__pairs"},!(null==x?void 0:x.isSmallBreakpoint())&&a.a.createElement("div",{className:"matching__column-titles-container"},a.a.createElement("div",{className:"matching__column-title "+(M?"":"field-required")},F("assessments.canvas.question.matching.headers.prompts")),a.a.createElement("div",{className:"matching__column-title "+(M?"":"field-required")},F("assessments.canvas.question.matching.headers.answers"))),a.a.createElement("ol",{className:"matching__list"},w.prompts.map(((t,s)=>a.a.createElement("li",{key:t.id,className:"matching__list-item"},a.a.createElement(ys,{...e,answerIsReused:os.d(w,t.id),answer:w.answers[t.matchingAnswerIndex],answerIdToPromptIndexMap:R,canDeletePromptAnswerPair:c,hasRemovePromptAnswerPairPermissions:!0===S.get(e,"question.permissions.addOrRemovePrompt")&&!0===S.get(e,"question.permissions.addOrRemoveAnswer")&&!0===S.get(e,"question.permissions.changeMatchingAnswerIndex")||z,hasReuseAnswerPermissions:K(),index:s,onPromptAnswerPairDeletion:g,prompt:t,reusableAnswers:_,reusedElsewherePair:os.d(w,t.id),startEditMode:C,setEditor:N}))))),!M&&a.a.createElement("div",{className:"matching__actions-container"},a.a.createElement("div",{className:"matching__action"},(!0===S.get(e,"question.permissions.addOrRemovePrompt")&&!0===S.get(e,"question.permissions.addOrRemoveAnswer")||z)&&a.a.createElement(_t.Link,{className:"matching__add-pair",onClick:b,onMouseDown:U,type:"button",disabled:Q,analyticsId:"assessments.canvas.question.matching.add.pair.link"},V)),a.a.createElement("span",{className:"matching__action"},F("assessments.canvas.question.matching.randomAnswers")))),(!M||M&&D.length>0)&&a.a.createElement("div",{className:"matching__distractors"},a.a.createElement("div",{className:"matching__distractors-list"},a.a.createElement("div",{className:"matching__distractors-list-label "+(1!==w.prompts.length||M?"":"field-required")},a.a.createElement("span",null,F("assessments.canvas.question.matching.additionalAnswers"))),a.a.createElement("ol",{className:"matching__list matching__distractors-list-items"},D.map(((t,s)=>a.a.createElement("li",{className:"matching__distractors-list-items-item",key:t.ui.id},a.a.createElement(ls,{...e,answer:t,canDeleteDistractor:l,hasRemoveAnswerPermissions:K(),index:s,onDistractorDeletion:m,setEditor:N})))))),a.a.createElement("div",{className:"matching__distractor-actions"},!M&&(!0===S.get(e,"question.permissions.addOrRemoveAnswer")||z)&&a.a.createElement(_t.Link,{className:"matching__add-distractor",onClick:h,onMouseDown:U,type:"button",disabled:$,analyticsId:"assessments.canvas.question.matching.add.disctractor.link"},H)))),a.a.createElement(xs.a,{question:e.question,onScoringOptionsChange:v,editMode:e.editMode,isAnswersEditMode:!0,options:G,translationKeyPrefix:"assessments.canvas.question.matching.scoringOptions"}),a.a.createElement(p.a,{assessmentId:s,activeEditorId:o,editMode:u,onQuestionChange:f,question:w,setActiveEditorId:E,pluginsConfig:O,assessmentType:A})):null)}));class Ts extends n.Component{constructor(){super(...arguments),this.validate=(e,t)=>{const s=t,n=s.answers.some((e=>""===e.answerText.rawText)),a=s.prompts.some((e=>""===e.promptText.rawText));return!(n||a)&&Object(d.j)(e,s)},this.onQuestionChange=(e,t)=>{const s={...e.applyAsyncPlugins,answerText:async()=>{var t;return{answers:await Promise.all(null===(t=e.answers)||void 0===t?void 0:t.map((e=>Object(A.a)(e))))}},promptText:async()=>{var t;const s=await Promise.all(null===(t=e.prompts)||void 0===t?void 0:t.map((e=>Object(A.a)(e))));return{prompts:this.updatePromptsPartialCreditPercentage({...e,prompts:s})}}},n={...e,prompts:this.updatePromptsPartialCreditPercentage(e),applyAsyncPlugins:s};this.props.onQuestionChange(n,this.validate,t)},this.onAnswerChange=e=>{const{question:t}=this.props,s=t.answers.map((t=>t.ui.id===e.ui.id?e:t)),n={...t,answers:s};this.onQuestionChange(n)},this.onPromptChange=e=>{const{question:t}=this.props,s=t.prompts.map((t=>t.id===e.id?e:t)),n={...t,prompts:s};this.onQuestionChange(n)},this.onPromptAnswerPairAddition=()=>{const{question:e,setActiveEditorId:t}=this.props,s=r.N.createMatchingAnswer(),n=r.N.createMatchingPrompt(e.answers.length),a={...e,prompts:[...e.prompts,n],answers:[...e.answers,s]};this.onQuestionChange(a,(()=>t(`prompt-${n.id}`)))},this.onDistractorAddition=()=>{const{question:e,setActiveEditorId:t}=this.props,s=r.N.createMatchingAnswer(!0),n={...e,answers:[...e.answers,s]};this.onQuestionChange(n,(()=>t(`distractor-${s.ui.id}`)))},this.onPromptAnswerPairDeletion=e=>{const{question:t}=this.props;this.onQuestionChange(os.f(t,e))},this.onDistractorDeletion=e=>{const{question:t}=this.props,s=t.answers.findIndex((t=>t.ui.id===e)),n=os.e(t,s);this.onQuestionChange(n)},this.onPromptAnswerReuse=(e,t)=>{const{question:s}=this.props,n=s.prompts.findIndex((t=>t.id===e)),a=s.prompts[n],i=s.prompts[n].matchingAnswerIndex,o=s.prompts[t].matchingAnswerIndex,r=[...s.prompts.slice(0,n),{...a,matchingAnswerIndex:o,reusesAnswer:!0},...s.prompts.slice(n+1)];let l={...s,prompts:r,answers:s.answers};a.reusesAnswer||(l=os.e(l,i)),this.onQuestionChange(l)},this.onPromptRemoveReusedAnswer=e=>{const{question:t,setActiveEditorId:s}=this.props,n=t.prompts.findIndex((t=>t.id===e)),a=r.N.createMatchingAnswer(!1),i=[...t.answers,a],o=i.length-1,l=[...t.prompts.slice(0,n),{...t.prompts[n],matchingAnswerIndex:o,reusesAnswer:!1},...t.prompts.slice(n+1)],c={...t,prompts:l,answers:i};this.onQuestionChange(c,(()=>s(os.b(e))))},this.canDeletePromptAnswerPair=e=>{const{question:t}=this.props;return t.prompts.length>r.I&&(t.answers.length>r.H||e)},this.canDeleteDistractor=()=>{const{question:e}=this.props;return e.answers.length>r.H},this.onScoringOptionsChange=e=>{const{question:t}=this.props,s={...t,...e};this.onQuestionChange(s)},this.updatePromptsPartialCreditPercentage=e=>{const t=e=>{const t=10**5;return Math.round(t*e)/t},s=e.prompts,n=(e=>{const t=10**5;return Math.trunc(t*e)/t})(100/s.length),a=-1*n,i=t(100-n*s.length);return s.map(((e,o)=>o===s.length-1?{...e,partialCredit:t(n+i),negativeCredit:t(a-i)}:{...e,partialCredit:n,negativeCredit:a}))}}render(){return a.a.createElement(Os,{...this.props,canDeleteDistractor:this.canDeleteDistractor,canDeletePromptAnswerPair:this.canDeletePromptAnswerPair,onAnswerChange:this.onAnswerChange,onDistractorAddition:this.onDistractorAddition,onDistractorDeletion:this.onDistractorDeletion,onPromptAnswerPairAddition:this.onPromptAnswerPairAddition,onPromptAnswerPairDeletion:this.onPromptAnswerPairDeletion,onPromptAnswerReuse:this.onPromptAnswerReuse,onPromptRemoveReusedAnswer:this.onPromptRemoveReusedAnswer,onPromptChange:this.onPromptChange,onQuestionChange:this.onQuestionChange,onScoringOptionsChange:this.onScoringOptionsChange})}}var ks=Object(ze.a)(Object(h.a)(Ts)),Ss=s("KLhW");class qs extends n.Component{constructor(e){super(e),this.validate=(e,t)=>{const s=t.answers.some((e=>""===e.answerText.rawText)),n=t.answers.some((e=>e.correctAnswer));return!s&&n&&Object(d.k)(e,t)},this.onQuestionChange=e=>{const t=this.getApplyAsyncPlugins(e),s=e.allowPartialCredit?{...e,answers:this.calculateAnswersPartialCreditPercentage(e.answers,e.allowNegativeScoreForIncorrectAnswers),applyAsyncPlugins:t}:{...e,applyAsyncPlugins:t};this.props.onQuestionChange(s,this.validate)},this.onAnswerChange=e=>{const{question:t,hasSubmissions:s}=this.props,n=t.answers.map((t=>t.id===e.id?e:t)),a=1===this.countCorrectAnswers(n),i={...t,answers:n,singleCorrectAnswer:a};s&&a&&Object.assign(i,{allowNegativeOverallScore:!1,allowNegativeScoreForIncorrectAnswers:!1,allowPartialCredit:!1}),this.onQuestionChange(i)},this.onAnswerAddition=()=>{const{question:e}=this.props,t=r.N.createMultipleAnswerAnswer(!1),s={...e,answers:[...e.answers,t]};this.onQuestionChange(s)},this.onAnswerDeletion=e=>{const{question:t}=this.props,s={...t,answers:t.answers.filter((t=>t.id!==e))};this.onQuestionChange(s)},this.onScoringOptionsChange=e=>{const{question:t}=this.props,s={...t,...e};this.onQuestionChange(s)},this.calculateAnswersPartialCreditPercentage=(e,t)=>{const s=e.filter((e=>e.correctAnswer)).length,n=parseFloat((-100/e.length).toFixed(8)),a=parseFloat((100/s).toFixed(8)),i=parseFloat((100-a*s).toFixed(8));let o=0;return e.map((e=>{let r;if(e.correctAnswer)return o+=1,r=o===s?a+i:a,{...e,partialCredit:r.toFixed(8)};if(t)return r=n,{...e,partialCredit:r.toFixed(8)};if(!t){const t={...e};return t.partialCredit&&delete t.partialCredit,{...t}}return e}))},this.canDeleteAnswer=e=>{const{correctAnswerCount:t}=this.state,{question:s}=this.props;return!(s.answers.length===r.J||1===t&&e.correctAnswer)},this.onReorder=e=>{const{onQuestionChange:t,question:s}=this.props,n={...s,answers:e},a=this.getApplyAsyncPlugins(n);t({...n,applyAsyncPlugins:a},d.k)},this.state={correctAnswerCount:this.countCorrectAnswers(e.question.answers)}}UNSAFE_componentWillReceiveProps(e){this.setState((()=>({correctAnswerCount:this.countCorrectAnswers(e.question.answers)})))}getApplyAsyncPlugins(e){return{...e.applyAsyncPlugins,answerText:async()=>{var t;const s=await Promise.all(null===(t=e.answers)||void 0===t?void 0:t.map((e=>Object(A.a)(e))));return{answers:e.allowPartialCredit?this.calculateAnswersPartialCreditPercentage(s,e.allowNegativeScoreForIncorrectAnswers):s}}}}countCorrectAnswers(e){return e.filter((e=>e.correctAnswer)).length}render(){return a.a.createElement(Ss.a,{...this.props,onReorder:this.onReorder,onQuestionChange:this.onQuestionChange,onAnswerChange:this.onAnswerChange,onAnswerAddition:this.onAnswerAddition,onAnswerDeletion:this.onAnswerDeletion,onScoringOptionsChange:this.onScoringOptionsChange,showScoringOptions:this.state.correctAnswerCount>1,canDeleteAnswer:this.canDeleteAnswer})}}var As=Object(ze.a)(qs),Ps=s("t3aq"),Is=s("PCui"),js=s("9i9V"),Fs=s("4yoV"),Ns=s("33wY");class Ds extends n.Component{constructor(e){var t;super(e),this.setupFileAttachmentMenuOptions=()=>{const{ally:e,localize:t,question:s}=this.props;if(this.isFileAttachment){const n=this.props.dropDownMenuOptionsOverrides||[],i=Object(Is.a)(s),{file:o,readOnly:l}=i[0],c=Object(_.eb)(o,l,this.props.localize.translate,void 0,[],this.props.supportsInlineDocumentRender,e.isAvailable).items.filter((e=>-1!==["viewFile","downloadFile"].indexOf(e.key)));e.isAvailable&&(c.push({key:"instructorfeedback",icon:a.a.createElement(St.AllyScore,null),name:t.translate("assessments.canvas.question.overflowOptions.viewAxFeedback"),additionalAttributes:{"data-ally-show":"instructorfeedback","data-ally-content-ref":s.id,"data-ally-invoke":"instructorfeedback"},style:{display:"none"}}),o.render!==r.t.InlineOnly&&c.push({key:"alternativeformats",icon:a.a.createElement(St.AllyDownload,null),name:t.translate("assessments.canvas.question.overflowOptions.alternativeFormats"),additionalAttributes:{"data-ally-show":"alternativeformats","data-ally-content-ref":s.id,"data-ally-invoke":"alternativeformats"},style:{display:"none"}})),this.setState({overflowMenuOptionOverrides:n.concat(c)})}},this.onQuestionChange=(e,t,s)=>{this.props.onQuestionChange(e,((e,t)=>Object(d.l)(e,t)),t,s)},this.saveFileSettings=e=>{this.setState((()=>({isShowingFileSettingsDialog:!1})));const{resourceUrl:t}=e,s=Object(js.a)(e),n=Object(js.b)(t,s),a={...this.props.question,questionText:{rawText:Object(Fs.b)(n)}};this.props.onQuestionChange(a,((e,t)=>Object(d.l)(e,t)),this.props.onQuestionSave,!1)},this.hideFileSettingsDialog=()=>{this.setState((()=>({isShowingFileSettingsDialog:!1})))},this.startEditMode=()=>{const{startEditMode:e}=this.props;this.isFileAttachment?this.setState((()=>({isShowingFileSettingsDialog:!0}))):e()},this.getFileViewerWidgets=()=>{const{localize:e,question:t}=this.props,s=Object(Is.a)(t),{file:n}=s[0];return a.a.createElement("div",{className:"presentation-only__file-content__widget-wrapper"},a.a.createElement("span",{className:"presentation-only__file-content__widget-wrapper__score-indicator","data-ally-content-ref":t.id,"data-ally-show":"instructorfeedback"},a.a.createElement(Ps.b,{contentRef:t.id,widgetType:Ps.d.ScoreIndicator})),n.render!==r.t.InlineOnly?a.a.createElement("span",{className:"presentation-only__file-content__widget-wrapper__alt-formats","data-ally-content-ref":t.id,"data-ally-show":"alternativeformats"},a.a.createElement(Ps.b,{contentRef:t.id,widgetType:Ps.d.AlternativeFormats,ariaLabel:e.translate("assessments.canvas.question.overflowOptions.alternativeFormats")})):void 0)},this.renderFile=()=>{var e,t,s;const{question:n,ally:i}=this.props,o=Object(Is.a)(n),{file:r}=o[0],l={...n.id?{"data-ally-content-id":n.id}:null,...this.xythosId?{"data-ally-file-eid":this.xythosId}:null,...this.resourceUrl?{"data-ally-file-preview-url":this.resourceUrl}:null},c=Object(_.ib)(Object(_.fb)(r))&&Object(_.Z)(r)&&(Object(_.hb)(r)||this.state.isMediaPreviewVisible);return a.a.createElement("div",{className:"presentation-only__file-content"},a.a.createElement(Ps.a,{contentId:null!==(e=n.id)&&void 0!==e?e:"",fileId:null!==(t=this.xythosId)&&void 0!==t?t:"",filePreviewUrl:null!==(s=this.resourceUrl)&&void 0!==s?s:""}),a.a.createElement(_.r,{...o[0],widgets:i.isAvailable&&this.getFileViewerWidgets(),inlineMediaAdditionalAttributes:c?l:{},isAllyEnabled:i.isAvailable,onToggleMediaPreview:e=>this.setState({isMediaPreviewVisible:e}),analyticsId:"assessment.question.presentation.fileViewer",supportsInlineDocumentRender:this.props.supportsInlineDocumentRender}),a.a.createElement(_.o,{file:r,hidden:!this.state.isShowingFileSettingsDialog,onCancel:this.hideFileSettingsDialog,onSave:this.saveFileSettings,analyticsId:"assessment.question.presentation.fileDialog",supportsInlineDocumentRender:this.props.supportsInlineDocumentRender,canProvideDescription:!0}))},this.renderText=()=>a.a.createElement(it.a,{...Object(it.b)(this.props,this.onQuestionChange)}),this.state={isShowingFileSettingsDialog:!1,overflowMenuOptionOverrides:[],isMediaPreviewVisible:!1};const{question:s,ally:n}=this.props;this.isFileAttachment=r.N.isFileAttachment(s);let i=[];this.isFileAttachment&&(i=Object(Is.a)(s)),this.isFileAttachment&&1===i.length&&(this.resourceUrl=null!==(t=i[0].file.resourceUrl)&&void 0!==t?t:"",this.xythosId=n.service.getXythosIdFromContentFileUrl(this.resourceUrl),n.isAvailable&&n.service.update(n.contentId,this.xythosId))}componentDidUpdate(e){const{editMode:t,question:s,setActiveEditorId:n}=this.props,{editMode:a}=e;Ve.a.INACTIVE===a&&Ve.a.ACTIVE===t&&s.id&&n(s.id)}UNSAFE_componentWillMount(){this.setupFileAttachmentMenuOptions()}render(){const{editMode:e,question:t}=this.props;return a.a.createElement("div",{className:"presentation-only"},a.a.createElement(i.a,{editMode:e,question:t},a.a.createElement(He.a,{...Object(He.b)(this.props),dropDownMenuOptionsOverrides:this.state.overflowMenuOptionOverrides,updateDropdownMenuOptions:this.setupFileAttachmentMenuOptions,startEditMode:this.startEditMode}),this.isFileAttachment?this.renderFile():this.renderText()))}}var _s=Object(ze.a)(Object(Ns.b)(Object(h.a)(Ds))),Rs=s("YuUd"),Ms=s("0Ljr"),Ls=s("I4tD");s.d(t,"a",(function(){return Bs})),s.d(t,"b",(function(){return Qs})),s.d(t,"c",(function(){return Vs}));const Bs=e=>{const{question:t,...s}=e;return Object(d.t)(t)?a.a.createElement(Ms.a,{...s,question:t}):Object(d.u)(t)?a.a.createElement(lt.a,{...s,question:t}):Object(d.v)(t)?a.a.createElement(ct.a,{...s,question:t}):Object(d.w)(t)?a.a.createElement(is,{...s,question:t}):Object(d.B)(t)?a.a.createElement(_s,{...s,question:t}):Object(d.x)(t)?a.a.createElement(ks,{...s,question:t}):Object(d.y)(t)?a.a.createElement(As,{...e}):Object(d.C)(t)?a.a.createElement(Rs.a,{...e}):Object(d.s)(t)?a.a.createElement(rt,{...e}):Object(d.r)(t)?a.a.createElement(Ge,{...s,question:t}):Object(d.A)(t)?a.a.createElement(Ls.a,{...s,question:t}):(console.error("Unknown question type encountered"),null)},Qs=({allyService:e,contentId:t,...s})=>a.a.createElement(Ns.a,{allyService:e,contentId:t},a.a.createElement(Bs,{...s})),Vs=(e,t)=>{const{openGoals:s,question:n}=e;return{...e,localize:{translate:t},openGoals:()=>null==s?void 0:s(n)}}},"6OL3":function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));var n=s("ERkP"),a=s("nsO7");const i=()=>{const[e,t]=Object(n.useState)({}),s=Object(n.useMemo)((()=>Object.keys(e).length),[e]),i=Object(n.useMemo)((()=>Object.values(e)||[]),[e]),o=Object(n.useMemo)((()=>Object(a.sortBy)(i,(e=>e.position))),[i]),r=Object(n.useCallback)((e=>t((t=>({...t,...e.reduce(((e,t)=>({...e,[t.object.id]:t})),{})})))),[]),l=Object(n.useCallback)((e=>r([e])),[r]),c=Object(n.useCallback)(((e,t)=>{const s=Object.values(e).map((e=>e.position)).sort(((e,t)=>e-t));return Object.keys(e).reduce(((n,a)=>{const i=s.indexOf(e[a].position)+1;return{...n,[a]:t({...e[a],position:i})}}),{})}),[]),u=Object(n.useCallback)(((e,s=a.identity)=>t((t=>{const n=Object.keys(t).filter((s=>!e.includes(t[s].position))).reduce(((e,s)=>({...e,[s]:t[s]})),{});return c(n,s)}))),[c]),d=Object(n.useCallback)((e=>u([e])),[u]),p=Object(n.useCallback)((e=>i.find((t=>t.object.id===e))),[i]),h=Object(n.useCallback)((e=>i.find((t=>t.position===e))),[i]),m=Object(n.useCallback)((e=>i.filter((t=>e.includes(t.position))).map((e=>e.object.id))),[i]),b=Object(n.useCallback)((e=>i.some((t=>t.position===e))),[i]),g=Object(n.useCallback)((()=>t((e=>({...e})))),[]),f=Object(n.useCallback)((t=>{var s;return null===(s=Object.values(e).find((e=>e.object.id===t.id)))||void 0===s?void 0:s.position}),[e]);return{add:l,count:s,remove:d,values:i,getById:p,refreshMap:g,addMultiple:r,sortedValues:o,getByPosition:h,removeMultiple:u,existsByPosition:b,getIdsByPosition:m,getObjectPosition:f}}},"6rLV":function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));s("zGdY");const n=(e,t,s,n,a,i)=>Object.keys(t).filter((e=>!1!==n[e])).map((n=>({analyticsId:`${i}.${n}`,key:`new_${n}_question`,icon:e,text:s(t[n].localization),children:t[n].inlineComponent,onClick:()=>a(n)})))},"7k4i":function(e,t,s){"use strict";var n=s("nsO7"),a=s("ERkP"),i=s.n(a),o=s("WBPx"),r=s("EGyI"),l=s("8tZv"),c=s("UJ5P");var u=s("ekqz"),d=s("AoSC"),p=s("IbyE"),h=s("zGdY"),m=s("8jLo");t.a=e=>{class t extends a.Component{constructor(e){super(e),this.originalQuestion=this.props.question,this.containerRef=null,this.duplicateOptionId=null,this.isExactDuplicate=!1,this.isPromptDuplicate=!1,this.isNewQuestion=()=>Object(d.z)(this.props.question),this.hasQuestionDeletePermissions=()=>{const{disableDeletingQuestion:e,deleteQuestion:t}=this.props;if(e||!t)return!1;const s=n.get(this.props,"question.permissions.delete");return null==s?this.isNewQuestion():s},this.hasQuestionEditPermissions=()=>{const{disableEditingQuestion:e}=this.props;if(e)return!1;const t=n.get(this.props,"question.permissions.edit");return null==t?this.isNewQuestion():t},this.hasAlignToGoalPermissions=()=>{const{disableAligningToGoal:e,openGoals:t}=this.props;if(e||!t)return!1;const s=n.get(this.props,"question.permissions.edit");return null==s?this.isNewQuestion():s},this.getEditMode=()=>this.editModeIsActive()?c.a.ACTIVE:c.a.INACTIVE,this.editModeIsActive=()=>this.props.question.id===this.props.questionBeingEditedId,this.refreshBbml=()=>{this.setState({refreshBbml:!0},(()=>this.setState({refreshBbml:!1})))},this.handleQuestionRevert=(e=null)=>{this.isNewQuestion()||this.resetQuestionFromProps(e)},this.resetQuestionFromProps=(e=null)=>{const t=this.props.question;this.originalQuestion=t,this.setState((()=>({question:t})),(()=>{this.refreshBbml(),e&&e()}))},this.setQuestionValid=()=>{this.setState({isValid:!0})},this.onQuestionChange=(e,t,s=null,n=!0)=>{this.setState((s=>{const n=t(this.originalQuestion,e,s.question,s.isValid);return{question:{...s.question,...e},isValid:n}}),(()=>{n&&this.props.onQuestionMadeDirty(!0),s&&s()}))},this.openGoals=()=>{const{openGoals:e,question:t}=this.props;null==e||e(t)},this.onSaveButtonClick=()=>{const{question:e}=this.state,{checkAndDisableAssessmentSettings:t,hasSubmissions:s}=this.props,n=Object(d.i)(e);let a=!1;s&&(a=Object(d.E)(this.originalQuestion,e)),a&&n?this.showCombinedRegradingLinkedQuestionDialog():a?this.showRegradingDialog():n?this.showLinkedQuestionDialog():this.state.isSaveInProgress||(!p.N.isPresentationOnly(e)&&t?t(this.onQuestionSave):this.onQuestionSave())},this.onQuestionDelete=()=>{const{deleteQuestion:e,question:t}=this.props;e(t)},this.onQuestionSave=()=>{this.setState({isSaveInProgress:!0});const e=this.state.question;if(this.state.hasDuplicateOptions||null!=this.state.foundDuplicateOption)this.dismissDuplicateOptionDialog();else{const t=Object(d.a)(e);if(this.duplicateOptionId=null==t?void 0:t.duplicateId,this.isExactDuplicate="exact"===(null==t?void 0:t.matchType),this.isPromptDuplicate=(null==t?void 0:t.duplicateId.indexOf("prompt-new"))>=0,this.duplicateOptionId)return void this.showDuplicateOptionDialog()}const t=this.refreshBbml,s=this.stopEditMode,n=this.props.persistQuestion,a=this.props.question,i=this.props.question.sourceInfo?this.props.question.sourceInfo.id:this.props.question.assessmentId;Object(m.a)(e).then((e=>(e=Object(d.F)(e),n(a,e,i)))).then((({question:e})=>{this.originalQuestion=e,t(),s()})).finally((()=>{this.setState({isSaveInProgress:!1})}))},this.onQuestionCancel=()=>{const{onQuestionEditCancel:e}=this.props;if(this.isNewQuestion()){const{deleteQuestion:e,question:t}=this.props;this.stopEditMode(),e(t)}else this.handleQuestionRevert(this.stopEditMode);e&&e()},this.startEditMode=(e=null)=>{this.props.isAnyQuestionDirty||this.props.questionBeingEditedId===this.props.question.id||this.props.question.questionType!==h.Qb.PageBreak&&(this.props.onQuestionEdit(this.props.question.id),e&&e())},this.stopEditMode=()=>{const{onQuestionEdit:e,onQuestionMadeDirty:t}=this.props;t(!1),e(null),this.containerRef&&this.containerRef.querySelector(`.${u.a}`)&&this.containerRef.querySelector(`.${u.a}`).focus(),this.setActiveEditorId(null),this.setState((()=>({isValid:!1,showRegradingDialog:!1,showLinkedQuestionDialog:!1,showCombinedRegradingLinkedQuestionDialog:!1})))},this.setActiveEditorId=e=>{this.setState((()=>({activeEditorId:e})))},this.showQuestionControls=()=>{if(!1===this.props.showQuestionControls)return!1;return null===this.props.questionBeingEditedId},this.showCombinedRegradingLinkedQuestionDialog=()=>{this.setState((()=>({showCombinedRegradingLinkedQuestionDialog:!0})))},this.showDuplicateOptionDialog=()=>{this.setState((()=>({hasDuplicateOptions:!0,isExactDuplicate:this.isExactDuplicate,isPromptDuplicate:this.isPromptDuplicate})))},this.dismissDuplicateOptionDialog=()=>{this.setState((()=>({hasDuplicateOptions:!1,foundDuplicateOption:this.duplicateOptionId,isExactDuplicate:!1})))},this.dismissCombinedRegradingLinkedQuestionDialog=()=>{this.setState((()=>({showCombinedRegradingLinkedQuestionDialog:!1})))},this.setDuplicationOptionIdToNull=()=>{this.setState((()=>({foundDuplicateOption:null})))},this.showLinkedQuestionDialog=()=>{this.setState((()=>({showLinkedQuestionDialog:!0})))},this.dismissLinkedQuestionDialog=()=>{this.setState((()=>({showLinkedQuestionDialog:!1})))},this.showRegradingDialog=()=>{this.setState((()=>({showRegradingDialog:!0})))},this.dismissRegradingDialog=()=>{this.setState((()=>({showRegradingDialog:!1})))},this.onSaveCancelMouseDown=e=>{e.preventDefault()},this.setContainerRef=e=>{this.containerRef=e},this.state={question:e.question,refreshBbml:!1,activeEditorId:null,isValid:!1,showRegradingDialog:!1,showLinkedQuestionDialog:!1,showCombinedRegradingLinkedQuestionDialog:!1,hasDuplicateOptions:!1,isExactDuplicate:!1,isPromptDuplicate:!1,foundDuplicateOption:null,isSaveInProgress:!1}}componentDidMount(){const{onQuestionMadeDirty:e,question:t,questionBeingEditedId:s}=this.props;this.isNewQuestion()&&!s&&(this.startEditMode(),e(!0));this.isNewQuestion()&&Object(d.D)(t)&&this.setQuestionValid()}componentDidUpdate(e){const{question:t}=e,{question:s}=this.props,n=!this.editModeIsActive(),a=Object(d.p)(t,s),i=Object(d.n)(t,s);n&&(i||a)&&this.resetQuestionFromProps()}render(){const{onQuestionEdit:t,onQuestionMadeDirty:s,isAnyQuestionDirty:n,persistQuestion:a,localizationPrefix:r,t:u,...d}=this.props,{question:p,refreshBbml:h,activeEditorId:m,showRegradingDialog:b,showLinkedQuestionDialog:g,showCombinedRegradingLinkedQuestionDialog:f,hasDuplicateOptions:v,isExactDuplicate:w,isPromptDuplicate:y,foundDuplicateOption:E}=this.state,C=this.getEditMode(),x=c.a.ACTIVE===C,O=this.hasQuestionEditPermissions()&&!n,T=u(`${r}.canvas.question.cancel`),k=`${r}.canvas.warningDialogs.questionRegrading.cancel`,S=`${r}.canvas.warningDialogs.questionRegrading.ok`;return i.a.createElement("div",{className:"question-container",ref:this.setContainerRef},i.a.createElement(e,{...d,showQuestionControls:this.showQuestionControls(),editMode:C,onQuestionChange:this.onQuestionChange,onQuestionRevert:this.handleQuestionRevert,onQuestionSave:this.onQuestionSave,question:p,refreshBbml:h,startEditMode:this.startEditMode,setActiveEditorId:this.setActiveEditorId,activeEditorId:m,deleteQuestion:this.onQuestionDelete,hasQuestionDeletePermissions:this.hasQuestionDeletePermissions(),hasQuestionEditPermissions:this.hasQuestionEditPermissions(),hasAlignToGoalPermissions:this.hasAlignToGoalPermissions(),openGoals:this.openGoals,canEnterEditMode:O,localizationPrefix:r,duplicateAnswerIdToFocus:E,setDuplicationOptionIdToNull:this.setDuplicationOptionIdToNull}),x&&i.a.createElement("div",{className:"question-container__buttons"},i.a.createElement(o.AnalyticsDefaultButton,{type:"button",onClick:this.onQuestionCancel,onMouseDown:this.onSaveCancelMouseDown,analyticsId:"assessments.canvas.editMode.question.cancel"},T),i.a.createElement(o.AnalyticsPrimaryButton,{disabled:!this.state.isValid,type:"button",onClick:this.onSaveButtonClick,onMouseDown:this.onSaveCancelMouseDown,analyticsId:"assessments.canvas.editMode.question.save"},u(`${r}.canvas.question.save`))),v&&w&&i.a.createElement(l.a,{show:!0,onDismiss:this.dismissDuplicateOptionDialog,onOk:this.dismissDuplicateOptionDialog,okButtonLocaleKey:"assessments.canvas.warningDialogs.duplicateOptionsFound.ok",title:u(y?"assessments.canvas.warningDialogs.duplicateOptionsFound.exactDuplicate.exactDuplicateTitleForPrompt":"assessments.canvas.warningDialogs.duplicateOptionsFound.exactDuplicate.exactDuplicateTitle"),subText:u(y?"assessments.canvas.warningDialogs.duplicateOptionsFound.exactDuplicate.exactDuplicateSubTextForPrompt":"assessments.canvas.warningDialogs.duplicateOptionsFound.exactDuplicate.exactDuplicateSubText"),showCloseButton:!1,analyticsId:"assessments.canvas.warningDialogs.duplicateOptionsFound",hideCancelButton:!0}),v&&!w&&i.a.createElement(l.a,{show:!0,onCancel:this.dismissDuplicateOptionDialog,onDismiss:this.dismissDuplicateOptionDialog,onOk:this.onQuestionSave,cancelButtonLocaleKey:y?"assessments.canvas.warningDialogs.duplicateOptionsFound.editPrompts":"assessments.canvas.warningDialogs.duplicateOptionsFound.editAnswers",okButtonLocaleKey:"assessments.canvas.warningDialogs.duplicateOptionsFound.save",title:u(y?"assessments.canvas.warningDialogs.duplicateOptionsFound.titleForPrompt":"assessments.canvas.warningDialogs.duplicateOptionsFound.title"),subText:u(y?"assessments.canvas.warningDialogs.duplicateOptionsFound.subTextForPrompt":"assessments.canvas.warningDialogs.duplicateOptionsFound.subText",{editAnswers:i.a.createElement("strong",null,u(y?"assessments.canvas.warningDialogs.duplicateOptionsFound.editPrompts":"assessments.canvas.warningDialogs.duplicateOptionsFound.editAnswers")),save:i.a.createElement("strong",null,u("assessments.canvas.warningDialogs.duplicateOptionsFound.save"))}),showCloseButton:!1,analyticsId:"assessments.canvas.warningDialogs.duplicateOptionsFound"}),f&&i.a.createElement(l.a,{show:!0,onCancel:this.dismissCombinedRegradingLinkedQuestionDialog,onDismiss:this.dismissCombinedRegradingLinkedQuestionDialog,onOk:this.onQuestionSave,cancelButtonLocaleKey:"assessments.canvas.warningDialogs.combinedRegradingLinkedQuestion.cancel",okButtonLocaleKey:"assessments.canvas.warningDialogs.combinedRegradingLinkedQuestion.ok",title:u("assessments.canvas.warningDialogs.combinedRegradingLinkedQuestion.title"),subText:u("assessments.canvas.warningDialogs.combinedRegradingLinkedQuestion.subText"),showCloseButton:!1,analyticsId:"assessments.canvas.warningDialogs.combinedRegradingLinkedQuestion"}),b&&i.a.createElement(l.a,{show:!0,onCancel:this.dismissRegradingDialog,onDismiss:this.dismissRegradingDialog,onOk:this.onQuestionSave,cancelButtonLocaleKey:k,okButtonLocaleKey:S,title:u(`${r}.canvas.warningDialogs.questionRegrading.title`),subText:u(`${r}.canvas.warningDialogs.questionRegrading.subText`),showCloseButton:!1,analyticsId:"assessments.canvas.warningDialogs.questionRegrading"}),g&&i.a.createElement(l.a,{show:!0,onCancel:this.dismissLinkedQuestionDialog,onDismiss:this.dismissLinkedQuestionDialog,onOk:this.onQuestionSave,cancelButtonLocaleKey:"assessments.canvas.warningDialogs.linkedQuestion.cancel",okButtonLocaleKey:"assessments.canvas.warningDialogs.linkedQuestion.ok",title:u("assessments.canvas.warningDialogs.linkedQuestion.title"),subText:u("assessments.canvas.warningDialogs.linkedQuestion.subText",{usageCount:p.usageCount}),showCloseButton:!1,analyticsId:"assessments.canvas.warningDialogs.linkedQuestion"}))}}return t.displayName=`WithSubscription(${function(e){return e.displayName||e.name||"Component"}(e)})`,Object(r.a)(t)}},"7x0g":function(e,t,s){"use strict";var n=s("ERkP"),a=s.n(n),i=s("MC1S"),o=s("WBPx"),r=s("VQ4P"),l=s("caKH");const c=({hidden:e,onCancel:t,onContinue:s,titleKey:n,textKey:c,cancelKey:u,continueKey:d,analyticsId:p})=>{const h=Object(r.a)();return a.a.createElement(l.c,{hidden:e,onDismiss:t,dialogContentProps:{type:i.DialogType.normal,title:h(n),subText:h(c),showCloseButton:!0},modalProps:{isBlocking:!1},analyticsId:`${p}.simpleDialog`},a.a.createElement(i.DialogFooter,null,a.a.createElement(o.AnalyticsDefaultButton,{onClick:t,analyticsId:`${p}.simpleDialog.defaultButton.cancel.button`},h(u)),a.a.createElement(o.AnalyticsPrimaryButton,{onClick:s,analyticsId:`${p}.simpleDialog.defaultButton.continue.button`},h(d))))};t.a=c},"8jLo":function(e,t,s){"use strict";function n(e){let t=Promise.resolve(e);return"function"==typeof e.applyAsyncPlugins?t=e.applyAsyncPlugins().then((t=>{const{applyAsyncPlugins:s,...n}=e;return{...n,...t}})):"object"==typeof e.applyAsyncPlugins&&(t=Promise.all(Object.values(e.applyAsyncPlugins).map((e=>e()))).then((t=>{const{applyAsyncPlugins:s,...n}=e;return t.reduce(((e,t)=>({...e,...t})),n)}))),t}s.d(t,"a",(function(){return n}))},"8tZv":function(e,t,s){"use strict";var n=s("ERkP"),a=s.n(n),i=s("MC1S"),o=s("WBPx"),r=s("VQ4P"),l=s("caKH");const c=e=>{const t=Object(r.a)(),{onCancel:s,onDismiss:n,onOk:c,show:u,subText:d,title:p,showCloseButton:h,okButtonLocaleKey:m,cancelButtonLocaleKey:b,hideCancelButton:g,analyticsId:f}=e;return a.a.createElement(l.c,{hidden:!u,onDismiss:n,dialogContentProps:{type:i.DialogType.normal,showCloseButton:h,title:p,subText:d,isAlert:!0},modalProps:{isBlocking:!0},analyticsId:`${f}.warningDialog`},a.a.createElement(i.DialogFooter,null,!g&&a.a.createElement(o.AnalyticsDefaultButton,{onClick:s,analyticsId:`${f}.warningDialog.cancel.button`},t(b)),a.a.createElement(o.AnalyticsPrimaryButton,{onClick:c,analyticsId:`${f}.warningDialog.ok.button`},t(m))))};c.defaultProps={showCloseButton:!0,cancelButtonLocaleKey:"assessments.canvas.warningDialogs.cancel",okButtonLocaleKey:"assessments.canvas.warningDialogs.ok"},t.a=c},"9i9V":function(e,t,s){"use strict";s.d(t,"a",(function(){return i})),s.d(t,"b",(function(){return o})),s.d(t,"c",(function(){return r}));var n=s("ERsv"),a=s("IbyE");function i(e){return{alternativeText:e.alternativeText,isDecorative:e.isDecorative,linkName:e.displayName,mimeType:e.mimeType,render:e.render,viewerUrl:e.viewerUrl}}function o(e,t){return{bbtype:"attachment",href:e,bbfile:JSON.stringify(t)}}function r(e){const t=[{apiBasePath:a.kb.apiBasePath,xsrfToken:a.kb.xsrf,...e}];return e.openCloudStorageIntegrationModal&&t.push(e.openCloudStorageIntegrationModal,"cloudStorageIntegration"),Object(n.uploadWorkflow)(...t).then((t=>1===t.length?function(e,t){return new Promise((s=>{const a={supportsInlineDocumentRender:t.supportsInlineDocumentRender,applyChange:e=>{e&&s(e.filter((e=>!!e.format)).map((e=>e.format.attachment)))}};Object(n.ShowEditFileAttachmentModal)(e.bbfile,null,a,t,e.href)}))}(t[0],e):t.map((({href:e,bbfile:t})=>o(e,t)))))}},AoSC:function(e,t,s){"use strict";s.d(t,"q",(function(){return u})),s.d(t,"g",(function(){return d})),s.d(t,"E",(function(){return f})),s.d(t,"c",(function(){return v})),s.d(t,"p",(function(){return w})),s.d(t,"b",(function(){return y})),s.d(t,"d",(function(){return E})),s.d(t,"e",(function(){return C})),s.d(t,"h",(function(){return x})),s.d(t,"f",(function(){return O})),s.d(t,"j",(function(){return T})),s.d(t,"k",(function(){return k})),s.d(t,"l",(function(){return S})),s.d(t,"o",(function(){return q})),s.d(t,"m",(function(){return A})),s.d(t,"n",(function(){return I})),s.d(t,"D",(function(){return j})),s.d(t,"z",(function(){return F})),s.d(t,"i",(function(){return N})),s.d(t,"t",(function(){return D})),s.d(t,"u",(function(){return _})),s.d(t,"v",(function(){return R})),s.d(t,"w",(function(){return M})),s.d(t,"B",(function(){return L})),s.d(t,"x",(function(){return B})),s.d(t,"y",(function(){return Q})),s.d(t,"C",(function(){return V})),s.d(t,"s",(function(){return $})),s.d(t,"r",(function(){return H})),s.d(t,"A",(function(){return z})),s.d(t,"F",(function(){return K})),s.d(t,"a",(function(){return U}));var n=s("nsO7"),a=s("IbyE"),i=s("zGdY"),o=s("3le2"),r=s("czSG"),l=s("RPob");const c=e=>!!e.questionText.rawText&&-1!==Math.sign(e.points),u=(e,t)=>e!==t&&-1!==Math.sign(t),d=(e,t)=>n.isUndefined(e.fullCredit)?!0===t.fullCredit:e.fullCredit!==t.fullCredit,p=(e,t)=>void 0===e.extraCredit?!0===t.extraCredit:e.extraCredit!==t.extraCredit,h=(e,t)=>e.allowPartialCredit!==t.allowPartialCredit||e.allowNegativeScoreForIncorrectAnswers!==t.allowNegativeScoreForIncorrectAnswers||e.allowNegativeOverallScore!==t.allowNegativeOverallScore,m=(e,t)=>e.partialCreditTolerance&&t.partialCreditTolerance&&(e.partialCreditTolerance.type!==t.partialCreditTolerance.type||e.partialCreditTolerance.value!==t.partialCreditTolerance.value),b=(e,t)=>e.correctAnswerTolerance&&t.correctAnswerTolerance&&(e.correctAnswerTolerance.type!==t.correctAnswerTolerance.type||e.correctAnswerTolerance.value!==t.correctAnswerTolerance.value),g=(e,t)=>e.units!==t.units&&(e.units.unitPointsPercent!==t.units.unitPointsPercent||e.units.unitsCaseSensitive!==t.units.unitsCaseSensitive||e.units.unitsRequired!==t.units.unitsRequired||e.units.unitValue!==t.units.unitValue),f=(e,t)=>{let s=!1;const{questionType:a}=e;if(s=e.points!==t.points||e.pointsPerQuestion!==t.pointsPerQuestion||d(e,t)||p(e,t),s)return!0;if(i.Qb.Multiple!==a&&i.Qb.Matching!==a||(s=h(e,t)),s)return!0;switch(a){case i.Qb.FIMB:s=n.some(t.answers,((t,s)=>{const a=e.answers[s];return!n.isEqual(t.answerValues,a.answerValues)}));break;case i.Qb.Multiple:s=n.some(t.answers,((t,s)=>{const n=e.answers[s];return t.id!==n.id||t.correctAnswer!==n.correctAnswer}));break;case i.Qb.Either:s=!n.isEqual(e.answer,t.answer);break;case i.Qb.CalculatedFormula:s=((e,t)=>e.answerFormula!==t.answerFormula||e.allowPartialCredit!==t.allowPartialCredit||e.partialCreditPointsPercent!==t.partialCreditPointsPercent||m(e,t)||b(e,t)||g(e,t))(e,t);break;case i.Qb.CalculatedNumeric:s=C(e,t);break;case i.Qb.Hotspot:s=x(e,t)}return s},v=(e,t)=>{var s,n;const a=(null===(s=e.questionText)||void 0===s?void 0:s.rawText)!==(null===(n=t.questionText)||void 0===n?void 0:n.rawText),i=u(e.points,t.points),o=d(e,t),r=p(e,t),l=((e,t)=>((e,t)=>!(!e.correctResponseFeedback||!t.correctResponseFeedback)&&e.correctResponseFeedback.rawText!==t.correctResponseFeedback.rawText)(e,t)||((e,t)=>!(!e.incorrectResponseFeedback||!t.incorrectResponseFeedback)&&e.incorrectResponseFeedback.rawText!==t.incorrectResponseFeedback.rawText)(e,t))(e,t);return a||i||o||l||r},w=(e,t)=>e.usageCount!==t.usageCount,y=(e,t)=>{var s,n,a,i;return(null===(s=e.correctResponseFeedback)||void 0===s?void 0:s.rawText)!==(null===(n=t.correctResponseFeedback)||void 0===n?void 0:n.rawText)||(null===(a=e.incorrectResponseFeedback)||void 0===a?void 0:a.rawText)!==(null===(i=t.incorrectResponseFeedback)||void 0===i?void 0:i.rawText)},E=(e,t)=>!(t.points<0)&&(!(e.answerFormula===t.answerFormula&&e.allowPartialCredit===t.allowPartialCredit&&e.answerScale===t.answerScale&&e.correctAnswerFormat===t.correctAnswerFormat&&e.correctAnswerPrecision===t.correctAnswerPrecision&&e.displayFormulaToStudent===t.displayFormulaToStudent&&e.displayRoundingSettingsToStudent===t.displayRoundingSettingsToStudent&&e.partialCreditPointsPercent===t.partialCreditPointsPercent&&n.isEqual(e.variableDefinitions,t.variableDefinitions)&&n.isEqual(e.variableSets,t.variableSets)&&e.variableSetCount===t.variableSetCount&&e.mathMLImageURL===t.mathMLImageURL&&e.mathMLImageAltText===t.mathMLImageAltText&&!m(e,t)&&!b(e,t)&&!g(e,t)&&!y(e,t))||v(e,t)),C=(e,t)=>{if(!c(t))return!1;if(null===t.answerValue||null===t.toleranceValue)return!1;if(v(e,t))return!0;const s=e.answerValue!==t.answerValue,n=e.toleranceValue!==t.toleranceValue;return s||n},x=(e,t)=>{var s,n,a,i,l,u,d;if(!c(t))return!1;const p=(t.answers||[]).filter((e=>e.correctAnswer)).length;if(!Object(o.b)(t)||(null===(s=null==t?void 0:t.answers)||void 0===s?void 0:s.length)<1||p<1||!0===(null==t?void 0:t.displayShapesToStudents)&&!Object(o.c)(t))return!1;if(v(e,t))return!0;if((null===(n=null==e?void 0:e.answers)||void 0===n?void 0:n.length)!==(null===(a=null==t?void 0:t.answers)||void 0===a?void 0:a.length))return!0;if((null==e?void 0:e.displayShapesToStudents)!==(null==t?void 0:t.displayShapesToStudents))return!0;const h=e.answers.some(((e,s)=>{var n,a,i,o;return(null==e?void 0:e.answerText)!==(null===(n=null==t?void 0:t.answers[s])||void 0===n?void 0:n.answerText)||(null==e?void 0:e.areaType)!==(null===(a=null==t?void 0:t.answers[s])||void 0===a?void 0:a.areaType)||Object(r.a)(null==e?void 0:e.coordinates,null===(i=null==t?void 0:t.answers[s])||void 0===i?void 0:i.coordinates)||(null==e?void 0:e.correctAnswer)!==(null===(o=null==t?void 0:t.answers[s])||void 0===o?void 0:o.correctAnswer)}));if(h)return!0;return(null===(i=null==e?void 0:e.hotSpotImage)||void 0===i?void 0:i.fileLocation)!==(null===(l=null==t?void 0:t.hotSpotImage)||void 0===l?void 0:l.fileLocation)||(null===(u=null==e?void 0:e.hotSpotImage)||void 0===u?void 0:u.fileName)!==(null===(d=null==t?void 0:t.hotSpotImage)||void 0===d?void 0:d.fileName)},O=(e,t)=>{var s,n,a,i;if(!c(t))return!1;if(v(e,t))return!0;return(null!==(n=null===(s=e.answerText)||void 0===s?void 0:s.rawText)&&void 0!==n?n:"")!==(null!==(i=null===(a=t.answerText)||void 0===a?void 0:a.rawText)&&void 0!==i?i:"")},T=(e,t)=>{if(!c(t))return!1;if(v(e,t))return!0;if(e.allowPartialCredit!==t.allowPartialCredit||e.allowNegativeScoreForIncorrectAnswers!==t.allowNegativeScoreForIncorrectAnswers||e.allowNegativeOverallScore!==t.allowNegativeOverallScore)return!0;if(e.prompts.length!==t.prompts.length)return!0;if(e.answers.length!==t.answers.length)return!0;const s=e.prompts.map((e=>e.id));if(t.prompts.map((e=>e.id)).some((e=>!s.includes(e))))return!0;const a=e.answers.map((e=>e.ui.id));if(t.answers.map((e=>e.ui.id)).some((e=>!a.includes(e))))return!0;const i=e.prompts.map((e=>e.promptText.rawText)),o=t.prompts.map((e=>e.promptText.rawText));if(!n.isEqual(i,o))return!0;const r=e.answers.map((e=>e.answerText.rawText)),l=t.answers.map((e=>e.answerText.rawText));return!n.isEqual(r,l)},k=(e,t)=>{if(!c(t))return!1;if(v(e,t))return!0;if(e.answers.length!==t.answers.length)return!0;const s=e.answers.map((e=>e.id));if(t.answers.map((e=>e.id)).some((e=>!s.includes(e))))return!0;const a=e.answers.map((e=>e.answerText.rawText)),i=t.answers.map((e=>e.answerText.rawText));if(!n.isEqual(a,i))return!0;if(e.answers.some((e=>{var s;return(null===(s=t.answers.find((t=>t.id===e.id)))||void 0===s?void 0:s.correctAnswer)!==e.correctAnswer})))return!0;if(h(e,t))return!0;let o=!1;for(let s=0;s<e.answers.length;s++)if(t.answers[s].id!==e.answers[s].id){o=!0;break}return o},S=(e,t)=>{var s,n;if(!c(t))return!1;return(null===(s=e.questionText)||void 0===s?void 0:s.rawText)!==(null===(n=t.questionText)||void 0===n?void 0:n.rawText)},q=(e,t)=>{if(!c(t))return!1;if(v(e,t))return!0;return e.answer!==t.answer},A=(e,t,s)=>!(t.pointsPerQuestion<0||t.numOfQuestionsToChoose<0)&&(e.pointsPerQuestion===t.pointsPerQuestion&&e.numOfQuestionsToChoose===t.numOfQuestionsToChoose&&e.numOfAvailableQuestions===t.numOfAvailableQuestions?void 0!==s&&(t.pointsPerQuestion!==s.pointsPerQuestion||t.numOfQuestionsToChoose!==s.numOfQuestionsToChoose):!(t.numOfQuestionsToChoose>t.numOfAvailableQuestions)),P={hasBaseQuestionChanged:v,hasCalculatedFormulaQuestionChanged:E,hasCalculatedNumericQuestionChanged:C,hasEssayQuestionChanged:O,hasFIMBQuestionChanged:(e,t)=>{if(!e.answers||!t.answers||e.answers.length!==t.answers.length)return!0;let s=!1;const a=n.keyBy(e.answers,(e=>e.ident));return t.answers.forEach((e=>{if(s)return;if(!a[e.ident]||e.answerValues.length!==a[e.ident].answerValues.length)return void(s=!0);const t=e.answerValues.map((e=>e.value)),i=a[e.ident].answerValues.map((e=>e.value));s=0!==n.difference(t,i).length})),s},hasHotspotQuestionChanged:x,hasPresentationQuestionChanged:S,hasQuestionBlockQuestionChanged:A,hasMatchingQuestionChanged:T,hasMultipleAnswerQuestionChanged:k,hasTrueFalseQuestionChanged:q,hasPageBreakQuestionChanged:(e,t)=>e.pageCount!==t.pageCount||e.pageNumber!==t.pageNumber},I=(e,t)=>{const{questionType:s}=e;switch(s){case i.Qb.CalculatedFormula:return P.hasCalculatedFormulaQuestionChanged(e,t);case i.Qb.CalculatedNumeric:return P.hasCalculatedNumericQuestionChanged(e,t);case i.Qb.Either:return P.hasTrueFalseQuestionChanged(e,t);case i.Qb.Essay:return P.hasEssayQuestionChanged(e,t);case i.Qb.FIMB:return P.hasFIMBQuestionChanged(e,t);case i.Qb.Hotspot:return P.hasHotspotQuestionChanged(e,t);case i.Qb.PresentationOnly:return P.hasPresentationQuestionChanged(e,t);case i.Qb.Matching:return P.hasMatchingQuestionChanged(e,t);case i.Qb.Multiple:return P.hasMultipleAnswerQuestionChanged(e,t);case i.Qb.QuestionBlock:return P.hasQuestionBlockQuestionChanged(e,t);case i.Qb.PageBreak:return P.hasPageBreakQuestionChanged(e,t);default:throw new Error(`No corresponding has-changed method specified for the given question type: ${s}`)}},j=e=>{const{questionType:t}=e;switch(t){case i.Qb.QuestionBlock:return!0;case i.Qb.PresentationOnly:return a.N.isFileAttachment(e);default:return!1}},F=e=>n.startsWith(e.id,a.K),N=e=>e.usageCount>=1,D=e=>e.questionType===i.Qb.Either,_=e=>e.questionType===i.Qb.Essay,R=e=>e.questionType===i.Qb.FIMB,M=e=>e.questionType===i.Qb.Hotspot,L=e=>e.questionType===i.Qb.PresentationOnly,B=e=>e.questionType===i.Qb.Matching,Q=e=>e.questionType===i.Qb.Multiple,V=e=>e.questionType===i.Qb.QuestionBlock,$=e=>e.questionType===i.Qb.CalculatedNumeric,H=e=>e.questionType===i.Qb.CalculatedFormula,z=e=>e.questionType===i.Qb.PageBreak,K=e=>{if(i.Qb.Multiple===e.questionType){const t=e.answers.map((e=>{var t;return{...e,answerText:{...e.answerText,rawText:e.answerText.rawText.replace(/^(&nbsp;)+|(&nbsp;)+$/g,""),displayText:null===(t=e.answerText.displayText)||void 0===t?void 0:t.replace(/^(&nbsp;)+|(&nbsp;)+$/g,"")}}}));return{...e,answers:t}}if(i.Qb.Matching===e.questionType){const t=e.prompts.map((e=>{var t;return{...e,promptText:{...e.promptText,rawText:e.promptText.rawText.replace(/^(&nbsp;)+|(&nbsp;)+$/g,""),displayText:null===(t=e.promptText.displayText)||void 0===t?void 0:t.replace(/^(&nbsp;)+|(&nbsp;)+$/g,"")}}})),s=e.answers.map((e=>{var t;return{...e,answerText:{...e.answerText,rawText:e.answerText.rawText.replace(/^(&nbsp;)+|(&nbsp;)+$/g,""),displayText:null===(t=e.answerText.displayText)||void 0===t?void 0:t.replace(/^(&nbsp;)+|(&nbsp;)+$/g,"")}}}));return{...e,prompts:t,answers:s}}return e},U=e=>{const t=(e,t)=>{const s=e[`${t}s`].length;for(let n=0;n<s;n++){const a=e[`${t}s`][n];for(let i=n+1;i<s;i++){const s=e[`${t}s`][i];if(""!==a[`${t}Text`].rawText&&""!==s[`${t}Text`].rawText&&a[`${t}Text`].rawText===s[`${t}Text`].rawText)return{duplicateId:s.id||s.ui.id,matchType:"exact"}}}return null},s=(e,t)=>{const s=e[`${t}s`].length;for(let n=0;n<s;n++){const a=e[`${t}s`][n];for(let i=n+1;i<s;i++){const s=e[`${t}s`][i],n=Object(l.q)(a[`${t}Text`].rawText.trim()),o=Object(l.q)(s[`${t}Text`].rawText.trim());if(""!==n&&""!==o&&(n===o||n.toLowerCase()===o.toLowerCase()))return{duplicateId:s.id||s.ui.id,matchType:null}}}return null};let n=null;return i.Qb.Multiple===e.questionType?t(e,"answer")||s(e,"answer"):(i.Qb.Matching===e.questionType&&(n=t(e,"prompt"),null===n?(n=t(e,"answer"),null===n?(n=s(e,"prompt"),null===n?(n=s(e,"answer"),null!==n&&(n.duplicateId="answer-new_"+n.duplicateId)):n.duplicateId="prompt-new_"+n.duplicateId):n.duplicateId="answer-new_"+n.duplicateId):n.duplicateId="prompt-new_"+n.duplicateId),n)}},"B/aE":function(e,t,s){"use strict";s.d(t,"a",(function(){return c}));var n=s("ERkP"),a=s("YUDX"),i=s("P+Wz"),o=s("nsO7"),r=s("zGdY");const l=["keydown","mousedown"],c=e=>{const{addPolygonPoint:t,getArrowKeyChanges:s,modifyHotspotObject:c,polygonToggleButton:u,addNewHotspot:d=o.noop,isPolygonDrawingModeOn:p,addNewHotspotPin:h=o.noop,activateLastHotspotObject:m,activateNextHotspotObject:b,activateFirstHotspotObject:g,deleteSelectedHotspotObjects:f,endPolygonDrawingMode:v=o.noop,startPolygonDrawingMode:w=o.noop,deleteMostRecentlyAddedPolygonPoint:y=o.noop}=e,[E,C]=Object(n.useState)(!1),[x,O]=Object(n.useState)(!1),T=Object(n.useCallback)((e=>{C(Object(a.j)(e)),O(Object(a.i)(e))}),[]),k=Object(n.useCallback)((()=>{E?g():x&&m()}),[x,E,g,m]),S=Object(n.useCallback)((e=>{if(Object(a.f)(e.key)&&(p?y:f)(),Object(a.k)(e)&&(p?v():b(e)),Object(a.d)(e.key)&&(e.preventDefault(),e.stopPropagation(),c(s(e))),p&&(e.key===i.Key.Escape&&(null==u?void 0:u.current)&&(v(!0),u.current.focus()),t&&e.key===i.Key.Enter&&t()),Object(a.g)(e)&&(void 0===p?h():!1===p&&w(!0)),!p&&(Object(a.h)(e)||Object(a.e)(e))){const t=Object(a.h)(e)?r.Q.Rectangle:r.Q.Circle;d({type:t})}}),[p,h,y,f,v,b,c,s,u,t,w,d]);return Object(n.useEffect)((()=>(l.forEach((e=>document.addEventListener(e,T))),()=>{l.forEach((e=>document.removeEventListener(e,T)))})),[T]),{handleCanvasFocus:k,handleCanvasKeydown:S}}},CD3w:function(e,t,s){"use strict";var n=s("ERkP"),a=s.n(n),i=s("Agfx");const o=Object(i.makeStyles)((()=>Object(i.createStyles)({root:{display:"flex",flexDirection:"row",alignItems:"center"}})));s.d(t,"a",(function(){return r}));const r=e=>{const t=o();return a.a.createElement("div",{className:t.root},e.children)}},E0B1:function(e,t,s){"use strict";s.d(t,"b",(function(){return a})),s.d(t,"a",(function(){return i})),s.d(t,"c",(function(){return o})),s.d(t,"o",(function(){return r})),s.d(t,"p",(function(){return l})),s.d(t,"l",(function(){return c})),s.d(t,"m",(function(){return u})),s.d(t,"n",(function(){return d})),s.d(t,"i",(function(){return m})),s.d(t,"k",(function(){return b})),s.d(t,"e",(function(){return g})),s.d(t,"f",(function(){return f})),s.d(t,"j",(function(){return v})),s.d(t,"d",(function(){return w})),s.d(t,"g",(function(){return y})),s.d(t,"h",(function(){return E}));const n={preserveObjectStacking:!0},a={...n},i={...n,stateful:!0},o="#046BF1",r=20,l=20,c=30,u=3,d=2*u,p={stroke:"white"},h={stroke:o,strokeDashArray:[8]},m={left:100,top:100,width:100,height:100,fill:"rgba(255,255,255,0.0)",strokeWidth:5,originX:"center",originY:"center",lockScalingFlip:!0},b={...m,...p},g={...m,...h},f={left:100,top:100,fill:"rgba(255,255,255,0.0)",strokeWidth:5,originX:"center",originY:"center",lockScalingFlip:!0,radius:50},v={...f,...p},w={...f,...h},y={fill:o,stroke:"white",strokeUniform:!0,strokeWidth:3,opacity:1,radius:15,originX:"center",originY:"center"},E={fill:"white",fontFamily:"sans-serif",fontSize:14,originX:"center",originY:"center"}},E9Bh:function(e,t,s){"use strict";s.d(t,"a",(function(){return n})),s.d(t,"b",(function(){return i}));var n,a=s("ERkP");!function(e){e.MOVING="moving",e.SCALING="scaling",e.MODIFIED="modified",e.SELECTED="selected",e.DESELECTED="deselected"}(n||(n={}));const i=e=>{const[t,s]=Object(a.useState)([]),[i,o]=Object(a.useState)([]),r=Object(a.useCallback)((e=>{const{object:t,position:a,selected:i,deselected:r}=e;i&&t.off(n.SELECTED,i),r&&t.off(n.DESELECTED,r);const l=()=>s((e=>e.filter((e=>e!==a)))),c=()=>s((e=>[...e,...e.includes(a)?[]:[a]]));t.on(n.SELECTED,c),t.on(n.DESELECTED,l),o((e=>[...e.filter((e=>e.object!==t)),{object:t,position:a,selected:c,deselected:l}]))}),[]);Object(a.useEffect)((()=>{i.filter((({object:t})=>e.values.some((e=>e.object===t)))).forEach((t=>{const s=e.getObjectPosition(t.object);s&&s!==t.position&&r({...t,position:s})}))}),[i,e,r]);return{registerEvents:Object(a.useCallback)((({events:e,object:t,position:s})=>{e.forEach((({name:e,handler:s})=>t.on(e,s))),r({object:t,position:s})}),[r]),selectedObjectPositions:t}}},EBQB:function(e,t,s){"use strict";var n=s("ERkP"),a=s.n(n),i=s("Agfx");const o=Object(i.makeStyles)((e=>Object(i.createStyles)({root:{fontWeight:e.typography.fontWeightSemiBold,marginRight:"12px",marginLeft:"12px"}})));s.d(t,"a",(function(){return r}));const r=e=>{const t=o();return a.a.createElement("div",{className:t.root},e.children)}},EG80:function(e,t,s){"use strict";var n=s("ERkP"),a=s.n(n),i=s("7O4Y"),o=s("ekqz"),r=s("VQ4P"),l=s("UJ5P"),c=s("tN4z"),u=s("Agfx"),d=s("eqO1"),p=s("THXI");const h=Object(u.makeStyles)((e=>Object(u.createStyles)({expansionPanel:{backgroundColor:"transparent","& .bb-editor-wrapper.read-only":{backgroundColor:e.palette.background.b2,border:`1px solid ${e.palette.border.main}`,borderRadius:"2px",paddingLeft:"10px",paddingRight:"10px","& .bb-editor-root .bb-editor-container.ql-container .ql-editor":{padding:"10px 0 10px"}}},expansionPanelGradingOrReviewing:{"& .bb-editor-wrapper.read-only":{backgroundColor:Object(d.p)(p.d.green,.15),borderWidth:"0"}},expansionPanelSummary:{fontWeight:e.typography.fontWeightSemiBold},expansionPanelDetails:{paddingTop:"0","& .bb-editor-wrapper":{width:"100%"}},expansionPanelEditModeExpanded:{backgroundColor:e.palette.background.b2,border:`1px solid ${e.palette.border.main}`,padding:"0 12px"}})));var m;s.d(t,"b",(function(){return m})),s.d(t,"a",(function(){return b})),s.d(t,"c",(function(){return g})),function(e){e.Grading="GRADING",e.Reviewing="REVIEWING",e.Building="BUILDING",e.Authoring="AUTHORING"}(m||(m={}));const b=({activeEditorId:e,courseId:t,disableFocus:s,isReadOnly:l,modelAnswerMode:u,editorPlugins:d,onChange:p,pluginsConfig:b,question:g,refreshBbml:f,setActiveEditorId:v,fileUploadSettings:w})=>{var y,E,C;const x=Object(r.a)(),O=h(),T="assessments.canvas.question.essay.modelAnswer",[k,S]=Object(n.useState)(l),q=u===m.Grading||u===m.Reviewing,A=`model-answer-summary__${null==g?void 0:g.id}`;return l&&!(null===(y=null==g?void 0:g.answerText)||void 0===y?void 0:y.rawText)?null:a.a.createElement(c.AnalyticsExpansionPanel,{analyticsId:`${T}.expansionPanel`,expanded:k,onChange:()=>S(!k),className:Object(i.a)(O.expansionPanel,"model-answer",{[O.expansionPanelEditModeExpanded]:k&&!l,[O.expansionPanelGradingOrReviewing]:q})},a.a.createElement(c.AnalyticsExpansionPanelSummary,{id:A,analyticsId:`${T}.expansionPanelSummary`,"aria-controls":`model-answer-details__${null==g?void 0:g.id}`,className:O.expansionPanelSummary},x("assessments.canvas.question.essay.modelAnswer.title")),a.a.createElement(c.AnalyticsExpansionPanelDetails,{analyticsId:`${T}.expansionPanelDetails`,className:O.expansionPanelDetails},a.a.createElement(o.b,{activeEditorId:e,ariaLabelledBy:A,ariaRequired:!1,bbml:null!==(C=null===(E=null==g?void 0:g.answerText)||void 0===E?void 0:E.rawText)&&void 0!==C?C:"",courseId:t,disableFocus:s,id:`${null==g?void 0:g.id}_model-answer`,isReadOnly:l,keepToolbarVisible:!1,onChange:e=>{const t={...g,answerText:{rawText:e.toBbML()},applyAsyncPlugins:{...g.applyAsyncPlugins,answerText:async()=>({answerText:{rawText:await e.toBbML(!0)}})}};null==p||p(t)},placeholder:x("assessments.canvas.question.placeholder.modelAnswer"),plugins:d,pluginsConfig:b,refreshBbml:f,setActiveEditorId:v,supportsInlineDocumentRender:!0,fileUploadSettings:w})))},g=(e,t)=>{const{question:s,editMode:n}=e,a=l.a.INACTIVE===n;return{activeEditorId:e.activeEditorId,courseId:e.courseId,disableFocus:e.disableFocus,isReadOnly:a,modelAnswerMode:e.modelAnswerMode,editorPlugins:e.editorPlugins,pluginsConfig:e.pluginsConfig,onChange:t,question:s,refreshBbml:e.refreshBbml,setActiveEditorId:e.setActiveEditorId,fileUploadSettings:e.fileUploadSettings}}},EuXa:function(e,t,s){"use strict";var n=s("ERkP"),a=s.n(n),i=s("np6O"),o=s("IzIX"),r=s("0x+l");s.d(t,"a",(function(){return l}));class l extends n.PureComponent{constructor(e){super(e),this.focus=()=>{var e;null===(e=this.inlineAddButton)||void 0===e||e.focus()},this.open=()=>{var e,t;null===(t=(e=this.props).onToggleAddMenu)||void 0===t||t.call(e,this,this.props.index)},this.close=()=>{var e,t;null===(t=(e=this.props).onDismissAddMenu)||void 0===t||t.call(e)},this.onClick=e=>{e.stopPropagation(),this.props.isMenuOpen?this.close():this.open()},this.onMouseEnter=()=>{this.setState({isMouseEnter:!0})},this.onMouseLeave=()=>{this.setState({isMouseEnter:!1})},this.onKeyboardFocus=()=>{this.setState({isKeyboardFocused:!0})},this.onKeyboardBlur=()=>{this.setState({isKeyboardFocused:!1})},this.getIcon=()=>this.props.isMenuOpen||this.state.isMouseEnter||this.state.isKeyboardFocused?a.a.createElement(o.a,{className:"inline-add-icon"}):a.a.createElement(r.Add,{className:"inline-add-icon"}),this.getIconClass=()=>{let e="create-new-bar";return this.props.isMenuOpen&&(e+=" -open -focused"),(this.state.isMouseEnter||this.state.isKeyboardFocused)&&(e+=" -focused"),this.props.isBlankCanvas&&(e+=" -blank"),this.props.show||(e+=" -hidden"),e},this.setInlineButtonRef=e=>{this.inlineAddButton=e},this.state={isMouseEnter:!1,isKeyboardFocused:!1}}render(){const{analyticsId:e}=this.props;return a.a.createElement(i.AnalyticsIconButton,{ref:this.setInlineButtonRef,className:this.getIconClass(),onFocus:this.onKeyboardFocus,onBlur:this.onKeyboardBlur,"aria-haspopup":"true","aria-expanded":this.props.isMenuOpen,"aria-controls":this.props.buttonAriaControls,"aria-hidden":this.props.removedFromTabOrder?"true":void 0,"aria-label":this.props.buttonAriaLabel,onClick:this.onClick,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,tabIndex:this.props.removedFromTabOrder?-1:0,analyticsId:`${e}.inlineAddButton.iconButton.button`},this.getIcon())}}},"FKP/":function(e,t,s){"use strict";var n=s("FgpP"),a=s("ERkP"),i=s("UJ5P"),o=s("ZQN4"),r=s("E1pj"),l=s("VQ4P");t.a=Object(r.windowResizingResponsiveComponentWrapper)((({editMode:e,question:t,isAnswersEditMode:s,options:r,onScoringOptionsChange:c,translationKeyPrefix:u,UltraWindowSize:d})=>{const p=Object(l.a)(),h=r.map((e=>({key:e.key,text:p(`${u}.${e.key}`)}))),m=i.a.INACTIVE===e,b=Object(o.a)(t),g=p(`${u}.${null==b?void 0:b.key}`),f=p(`${u}.readPlaceholder`,{scoringOption:g});return a.createElement(a.Fragment,null,m?a.createElement("div",{className:"scoring-options__text"},f):a.createElement("div",{className:"scoring-options__wrapper"},a.createElement("div",{className:"scoring-options__selector"},a.createElement(n.Dropdown,{label:p(`${u}.dropdownLabel`),options:h,onChanged:e=>{let t=null;switch(e.key){case o.c:t={allowPartialCredit:!0,allowNegativeScoreForIncorrectAnswers:!1,allowNegativeOverallScore:!1};break;case o.b:t={allowPartialCredit:!1,allowNegativeScoreForIncorrectAnswers:!1,allowNegativeOverallScore:!1};break;case o.e:t={allowPartialCredit:!0,allowNegativeScoreForIncorrectAnswers:!0,allowNegativeOverallScore:!1};break;case o.d:t={allowPartialCredit:!0,allowNegativeScoreForIncorrectAnswers:!0,allowNegativeOverallScore:!0}}c(t)},selectedKey:null==b?void 0:b.key,inlineLabel:!(null==d?void 0:d.isSmallBreakpoint()),analyticsId:`${u}.dropdown`,disabled:!s}))))}))},Fr0Y:function(e,t){e.exports='<svg viewBox="0 0 200 200" enable-background="new 0 0 220 200" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="a" d="M38 45h123v98H38z"/><path id="c" d="M49 51h101v54H49z"/><path id="d" d="M4.369.4H56V6H4.369z"/><path d="M1.362 8.883C19.705 31.04 47.418 45.154 78.43 45.154c31.01 0 58.723-14.115 77.066-36.27H1.362Z" id="f"/><path d="M2.718 9.456C20.684 26.69 45.071 37.28 71.932 37.28c26.86 0 51.248-10.59 69.214-27.824H2.718Z" id="h"/><path d="M33.462 174.652h133.076C148.862 190.418 125.55 200 100 200c-25.55 0-48.862-9.582-66.538-25.348Z" id="j"/><path id="l" d="M1.582 8H89v8H1.582z"/><filter x="-.4%" y="-.5%" width="100.8%" height="101%" filterUnits="objectBoundingBox" id="b"><feOffset dx="-1" dy="1" in="SourceAlpha" result="shadowOffsetInner1"/><feComposite in="shadowOffsetInner1" in2="SourceAlpha" operator="arithmetic" k2="-1" k3="1" result="shadowInnerInner1"/><feColorMatrix values="0 0 0 0 1 0 0 0 0 0.619607843 0 0 0 0 0.37254902 0 0 0 1 0" in="shadowInnerInner1"/></filter><filter x="-1%" y="-8.9%" width="101.9%" height="117.9%" filterUnits="objectBoundingBox" id="e"><feOffset dx="-1" dy="1" in="SourceAlpha" result="shadowOffsetInner1"/><feComposite in="shadowOffsetInner1" in2="SourceAlpha" operator="arithmetic" k2="-1" k3="1" result="shadowInnerInner1"/><feColorMatrix values="0 0 0 0 1 0 0 0 0 1 0 0 0 0 1 0 0 0 1 0" in="shadowInnerInner1"/></filter><filter x="-.3%" y="-1.4%" width="100.6%" height="102.8%" filterUnits="objectBoundingBox" id="g"><feOffset dy="1" in="SourceAlpha" result="shadowOffsetInner1"/><feComposite in="shadowOffsetInner1" in2="SourceAlpha" operator="arithmetic" k2="-1" k3="1" result="shadowInnerInner1"/><feColorMatrix values="0 0 0 0 0.850980392 0 0 0 0 0.639215686 0 0 0 0 0.247058824 0 0 0 1 0" in="shadowInnerInner1"/></filter><filter x="-.4%" y="-1.8%" width="100.7%" height="103.6%" filterUnits="objectBoundingBox" id="i"><feOffset dy="1" in="SourceAlpha" result="shadowOffsetInner1"/><feComposite in="shadowOffsetInner1" in2="SourceAlpha" operator="arithmetic" k2="-1" k3="1" result="shadowInnerInner1"/><feColorMatrix values="0 0 0 0 0.850127551 0 0 0 0 0.639317415 0 0 0 0 0.246075431 0 0 0 1 0" in="shadowInnerInner1"/></filter><filter x="-.4%" y="-2%" width="100.8%" height="103.9%" filterUnits="objectBoundingBox" id="k"><feOffset dy="1" in="SourceAlpha" result="shadowOffsetInner1"/><feComposite in="shadowOffsetInner1" in2="SourceAlpha" operator="arithmetic" k2="-1" k3="1" result="shadowInnerInner1"/><feColorMatrix values="0 0 0 0 1 0 0 0 0 0.619607843 0 0 0 0 0.37254902 0 0 0 1 0" in="shadowInnerInner1"/></filter><filter x="-.3%" y="-3.1%" width="100.6%" height="106.2%" filterUnits="objectBoundingBox" id="m"><feOffset dx="-.5" dy=".5" in="SourceAlpha" result="shadowOffsetInner1"/><feComposite in="shadowOffsetInner1" in2="SourceAlpha" operator="arithmetic" k2="-1" k3="1" result="shadowInnerInner1"/><feColorMatrix values="0 0 0 0 1 0 0 0 0 1 0 0 0 0 1 0 0 0 1 0" in="shadowInnerInner1"/></filter></defs><g fill="none" fill-rule="evenodd"><circle fill="#B3D0DD" cx="100" cy="100" r="100"/><path d="M6.381 135.227H193.62C179.37 173.074 142.829 200 100 200c-42.83 0-79.37-26.926-93.619-64.773Z" fill="#E3F4FC"/><path d="m87.64 36.511 31.373-31.28 25.046 27.803-29.928 29.969L87.639 36.51ZM83.229 198.6C35.985 190.622 0 149.513 0 100c0-6.02.532-11.915 1.551-17.642l37.03-37.03 3.745.986 21.476-21.476 57.813 116.21L83.23 198.6Z" fill="#758D97" opacity=".436"/><use fill="#FF7E28" xlink:href="#a"/><use fill="#000" filter="url(#b)" xlink:href="#a"/><path d="M37.175 177.806a100.53 100.53 0 0 1-21.84-24.568l34.091-45.588h101.297l34.007 45.486a100.53 100.53 0 0 1-21.905 24.67H37.175Z" fill="#7F7C76"/><path d="M37.398 177.806a100.509 100.509 0 0 1-6.05-5.288c-.622-6.967-1.07-13.2-1.345-18.697-.341-6.854-1.393-12.18-3.156-15.977l22.58-30.194h101.296l33.982 45.451a100.472 100.472 0 0 1-21.987 24.705H37.398Z" fill="#434240"/><path fill="#302F2F" d="M50 108h101v49H50z"/><path fill="#000" d="M49.792 107.63h100.532l-1.783 1.78-47.161 47.106H49.792z"/><path d="M184.76 153.089c-.236.375-.473.748-.714 1.12l-33.721-46.58h.39l34.045 45.46ZM16 154.28c-.241-.372-.48-.746-.716-1.12l34.099-45.53h.389l-33.773 46.65Z" fill="#8C8C8C"/><use fill="#FF7E28" xlink:href="#c"/><path stroke="#C16325" d="M49.5 51.5h100v53h-100z"/><path fill="#B95C1E" d="M74.446 56.389 78.167 62l-.83 1.276h41.071L119.451 62H126l-4.96 6H70.055v-4.724z"/><g transform="translate(70 56)"><use fill="#E5E5E5" xlink:href="#d"/><use fill="#000" filter="url(#e)" xlink:href="#d"/></g><g transform="translate(45.64 109.172)"><path d="M6.142 4.194h67.793L76.954 0h16.414l2.681 4.194h8.32a4 4 0 0 1 4 4v20.792c0 7.732-6.269 14-14 14H16.141c-7.732 0-14-6.268-14-14V8.194a4 4 0 0 1 4-4Z" fill="#FECA69"/><rect fill="#FCD59D" y="6.018" width="110.082" height="40.837" rx="4"/></g><g transform="translate(41.694 112.322)"><path d="M6.139 5.252h59.31l3.21-4.465h17.45l2.851 4.465h22.118a4 4 0 0 1 4 4v23.297c0 7.732-6.268 14-14 14H16.139c-7.732 0-14-6.268-14-14V9.252a4 4 0 0 1 4-4Z" fill="#F5C05E"/><rect fill="#FCD59D" y="7.203" width="116.789" height="43.196" rx="4"/></g><path d="M43.89 122.208h77.904l3.444-4.767h18.725l3.06 4.767h10.054a4 4 0 0 1 4 4v26.1c0 7.732-6.268 14-14 14H53.889c-7.732 0-14-6.268-14-14v-26.1a4 4 0 0 1 4-4Z" fill="#FECA69"/><path d="M41.124 124.3h118.718a4 4 0 0 1 3.943 3.327l6.527 38.296a4 4 0 0 1-3.943 4.672H34.597a4 4 0 0 1-3.943-4.672l6.527-38.296a4 4 0 0 1 3.943-3.328Z" fill="#FCD59D"/><path d="M41.124 124.3h11.217l93.072 7.432 12.864 13.571-25.967 25.292H56.786l-22.7-24.812 3.095-18.156a4 4 0 0 1 3.943-3.328Z" fill="#B99F79"/><g><path d="m89.952 54.43 68.259 79.62a1 1 0 0 1-.186 1.47l-66.918 46.843a1 1 0 0 1-1.353-.192l-63.458-78.889a1 1 0 0 1 .171-1.42l62.118-47.574a1 1 0 0 1 1.367.143Z" fill="#FFF"/><g transform="rotate(-9 517.29 -207.606)"><path d="M.176 27.933 50.525.176M2.993 33.555l42.955-23.541" stroke="#979797" stroke-width="4" stroke-linecap="round"/><path d="m15.123 38.216 18.69-10.237M19.072 45.694l28.832-15.887M23.04 53.518l22.887-12.649" stroke="#D8D8D8" stroke-width="4" stroke-linecap="round"/><ellipse fill="#D8D8D8" cx="9.396" cy="41.749" rx="2.968" ry="2.962"/><ellipse fill="#D8D8D8" cx="13.416" cy="49.233" rx="2.968" ry="2.962"/><ellipse fill="#44E17D" cx="17.862" cy="56.619" rx="2.968" ry="2.962"/></g><g transform="rotate(-9 761.828 -378.653)"><path d="M.176 27.933 50.525.176M2.993 33.555l17.35-9.832" stroke="#979797" stroke-width="4" stroke-linecap="round"/><path d="M15.123 38.216 34.518 27.36M19.072 45.694l22.886-12.649M23.04 53.518 43.72 42.37" stroke="#D8D8D8" stroke-width="4" stroke-linecap="round"/><ellipse fill="#44E17D" cx="9.396" cy="41.749" rx="2.968" ry="2.962"/><ellipse fill="#D8D8D8" cx="13.416" cy="49.233" rx="2.968" ry="2.962"/><ellipse fill="#44E17D" cx="17.862" cy="56.619" rx="2.968" ry="2.962"/></g></g><g><path d="M21.833 162.375C40.157 185.308 68.363 200 100 200c31.739 0 60.024-14.786 78.343-37.845a14.07 14.07 0 0 0-2.698-.26H145.31l-4.497-7.05h-27.53l-5.063 7.05H25.482c-1.262 0-2.486.167-3.649.48Z" fill="#F5C05E"/><g transform="translate(21.571 154.846)"><use fill="#FCD59D" xlink:href="#f"/><use fill="#000" filter="url(#g)" xlink:href="#f"/></g><g><path d="M31.335 172.7C49.248 189.623 73.412 200 100 200c27.164 0 51.798-10.83 69.82-28.41l-4.13-6.507h-29.577l-5.44 7.616H31.335Z" fill-opacity=".209" fill="#000"/><path d="M28.918 170.337C47.043 188.653 72.196 200 100 200c28.739 0 54.646-12.123 72.887-31.534l-3.645-5.746h-29.578l-5.44 7.617H28.918Z" fill="#FECA69"/><g transform="translate(28.068 162.72)"><use fill="#FCD59D" xlink:href="#h"/><use fill="#000" filter="url(#i)" xlink:href="#h"/></g></g></g><g><use fill="#FF7E28" xlink:href="#j"/><use fill="#000" filter="url(#k)" xlink:href="#j"/></g><g><path fill="#B95C1E" d="M132.901 184v4.002h-3.932zM58.145 190.82a99.34 99.34 0 0 1-2.936-1.42l5.306-5.4v6.82h-2.37Z"/><path d="m65.682 188 1.95-4h-7.12l-1.95 4-1.98 4H144l-1.978-4h-.028l-1.95-4h-7.12l1.95 4H65.682Z" fill="#F8F8F8"/><path fill="#E5E5E5" d="m67.631 184 .027 4.003H65.68z"/><path fill="#666" d="M132.925 184.005v3.998h1.978z"/><g transform="translate(55 184)"><use fill="#E5E5E5" xlink:href="#l"/><use fill="#000" filter="url(#m)" xlink:href="#l"/></g></g><g fill-rule="nonzero"><path d="M58.626 32.059h53.212V45H58.626a.639.639 0 0 1-.626-.65V32.676a.637.637 0 0 1 .626-.618Z" fill="#44E17D"/><path d="M58.618 32.059h10.037V45H58.618c-.341 0-.618-.291-.618-.65V32.676c.016-.347.288-.619.618-.618Z" fill="#2BAF56"/><path fill="#F7EDDD" d="M70.338 33.747h42.061v9.003H70.338z"/><path fill="#2BAF56" d="M70.338 33.747h42.061v1.688H70.338z"/><path fill="#FFF" d="M70.338 37.686h42.061v1.688H70.338zM70.338 41.062h42.061v1.688H70.338z"/><g><path d="M63.762 25h39.57v7.059h-39.57a.63.63 0 0 1-.638-.621v-5.825a.63.63 0 0 1 .638-.613Z" fill="#FDE000"/><path d="M63.748 25h10.136v7.059H63.748a.622.622 0 0 1-.624-.621v-5.825a.623.623 0 0 1 .624-.613Z" fill="#D1AB2A"/><path fill="#F7EDDD" d="M76.15 26.629h27.182v3.801H76.15z"/><path fill="#D1AB2A" d="M76.15 26.629h27.182v1.629H76.15z"/><path fill="#FFF" d="M76.15 28.801h27.182v1.629H76.15z"/></g></g><g><path fill="#D8A448" d="M133.295 40.31v4.683h-1.566V40.31z"/><path d="M133.295 39.913v1.171c-.26.179-.522.268-.783.268-.26 0-.522-.09-.783-.268v-1.17h1.566Z" fill="#BF903D"/><path d="M138.366 45c-1.747-2.088-3.699-3.132-5.854-3.132-2.155 0-4.106 1.044-5.853 3.132h11.707Z" fill="#D8A448"/><path d="M138.366 45c-.927-1.138-1.947-1.97-3.061-2.494-.622.183-1.695 1.015-3.22 2.494h6.28Z" fill="#FCD590"/><g transform="translate(113)"><path d="M33.55 3.66c8.354 8.355 8.077 22.294 0 30.37-8.077 8.078-21.104 8.673-29.459.32" stroke="#FCD590" stroke-width="2"/><path d="M23.866 39.646c-6.79 1.815-14.29.188-19.775-5.297" stroke="#D8A448" stroke-width="2" stroke-linecap="round"/><path fill="#FEC34C" d="m30.822 4.518 3.312-3.311 1.118 1.118-3.312 3.311z"/><ellipse fill="#1987D1" cx="18.537" cy="18.77" rx="18.537" ry="18.77"/><path d="M21.94.316C30.553 1.934 37.074 9.58 37.074 18.77a18.83 18.83 0 0 1-5.708 13.549c-4.307-.143-9.09-1.939-9.36-5.996-.597-8.994 8.09-5.607 8.09-12.58 0-6.34-8.803-7.582-8.154-13.427Z" fill="#4DC238"/><path d="M26.68 1.904c6.155 3.052 10.393 9.458 10.393 16.866a18.87 18.87 0 0 1-2.301 9.066c-4.452 1.89-9.953 2.871-9.255-1.513.746-4.686 7.363-3.5 7.363-10.474 0-5.606-5.57-8.934-6.2-13.945Z" fill="#80F56B"/><path d="M10.7 35.786C4.38 32.796 0 26.3 0 18.77A18.82 18.82 0 0 1 7.414 3.753c1.242 4.669 3.762 4.397 4.81 7.651 1.971 6.129-5.712 4.571-6.046 8.099-.522 5.501 10.399 4.21 7.18 10.287-1.774 3.352-2.352 4.752-2.657 5.996Z" fill="#4DC238"/><path d="M6.667 33.188A18.825 18.825 0 0 1 0 18.77c0-4.885 1.843-9.334 4.863-12.673 1.014 3.09 2.152 4.21 1.69 7.278-.45 2.99-4.01 4.603-4.2 6.775-.412 4.675 2.537 8.583 4.2 10.49.711.816.573 1.604.114 2.548Z" fill="#80F56B"/><path d="M19.354 13.555c1.293 0 .939-2.195.939-4.269 0-2.073-2.986-4.034-4.28-4.034-1.292 0 0 2.078 0 4.151 0 2.074 2.047 4.152 3.34 4.152Z" fill="#4DC238"/><path d="M18.719 11.756c.733 0 .532-1.244.532-2.419s-1.337-2.44-2.07-2.44c-.733 0 .276 1.265.276 2.44s.529 2.42 1.262 2.42Z" fill="#80F56B"/><path d="M7.751 3.502A18.297 18.297 0 0 1 18.537 0c10.237 0 18.536 8.404 18.536 18.77 0 4.074-1.281 7.845-3.459 10.921a18.297 18.297 0 0 1-10.785 3.503c-10.237 0-18.536-8.404-18.536-18.77 0-4.074 1.281-7.845 3.458-10.922Z" fill="#FFF" opacity=".249"/><path fill="#BF903D" d="m1.554 34.945 3.311-3.311 1.118 1.118-3.311 3.311z"/></g></g></g></svg>'},G52d:function(e,t,s){"use strict";s.d(t,"b",(function(){return i})),s.d(t,"a",(function(){return o}));var n=s("DRH8"),a=s("RxZr");const i=e=>!!(null==e?void 0:e.toleranceValue)&&0!==e.toleranceValue,o=(e,t,s)=>Object(n.d)(e,t,!0,s,{maximumFractionDigits:a.c})},"H+fs":function(e,t,s){"use strict";var n=s("ERkP"),a=s.n(n),i=s("0x+l");class o extends n.PureComponent{render(){return a.a.createElement("div",{className:`drag-button ${null!=this.props.className?this.props.className:""}`,ref:this.props.dragPointRef,draggable:!0,title:this.props.title,"aria-label":this.props.ariaLabel,"aria-describedby":this.props.ariaDescribedBy,role:"button","aria-hidden":this.props.removedFromTabOrder?"true":void 0,tabIndex:this.props.removedFromTabOrder?-1:0},a.a.createElement(i.MoveItemUpDown,null))}}t.a=o},I4tD:function(e,t,s){"use strict";var n=s("7O4Y"),a=s("ERkP"),i=s.n(a),o=s("VQ4P"),r=s("tN4z"),l=s("0x+l"),c=s("7k4i"),u=s("Agfx");const d=Object(u.makeStyles)((e=>Object(u.createStyles)({divider:{width:"100%",position:"relative","&::before":{content:'""',position:"absolute",left:0,right:0,borderTop:`2px solid ${e.palette.common.black}`}},pageBreak:{paddingBottom:"20px"},pageBreakContents:{display:"flex",alignItems:"center",paddingTop:"10px"},combineButton:{width:"100%",display:"flex",justifyContent:"center",alignItems:"center","&:hover":{"& $divider":{"&::before":{borderTop:`2px solid ${e.palette.brand.main}`}},"& $combineButtonText":{color:e.palette.brand.main,textDecoration:"underline",textDecorationColor:e.palette.brand.main},"& $combineButtonIcon":{color:e.palette.brand.main}}},combineButtonLabel:{display:"flex",alignItems:"center",padding:"0px 7px"},combineButtonText:{whiteSpace:"nowrap",color:e.palette.text.hint},combineButtonIcon:{transform:"rotate(45deg)",flip:!1,color:e.palette.text.hint},isReadOnly:{"& > span":{color:e.palette.text.disabled},"& $divider":{"&::before":{borderTop:`2px solid ${e.palette.text.disabled}`}}}}))),p=Object(c.a)((e=>{const{deleteQuestion:t,onQuestionSave:s,question:c,hasSubmissions:u}=e,{pageNumber:p,pageCount:h}=c,m=Object(o.a)(),b=d();Object(a.useEffect)((()=>{s()}),[s]);const g={pageA:p-1,pageB:p},f=u?m("assessments.canvas.question.pageBreak.pageBreak"):m("assessments.canvas.question.pageBreak.combineButtonAriaLabel",g),v=u?m("assessments.canvas.question.pageBreak.pageBreak"):m("assessments.canvas.question.pageBreak.combineButtonTitle",g);return i.a.createElement("div",null,i.a.createElement(r.AnalyticsIconButton,{analyticsId:"assessments.canvas.question.pageBreak",className:Object(n.a)(b.combineButton,u&&b.isReadOnly),"aria-label":f,onClick:()=>t(c),disabled:u},i.a.createElement("div",{className:b.divider}),i.a.createElement("div",{className:b.combineButtonLabel},i.a.createElement(r.AnalyticsTypography,{className:b.combineButtonText,component:"span"},v),!u&&i.a.createElement(l.Collapse,{className:b.combineButtonIcon})),i.a.createElement("div",{className:b.divider})),i.a.createElement("div",{className:b.pageBreak},i.a.createElement("div",{className:`${b.pageBreakContents} js-page-break-number-${p}`},i.a.createElement(r.AnalyticsTypography,{component:"span"},m("assessments.canvas.question.pageBreak.pageNumber",{pageNumber:p,pageCount:h})))))}));t.a=p},IIIX:function(e,t,s){"use strict";var n=s("ERkP"),a=s.n(n),i=s("VQ4P"),o=s("M0dR"),r=s("0x+l"),l=s("Agfx");const c=Object(l.makeStyles)((e=>{var t;return Object(l.createStyles)({base:{marginTop:"24px"},contentSection:{paddingTop:"6px"},contentToggle:{borderBottom:`1px solid ${null===(t=e.palette.border)||void 0===t?void 0:t.main}`,marginBottom:"10px",padding:"12px 0",width:"100%",display:"flex",justifyContent:"space-between"},sectionHeader:{},sectionTitle:{}})}));var u=s("ekqz"),d=s("7O4Y");const p="automated-question-feedback-read";t.a=({question:e,className:t,pluginsConfig:s})=>{var n,l;const h=Object(i.a)(),m=c(),[b,g]=a.a.useState(!1);if(!(null===(n=e.correctResponseFeedback)||void 0===n?void 0:n.rawText)&&!(null===(l=e.incorrectResponseFeedback)||void 0===l?void 0:l.rawText))return null;const f=`${p}_content${e.id}`;return a.a.createElement("div",{className:Object(d.a)(m.base,t,p)},a.a.createElement(o.a,{component:"h4",variant:"h4"},a.a.createElement("button",{className:Object(d.a)(m.contentToggle,`${p}__content-toggle`),onClick:()=>g(!b),type:"button","aria-expanded":b,"aria-controls":b?f:void 0},a.a.createElement("span",null,h("automatedQuestionFeedback.read.contentToggleLabel")),b?a.a.createElement(r.ArrowUp,null):a.a.createElement(r.ArrowDown,null))),b&&(()=>{var t,n;const i=`-${p}_correct-feedback${e.id}`,r=`-${p}_incorrect-feedback${e.id}`,l=`${p}_incorrect-section-title_${e.id}`,c=`${p}_correct-section-title_${e.id}`;return a.a.createElement("div",{id:f},(null===(t=e.correctResponseFeedback)||void 0===t?void 0:t.rawText)&&a.a.createElement("div",{className:Object(d.a)(m.contentSection,`${p}__content-section`)},a.a.createElement("div",{className:m.sectionHeader},a.a.createElement(o.a,{id:c,component:e=>a.a.createElement("label",{htmlFor:`bb-editor${i}`,...e}),variant:"h6",className:m.sectionTitle},h("automatedQuestionFeedback.correctAnswerLabel"))),a.a.createElement(u.b,{bbml:e.correctResponseFeedback.rawText,id:i,isReadOnly:!0,ariaLabelledBy:c,pluginsConfig:s})),(null===(n=e.incorrectResponseFeedback)||void 0===n?void 0:n.rawText)&&a.a.createElement("div",{className:Object(d.a)(m.contentSection,`${p}__content-section`)},a.a.createElement("div",{className:m.sectionHeader},a.a.createElement(o.a,{id:l,component:e=>a.a.createElement("label",{htmlFor:`bb-editor${r}`,...e}),variant:"h6",className:m.sectionTitle},h("automatedQuestionFeedback.incorrectAnswerLabel"))),a.a.createElement(u.b,{bbml:e.incorrectResponseFeedback.rawText,id:r,isReadOnly:!0,ariaLabelledBy:l,pluginsConfig:s})))})())}},JAGG:function(e,t,s){"use strict";var n=s("VQ4P"),a=s("ERkP"),i=s.n(a),o=s("Agfx");const r=Object(o.makeStyles)((e=>{const t={display:"flex",backgroundColor:e.palette.background.b4,"& > div":{flex:"1"}},s={...t,marginBottom:"4px"},n={content:"counter(hotspots)",counterIncrement:"hotspots",display:"flex",height:"24px",width:"24px",boxSizing:"border-box",marginRight:"10px",fontWeight:e.typography.fontWeightBold,border:"1px solid "+e.palette.primary.main,borderRadius:"100%",alignItems:"center",justifyContent:"center",flexShrink:"0"},a={...n,border:"2px solid "+e.palette.primary.main,height:"28px",width:"28px",fontSize:e.typography.fontSizeMedium},i={backgroundColor:e.palette.background.b10,color:e.palette.getContrastText(e.palette.background.b10)},r={paddingTop:"10px",paddingBottom:"10px"};return Object(o.createStyles)({list:{counterReset:"hotspots",padding:0,margin:0,"& > li":{position:"relative",display:"flex",alignItems:"center",listStylePosition:"inside",color:e.palette.text.primary,padding:"0 10px",borderRadius:"2px",minHeight:"40px"}},listItem:{...t,"&:before":{...n},marginBottom:"10px"},unselectedIncorrectListItem:{...s,"&:before":{...a},opacity:.75,backgroundColor:"transparent"},unselectedCorrectListItem:{...s,"&:before":{...a},backgroundColor:e.palette.background.b3},selectedCorrectListItem:{...s,"&:before":{...a,...i},backgroundColor:e.palette.success.light},selectedIncorrectListItem:{...s,"&:before":{...a,...i},backgroundColor:e.palette.error.light},answerText:{...r},emphasizedAnswerText:{...r,fontWeight:e.typography.fontWeightSemiBold},correct:{display:"flex",alignItems:"center",marginLeft:"auto",fontSize:e.typography.fontSizeSmall,paddingLeft:"20px",color:e.palette.text.primary,cursor:"default"}})}));var l=s("7O4Y");s.d(t,"a",(function(){return c}));const c=e=>{var t;const s=r(),{question:a,givenAnswers:o}=e,c=Object(n.a)();return i.a.createElement("ol",{className:s.list},null===(t=a.answers)||void 0===t?void 0:t.map((e=>{const t=!!o,n=t&&(a=e,o.some((e=>e.answerIds.indexOf(a.id)>-1&&e.correctAnswer===a.correctAnswer)));var a;let r=s.listItem;t&&(r=e.correctAnswer?n?s.selectedCorrectListItem:s.unselectedCorrectListItem:n?s.selectedIncorrectListItem:s.unselectedIncorrectListItem);const u=t?s.emphasizedAnswerText:s.answerText,d=e.correctAnswer||n,p=e.correctAnswer?"assessments.canvas.question.hotspot.answerOptions.correctAnswer":"assessments.canvas.question.hotspot.answerOptions.incorrectAnswer";return i.a.createElement("li",{key:e.id,className:r},i.a.createElement("div",{className:Object(l.a)("js-hotspot-answer-text",u)},e.answerText),d&&i.a.createElement("span",{className:s.correct},c(p)))})))}},K9sL:function(e,t,s){"use strict";var n=s("ERkP"),a=s.n(n),i=s("UJ5P"),o=s("IIIX"),r=s("uDfI"),l=s("VQ4P"),c=s("tN4z"),u=s("ECG1"),d=s("IbyE"),p=s("zGdY"),h=s("Agfx"),m=s("xkx/");const b=Object(h.makeStyles)((e=>Object(h.createStyles)({base:{marginTop:"16px","& label$toggleLabel":{cursor:"pointer"}},toggleLabel:{marginLeft:"-8px",marginRight:0},toggleSwitch:{},correct:{margin:"10px 0",[e.breakpoints.up("sm")]:{margin:"21px 0 10px"}},incorrect:{margin:"16px 0 10px"},sectionHeader:{marginBottom:"10px"},sectionTitle:{},sectionInstructions:{color:m.BbSemanticPalette.textMedium},header:{display:"flex",flexDirection:"column",[e.breakpoints.up("sm")]:{flexDirection:"row"}},displaySettings:{display:"flex",alignItems:"center",flexDirection:"row-reverse",marginLeft:"-8px",marginRight:"auto",[e.breakpoints.up("sm")]:{flexDirection:"row",marginLeft:"auto",marginRight:"-8px"}},displaySettingsButton:{}})));var g=s("ekqz"),f=s("7O4Y"),v=s("8tZv");const w=({modeDisplayText:e,uniqueId:t})=>{const s=Object(l.a)(),n=b();return a.a.createElement("div",{className:n.displaySettings},a.a.createElement(c.AnalyticsTypography,{component:"span",variant:"inherit",id:`${y}__displaySettingsText-${t}`},e),a.a.createElement(c.AnalyticsTooltip,{analyticsId:`${E}.tooltip`,title:s("automatedQuestionFeedback.edit.displaySettings.tooltip.content"),placement:"top"},a.a.createElement(c.AnalyticsIconButton,{className:n.displaySettingsButton,analyticsId:`${E}.displaySettings.tooltip`,"aria-label":s("automatedQuestionFeedback.edit.displaySettings.tooltip.ariaLabel")},a.a.createElement(u.a,null))))},y="automated-question-feedback-edit",E="assessments.automated-question-feedback.edit",C=`js-${y}__correct-feedback`,x=`js-${y}__incorrect-feedback`;var O=Object(r.b)(((e,t)=>{var s;return{content:d.gc.content.getContentByAssessmentId(e,null!==(s=t.assessmentId)&&void 0!==s?s:""),fileUploadSettings:d.gc.fileUploadSettings.getFileUploadSettings(e)}}))((({content:e,question:t,onQuestionChange:s,setActiveEditorId:n,activeEditorId:i,pluginsConfig:o,fileUploadSettings:r,assessmentType:u})=>{var h,m,O,T;const k=Object(l.a)(),S=b(),q=`${y}_incorrect-section-title_${t.id}`,A=`${y}_correct-section-title_${t.id}`,[P,I]=a.a.useState(!!(null===(h=t.correctResponseFeedback)||void 0===h?void 0:h.rawText)||!!(null===(m=t.incorrectResponseFeedback)||void 0===m?void 0:m.rawText)),[j,F]=a.a.useState(!1),[N,D]=a.a.useState(!1);return a.a.createElement("div",{className:Object(f.a)(S.base,y)},a.a.createElement("div",{className:S.header},a.a.createElement(c.AnalyticsFormControlLabel,{analyticsId:`${E}.toggleLabel`,className:S.toggleLabel,control:a.a.createElement(c.AnalyticsSwitch,{analyticsId:`${E}.toggleSwitch`,checked:P,className:Object(f.a)(S.toggleSwitch,`${y}__toggleSwitch`),onChange:(e,s)=>{var n,a;const i=(null===(n=t.correctResponseFeedback)||void 0===n?void 0:n.rawText)||(null===(a=t.incorrectResponseFeedback)||void 0===a?void 0:a.rawText);s||!i&&!N?I(s):F(!0)}}),label:k("automatedQuestionFeedback.edit.toggleLabel")}),u!==p.h.Pool&&P&&a.a.createElement(w,{modeDisplayText:function(){var t;const s=null===(t=null==e?void 0:e.deploymentSettings)||void 0===t?void 0:t.feedbackSettings;let n=null,a=null;if(s){const e=d.s.getFeedbackModeByOption(p.f.InstructorFeedback,s);n=e.mode,a=e.associatedDate}return n?a?k("automatedQuestionFeedback.edit.displaySettings.feedbackMode.osd",{date:a}):k(`automatedQuestionFeedback.edit.displaySettings.feedbackMode.${n}`):k("automatedQuestionFeedback.edit.displaySettings.hidden")}(),uniqueId:t.id})),P&&a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:`${S.correct} ${C}`},a.a.createElement("div",{className:S.sectionHeader},a.a.createElement(c.AnalyticsTypography,{id:A,component:e=>a.a.createElement("label",{htmlFor:`correct-feedback_${t.id}`,...e}),variant:"h6",className:S.sectionTitle},k("automatedQuestionFeedback.correctAnswerLabel"))),a.a.createElement(g.b,{ariaLabelledBy:A,bbml:null===(O=t.correctResponseFeedback)||void 0===O?void 0:O.rawText,id:`correct-feedback_${t.id}`,isReadOnly:!1,onChange:e=>{D(!0),s({...t,correctResponseFeedback:{rawText:e.toBbML()},applyAsyncPlugins:{...t.applyAsyncPlugins,correctResponseFeedback:async()=>({correctResponseFeedback:{rawText:await e.toBbML(!0)}})}})},setActiveEditorId:n,keepToolbarVisible:!1,activeEditorId:i,pluginsConfig:o,fileUploadSettings:r})),a.a.createElement("div",{className:`${S.correct} ${x}`},a.a.createElement("div",{className:S.sectionHeader},a.a.createElement(c.AnalyticsTypography,{id:q,component:e=>a.a.createElement("label",{htmlFor:`incorrect-feedback_${t.id}`,...e}),variant:"h6",className:S.sectionTitle},k("automatedQuestionFeedback.incorrectAnswerLabel")),a.a.createElement(c.AnalyticsTypography,{component:"span",variant:"body2",className:S.sectionInstructions},k("automatedQuestionFeedback.edit.incorrectAnswerInstructions"))),a.a.createElement(g.b,{ariaLabelledBy:q,bbml:null===(T=t.incorrectResponseFeedback)||void 0===T?void 0:T.rawText,id:`incorrect-feedback_${t.id}`,isReadOnly:!1,onChange:e=>{D(!0),s({...t,incorrectResponseFeedback:{rawText:e.toBbML()},applyAsyncPlugins:{...t.applyAsyncPlugins,incorrectResponseFeedback:async()=>({incorrectResponseFeedback:{rawText:await e.toBbML(!0)}})}})},setActiveEditorId:n,keepToolbarVisible:!1,activeEditorId:i,pluginsConfig:o,fileUploadSettings:r}))),a.a.createElement(v.a,{analyticsId:`${E}.removeFeedbackWarning`,okButtonLocaleKey:"automatedQuestionFeedback.edit.warningDialog.okButton",onOk:()=>{F(!1),I(!1),D(!1),s({...t,correctResponseFeedback:{rawText:""},incorrectResponseFeedback:{rawText:""},applyAsyncPlugins:void 0})},onCancel:()=>F(!1),onDismiss:()=>F(!1),show:j,subText:k("automatedQuestionFeedback.edit.warningDialog.text"),title:k("automatedQuestionFeedback.edit.warningDialog.title")}))}));var T=({assessmentId:e,editMode:t,onQuestionChange:s,question:n,setActiveEditorId:r,activeEditorId:l,pluginsConfig:c,assessmentType:u})=>a.a.createElement(a.a.Fragment,null,i.a.INACTIVE===t?a.a.createElement(o.a,{question:n,pluginsConfig:c}):a.a.createElement(O,{assessmentId:e,onQuestionChange:s,question:n,activeEditorId:l,setActiveEditorId:r,pluginsConfig:c,assessmentType:u})),k=s("M0dR"),S=s("0x+l");const q=Object(h.makeStyles)((e=>Object(h.createStyles)({base:{marginTop:"12px","& .bb-editor":{padding:"8px 0 0 !important"},"& .bb-editor-container":{margin:"0 !important"}},contentSection:{backgroundColor:e.palette.background.b3,borderRadius:"2px",padding:"12px"},contentToggle:{padding:"12px 0",display:"flex",alignItems:"center"},contentToggleIcon:{height:"8px",width:"8px",marginLeft:"8px"},sectionHeader:{display:"flex",alignItems:"center"},contentTitle:{},feedbackIcon:{marginRight:"8px"}}))),A="automated-question-feedback-attempt-review";var P=({feedback:e,isCollapsible:t,editorPluginsOptions:s})=>{const n=Object(l.a)(),i=q(),[o,r]=a.a.useState(!1);if(!e)return null;const c=Math.floor(1e6*Math.random()+1),u=`automated-question-feedback-attempt-review__feedback-${c}`,d=`automated-question-feedback-attempt-review_content${c}`,p=e=>a.a.createElement("label",{htmlFor:u,...e});return a.a.createElement("div",{className:Object(f.a)(i.base,A)},t&&a.a.createElement(k.a,{component:"div",variant:"body1"},a.a.createElement("button",{className:Object(f.a)(i.contentToggle,"automated-question-feedback-attempt-review__content-toggle"),onClick:()=>r(!o),type:"button","aria-expanded":o,"aria-controls":o?d:void 0},a.a.createElement("span",null,n(o?"automatedQuestionFeedback.attemptReview.hideFeedbackToggleLabel":"automatedQuestionFeedback.attemptReview.showFeedbackToggleLabel")),o?a.a.createElement(S.ArrowUp,{className:i.contentToggleIcon}):a.a.createElement(S.ArrowDown,{className:i.contentToggleIcon}))),(!t||o)&&a.a.createElement("div",{className:Object(f.a)(i.base,"automated-question-feedback-attempt-review__content-section"),id:d},a.a.createElement("div",{className:i.contentSection},a.a.createElement("div",{className:i.sectionHeader},a.a.createElement(S.Feedback,{className:i.feedbackIcon}),a.a.createElement(k.a,{component:p,variant:"h4",className:i.contentTitle},n("automatedQuestionFeedback.attemptReview.feedbackLabel"))),a.a.createElement(g.b,{bbml:e,id:u,isReadOnly:!0,refreshBbml:!0,pluginsConfig:s}))))};s.d(t,"a",(function(){return T})),s.d(t,"c",(function(){return O})),s.d(t,"d",(function(){return o.a})),s.d(t,"b",(function(){return P}))},KDr4:function(e,t,s){"use strict";s.d(t,"c",(function(){return i})),s.d(t,"e",(function(){return o})),s.d(t,"h",(function(){return r})),s.d(t,"d",(function(){return l})),s.d(t,"f",(function(){return c})),s.d(t,"g",(function(){return u})),s.d(t,"b",(function(){return d})),s.d(t,"a",(function(){return p}));var n=s("E0B1"),a=s("zGdY");const i=(e,t)=>e*(1/t),o=(e,t,s,n,a)=>{if(e<0)return 0;const o=i(t,s);let r=0;Number.isFinite(n)&&Number.isFinite(a)&&(r=(null!=n?n:0)*(null!=a?a:1));const l=o-r;return e>l?l:e},r=(e,t)=>{var s,n,a,i;if(!e)return;const r=t.getBoundingRect(!0,!0),l="hotspotPolygon"===t.type?t.getTopPointLeftDelta():r.width/2,c=o(r.left+l+e.width/2,null!==(a=null===(n=null===(s=t.canvas)||void 0===s?void 0:s.backgroundImage)||void 0===n?void 0:n.width)&&void 0!==a?a:0,null===(i=t.canvas)||void 0===i?void 0:i.getZoom());e.set({left:Math.max(0,c-e.width),top:Math.max(0,r.top-e.height/2)})},l=(e,t,s,n,a,o)=>{if(e<0)return n;const r=t*s,l=i(a,o)-e;return r>l?l/t:s},c=(e,t,s,n,a)=>{let o=0,r=0;return Number.isFinite(s)&&Number.isFinite(n)&&Number.isFinite(a)&&(o=i(null!=n?n:0,s)/2,r=i(null!=a?a:0,s)/2),{left:e/2-o,top:t/2-r}},u=(e,t,s,o)=>{switch(o){case a.Q.Rectangle:return((e,t,s)=>({...c(e,t,s,n.i.width,n.i.height),width:i(n.i.width,s),height:i(n.i.height,s)}))(e,t,s);case a.Q.Circle:return((e,t,s)=>{const a=2*n.f.radius;return{...c(e,t,s,a,a),radius:i(n.f.radius,s)}})(e,t,s);default:throw new Error("Hotspot type must be a basic shape to determine default size and position")}},d=e=>n.l/e,p=(e,t,s)=>{const n=d(t),a=(e*t+s)/t;return a>n?a:n}},KLhW:function(e,t,s){"use strict";var n=s("ERkP"),a=s.n(n),i=s("VQ4P"),o=s("nsO7"),r=s("MC1S"),l=s("K9sL"),c=s("g27D"),u=s("nBlB"),d=s("EGyI"),p=s("tN4z"),h=s("np6O"),m=s("UJ5P"),b=s("ekqz"),g=s("YSVG"),f=s("H+fs"),v=s("0x+l"),w=s("GR+8");class y extends n.Component{constructor(e){super(e),this.translationKeyPrefix="assessments.canvas.question.multipleAnswer",this.handleEditorFocus=()=>{this.setState({editorFocused:!0})},this.handleEditorBlur=()=>{this.setState({editorFocused:!1})},this.onTextChange=e=>{const{answer:t,onAnswerChange:s}=this.props;s({...t,answerText:{rawText:e.toBbML()},applyAsyncPlugins:{answerText:async()=>({answerText:{rawText:await e.toBbML(!0)}})}})},this.onCorrectAnswerChange=(e,t)=>{const{answer:s,onAnswerChange:n}=this.props;n({...s,correctAnswer:t})},this.onDelete=()=>{const{onAnswerDeletion:e,answer:t}=this.props;e(t.id)},this.state={editorFocused:!1}}getChoiceTextClassName(){const{answer:e,activeEditorId:t,canEnterEditMode:s}=this.props;let n="multiple-answer-li__text";return!(e.id===t)&&s&&(n+=" -is-clickable"),n}render(){const{answer:e,canDeleteAnswer:t,dragButtonAriaLabel:s,dragPointRef:n,editMode:i,hasAddOrRemoveAnswerPermissions:o,hasReorderAnswersPermissions:r,hasSubmissions:l,index:c,localize:{translate:u},question:d,questionTitle:w,setEditor:y}=this.props,E=m.a.INACTIVE===i,C=c+1,x=`answer-header-${d.id}-${c}`,O=`${g.a}${d.id} ${x}`,T=u(`${this.translationKeyPrefix}.answerPlaceholder`,{answerNumber:C}),k=u(`${this.translationKeyPrefix}.checkboxAriaLabel`,{questionTitle:w,answerNumber:C}),S=u(`${this.translationKeyPrefix}.trashButtonAriaLabel`,{questionTitle:w,answerNumber:C}),q=u("assessments.canvas.drag.instructions"),A=u(`${this.translationKeyPrefix}.correctAnswer`);let P="multiple-answer-li__delete";this.state.editorFocused&&(P+=" multiple-answer-li--editor-focused");let I="multiple-answer-li__dnd";return this.state.editorFocused&&(I+=" multiple-answer-li--editor-focused"),a.a.createElement("div",{className:"multiple-answer-li"},a.a.createElement("div",{className:"multiple-answer-li__answer"},!E&&a.a.createElement(p.AnalyticsFormControlLabel,{label:"","aria-label":k,className:"question-multiple-answer-checkbox",control:a.a.createElement(p.AnalyticsCheckbox,{checked:e.correctAnswer,onChange:this.onCorrectAnswerChange,"aria-describedby":`bb-editor${e.id}`,analyticsId:"assessments.canvas.question.multipleAnswer.correctAnswerChange"}),analyticsId:"assessments.canvas.question.multipleAnswer.correctAnswerChange.label"}),a.a.createElement("div",{className:this.getChoiceTextClassName()},a.a.createElement("div",{id:x,className:"sr-only"},u("assessments.canvas.question.multipleAnswer.answerHeader",{answerNumber:C})),a.a.createElement(b.b,{...this.props,ariaLabelledBy:O,bbml:e.answerText.rawText,id:e.id,isReadOnly:E,onChange:this.onTextChange,onFocus:this.handleEditorFocus,onBlur:this.handleEditorBlur,placeholder:T,toolbarSet:"minimal",supportsInlineDocumentRender:!1,ref:e=>null==y?void 0:y(this.props.answer.id,e)})),E&&e.correctAnswer&&a.a.createElement("span",{className:"multiple-answer-li__correct"},A),!E&&!l&&a.a.createElement("div",null,r&&a.a.createElement(f.a,{className:I,dragPointRef:n,title:q,ariaLabel:s,ariaDescribedBy:`bb-editor${e.id}`}),o&&a.a.createElement(h.AnalyticsIconButton,{onClick:this.onDelete,className:P,disabled:!t(e),"aria-label":S,"aria-describedby":`bb-editor${e.id}`,analyticsId:"assessments.canvas.question.deleteAnswer"},a.a.createElement(v.Trash,null)))))}}const E=Object(u.DragNDropItem)(Object(w.a)(y));var C=s("l4Sq"),x=s("+VgB");class O extends n.Component{constructor(){super(...arguments),this.answerChoices={},this.getDraggingLabelObject=e=>{var t;const{t:s}=this.props,n=this.props.keyInsertIndex-1,a=Object(x.a)(s);return this.props.isKeyboardMoving?e===n?{string:"assessments.canvas.drop.buttonStart",relation:""}:0===this.props.keyInsertIndex?{string:"assessments.canvas.dropAnswer.buttonTop",relation:null!==(t=this.props.questionTitle)&&void 0!==t?t:""}:Object(C.a)("dropAnswer",this.props.question.answers[n],this.props.questionTitle,a):Object(C.a)("dragAnswer",this.props.question,this.props.questionTitle,a)},this.setChoiceEditor=(e,t)=>{this.answerChoices[e]=t}}componentDidUpdate(){var e,t,s;null!=this.props.duplicateAnswerIdToFocus&&(null===(e=this.answerChoices[this.props.duplicateAnswerIdToFocus])||void 0===e||e.focusEditor(),null===(s=(t=this.props).setDuplicationOptionIdToNull)||void 0===s||s.call(t))}render(){const{items:e,t,keyInsertIndex:s,isKeyboardMoving:n}=this.props;return a.a.createElement("ol",{id:"multiple-answer-dnd",className:"multiple-answer__list"},e.map(((e,i)=>{const o=this.getDraggingLabelObject(i),r=n?s:i+1,l=t(o.string,{relatedQuestion:o.relation,answerNumber:r});return a.a.createElement("li",{key:e.id,className:"multiple-answer__dnd-item"},a.a.createElement(E,{...this.props,answer:e,index:i,dragButtonAriaLabel:l,setEditor:this.setChoiceEditor,preview:a.a.createElement("div",{className:"multiple-answer__preview",dangerouslySetInnerHTML:{__html:e.answerText.rawText}})}))})))}}var T=Object(d.a)(Object(u.DragNDropContainer)(O)),k=s("AoSC"),S=s("sptZ"),q=s("NH8g"),A=s("+phe"),P=s("bJi+"),I=s("ZQN4"),j=s("FKP/"),F=s("4raK"),N=s("6Nff");s.d(t,"a",(function(){return _}));const D=e=>{const t=Object(i.a)();return a.a.createElement("ol",{className:"multiple-answer__list"},e.question.answers.map(((s,n)=>a.a.createElement("li",{key:s.id,className:"multiple-answer__dnd-item"},a.a.createElement(y,{...{...e,localize:{translate:t}},answer:s,index:n})))))},_=e=>{const{assessmentId:t,activeEditorId:s,editMode:n,hasSubmissions:u,onAnswerAddition:d,onQuestionChange:p,onReorder:h,question:b,questionTitle:g,setActiveEditorId:f,showScoringOptions:v,pluginsConfig:w,detailsHidden:y,readonlyPoints:E,assessmentType:C,extraCreditVisibility:x}=e,O=Object(i.a)(),_=m.a.INACTIVE===n,R=!_&&Object(k.i)(b),M=!y||!_,L=O("assessments.canvas.question.multipleAnswer.answerInstructions"),B=O("assessments.canvas.question.multipleAnswer.addChoice"),Q=Object(k.z)(e.question),V=[{key:I.b},{key:I.c},{key:I.e}],$=()=>!0===o.get(e,"question.permissions.addOrRemoveAnswer")||Q,H=()=>!0===o.get(e,"question.permissions.reorderAnswers")||Q,z=e=>{e.preventDefault()};return a.a.createElement("div",{className:"multiple-answer "+(_?"multiple-answer--read":"multiple-answer--edit")},a.a.createElement(c.a,{editMode:n,question:b},M?a.a.createElement(a.a.Fragment,null,a.a.createElement(q.a,{...Object(q.b)(Object(N.c)(e,O),p)}),a.a.createElement(S.a,{show:R,question:b})):a.a.createElement(F.a,{question:b,questionTitle:g,readonlyPoints:E,extraCreditVisibility:x}),a.a.createElement(A.a,{...Object(A.b)(e)}),M&&a.a.createElement(P.a,{...Object(P.b)({...e,localize:{translate:O}},p)})),M&&a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:(()=>{let e="multiple-answer__container";return!u&&$||(e+=" -cannot-add-more"),e})()},!_&&a.a.createElement("div",{className:"multiple-answer__instructions"},L),_?a.a.createElement(D,{...e,hasAddOrRemoveAnswerPermissions:$(),hasReorderAnswersPermissions:H()}):a.a.createElement(a.a.Fragment,null,a.a.createElement(T,{...e,items:b.answers,question:b,questionTitle:g,onReorderItem:h,boundingElementId:"gradebook-item-panel-content",scrollContainerId:"multiple-answer-dnd",hasAddOrRemoveAnswerPermissions:$(),hasReorderAnswersPermissions:H()}),!u&&$()&&a.a.createElement(r.Link,{className:"multiple-answer__add-choice",onClick:d,onMouseDown:z,type:"button",analyticsId:"assessments.canvas.question.multipleAnswer.addAnswer"},B))),v&&a.a.createElement(j.a,{question:e.question,onScoringOptionsChange:e.onScoringOptionsChange,editMode:e.editMode,isAnswersEditMode:!0,options:V,translationKeyPrefix:"assessments.canvas.question.multipleAnswer.scoringOptions"}),a.a.createElement(l.a,{assessmentId:t,activeEditorId:s,editMode:n,onQuestionChange:p,question:b,setActiveEditorId:f,pluginsConfig:w,assessmentType:C})))};_.defaultProps={showScoringOptions:!1}},M2Sb:function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" fill="none"><path fill="#fff" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M23.707 7.293a1 1 0 0 1 0 1.414l-13 13a1 1 0 0 1-1.414 0l-5-5a1 1 0 0 1 0-1.414l13-13a1 1 0 0 1 1.414 0l5 5Z"/><path fill="#fff" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M24.707 4.293a1 1 0 0 1 0 1.414l-2 2a1 1 0 0 1-1.414 0l-3-3a1 1 0 0 1 0-1.414l2-2a1 1 0 0 1 1.414 0l3 3ZM10.707 20.293a1 1 0 0 1-.356 1.643l-8 3a1 1 0 0 1-1.287-1.287l3-8a1 1 0 0 1 1.643-.356l5 5Z"/><path stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width="4" d="m14 3-7 7"/><path stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.5 4.5 20 11"/><g stroke="#262626" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" clip-path="url(#a)"><path fill="#fff" d="M10 21 23 8l-5-5L5 16l5 5Z"/><path fill="#fff" d="m22 7 2-2-3-3-2 2 3 3ZM10 21l-8 3 3-8 5 5Z"/><path d="m14 3-7 7M13.5 4.5 20 11"/></g><defs><clipPath id="a"><path fill="#fff" d="M1 1h24v24H1z"/></clipPath></defs></svg>'},"M9/2":function(e,t,s){"use strict";s.d(t,"b",(function(){return n})),s.d(t,"a",(function(){return a}));const n=e=>({fill:e.palette.background.b3,opacity:.35}),a=()=>({fill:"rgba(255,255,255,0.0)",opacity:1})},N0Hd:function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var n=s("031P"),a=s("vymd"),i=s("E0B1"),o=s("KDr4");const r=n.fabric.util.createClass(n.fabric.Group,{type:a.a.HotspotLabel,createCircleObj:()=>new n.fabric.Circle({...i.g}),createTextObj:e=>new n.fabric.Text(e,{...i.h}),initialize(e){const t=[this.createCircleObj(),this.createTextObj(e)];this.callSuper("initialize",t,{selectable:!1,hasControls:!1,hoverCursor:"default"})},getLabel(){let e="";return this.forEachObject((function(t){t.type===a.a.Text&&(e=t.text)})),e},updateLabel(e){this.forEachObject((function(t){t.type===a.a.Text&&t.set({text:e})}))},resize(e){const t=Object(o.c)(i.g.radius,e),s=Object(o.c)(i.g.strokeWidth,e),n=2*t+s;this.set({width:n,height:n}),this.forEachObject((function(s){s.type===a.a.Circle?(s.set({radius:t}),s.set({strokeWidth:Object(o.c)(i.g.strokeWidth,e)})):s.type===a.a.Text&&s.set({fontSize:Object(o.c)(i.h.fontSize,e)})}))}})},N8vG:function(e,t,s){"use strict";s.d(t,"a",(function(){return o})),s.d(t,"b",(function(){return r})),s.d(t,"d",(function(){return l})),s.d(t,"q",(function(){return c})),s.d(t,"n",(function(){return u})),s.d(t,"k",(function(){return d})),s.d(t,"o",(function(){return p})),s.d(t,"f",(function(){return h})),s.d(t,"e",(function(){return m})),s.d(t,"l",(function(){return b})),s.d(t,"m",(function(){return g})),s.d(t,"j",(function(){return f})),s.d(t,"p",(function(){return v})),s.d(t,"c",(function(){return w})),s.d(t,"i",(function(){return y})),s.d(t,"h",(function(){return E})),s.d(t,"g",(function(){return C}));var n=s("nsO7"),a=s("a6r6"),i=s("zGdY");const o="assessments.canvas.question.calculatedFormula",r={ONE:0,TWO:1,THREE:2};function l(e){const t=/\[([^\s[\]]+)\]/gi,s=[];let n=t.exec(e);for(;null!=n;)1!==n.index&&"\\"===e.charAt(n.index-1)||s.push(n[1]),n=t.exec(e);return Array.from(new Set(s))}function c(e){const t=e.match(/[a-zA-Z]/gi);return!t||t.length<e.length}function u(e){return a.b.DEFAULT_RESERVED_WORDS.includes(e)}function d(e){return{name:e,maxValue:100,minValue:0,scale:0}}function p(e){const t=e.split("");let s=!1;return t.some(((e,n)=>{if(s&&"]"===e)s=!1;else{if(s){const t=e.match(/\s/i);return!!(t&&t.length>0)}"["===e&&(s=0===n||"\\"!==t[n-1])}return!1}))||s}function h(e){const t={};return e.forEach((e=>{const{minValue:s,maxValue:a,name:i,scale:o}=e;t[i]=Object(n.round)(Math.random()*(a-s)+s,o)})),t}function m(e){const t={};return e.forEach((e=>{const{name:s,scale:n}=e;t[s]=n})),t}function b(e){return e?e.map((e=>e.name)):[]}function g(e,t){return Object(n.xor)(b(e),b(t)).length>0}function f(e,t){return Object(n.without)(function(e){return e?Object(n.without)(e.match(/[a-zA-Z0-9]+(?=<\/mi>)/g),...a.b.DEFAULT_RESERVED_WORDS):[]}(e),...b(t))}function v(e,t,s,n){const{SignificantFigures:a,Decimal:o}=i.n,{Normal:r,Exponential:l}=i.m;if(s===r&&n===o){const s=Number((Math.abs(e)*10**t).toPrecision(15));return Math.round(s)/10**t*Math.sign(e)}return s===l&&n===o?parseFloat(e.toExponential(t)):n===a?parseFloat(e.toPrecision(t)):null}function w({variableDefinitions:e}){return null!=e&&e.length>0}function y(e){return e&&e.value>0?e.value:null}function E(e){return e&&e.value>0?e.type:null}function C(e,t,s,n){let a="";if(n&&s)a=t===i.o.Numeric?"unitsAndAnswerTolerance":"unitsAndAnswerTolerancePercent";else if(n&&!s)a="units";else{if(n||!s)return null;a=t===i.o.Numeric?"answerTolerance":"answerTolerancePercent"}return`${e}.${a}`}},NH8g:function(e,t,s){"use strict";var n=s("ERkP"),a=s.n(n),i=s("YSVG"),o=s("l4Sq"),r=s("+VgB");const l=(e,t)=>{var s;const{alignedGoals:n,canEnterEditMode:a,customQuestionHeader:i,deleteQuestion:l,disableFocus:c,disableInteraction:u,editMode:d,focusTitle:p,hasQuestionEditPermissions:h,hasSubmissions:m,localize:{translate:b},openGoals:g,question:f,questionTitle:v,questionVisibleNumber:w,startEditMode:y,assessmentType:E,readonlyPoints:C,extraCreditVisibility:x}=e,O=Object(o.a)("goal",f,v,Object(r.a)(b));return{alignedGoals:n,analyticsId:"assessments.canvas.question.header",canEnterEditMode:a,deleteQuestion:l,disableFocus:c,disableInteraction:u,editMode:d,focusTitle:p,goalAriaLabel:b(O.string,{relatedContent:O.relation}),hasAlignedGoals:n&&n.length>0,hasQuestionEditPermissions:h,hasSubmissions:m,hideEditPoints:f.externallyReferencedQuestion,header:i,hideFullCreditCheckbox:!1,id:null!==(s=f.id)&&void 0!==s?s:"",onPointsClick:y,onQuestionChange:t,openGoals:g,points:f.points,question:f,questionTitle:v,questionVisibleNumber:w,startEditMode:y,assessmentType:E,readonlyPoints:C,extraCreditVisibility:x}};var c=e=>a.a.createElement(a.a.Fragment,null,e.header?e.header(e):a.a.createElement(i.b,{...e}));s.d(t,"a",(function(){return c})),s.d(t,"b",(function(){return l}))},PCui:function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));var n=s("ERsv"),a=s("4yoV");function i(e){var t;return Object(a.c)(null===(t=e.questionText)||void 0===t?void 0:t.rawText).map((e=>{const{bbfile:t,href:s}=e;return{file:{resourceUrl:s,fileName:Object(n.getFileNameWithTypeExtension)(t.linkName,t.mimeType),render:t.render,alternativeText:t.alternativeText||t.linkName,displayName:t.linkName,mimeType:t.mimeType,isDecorative:t.isDecorative||!1,viewerUrl:t.viewerUrl},readOnly:!0,showContextMenu:!1}}))}},Pu34:function(e,t,s){"use strict";var n=s("rQEZ"),a=s("ERkP"),i=s("eqO1"),o=s("031P"),r=s("fN3Q"),l=s("nsO7"),c=s("6OL3"),u=s("iD7+"),d=s("Y8zf"),p=s("yX1G"),h=s("E9Bh"),m=s("N0Hd"),b=s("vymd"),g=s("E0B1"),f=s("KDr4");const v={originX:"center",originY:"center"},w=o.fabric.util.createClass(o.fabric.Group,{type:b.a.HotspotPolygonPoint,createCirclePoint:e=>new o.fabric.Circle({...v,fill:g.c,left:e.x,radius:8,stroke:"white",strokeWidth:2,top:e.y}),createRectanglePoint:e=>new o.fabric.Rect({...v,fill:"white",top:e.y,left:e.x,stroke:g.c,width:16,height:16,strokeWidth:1}),initialize(e,t,s){const n=[s?this.createCirclePoint(t):this.createRectanglePoint(t)];this.callSuper("initialize",n,{hasBorders:!1,hasControls:!1}),this.set("id",e||""),this.centerPointCoordinates=t},getCenterPointCoordinates(){return this.centerPointCoordinates},resize(e){this.forEachObject((function(t){t.radius?t.set({radius:Object(f.c)(8,e),strokeWidth:Object(f.c)(2,e)}):t.set({width:Object(f.c)(16,e),height:Object(f.c)(16,e),strokeWidth:Object(f.c)(1,e)})}))}}),y={strokeWidth:5,originX:"center",originY:"center"},E={...y,stroke:g.c,strokeDashArray:[8]},C=o.fabric.util.createClass(o.fabric.Group,{type:b.a.HotspotPolygonLine,createLine(e,t){const{x1:s,y1:n,x2:a,y2:i}=e;return new o.fabric.Line([s,n,a,i],t)},createWhiteLine(e){return this.createLine(e,{...y,stroke:"white"})},createBlueDashedLine(e){return this.createLine(e,{...E})},initialize(e,t){const s=[this.createWhiteLine(t),this.createBlueDashedLine(t)];this.callSuper("initialize",s,{hasBorders:!1,hasControls:!1}),this.set("id",e||""),this.coords=t},resize(e){this.forEachObject((function(t){t.set({strokeWidth:Object(f.c)(y.strokeWidth,e)}),t.strokeDashArray&&t.set({strokeDashArray:E.strokeDashArray.map((t=>Object(f.c)(t,e)))})}))},updateLineCoordinates(e,t){this.getObjects().forEach((e=>this.remove(e)));const s={...this.coords,...e};this.addWithUpdate(this.createWhiteLine(s)),this.addWithUpdate(this.createBlueDashedLine(s)),this.coords=s,this.resize(t)},getCoordinates(){return this.coords}});var x=s("SEyF"),O=s("M2Sb"),T=s.n(O);var k=s("zGdY"),S=s("M9/2"),q=s("cexh");const A=["selectable","hasControls","hoverCursor"],P=e=>{const{canvas:t,addPolygonHotspot:s,otherHotspots:n=[]}=e,l=Object(i.t)(),[c,u]=Object(a.useState)(!1),[d,p]=Object(a.useState)([]),[h,m]=Object(a.useState)([]),[b,v]=Object(a.useState)(null),[y,E]=Object(a.useState)(null),[O,P]=Object(a.useState)({}),{changeCursorPosition:I,cursorIcon:j,centerPositionCursor:F}=(e=>{const{canvas:t,isPolygonDrawingModeOn:s}=e,[n,i]=Object(a.useState)(!1),[r,l]=Object(a.useState)(!1),[c,u]=Object(a.useState)(null);Object(a.useEffect)((()=>{s?o.fabric.loadSVGFromString(T.a.toString(),(e=>{const t=o.fabric.util.groupSVGElements(e);t.set({hasControls:!1,selectable:!1}),u(t)})):(l(!1),i(!1))}),[s]);const d=Object(a.useCallback)((()=>{r&&c&&c.bringToFront()}),[r,c]);Object(a.useEffect)((()=>{t&&c&&(r?(t.defaultCursor="none",t.hoverCursor="none",t.moveCursor="none",c.isOnScreen()||(t.add(c),d())):(t.defaultCursor="default",t.hoverCursor="default",t.moveCursor="default",t.remove(c)),t.requestRenderAll())}),[t,c,r,d,n]),Object(a.useEffect)((()=>{var e,s;if(n&&t&&c){const n=t.getZoom();c.set({top:Object(f.c)((null!==(e=t.height)&&void 0!==e?e:0)/2,n),left:Object(f.c)((null!==(s=t.width)&&void 0!==s?s:0)/2,n),originX:"left",originY:"bottom"}),l(!0)}}),[t,c,n]),Object(a.useEffect)((()=>{const e=e=>{if(!e.pointer||!t||!c)return;const s=t.getZoom();l(!0),c.set({top:Object(f.c)(e.pointer.y,s),left:Object(f.c)(e.pointer.x,s),originX:"left",originY:"bottom"}),t.requestRenderAll()},n=()=>{d()};return s&&(null==t||t.on("mouse:move",e),null==t||t.on("object:added",n)),()=>{s&&(null==t||t.off("mouse:move",e),null==t||t.off("object:added",n))}}),[t,s,c,d]);const p=Object(a.useCallback)((e=>{var s,n,a,i;if(!t||!c)return;const o=t.getZoom(),{left:r=0,top:l=0}=e;c.set({top:Object(f.e)((null!==(s=c.top)&&void 0!==s?s:0)+l,null!==(n=t.height)&&void 0!==n?n:0,o),left:Object(f.e)((null!==(a=c.left)&&void 0!==a?a:0)+r,null!==(i=t.width)&&void 0!==i?i:0,o)}),t.requestRenderAll()}),[t,c]),h=Object(a.useCallback)((()=>{i(!0)}),[]);return{changeCursorPosition:p,cursorIcon:c,centerPositionCursor:h}})({canvas:t,isPolygonDrawingModeOn:c}),N=Object(a.useMemo)((()=>[...d,...h,...y?[y]:[],...b?[b]:[]]),[y,b,d,h]),D=Object(a.useMemo)((()=>h.map((e=>({x:e.left+e.width/2,y:e.top+e.height/2})))),[h]),_=Object(a.useMemo)((()=>({hasControls:!1,selectable:!1,objectCaching:!1,...Object(S.b)(l)})),[l]),R=Object(a.useMemo)((()=>h.length>=g.m),[h]),M=Object(a.useCallback)((()=>{p([]),m([]),E(null),v(null)}),[]),L=Object(a.useCallback)((()=>P(n.reduce(((e,t)=>({...e,[t.id]:A.reduce(((e,s)=>({...e,[s]:t[s]})),{})})),{}))),[n]),B=Object(a.useCallback)((e=>{t&&!c&&(L(),n.forEach((e=>e.set({selectable:!1,hasControls:!1,hoverCursor:"none"}))),t.selection=!1,M(),u(!0),e&&F())}),[t,F,c,n,M,L]),Q=Object(a.useCallback)((e=>{if(!t||!j)return;const{x:s,y:n}=e;if(h.some((e=>e.getCenterPointCoordinates().y===n&&e.getCenterPointCoordinates().x===s)))return;const a=new w(Object(r.v4)(),e,!h.length);t.add(a),m((e=>[...e,a])),y&&(E(null),t.remove(y));const i=new C(`${Object(r.v4)()}-activeLine`,{x1:a.left+a.width/2,y1:a.top+a.height/2,x2:s,y2:n});if(t.add(i),i.sendToBack(),E(i),h.length){const a=h[h.length-1],i=new C(Object(r.v4)(),{x1:a.left+a.width/2,y1:a.top+a.height/2,x2:s,y2:n});t.add(i),i.sendToBack(),p((e=>[...e,i]));const o=[...D,e],l=Object(x.b)(o,_);b&&t.remove(b),t.add(l),v(l)}t.requestRenderAll()}),[t,j,h,y,D,_,b]),V=Object(a.useCallback)((({x:e,y:s})=>{const n=h[0];if(!n||!t)return!1;const a=t.getZoom(),i=a*n.top,o=a*n.left,r=a*n.left+n.width,l=a*n.top+n.height;return e>=o&&e<=r&&s>=i&&s<=l}),[t,h]),$=Object(a.useCallback)((()=>{R&&s({type:k.Q.Polygon,coordinates:Object(q.d)(D)})}),[s,R,D]),H=Object(a.useCallback)((e=>!(!t||!c)&&(n.forEach((e=>e.set(O[e.id]))),u(!1),N.forEach((e=>t.remove(e))),M(),t.selection=!0,e||$(),t.requestRenderAll(),!e&&R)),[N,R,t,$,c,n,O,M]),z=Object(a.useCallback)((()=>{var e;if(!t||!h.length)return;const s=d[d.length-1],n=h[h.length-1];if(t.remove(n),m((e=>e.slice(0,-1))),s&&(t.remove(s),p((e=>e.slice(0,-1)))),1===h.length)return void t.remove(y);const a=h[h.length-2];y.updateLineCoordinates({y1:a.top+a.height/2,x1:a.left+a.width/2},t.getZoom()),2!==h.length?(null!==(e=null==b?void 0:b.points.length)&&void 0!==e?e:0)>D.length&&(null==b||b.set({points:b.points.filter(((e,t)=>t!==b.points.length-2))})):t.remove(b)}),[y,b,t,d,D.length,h]),K=Object(a.useCallback)((e=>{var s,n,a,i,o,r;if(!t)return;const{left:l=0,top:c=0}=e,u=t.getZoom();if(y){const e={top:Object(f.e)((null!==(s=null==y?void 0:y.getCoordinates().y2)&&void 0!==s?s:0)+c,null!==(n=null==t?void 0:t.height)&&void 0!==n?n:0,u),left:Object(f.e)((null!==(a=null==y?void 0:y.getCoordinates().x2)&&void 0!==a?a:0)+l,null!==(i=null==t?void 0:t.width)&&void 0!==i?i:0,u)};null==y||y.updateLineCoordinates({x2:e.left,y2:e.top},u)}if(b){const e=b.points[b.points.length-1],s={top:Object(f.e)(e.y+c,null!==(o=null==t?void 0:t.height)&&void 0!==o?o:0,u),left:Object(f.e)(e.x+l,null!==(r=null==t?void 0:t.width)&&void 0!==r?r:0,u)};b.set({points:[...D,{x:s.left,y:s.top}]})}I(e),t.requestRenderAll()}),[y,b,t,I,D]),U=Object(a.useCallback)((()=>{var e,s;if(!j||!t)return;const n={x:null!==(e=j.left)&&void 0!==e?e:0,y:null!==(s=j.top)&&void 0!==s?s:0},a=t.getZoom();V({x:n.x*a,y:n.y*a})?H():Q(n)}),[t,Q,j,H,V]);return Object(a.useEffect)((()=>{if(t){const e=t.getZoom();null==y||y.resize(e),d.forEach((t=>t.resize(e))),h.forEach((t=>t.resize(e))),j&&(j.scaleX=1/e,j.scaleY=1/e),t.requestRenderAll()}}),[y,t,j,d,h]),Object(a.useEffect)((()=>{const e=e=>{if(!e.pointer||!t)return;const s=t.getZoom();null==y||y.updateLineCoordinates({x2:Object(f.c)(e.pointer.x,s),y2:Object(f.c)(e.pointer.y,s)},s),null==b||b.set({points:[...D,{x:Object(f.c)(e.pointer.x,s),y:Object(f.c)(e.pointer.y,s)}]}),t.requestRenderAll()},s=e=>{if(!e.pointer||!t)return;const s=t.getZoom(),n=2===e.e.detail;h.length&&V({...e.pointer})||n?H():Q({x:Object(f.c)(e.pointer.x,s),y:Object(f.c)(e.pointer.y,s)}),t.requestRenderAll()};return c&&(null==t||t.on("mouse:move",e),null==t||t.on("mouse:down",s)),()=>{c&&(null==t||t.off("mouse:move",e),null==t||t.off("mouse:down",s))}}),[l,t,y,b,D,h.length,Q,V,H,c]),{endPolygonDrawingMode:H,movePolygonModeCursor:K,isPolygonDrawingModeOn:c,startPolygonDrawingMode:B,deleteMostRecentlyAddedPolygonPoint:z,addPolygonPoint:U}};var I=s("vLEk"),j=s("xMR0");s.d(t,"a",(function(){return N}));const F="{unset}",N=e=>{const{onUpdate:t,canvasBackgroundOptions:s,onHotspotImageLoaded:g}=e,v=Object(i.t)(),w=Object(c.a)(),{selectedObjectPositions:y,registerEvents:E}=Object(h.b)(w),{requestUpdate:C}=Object(d.a)({onUpdate:t,values:w.values,refreshData:w.refreshMap,coordinateInfoMapper:u.a}),{canvas:O,nextHotspotObjectNumber:T,deleteSelectedHotspotObjects:A,...N}=Object(n.a)({mapManager:w,onHotspotImageLoaded:g,selectedObjectPositions:y,canvasBackgroundOptions:s,requestHotspotQuestionUpdate:C}),{handleHotspotScale:D,restrictHotspotObjScale:_}={handleHotspotScale:Object(a.useCallback)((({hotspot:e,newScaleX:t,newScaleY:s,label:n})=>{Object(b.d)(e)&&(e.updateScale(t,s),Object(b.e)(e),Object(f.h)(n,e))}),[]),restrictHotspotObjScale:Object(a.useCallback)((e=>{var t,s;if(!Object(b.d)(e))return;const{top:n,left:a,width:i,height:o,scaleX:r}=e,{scaleX:l,top:c,left:u}=e._stateProperties,d=e.canvas,p=e.canvas.getZoom(),h=Object(f.b)(i),m=Object(f.b)(o);let g=e.scaleY,v=e._stateProperties.scaleY;const w=Object(b.c)(e);w&&(g=r,v=e._stateProperties.scaleX);const y=r<h,E=g<m,C={scaleX:Object(f.d)(a,i,y?l:r,l,null!==(t=d.width)&&void 0!==t?t:0,p),scaleY:Object(f.d)(n,o,E?v:g,v,null!==(s=d.height)&&void 0!==s?s:0,p)};C.left=y||a<0?u:a,C.top=E||n<0?c:n;const x=C.scaleX!==r||C.scaleY!==g;w&&x&&(C.scaleX=l,C.scaleY=v,C.left=u,C.top=c),e.set({...C}),e.setCoords(),e.saveState()}),[])};Object(a.useEffect)((()=>{Object(u.c)({objects:w.sortedValues.map((e=>e.object)),selectedObjectPositions:y}),Object(u.c)({objects:w.sortedValues.map((e=>e.label)).filter(l.identity),selectedObjectPositions:y,skipCount:w.count})}),[w.count,w.sortedValues,y]),Object(a.useEffect)((()=>{if(O){const e=O.getActiveObjects();O.discardActiveObject();const t=O.getZoom();if(w.values.forEach((({label:e,object:s})=>{s.resize(t),e&&(e.resize(t),Object(f.h)(e,s))})),(null==e?void 0:e.length)>1){const t=new o.fabric.ActiveSelection(e,{canvas:O});O.setActiveObject(t)}else 1===(null==e?void 0:e.length)&&O.setActiveObject(e[0]);O.requestRenderAll()}}),[O,null==O?void 0:O.width,null==O?void 0:O.height,w.values]);const R=Object(a.useCallback)((()=>{A((e=>(e.label.updateLabel(e.position.toString()),e)))}),[A]),M=Object(a.useCallback)((({hotspot:e,newTop:t,newLeft:s,label:n})=>{e.updateCoords(t,s),e.setCoords(),Object(f.h)(n,e)}),[]),L=Object(a.useCallback)((({object:e,label:t,position:s})=>{if(!O)return;const n=[{name:h.a.MOVING,handler:()=>{var s,n;const{top:a,left:i,width:o,height:r,scaleX:l,scaleY:c,canvas:u}=e,d=u.getZoom(),p=Object(f.e)(a,null!==(s=u.height)&&void 0!==s?s:0,d,r,c),h=Object(f.e)(i,null!==(n=u.width)&&void 0!==n?n:0,d,o,l);M({hotspot:e,newTop:p,newLeft:h,label:t})}},{name:h.a.SCALING,handler:()=>{_(e);const s=e.scaleX,n=e.scaleY;D({hotspot:e,newScaleX:s,newScaleY:n,label:t})}},{name:h.a.MODIFIED,handler:C},{name:h.a.SELECTED,handler:()=>{e.getOverlayObj().set({...Object(S.b)(v)}),O.requestRenderAll()}},{name:h.a.DESELECTED,handler:()=>{e.getOverlayObj().set({...Object(S.a)()}),O.requestRenderAll()}}];E({events:n,object:e,position:s})}),[O,M,D,C,E,_,v]),B=Object(a.useCallback)(((e,t,s,n,a,i)=>s&&n.type!==k.Q.Polygon?{...Object(f.g)(e,t,i,n.type),isModifiable:a}:{...Object(q.b)(n.coordinates,n.type),isModifiable:a}),[]),Q=Object(a.useCallback)((e=>{var t;if(!O)return{};const s=O.getZoom();let n=e.hotspotId;const a=!n||n===F;n=a?Object(r.v4)():n;const{width:i,height:o}=O.backgroundImage,l=B(i,o,a,e,!0,s);let c;switch(e.type){case k.Q.Rectangle:c=new I.a(n,l);break;case k.Q.Circle:c=new j.a(n,l);break;case k.Q.Polygon:c=new x.a(n,l);break;default:throw new Error("Type of new hotspot is invalid")}O.add(c);const u=null!==(t=e.hotspotNumber)&&void 0!==t?t:T,d=new m.a(u.toString());Object(f.h)(d,c),O.add(d);const p={position:u,object:c,label:d};return L(p),a&&(w.add(p),O.setActiveObject(c),C()),p}),[w,O,T,L,C,B]),V=Object(a.useCallback)((e=>{var t;Q({...e,hotspotId:F,coordinates:null!==(t=e.coordinates)&&void 0!==t?t:F})}),[Q]),$=Object(a.useCallback)((e=>{const t=e.map(Q);w.addMultiple(t)}),[Q,w]),H=Object(a.useCallback)((e=>{var t,s,n,a,i,o,r,l;const c=w.getByPosition(y[0]);if(!O||!c||1!==y.length)return;const{object:u,label:d}=c,{top:p,left:h,width:m,height:g,scaleX:v}=u;let{scaleY:E}=u;const{top:x,left:T,width:k}=e;let{height:S}=e;const q={};let A=u._stateProperties.scaleY;const P=Object(b.c)(u),I=O.getZoom();x&&Number.isFinite(x)&&(q.top=Object(f.e)(p+x,null!==(t=O.height)&&void 0!==t?t:0,I,g,E)),T&&Number.isFinite(T)&&(q.left=Object(f.e)(h+T,null!==(s=O.width)&&void 0!==s?s:0,I,m,v));const j=k&&Number.isFinite(k);if(j){const e=Object(f.a)(v,m,k),t=u._stateProperties.scaleX;q.scaleX=Object(f.d)(h,m,e,t,null!==(n=O.width)&&void 0!==n?n:0,I),P&&(E=v,A=u._stateProperties.scaleX,S=k)}const F=S&&Number.isFinite(S);if(!P&&F||P&&j&&F){const e=Object(f.a)(E,g,null!=S?S:0);q.scaleY=Object(f.d)(p,g,e,A,null!==(a=O.height)&&void 0!==a?a:0,I)}if(Number.isFinite(q.top)||Number.isFinite(q.left)){const e=null!==(i=q.top)&&void 0!==i?i:u.top,t=null!==(o=q.left)&&void 0!==o?o:u.left;M({hotspot:u,newTop:e,newLeft:t,label:d})}else if(Number.isFinite(q.scaleX)||Number.isFinite(q.scaleY)){let e=null!==(r=q.scaleX)&&void 0!==r?r:u.scaleX,t=null!==(l=q.scaleY)&&void 0!==l?l:u.scaleY;if(P&&e!==t){const s=Math.min(e,t);e=s,t=s}D({hotspot:u,newScaleX:e,newScaleY:t,label:d})}u.saveState(),O.requestRenderAll(),C()}),[w,O,M,D,C,y]),{addReadonlyHotspots:z}=Object(p.a)({canvas:O,mapManager:w}),K=P({canvas:O,addPolygonHotspot:V,otherHotspots:Object(l.flatMap)(w.values,(e=>[e.label,e.object]))}),U=Object(a.useCallback)((e=>{null==O||O.discardActiveObject(),K.startPolygonDrawingMode(e)}),[O,K]);return{...K,...N,addNewHotspot:V,modifyHotspot:H,addExistingHotspots:$,addReadonlyHotspots:z,deleteSelectedHotspots:R,startPolygonDrawingMode:U}}},PxJx:function(e,t,s){"use strict";var n=s("ERkP"),a=s.n(n),i=s("VQ4P"),o=s("tN4z"),r=s("ECG1"),l=s("Agfx");const c=Object(l.makeStyles)((e=>Object(l.createStyles)({keyboardControlsWrapper:{display:"flex",flexDirection:"row",alignItems:"center"},tooltipTitleList:{marginBottom:0},tooltipTitleListContainer:{marginLeft:"10px"},tooltipTitle:{display:"flex",flexDirection:"column",gap:"10px"},tooltipSectionTitle:{fontWeight:e.typography.fontWeightSemiBold,marginBottom:"10px"},sectionTitle:{marginRight:"2px"},infoButton:{borderRadius:"2px",alignSelf:"stretch"}})));t.a=Object(n.memo)((e=>{const{infoLocaleKeys:t,analyticsIdPrefix:s}=e,l=c(),u=Object(i.a)(),d="hotspot-keyboard-controls-info",p=Object(n.useMemo)((()=>a.a.createElement("div",{className:l.tooltipTitle},t.map(((e,t)=>a.a.createElement("div",{key:`section-${t+1}`},e.title&&a.a.createElement("div",{className:l.tooltipSectionTitle},u(e.title)),a.a.createElement("div",{className:l.tooltipTitleListContainer},a.a.createElement("ul",{className:l.tooltipTitleList},e.items.map((e=>a.a.createElement("li",{key:e},u(e))))))))))),[l.tooltipSectionTitle,l.tooltipTitle,l.tooltipTitleList,l.tooltipTitleListContainer,t,u]);return a.a.createElement("div",{className:l.keyboardControlsWrapper},a.a.createElement(o.AnalyticsTypography,{id:d,className:l.sectionTitle},u("assessments.canvas.question.hotspot.keyboardControlsInfoComponent.label")),a.a.createElement(o.AnalyticsTooltip,{analyticsId:`${s}.hotspotKeyboardControlsInfo.tooltip`,title:p,placement:"left-end"},a.a.createElement(o.AnalyticsIconButton,{analyticsId:`${s}.hotspotKeyboardControlsInfo.button`,"aria-labelledby":d,className:l.infoButton},a.a.createElement(r.a,null))))}))},Rco2:function(e,t,s){"use strict";var n=s("ERkP"),a=s.n(n),i=s("031P"),o=s("7O4Y"),r=s("Agfx");const l=Object(r.makeStyles)((()=>Object(r.createStyles)({canvasWrapper:{display:"flex",flexDirection:"column",alignItems:"center"}})));s.d(t,"a",(function(){return c}));const c=e=>{const t=Object(n.useRef)(null),[s,r]=Object(n.useState)(null),{className:c,onReady:u,onResizeCanvas:d,canvasOptions:p}=e,h=l();return Object(n.useEffect)((()=>{const e=new i.fabric.Canvas(t.current,p||{});return u&&u(e),()=>{e.dispose()}}),[]),Object(n.useEffect)((()=>{const e=new ResizeObserver((e=>{var t,s;const n=null===(s=null===(t=e[0])||void 0===t?void 0:t.contentRect)||void 0===s?void 0:s.width;Number.isFinite(n)&&d(n)}));return s&&e.observe(s),()=>e.disconnect()}),[d,s]),a.a.createElement("div",{ref:e=>r(e),className:Object(o.a)(c,h.canvasWrapper)},a.a.createElement("canvas",{ref:t}))}},SEyF:function(e,t,s){"use strict";s.d(t,"b",(function(){return c})),s.d(t,"a",(function(){return u}));var n=s("031P"),a=s("E0B1"),i=s("vymd"),o=s("M9/2");const r={fill:"transparent",strokeWidth:5},l={...r,stroke:a.c,strokeDashArray:[8],fill:"rgba(255, 255, 255, 0.01)"},c=(e,t)=>new n.fabric.Polygon(e,t),u=n.fabric.util.createClass(n.fabric.Group,{type:i.a.HotspotPolygon,defaultStrokeWidth:r.strokeWidth,defaultStrokeDashArray:l.strokeDashArray,createWhitePolygon:e=>new n.fabric.Polygon(e,{...r,stroke:"white"}),createBlueDashedPolygon:e=>new n.fabric.Polygon(e,{...l}),initialize(e,t){var s;const n=t.coords;let a;a=t.isModifiable?{selectable:!0,hasBorders:!1,hasControls:!1,strokeWidth:0,perPixelTargetFind:!0,hoverCursor:"move"}:{selectable:!1,hasControls:!1,hoverCursor:"default"};const i=c(n,{...Object(o.a)()}),r=[i,this.createWhitePolygon(n),this.createBlueDashedPolygon(n)];this.callSuper("initialize",r,a),this.set("id",e||""),this.overlayPolygon=i;const l=null!==(s=n.find((e=>e.y===Math.min(...n.map((e=>e.y))))))&&void 0!==s?s:n[0];this.topPointLeftDelta=l.x-this.left,this.prevLeft=this.left,this.prevTop=this.top,this.points=n},resize(e){Object(i.b)(this,e),Object(i.e)(this)},updateScale(e,t){},updateCoords(e,t){this.top=e,this.left=t;const s=this.left-this.prevLeft,n=this.top-this.prevTop;this.points=this.points.map((e=>({x:e.x+s,y:e.y+n}))),this.prevLeft=this.left,this.prevTop=this.top},getOverlayObj(){return this.overlayPolygon},getTopPointLeftDelta(){return this.topPointLeftDelta},getFabricObjOptionsCalcMethod:()=>e=>({width:e.width,height:e.height,scaleX:e.scaleX,scaleY:e.scaleY})})},SFo1:function(e,t,s){"use strict";var n=s("ERkP"),a=s.n(n),i=s("UJ5P"),o=s("/n7R"),r=s("ufrm"),l=s("Rb2q"),c=s("8jBL"),u=s("THXI"),d=s("VQ4P"),p=s("Agfx");const h=Object(p.makeStyles)((()=>Object(p.createStyles)({tooltipPopper:{zIndex:1000001},kudosButton:{display:"flex",lineHeight:0,marginRight:"15px"}})));var m,b=s("GuFu");s.d(t,"b",(function(){return m})),s.d(t,"a",(function(){return g})),function(e){e[e.Hidden=0]="Hidden",e[e.ReadOnly=1]="ReadOnly",e[e.Visible=2]="Visible"}(m||(m={}));const g=({question:e,questionVisibleNumber:t,onQuestionChange:s,editMode:n,extraCreditVisibility:p,hasFocus:g=!1})=>{const f=Object(d.a)(),v=h(),w=Object(b.p)("feature.course.content.assessments.extraCreditQuestions"),y=a.a.useRef(!w&&(null==e?void 0:e.extraCredit)),E="assessments.canvas.question.header",C=(t,n)=>{s({...e,extraCredit:n})},x=f("assessments.canvas.question.header.extraCredit.ariaLabelText",{questionPosition:null!=t?t:""});return m.Hidden===p||(null==e?void 0:e.externallyReferencedQuestion)?null:i.a.ACTIVE===n&&m.Visible===p?w||(null==e?void 0:e.extraCredit)||y.current?a.a.createElement(l.a,{analyticsId:`${E}.extra.credit.checkbox.form`,label:f("assessments.canvas.question.header.extraCredit.label"),htmlFor:"checkboxExtraCredit",control:a.a.createElement(r.a,{analyticsId:`${E}.extra.credit.checkbox`,id:"checkboxExtraCredit",...w||!w&&(null==e?void 0:e.extraCredit)?{onChange:C,checked:null!==(O=e.extraCredit)&&void 0!==O&&O,autoFocus:g}:y&&!(null==e?void 0:e.extraCredit)?{checked:!1,disabled:!0}:null})}):null:e.extraCredit&&i.a.INACTIVE===n?a.a.createElement(o.AnalyticsTooltip,{analyticsId:`${E}.extra.credit.icon.tooltip`,title:f("assessments.canvas.question.header.extraCredit.tooltipText"),classes:{popper:v.tooltipPopper},tabIndex:0},a.a.createElement("button",{"aria-label":x,className:v.kudosButton},a.a.createElement(c.Kudos,{htmlColor:u.c.purpleDark}))):null;var O}},UJ5P:function(e,t,s){"use strict";var n;s.d(t,"a",(function(){return n})),function(e){e[e.INACTIVE=0]="INACTIVE",e[e.ACTIVE=1]="ACTIVE"}(n||(n={}))},Y8zf:function(e,t,s){"use strict";s.d(t,"a",(function(){return a}));var n=s("ERkP");const a=e=>{const{onUpdate:t,coordinateInfoMapper:s,values:a,refreshData:i}=e,[o,r]=Object(n.useState)(!1),l=Object(n.useMemo)((()=>a.map(s)),[s,a]);Object(n.useEffect)((()=>{o&&t&&(t(l),r(!1))}),[l,o,t]);return{requestUpdate:Object(n.useCallback)((()=>{i(),r(!0)}),[i])}}},YSVG:function(e,t,s){"use strict";var n=s("ERkP"),a=s.n(n),i=s("tN4z"),o=s("EGyI"),r=s("E1pj"),l=s("myse"),c=s("0x+l"),u=s("8jBL"),d=s("IbyE"),p=s("ZQFV"),h=s("UJ5P"),m=s("np6O"),b=s("/n7R"),g=s("SFo1"),f=s("AoSC"),v=s("zGdY");s.d(t,"a",(function(){return w}));const w="question-header__title";class y extends n.Component{constructor(e){super(e),this.titleRef=a.a.createRef(),this.handlePointsClick=()=>{this.canEnterEditMode&&this.props.onPointsClick()},this.handleOpenGoalsIconClick=()=>{this.props.openGoals&&this.props.hasQuestionEditPermissions&&!this.props.hasSubmissions&&this.props.openGoals()},this.onFullCreditChange=(e,t)=>{this.props.onQuestionChange({...this.props.question,fullCredit:t})},this.onPointsChange=e=>{let t=!0;const s={...this.props.question};if(d.N.isQuestionBlock(s)){s.pointsPerQuestion===e?t=!1:s.pointsPerQuestion=e}else s.points=e;t&&this.props.onQuestionChange(s)},this.renderRegradeCheckbox=()=>{var e;const{editMode:t,hasQuestionEditPermissions:s,hasSubmissions:n,hideFullCreditCheckbox:o,t:r,question:l,UltraWindowSize:c,focusTitle:u}=this.props,{showFullCreditCheckboxWhenNoSubmissions:d}=this.state,p=r("assessments.canvas.question.header.fullCredit"),m=h.a.ACTIVE===t,b=c.isSmallBreakpoint();if(o||!s||!m)return null;if(!n&&!d)return null;const g=!u&&(!b||Object(f.i)(l));return a.a.createElement("div",{className:"question-header__full-credit"},a.a.createElement(i.AnalyticsFormControlLabel,{analyticsId:"questionPools.fullCredit.checkBox",label:p,"aria-label":p,className:"full-credit-checkBox",htmlFor:"question-pools-full-credit-checkBox",control:a.a.createElement(i.AnalyticsCheckbox,{id:"question-pools-full-credit-checkBox",onChange:this.onFullCreditChange,checked:null!==(e=l.fullCredit)&&void 0!==e&&e,analyticsId:"questionPools.fullCredit.checkBox",autoFocus:g})}))},this.renderRegradeInfo=()=>{const{editMode:e,t,question:s}=this.props,n=h.a.ACTIVE===e,i=null==s?void 0:s.fullCredit,o=!n&&i,r=o?a.a.createElement("span",{className:"question-header__full-credit-label"},t("assessments.canvas.question.header.fullCreditLabel")):null;return o?r:this.renderRegradeCheckbox()},this.renderExtraCreditInfo=()=>{const{editMode:e,extraCreditVisibility:t,question:s,questionVisibleNumber:n,onQuestionChange:i,UltraWindowSize:o,hasSubmissions:r,hideFullCreditCheckbox:l,focusTitle:c}=this.props;let u=!1;if(!o.isSmallBreakpoint()&&!c){const{showFullCreditCheckboxWhenNoSubmissions:e}=this.state;u=!(r||e)||l}return a.a.createElement(g.a,{question:s,questionVisibleNumber:n,onQuestionChange:i,editMode:e,extraCreditVisibility:t,hasFocus:u})},this.state={showFullCreditCheckboxWhenNoSubmissions:e.giveFullCredit}}static getDerivedStateFromProps(e){return h.a.INACTIVE!==e.editMode||e.giveFullCredit||e.hasSubmissions?null:{showFullCreditCheckboxWhenNoSubmissions:!1}}componentDidMount(){this.props.focusTitle&&this.titleRef.current&&this.titleRef.current.focus()}componentDidUpdate(e){const{focusTitle:t}=this.props,{focusTitle:s}=e;!s&&t&&this.titleRef.current&&this.titleRef.current.focus()}get canEnterEditMode(){return this.props.onPointsClick&&this.props.canEnterEditMode}getGrade(){const{points:e,question:t}=this.props;return{value:e,unit:d.N.isQuestionBlock(t)?p.t.PointsEach:p.t.Points}}renderPointsInfo(){const{editMode:e,hasQuestionEditPermissions:t,id:s,question:n,t:i,questionTitle:o,showPointsInfo:r,hideEditPoints:c,analyticsEventAugmentor:u,disableInteraction:m,assessmentType:b,readonlyPoints:g}=this.props;if(!1!==r){const r=!!m||void 0,f=`question-points-${s}`,w=h.a.ACTIVE===e,y=!t,E=t&&!w,C=g&&!w,x=t&&w,O=d.N.isQuestionBlock(n),T=()=>{const e="assessments.canvas.question.header.edit.ariaLabel."+(O?"block":"question"),t=i(e,{questionTitle:o}),s=this.canEnterEditMode?"question-header__pill--clickable":"",n=`${e}.gradepill`,c=u(l.AnalyticsEventTypes.CLICK_EVENT,this.handlePointsClick,e),{value:d,unit:h}=this.getGrade();return a.a.createElement(a.a.Fragment,null,C?a.a.createElement("span",{className:"question-header__readonly-pill-wrapper"},a.a.createElement(p.I,{grade:d,variant:p.p.UnitBased,unit:h})):a.a.createElement("span",{"data-analytics-id":e,id:f,onClick:c,className:`question-header__pill-wrapper ${s}`},a.a.createElement(p.o,{variant:p.p.UnitBased,grade:d,unit:h,ariaLabel:t,ariaHidden:r,ariaDescribedBy:f,analyticsId:n})))},k=()=>{const{focusTitle:e,UltraWindowSize:t}=this.props,n=`points-input${s}`,{value:l,unit:c}=this.getGrade(),u="assessments.canvas.question.header.edit.ariaLabel."+(O?"block":"question"),d=i(u,{questionTitle:o}),h=`${u}.gradepill`,m=t.isSmallBreakpoint(),g=!e&&(m||O);return a.a.createElement("div",{className:"question-header__points"},a.a.createElement(p.o,{id:n,variant:p.p.UnitBased,grade:l,emptyGradeNotAllowed:b!==v.h.Pool,unit:c,onBlur:this.onPointsChange,hasFocus:g,ariaLabel:d,ariaHidden:r,analyticsId:h}))};if(y||E)return T();if(x&&!c)return k()}return null}renderSmallBreakpoint(e){const{editMode:t,question:s}=this.props,n=h.a.ACTIVE===t,i=null==s?void 0:s.fullCredit,o=null==s?void 0:s.extraCredit;return n?a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:"question-header__column question-header__first-column"},e,this.renderPointsInfo()),a.a.createElement("div",{className:"question-header__column question-header__secondary-edition-column"},this.renderRegradeInfo(),this.renderExtraCreditInfo())):i||o?a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:"question-header__column question-header__first-column"},e,this.renderExtraCreditInfo(),this.renderPointsInfo()),a.a.createElement("div",{className:"question-header__column question-header__secondary-column"},this.renderRegradeInfo())):a.a.createElement(a.a.Fragment,null,e,this.renderPointsInfo())}render(){const{disableFocus:e,disableInteraction:t,editMode:s,goalAriaLabel:n,hasAlignedGoals:i,question:o,t:r,UltraWindowSize:l}=this.props,p=h.a.ACTIVE===s,g=d.N.isQuestionBlock(o),v=p?"question-header__edit":"",y=l.isSmallBreakpoint(),E=a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:"question-header__title-container"},a.a.createElement("h3",{id:`${w}${this.props.id}`,className:"question-header__title",ref:this.titleRef,tabIndex:-1},this.props.questionTitle),Object(f.i)(this.props.question)&&a.a.createElement(b.AnalyticsTooltip,{analyticsId:"assessments.canvas.question.header.linkedQuestionIcon.tooltip",title:r("assessments.canvas.question.header.linkedQuestionIcon.tooltipText"),placement:"top",classes:{popper:"question-header__tooltip-popper"}},a.a.createElement(m.AnalyticsIconButton,{analyticsId:"assessments.canvas.question.header.linkedQuestionIcon.button","aria-label":r("assessments.canvas.question.header.linkedQuestionIcon.ariaLabel")},a.a.createElement(c.Link,null))),g&&!p&&a.a.createElement("div",{className:"question-header__pool-indicator"},r("assessments.canvas.question.header.poolIndicator"))),i&&a.a.createElement(m.AnalyticsIconButton,{className:"question-header__goal-icon-button",onClick:this.handleOpenGoalsIconClick,"aria-label":n,disabled:e,"aria-hidden":t?"true":void 0,tabIndex:t?-1:0,analyticsId:"assessments.canvas.question.header.goalIcon.button"},a.a.createElement(u.Goal,null)));return a.a.createElement("div",{className:`question-header question-header__regrading ${v}`},y&&a.a.createElement(a.a.Fragment,null,this.renderSmallBreakpoint(E)),!y&&a.a.createElement(a.a.Fragment,null,E,this.renderRegradeInfo(),this.renderExtraCreditInfo(),this.renderPointsInfo()))}}const E=Object(o.a)(y);t.b=Object(r.windowResizingResponsiveComponentWrapper)(Object(l.withAnalytics)(E))},YUDX:function(e,t,s){"use strict";s.d(t,"f",(function(){return o})),s.d(t,"d",(function(){return r})),s.d(t,"e",(function(){return l})),s.d(t,"g",(function(){return c})),s.d(t,"h",(function(){return u})),s.d(t,"k",(function(){return d})),s.d(t,"j",(function(){return p})),s.d(t,"i",(function(){return h})),s.d(t,"a",(function(){return m})),s.d(t,"b",(function(){return b})),s.d(t,"c",(function(){return g}));var n=s("P+Wz");const a=e=>(null==e?void 0:e.altKey)?1:10,i=(e,t)=>{switch(e){case n.Key.ArrowLeft:return{left:-1*t};case n.Key.ArrowUp:return{top:-1*t};case n.Key.ArrowRight:return{left:t};case n.Key.ArrowDown:return{top:t};default:return{}}},o=e=>e===n.Key.Backspace||e===n.Key.Delete,r=e=>e===n.Key.ArrowLeft||e===n.Key.ArrowRight||e===n.Key.ArrowUp||e===n.Key.ArrowDown,l=e=>"c"===e.key,c=e=>"p"===e.key,u=e=>"r"===e.key,d=e=>(null==e?void 0:e.key)===n.Key.Tab,p=e=>d(e)&&!(null==e?void 0:e.shiftKey),h=e=>d(e)&&(null==e?void 0:e.shiftKey),m=e=>(null==e?void 0:e.shiftKey)?((e,t)=>{switch(e){case n.Key.ArrowLeft:return{width:-1*t};case n.Key.ArrowUp:return{height:-1*t};case n.Key.ArrowRight:return{width:t};case n.Key.ArrowDown:return{height:t};default:return{}}})(null==e?void 0:e.key,a(e)):i(null==e?void 0:e.key,a(e)),b=e=>i(null==e?void 0:e.key,a(e)),g=e=>i(null==e?void 0:e.key,a(e))},YuUd:function(e,t,s){"use strict";var n=s("ERkP"),a=s.n(n),i=s("uxze"),o=s("zDAW"),r=s("pNgc"),l=s("AuQm");const c="question-block",u="assessments.canvas.question.questionBlock";var d=s("AoSC"),p=s("VQ4P");const h=e=>{-1!==e.clipboardData.getData("Text").indexOf(".")&&(e.preventDefault(),e.stopPropagation())};var m=e=>{var t;const{hasSubmissions:s,onQuestionChange:n,openPoolQuestionPanel:m,question:b,questionBeingEditedId:g}=e,f=Object(p.a)(),v=`question-block-display-questions-${b.id}`,w=f(`${u}.displayQuestions.invalid`),y=b.numOfQuestionsToChoose>=0&&b.numOfQuestionsToChoose<=b.numOfAvailableQuestions,E=a.a.useCallback((e=>{let t;t=Number.isInteger(e)?e:null==e?0:b.numOfQuestionsToChoose,n({...b,numOfQuestionsToChoose:t})}),[b,n]);return a.a.createElement("div",{className:`${c} ${c}--edit`},a.a.createElement("div",{className:`${c}__content`},a.a.createElement("div",{className:`${c}__editables-wrapper`},a.a.createElement("div",{className:`${c}__editables-details`},a.a.createElement(r.a,{className:`${c}__icon`,color:"primary"}),a.a.createElement("div",{className:`${c}__content-description-wrapper`},a.a.createElement("div",{className:`${c}__content-description`},f(`${u}.description.edit.plural`,{questionsTotal:b.numOfAvailableQuestions})),a.a.createElement(i.Link,{disabled:Object(d.z)(b)||g!==b.id,onClick:()=>m(b.id),analyticsId:"questionBlockQuestionEdit.poolQuestionPanel.open.link"},f(`${u}.viewQuestions`,{questionsTotal:b.numOfAvailableQuestions})))),a.a.createElement("div",{className:`${c}__editables-divider`}),a.a.createElement("div",{className:`${c}__display-questions-wrapper`},a.a.createElement(o.Label,{className:`${c}__display-questions-label`,htmlFor:v},f(`${u}.displayQuestions.label`)),a.a.createElement(l.G,{className:`${c}__display-questions-input-wrapper`,helperText:y?"":w,validate:()=>y,id:v,min:0,onPaste:h,onChange:E,value:null!==(t=b.numOfQuestionsToChoose)&&void 0!==t?t:0,disabled:s,analyticsId:"questionBlockQuestionEdit.displayQuestionsInput.textField",hideErrorMessage:!0})))))};var b=e=>{const t=Object(p.a)();return a.a.createElement("div",{className:`${c} ${c}--read`},a.a.createElement("div",{className:`${c}__content`},a.a.createElement(r.a,{className:`${c}__icon`,color:"primary"}),a.a.createElement("div",{className:`${c}__content-description-wrapper`},a.a.createElement("div",{className:`${c}__content-description`},t(`${u}.description.read.plural`,{questionsDisplayed:e.question.numOfQuestionsToChoose,questionsTotal:e.question.numOfAvailableQuestions})),a.a.createElement(i.Link,{className:`${c}__view-questions-link`,disabled:null!=e.questionBeingEditedId,onClick:()=>(({question:e,openPoolQuestionPanel:t,addQuestionsToEmptyPool:s})=>{e.numOfAvailableQuestions>0?t(e.id):s(e.id)})(e),analyticsId:"assessments.question.question-block-question.read"},t(`${u}.viewQuestions`,{questionsTotal:e.question.numOfAvailableQuestions})))))},g=s("g27D"),f=s("UJ5P"),v=s("NH8g"),w=s("7k4i"),y=s("+phe"),E=s("GR+8"),C=s("SFo1");var x=Object(w.a)(Object(E.a)((e=>{const t=t=>{e.onQuestionChange(t,d.m)},s={...e,onQuestionChange:t},n=f.a.ACTIVE===e.editMode,i=e.localize.translate(`${u}.editTitle`),o={...Object(v.b)(e,t),...n&&{questionTitle:i},hideFullCreditCheckbox:!0,points:e.question.pointsPerQuestion,extraCreditVisibility:C.b.Hidden};return a.a.createElement(a.a.Fragment,null,a.a.createElement(g.a,{editMode:e.editMode,question:e.question},a.a.createElement(v.a,{...o}),a.a.createElement(y.a,{...Object(y.b)(e)})),n?a.a.createElement(m,{...s}):a.a.createElement(b,{...s}))})));s.d(t,"a",(function(){return x}))},ZQN4:function(e,t,s){"use strict";s.d(t,"b",(function(){return n})),s.d(t,"c",(function(){return a})),s.d(t,"e",(function(){return i})),s.d(t,"d",(function(){return o})),s.d(t,"a",(function(){return l}));const n="noPartialCredit",a="partialCreditNoPenalty",i="partialCreditWithPenalty",o="partialCreditOverallNegative",r=[{key:a},{key:n},{key:i},{key:o}];function l({allowPartialCredit:e,allowNegativeScoreForIncorrectAnswers:t,allowNegativeOverallScore:s}){return e?s?r.find((e=>e.key===o)):t?r.find((e=>e.key===i)):r.find((e=>e.key===a)):r.find((e=>e.key===n))}},Zbp7:function(e,t,s){"use strict";var n=s("ERkP"),a=s.n(n),i=s("Agfx");const o=Object(i.makeStyles)((e=>Object(i.createStyles)({root:{display:"flex",flexDirection:"row",alignItems:"center",borderLeft:`1px solid ${e.palette.border.main}`,[e.breakpoints.up("sm")]:{borderLeft:"none","& > div":{borderLeft:`1px solid ${e.palette.border.main}`}}}})));s.d(t,"a",(function(){return r}));const r=e=>{const t=o();return a.a.createElement("div",{className:t.root},e.children)}},b2gR:function(e,t,s){"use strict";s.d(t,"b",(function(){return l}));var n=s("ERkP"),a=s.n(n),i=s("ekqz"),o=s("UJ5P"),r=s("YSVG");const l=(e,t)=>{const{localize:s,localizationPrefix:n,question:a,questionTitle:i,fileUploadSettings:o}=e,l=`${r.a}${a.id}`,c=s.translate(`${n}.canvas.question.placeholder.question`,{questionTitle:i||""});return{activeEditorId:e.activeEditorId,ariaLabelledBy:l,courseId:e.courseId,disableFocus:e.disableFocus,editMode:e.editMode,placeholderText:c,plugins:e.editorPlugins,pluginsConfig:e.pluginsConfig,onChange:t,question:a,refreshBbml:e.refreshBbml,setActiveEditorId:e.setActiveEditorId,supportsInlineDocumentRender:e.supportsInlineDocumentRender,fileUploadSettings:o}};t.a=({activeEditorId:e,ariaLabelledBy:t,disableEditor:s,courseId:n,disableFocus:r,editMode:l,editorPlugins:c,placeholderText:u,onChange:d,pluginsConfig:p,question:h,refreshBbml:m,setActiveEditorId:b,supportsInlineDocumentRender:g,fileUploadSettings:f})=>{var v;const w=o.a.INACTIVE===l||!!s;return a.a.createElement("div",{className:"question-text"},a.a.createElement(i.b,{activeEditorId:e,ariaLabelledBy:t,ariaRequired:!0,bbml:null===(v=h.questionText)||void 0===v?void 0:v.rawText,courseId:n,disableFocus:r,id:h.id,isReadOnly:w,keepToolbarVisible:!1,onChange:e=>{const t={...h,questionText:{rawText:e.toBbML()},applyAsyncPlugins:{...h.applyAsyncPlugins,questionText:async()=>({questionText:{rawText:await e.toBbML(!0)}})}};null==d||d(t)},placeholder:u,plugins:c,pluginsConfig:p,refreshBbml:m,setActiveEditorId:b,supportsInlineDocumentRender:g,fileUploadSettings:f}))}},"bJi+":function(e,t,s){"use strict";var n=s("b2gR");s.d(t,"a",(function(){return n.a})),s.d(t,"b",(function(){return n.b}))},cexh:function(e,t,s){"use strict";s.d(t,"a",(function(){return l})),s.d(t,"d",(function(){return c})),s.d(t,"e",(function(){return d})),s.d(t,"c",(function(){return p})),s.d(t,"b",(function(){return h}));var n=s("vymd"),a=s("nsO7"),i=s.n(a),o=s("zGdY"),r=s("E0B1");const l=e=>e.join(","),c=e=>l(i.a.flatMap(e,(e=>[e.x,e.y]))),u=({learnCoordinates:e,minCoordsCount:t,coordsExactCount:s,objectName:n,coordinatesMapper:a})=>{const i=e.split(",");if(s&&i.length!==s)throw new Error(`Hotspot ${n} coordinates must have exactly ${s} values. Received ${e}`);if(t&&i.length<t)throw new Error(`Hotspot ${n} coordinates must have at least ${t} values. Received ${e}`);return a(i.map(parseFloat))},d=e=>u({learnCoordinates:e,objectName:"pin",coordsExactCount:2,coordinatesMapper:e=>({left:e[0],top:e[1]})}),p=e=>{switch(e.type){case n.a.HotspotRectangle:return(e=>{if(e.aCoords){const{tl:t,br:s}=e.aCoords,n=t.x,a=t.y,i=s.x-r.i.strokeWidth,o=s.y-r.i.strokeWidth;return l([n,a,i,o])}throw new Error(`Error getting Learn rectangular coordinates. FabricJS object missing coordinate info: ${e}`)})(e);case n.a.HotspotPin:return(e=>{const t=e.getCenterPoint();return l([t.x,t.y])})(e);case n.a.HotspotPolygon:return c(e.points);case n.a.HotspotCircle:return(e=>{const{x:t,y:s}=e.getCenterPoint();return l([t,s,e.getRadius()])})(e);default:throw new Error(`Error getting Learn coordinates. FabricJS object hotspot type not supported: ${e}`)}},h=(e,t)=>{switch(t){case o.Q.Rectangle:return(e=>u({learnCoordinates:e,coordsExactCount:4,objectName:"rectangle",coordinatesMapper:e=>{const t=e[0],s=e[1];return{left:t,top:s,width:e[2]-t,height:e[3]-s}}}))(e);case o.Q.Polygon:return(e=>u({learnCoordinates:e,objectName:"polygon",minCoordsCount:r.n,coordinatesMapper:e=>({coords:Object(a.chunk)(e,2).map((e=>({x:e[0],y:e[1]})))})}))(e);case o.Q.Circle:return(e=>u({learnCoordinates:e,objectName:"circle",coordsExactCount:3,coordinatesMapper:e=>({left:e[0]-e[2]-r.f.strokeWidth/2,top:e[1]-e[2]-r.f.strokeWidth/2,radius:e[2]})}))(e);default:throw new Error(`Error getting Hotspot coordinates. Hotspot type not supported: ${t}`)}}},cw3y:function(e,t,s){"use strict";s.d(t,"g",(function(){return a})),s.d(t,"a",(function(){return i})),s.d(t,"e",(function(){return o})),s.d(t,"f",(function(){return r})),s.d(t,"d",(function(){return l})),s.d(t,"b",(function(){return c})),s.d(t,"c",(function(){return u}));var n=s("IbyE");function a(e){return e.prompts.filter((e=>!e.reusesAnswer)).filter((t=>e.answers[t.matchingAnswerIndex]&&""!==e.answers[t.matchingAnswerIndex].answerText.rawText)).map((t=>e.answers[t.matchingAnswerIndex]))}function i(e){const t={};return e.prompts.forEach(((s,n)=>{if(!s.reusesAnswer&&null!=s.matchingAnswerIndex){const a=e.answers[s.matchingAnswerIndex];a&&(t[a.ui.id]=n)}})),t}function o(e,t){const s=e.prompts.map((e=>e.matchingAnswerIndex>t?{...e,matchingAnswerIndex:e.matchingAnswerIndex-1}:e));return{...e,prompts:s,answers:[...e.answers.slice(0,t),...e.answers.slice(t+1)]}}function r(e,t){const s=e.prompts,a=e.answers,i=s.findIndex((e=>e.id===t)),o=s[i],r=o.matchingAnswerIndex;let l=[...a],c=s.filter((e=>e.id!==t));return o.reusesAnswer||(l=[...l.slice(0,r),...l.slice(r+1)],c=c.map((e=>e.reusesAnswer&&e.matchingAnswerIndex===r?(l.push(n.N.createMatchingAnswer(!1)),{...e,reusesAnswer:!1,matchingAnswerIndex:l.length-1}):e.matchingAnswerIndex>r?{...e,matchingAnswerIndex:e.matchingAnswerIndex-1}:e))),{...e,prompts:c,answers:l}}function l(e,t){const s=e.prompts.find((e=>e.id===t));if(null==s?void 0:s.reusesAnswer)return!1;return e.prompts.findIndex((e=>!0===e.reusesAnswer&&e.matchingAnswerIndex===(null==s?void 0:s.matchingAnswerIndex)))>-1}function c(e){return`answer-${e}`}function u(e){return`prompt-${e}`}},czSG:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));const n=(e,t)=>{if(e===t)return!1;const s=(e||"").split(",").map(parseFloat),n=(t||"").split(",").map(parseFloat);return s.some(((e,t)=>Math.abs(e-n[t])>.001))}},ekqz:function(e,t,s){"use strict";var n=s("ERkP"),a=s.n(n),i=s("ERsv"),o=s("GR+8"),r=s("IbyE"),l=s("33wY");s.d(t,"a",(function(){return c}));const c="bb-editor-wrapper";class u extends n.Component{constructor(e){super(e),this.ref=null,this.focusEditor=()=>{const e=this.ref.querySelector(".bb-editor");e&&e.focus()},this.updateEditorStyle=()=>{const e=this.ref.classList;this.props.isReadOnly?e.add("read-only"):e.remove("read-only")},this.onEditorBlur=()=>{this.setState((()=>({hasFocus:!1})),this.props.setActiveEditorId(null)),this.props.onBlur&&this.props.onBlur()},this.onEditorFocus=()=>{const{id:e,setActiveEditorId:t}=this.props;this.setState((()=>({hasFocus:!0})),t(e)),this.props.onFocus&&this.props.onFocus()},this.onTextChange=e=>{this.props.refreshBbml||this.props.onChange(e)},this.isToolbarHidden=()=>{const{keepToolbarVisible:e}=this.props;return!e&&!this.state.hasFocus},this.state={ally:this.buildAlly(),bbml:e.bbml,hasFocus:!1,plugins:this.buildPlugins()}}componentDidMount(){this.setState((()=>({bbml:null}))),this.updateEditorStyle()}UNSAFE_componentWillReceiveProps(e){e.refreshBbml?this.setState((()=>({bbml:e.bbml}))):null!==this.state.bbml&&this.setState((()=>({bbml:null})))}shouldComponentUpdate(e){return!e.id||!e.activeEditorId||e.id===e.activeEditorId}componentDidUpdate(e,t){var s,n;this.updateEditorStyle();this.props.id===this.props.activeEditorId&&!t.hasFocus&&this.focusEditor();const a=["babelfishInstance","babelfishFormatInstance","courseId","currentLocale","pluginsConfig","plugins","fileUploadSettings"].some((t=>e[t]!==this.props[t])),i=(null===(s=this.props.ally)||void 0===s?void 0:s.service)!==(null===(n=e.ally)||void 0===n?void 0:n.service);(i||a)&&this.setState({...i?{ally:this.buildAlly()}:null,...a?{plugins:this.buildPlugins()}:null})}buildAlly(){const{service:e}=this.props.ally;return{allyService:e,indexMap:new Map}}buildPlugins(){const{localize:{babelfish:e,babelfishFormat:t,locale:s},courseId:n,pluginsConfig:a,plugins:o,fileUploadSettings:l}=this.props,c={apiBasePath:r.kb.apiBasePath,babelfishFormatInstance:t,babelfishInstance:e,locale:s,xsrfToken:r.kb.xsrf,fileUploadSettings:l},u=[...o,...!1!==(null==a?void 0:a.attachment)?[Object(i.insertLocalFile)({courseId:n,...c,supportsInlineDocumentRender:this.props.supportsInlineDocumentRender})]:[],Object(i.link)(),Object(i.image)(),Object(i.video)(),Object(i.math)({...c,courseId:n})];return a&&a.contentMarket&&u.push(Object(i.contentMarket)({...a.contentMarket,...c})),a&&a.insertCloudStorageIntegrationFile&&u.push(Object(i.insertCloudStorageIntegrationFile)({...a.insertCloudStorageIntegrationFile,...c})),a&&a.insertYoutubeVideo&&u.push(Object(i.insertYoutubeVideo)({...a.insertYoutubeVideo,...c})),u}render(){const{ally:e,courseId:t,id:s,localize:n,pluginsConfig:o,...r}=this.props,{ally:l,bbml:u,hasFocus:d,plugins:p}=this.state,h=d?this.props:r,m=`bb-editor${s}`;return a.a.createElement("div",{ref:e=>{this.ref=e},className:c},a.a.createElement(i.BbEditor,{...h,ariaDescribedBy:m,bbml:u,editorId:m,isToolbarHidden:this.isToolbarHidden(),onBlur:this.onEditorBlur,onChange:this.onTextChange,onFocus:this.onEditorFocus,plugins:p,rootContentId:e.contentId,ally:l,supportsInlineDocumentRender:this.props.supportsInlineDocumentRender}))}}u.defaultProps={plugins:[],keepToolbarVisible:!1,toolbarSet:"default"};t.b=Object(l.b)(Object(o.a)(u))},g27D:function(e,t,s){"use strict";var n=s("ERkP"),a=s.n(n),i=s("UJ5P"),o=s("AoSC"),r=s("65tE");var l=({editMode:e,question:t,children:s})=>{const n=i.a.ACTIVE===e;return a.a.createElement("div",{className:Object(r.a)(`\n                    base-question\n                    ${n?"base-question--edit":"base-question--read"}\n                    ${Object(o.z)(t)?"js-new-question":""}\n                `)},a.a.createElement("div",{className:"base-question__content"},s))};s.d(t,"a",(function(){return l}))},hLhy:function(e,t,s){"use strict";var n=s("ERkP"),a=s.n(n),i=s("MC1S"),o=s("IbyE"),r=s("ERsv"),l=s("nsO7"),c=s("AoSC"),u=s("K9sL"),d=s("g27D"),p=s("UJ5P"),h=s("sptZ"),m=s("NH8g"),b=s("7k4i"),g=s("+phe"),f=s("ym5S"),v=s("bJi+"),w=s("5O/A"),y=s("65tE"),E=s("4raK"),C=s("FKP/"),x=s("ZQN4"),O=s("GR+8"),T=s("6Nff"),k=s("8jLo");class S extends n.Component{constructor(e){var t;super(e),this.QuestionRef=a.a.createRef(),this.getTranslatedIdentifier=e=>this.state.translatedIdentifiersMap[e]||e,this.textContainsClosedBracketsWithTextInside=e=>{const t=e.match(/\[(.*)\]/i);return null!==t&&""!==t[1]},this.validate=(e,t,s,n,a,i)=>{const o=e.points!==t.points,r=Object(c.g)(e,t),u=n.rawText;return!(r||o||Object(c.z)(t)||!u||u!==a.rawText||!Object(c.b)(e,t))||!1!==i&&(!Object(l.isEqual)(e,t)||(this.props.hasSubmissions?o?Object(c.q)(s.points,t.points):r:Object(c.q)(s.points,t.points)))},this.onQuestionChange=e=>{const{originalDisplayQuestionText:t,isAnswersEditMode:s}=this.state,n=this.props.question.questionText;let a;"function"==typeof e.applyAsyncPlugins?a=e.applyAsyncPlugins:"object"==typeof e.applyAsyncPlugins&&(a={...e.applyAsyncPlugins}),this.props.onQuestionChange({...e,questionText:n,applyAsyncPlugins:a},((n,a,i)=>this.validate(n,a,i,t,e.questionText,s))),this.setState({isValidTemplate:this.textContainsClosedBracketsWithTextInside(e.questionText.rawText),displayQuestionText:e.questionText,applyAsyncPlugins:a})},this.onTranslate=(e,t,s,n,a)=>{this.setState((s=>({isAnswersEditMode:a,disableAnswersTextFields:!a,displayQuestionText:{rawText:e},translatedIdentifiersMap:{...s.translatedIdentifiersMap,...t}})),(()=>this.refreshBbml()))},this.translateIdent=e=>{const{localize:{translate:t}}=this.props;return t("assessments.canvas.question.fimb.blank",{count:e.split("-")[1]})},this.onScoringOptionsChange=e=>{const{question:t}=this.props,s={...t,...e};this.onQuestionChange(s)},this.translateQuestion=(e,t,s,n)=>{let a=e;const i={...s},o=[];return t.forEach((e=>{if(i[e.ident]){const t=i[e.ident];a=a.replace(e.ident,t)}else{const t=this.translateIdent(e.ident);a=a.replace(e.ident,t),i[e.ident]=t,o.push(t)}})),Promise.all(o).then((()=>{this.onTranslate(a,i,e,t,n)}))},this.parseQuestionText=()=>{const e={courseId:this.props.courseId,assessmentId:this.props.question.assessmentId};let t=this.props.question;return t.applyAsyncPlugins||(t={...this.props.question,questionText:{rawText:this.state.displayQuestionText.rawText},applyAsyncPlugins:{...t.applyAsyncPlugins,questionText:async()=>({...t,questionText:{rawText:this.state.displayQuestionText.rawText}})}}),Object(k.a)(t).then((t=>(this.setState({displayQuestionText:t.questionText,applyAsyncPlugins:void 0,refreshBbml:!0},(()=>this.setState({refreshBbml:!1}))),Object(o.Ub)(t.questionText,e))))},this.refreshBbml=()=>{this.setState({refreshBbml:!0},(()=>this.setState({refreshBbml:!1})))},this.removeIdentifierWrappersInQuestionText=e=>{var t;const s=document.createElement("div");s.innerHTML=e;const n=s.querySelectorAll("a[data-bbfile]");if(null!=n&&n.length>0)for(let e=0;e<n.length;e+=1){const s=n[e];-1!==(null===(t=s.getAttribute("data-bbfile"))||void 0===t?void 0:t.indexOf("fimb-answer-value"))&&(s.outerHTML=s.innerHTML)}return s.innerHTML},this.replaceQuestionTextWithAnswers=(e,t)=>{let s=this.removeIdentifierWrappersInQuestionText(e);return t.forEach((e=>{const t=e.answerValues.map((e=>e.value)).join(w.a),n=this.getTranslatedIdentifier(e.ident);s=s.replace(n,t)})),s},this.toggleAnswersEditMode=()=>{this.state.isAnswersEditMode?this.setAnswersEditModeOff():this.setAnswersEditModeOn()},this.setAnswersEditModeOff=()=>{this.translateQuestion(this.props.question.questionText.rawText,this.props.question.answers,{},!1).then((()=>{this.setState(((e,t)=>({isAnswersEditMode:!1,disableAnswersTextFields:!0,displayQuestionText:{rawText:this.replaceQuestionTextWithAnswers(e.displayQuestionText.rawText,t.question.answers)}})),this.refreshBbml),this.props.onQuestionChange(this.props.question,(()=>!1))}))},this.preserveAnswersSetup=e=>e.answers.map(((e,t)=>({...e,answerValues:e.answerValues.map((e=>{const s=this.props.question.answers[t];return s?{...e,evaluationType:s.answerValues[0].evaluationType,caseSensitive:s.answerValues[0].caseSensitive}:e}))}))),this.setAnswersEditModeOn=()=>{const{question:e,hasSubmissions:t}=this.props;return this.parseQuestionText().then((s=>{var n;const a=s.answers.length!==e.answers.length;if(t&&a)return void this.setState({regradingError:!0},(()=>{this.QuestionRef.current.scrollIntoView({behavior:"smooth",block:"start"})}));!0===this.state.regradingError&&this.setState({regradingError:!1});const i={...e,answers:this.preserveAnswersSetup(s),questionText:{...e.questionText,rawText:s.replacedQuestionText},applyAsyncPlugins:this.state.applyAsyncPlugins};(null===(n=i.questionText)||void 0===n?void 0:n.webLocation)&&delete i.questionText.webLocation,this.props.onQuestionChange(i,(e=>!Object(l.isEqual)(e,i)),(()=>{this.translateQuestion(s.replacedQuestionText,s.answers,this.state.translatedIdentifiersMap,!0)}))}))},this.startEditMode=e=>{this.props.startEditMode((()=>{this.setState(((e,t)=>{const s={rawText:this.replaceQuestionTextWithAnswers(e.displayQuestionText.rawText,t.question.answers)},n={originalDisplayQuestionText:s,displayQuestionText:s};return e.isAnswersEditMode&&(n.isAnswersEditMode=!1,n.disableAnswersTextFields=!0),n}),(()=>{this.refreshBbml(),e&&e()}))}))},this.onAnswerChange=e=>{const{question:t,onQuestionChange:s}=this.props,n=t.answers.map((t=>t.ident===e.ident?e:t)),a={...t,answers:n},i=a.answers.some((e=>!e.answerValues.some((e=>e.value))));s(a,(()=>!i))},this.dismissRegradingError=()=>{this.setState({regradingError:!1})},this.state={isValidTemplate:this.textContainsClosedBracketsWithTextInside(null===(t=e.question.questionText)||void 0===t?void 0:t.rawText),isAnswersEditMode:!1,disableAnswersTextFields:!0,refreshBbml:!1,translatedIdentifiersMap:{},displayQuestionText:{rawText:""},originalDisplayQuestionText:{rawText:""},regradingError:!1};const s=this.props.question;if(s&&s.questionText&&s.answers&&s.answers.length>0){const e=this.translateQuestion(s.questionText.rawText,s.answers,{},!1);p.a.ACTIVE===this.props.editMode&&e.then((()=>{this.setState((e=>({displayQuestionText:{rawText:this.replaceQuestionTextWithAnswers(e.displayQuestionText.rawText,s.answers)}})),(()=>{this.refreshBbml()}))}))}}static getDerivedStateFromProps(e,t){if(e.refreshBbml){let s=e.question.questionText.rawText;return e.question.answers.forEach((e=>{const n=t.translatedIdentifiersMap[e.ident];s=s.replace(e.ident,n)})),{...t,displayQuestionText:{rawText:s},regradingError:!1}}return null}render(){const{isValidTemplate:e,isAnswersEditMode:t,disableAnswersTextFields:s,regradingError:n}=this.state,{assessmentId:o,detailsHidden:l,questionTitle:b,question:O,readonlyPoints:k,assessmentType:S,extraCreditVisibility:q,localize:{translate:A}}=this.props,P=p.a.ACTIVE===this.props.editMode,I=!l||P,j={...this.props.question,questionText:this.state.displayQuestionText},F=A("assessments.canvas.question.fimb.regradingErrorMessage"),N=P&&Object(c.i)(this.props.question),D=P&&!t,_=[{key:x.b},{key:x.c}],R=a.a.createElement(C.a,{question:this.props.question,onScoringOptionsChange:this.onScoringOptionsChange,editMode:this.props.editMode,isAnswersEditMode:t,options:_,translationKeyPrefix:"assessments.canvas.question.multipleAnswer.scoringOptions"});return a.a.createElement("div",{className:"fimb-question "+(P?"fimb-question--edit":"fimb-question--read"),ref:this.QuestionRef},n&&a.a.createElement(i.Notification,{type:i.NotificationType.Failure,message:F,onClose:this.dismissRegradingError}),a.a.createElement(d.a,{editMode:this.props.editMode,question:j},I?a.a.createElement(a.a.Fragment,null,a.a.createElement(m.a,{...Object(m.b)(Object(T.c)(this.props,A),this.onQuestionChange),question:j,onPointsClick:this.startEditMode}),a.a.createElement(h.a,{question:this.props.question,show:N})):a.a.createElement(E.a,{question:O,questionTitle:b,readonlyPoints:k,extraCreditVisibility:q}),a.a.createElement(g.a,{...Object(g.b)(this.props),startEditMode:this.startEditMode}),I?a.a.createElement(a.a.Fragment,null,a.a.createElement(f.a,{instructions:A("assessments.canvas.question.fimb.instructions"),show:D}),a.a.createElement(v.a,{...Object(v.b)(this.props,this.onQuestionChange),disableEditor:t,editorPlugins:[Object(r.customClass)()],question:j,refreshBbml:this.state.refreshBbml||this.props.refreshBbml})):null),this.props.question.answers&&this.props.question.answers.length>0&&I?a.a.createElement("div",{className:Object(y.a)("fimb-question__answers-container\n             fimb-question__answers-container--"+(P?"edit":"read"))},this.props.question.answers.map((e=>a.a.createElement(w.c,{answer:e,assessmentId:this.props.question.assessmentId,courseId:this.props.courseId,disabled:s,inputLabel:this.getTranslatedIdentifier(e.ident),key:e.ident,onAnswerChange:this.onAnswerChange,readOnly:!P})))):null,P?a.a.createElement("div",{className:"fimb-question__mode-changer "+(t?"-off":"-on")},a.a.createElement(i.Link,{onClick:this.toggleAnswersEditMode,disabled:!t&&!e,analyticsId:"assessments.canvas.question.fimb.step.link"},A(t?"assessments.canvas.question.fimb.previousStep":"assessments.canvas.question.fimb.nextStep"))):null,this.props.question.answers&&this.props.question.answers.length>1&&I?R:null,I?a.a.createElement(u.a,{assessmentId:o,editMode:this.props.editMode,onQuestionChange:this.onQuestionChange,question:j,setActiveEditorId:this.props.setActiveEditorId,activeEditorId:this.props.activeEditorId,pluginsConfig:this.props.pluginsConfig,assessmentType:S}):null)}}const q=Object(b.a)(Object(O.a)(S));t.a=q},i9xO:function(e,t,s){"use strict";var n=s("ERkP"),a=s.n(n),i=s("7O4Y"),o=s("5vtU"),r=s("Agfx");const l=Object(r.makeStyles)((e=>Object(r.createStyles)({root:{display:"flex",alignItems:"center",alignSelf:"stretch"},button:{alignSelf:"stretch",padding:"0px 12px",borderRadius:"2px"},text:{marginLeft:"9px",display:"none",fontWeight:e.typography.fontWeightSemiBold,[e.breakpoints.up("sm")]:{display:"block"}},textDisabled:{color:e.palette.text.disabled}})));s.d(t,"a",(function(){return c}));const c=e=>{const{icon:t,text:s,analyticsId:n,onClick:r,disabled:c=!1}=e,u=l(),d=Object(i.a)("js-secondary-control-text",u.text,c&&u.textDisabled);return a.a.createElement("div",{className:u.root},a.a.createElement(o.a,{analyticsId:n,onClick:r,disabled:c,"aria-label":s,classes:{root:u.button}},a.a.createElement(t,{analyticsId:"assessment.hotspot-canvas-toolbar-secondary-control.icon",color:c?"disabled":"primary"}),a.a.createElement("div",{className:d},s)))}},"iD7+":function(e,t,s){"use strict";var n=s("zGdY"),a=s("vymd");const i={[n.Q.Rectangle]:a.a.HotspotRectangle,[n.Q.Circle]:a.a.HotspotCircle,[n.Q.Polygon]:a.a.HotspotPolygon},o=e=>{const t=Object.keys(i).find((t=>i[t]===e));if(!t)throw new Error(`Error parsing Learn hotspot type. Hotspot type not supported: ${e}`);return t};var r=s("cexh");s.d(t,"c",(function(){return l})),s.d(t,"a",(function(){return c})),s.d(t,"b",(function(){return u}));const l=e=>{const{skipCount:t=0,objects:s,selectedObjectPositions:n=[]}=e,a=[],i=[];s.forEach(((e,t)=>(n.includes(t+1)?a:i).push(e))),[...i,...a].forEach(((e,s)=>e.moveTo(t+s+1)))},c=({object:e})=>({hotspotId:e.id,type:o(e.type),coordinates:Object(r.c)(e)}),u=({object:e})=>({hotspotPinId:e.id,coordinates:Object(r.c)(e)})},iHhY:function(e,t,s){"use strict";var n=s("ERkP"),a=s.n(n),i=s("MC1S"),o=s("VQ4P"),r=s("vQ80");s.d(t,"a",(function(){return l}));const l=({image:e,title:t,message:s,showFilterPanelButton:n,onFilterPanelToggle:l,titleIsH2Tag:c=!1})=>{const u=Object(o.a)();return a.a.createElement("div",{className:"items-empty-state js-items-empty-state"},a.a.createElement(r.a,{image:e,passedClass:"items-empty-state__image",presentationOnly:!0}),a.a.createElement("div",{role:"alert"},c?a.a.createElement("h2",{className:"items-empty-state__title"},t):a.a.createElement("h3",{className:"items-empty-state__title"},t),a.a.createElement("div",{className:"items-empty-state__message"},s)),n&&a.a.createElement(i.PrimaryButton,{className:"items-empty-state__button js-items-empty-state-filter-button",onClick:l,text:u("questionReuse.emptyState.dueToFilter.filterButton"),analyticsId:"questionReuse.emptyState.dueToFilter.filter"}))}},l4Sq:function(e,t,s){"use strict";s.d(t,"a",(function(){return l}));var n=s("ERsv"),a=s("IbyE"),i=s("4yoV"),o=s("zGdY"),r=s("RPob");function l(e,t,s,l,c="assessments.canvas"){const u=a.N.isPresentationOnly(t),d=`${c}.${e}.button${{FILE:"File",TEXT:"Text",default:"Question"}[u?t.subType:"default"]}${a.N.isQuestionBlock(t)?"Block":""}`;let p=s;if(!s&&t.questionText){const e=t.questionText.rawText,s=Object(r.q)(e,l).substring(0,180);if(u&&t.subType===o.Pb.File){const t=Object(i.c)(e)[0];if(t){const e=t.bbfile;p=Object(n.getFileNameWithTypeExtension)(e.linkName,e.mimeType)}else p=s}else p=s}return{string:d,relation:p}}},lqgZ:function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));var n=s("031P"),a=s("E0B1");const i=(e,t)=>{let s="";const{webLocation:n,fileName:a,permanentUrl:i}=e.hotSpotImage||{};return n&&a?s=n+a:i&&(s=i),{backgroundColor:o(t),backgroundImage:s}},o=e=>{const t=new n.fabric.StaticCanvas(null,{enableRetinaScaling:!1,renderOnAddRemove:!0});t.setHeight(a.o),t.setWidth(a.p),t.renderAll();const s=t.getWidth(),i=t.getHeight(),o=e.palette.background.b5,r=e.palette.background.b6,l=t.getContext();l.beginPath();const c=new n.fabric.Rect({width:s/2,height:i/2,left:s/2,top:0,strokeWidth:0});c.set("fill",o);const u=new n.fabric.Rect({width:s/2,height:i/2,left:0,top:0,strokeWidth:0});u.set("fill",r);const d=new n.fabric.Rect({width:s/2,height:i/2,left:0,top:i/2,strokeWidth:0});d.set("fill",o);const p=new n.fabric.Rect({width:s/2,height:i/2,left:s/2,top:i/2,strokeWidth:0});p.set("fill",r),t.add(c),t.add(u),t.add(d),t.add(p),t.calcOffset(),l.fill(),t.renderAll();return new n.fabric.Pattern({source:t.getElement(),repeat:"repeat"})}},mZt7:function(e,t,s){"use strict";var n=s("ERkP"),a=s.n(n),i=s("g27D"),o=s("UJ5P"),r=s("sptZ"),l=s("NH8g"),c=s("7k4i"),u=s("+phe"),d=s("bJi+"),p=s("AoSC"),h=s("4raK"),m=s("EGyI"),b=s("6Nff"),g=s("EG80");class f extends n.Component{constructor(){super(...arguments),this.onQuestionChange=e=>{this.props.onQuestionChange(e,((e,t)=>Object(p.f)(e,t)))}}render(){const{editMode:e,t,localizationPrefix:s,question:n,detailsHidden:c,questionTitle:m,readonlyPoints:f,extraCreditVisibility:v}=this.props,w=o.a.ACTIVE===e,y=w&&Object(p.i)(n),E=!c||w,C={...this.props,modelAnswerMode:g.b.Building};return a.a.createElement("div",{className:"essay "+(e?"essay--edit":"essay--read")},a.a.createElement(i.a,{editMode:e,question:n},E?a.a.createElement(a.a.Fragment,null,a.a.createElement(l.a,{...Object(l.b)(Object(b.c)(this.props,t),this.onQuestionChange)}),a.a.createElement(r.a,{question:n,show:y})):a.a.createElement(h.a,{question:n,questionTitle:m,readonlyPoints:f,extraCreditVisibility:v}),a.a.createElement(u.a,{...Object(u.b)(this.props)}),E&&a.a.createElement(d.a,{...Object(d.b)({...this.props,localize:{translate:t}},this.onQuestionChange)}),w&&a.a.createElement(g.a,{...Object(g.c)(C,this.onQuestionChange)})),w||c?null:a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:"essay__info"},a.a.createElement("div",null,t(`${s}.canvas.question.essay.instructions`))),a.a.createElement(g.a,{...Object(g.c)(C)})))}}const v=Object(c.a)(Object(m.a)(f));t.a=v},o1iR:function(e,t,s){"use strict";var n=s("ERkP"),a=s.n(n),i=s("np6O"),o=s("2GUQ"),r=s("Agfx");const l=Object(r.makeStyles)((e=>Object(r.createStyles)({root:{marginLeft:"4px",marginRight:"4px",borderRadius:"2px",alignItems:"center",alignSelf:"stretch","&:hover":{backgroundColor:e.palette.background.b3,border:`1px solid ${e.palette.background.b8}`}}})));s.d(t,"a",(function(){return c}));const c=e=>{const t=l(),{icon:s,onClick:n,ariaLabel:r,analyticsId:c,controlInfoDescriptionLocaleKey:u,controlInfoCommandLocaleKey:d}=e;return a.a.createElement(o.a,{analyticsIdPrefix:c,descriptionLocaleKey:u,commandLocaleKey:d},a.a.createElement(i.AnalyticsIconButton,{analyticsId:c,"aria-label":r,onClick:n,className:t.root},s))}},"pO+K":function(e,t,s){"use strict";var n;s.d(t,"a",(function(){return n})),function(e){e[e.Large=300]="Large",e[e.Small=150]="Small"}(n||(n={}))},rQEZ:function(e,t,s){"use strict";var n=s("ERkP"),a=s("nsO7"),i=s("031P");var o=s("YUDX");s.d(t,"a",(function(){return r}));const r=e=>{const{mapManager:t,onHotspotImageLoaded:s,selectedObjectPositions:r,canvasBackgroundOptions:l,requestHotspotQuestionUpdate:c}=e,{backgroundColor:u,backgroundImage:d}=l||{},[p,h]=Object(n.useState)(0),[m,b]=Object(n.useState)(0),[g,f]=Object(n.useState)(),[v,w]=Object(n.useState)(),y=Object(n.useMemo)((()=>t.count+1),[t.count]);Object(n.useEffect)((()=>{var e;r.length>1&&(null===(e=null==g?void 0:g.getActiveObject())||void 0===e||e.set({hasControls:!1,hoverCursor:"default",lockMovementX:!0,lockMovementY:!0}))}),[g,r.length]),Object(n.useEffect)((()=>{if(g&&m&&p&&v){const e=Math.min(p,v),t=e*(m/p),s=e/p;g.setWidth(e),g.setHeight(t),g.setViewportTransform([s,0,0,s,0,0])}}),[g,p,m,v]),Object(n.useEffect)((()=>{g&&u&&g.setBackgroundColor(u,g.renderAll.bind(g))}),[g,u]),Object(n.useEffect)((()=>{if(g&&d){const e=e=>{var t,n;g.renderAll.bind(g),h(null!==(t=e.width)&&void 0!==t?t:0),b(null!==(n=e.height)&&void 0!==n?n:0),s()};g.setBackgroundImage(d,e,{originX:"left",originY:"top"})}}),[g,d,s]);const E=Object(n.useCallback)((e=>{f(e)}),[]),C=Object(n.useCallback)((e=>{w(e)}),[]),x=Object(n.useCallback)((e=>{const s=t.getByPosition(e);s&&g&&(g.discardActiveObject(),g.setActiveObject(s.object),g.requestRenderAll())}),[t,g]),{activateFirstHotspotObject:O,activateLastHotspotObject:T,activateNextHotspotObject:k}=(e=>{const{canvas:t,mapManager:s,activateObjectOnCanvas:a,selectedObjectPositions:i}=e,r=Object(n.useCallback)((e=>{if(!(Object(o.k)(e)&&t&&s.count&&i.length))return;const n=!e.shiftKey,r=n?1:-1,l=n?Math.max(...i):Math.min(...i);(n?l<s.count:l>1)?(e.preventDefault(),a(l+r)):(t.discardActiveObject(),t.requestRenderAll())}),[a,t,s,i]);return{activateFirstHotspotObject:Object(n.useCallback)((()=>a(1)),[a]),activateLastHotspotObject:Object(n.useCallback)((()=>a(s.count)),[a,s.count]),activateNextHotspotObject:r}})({mapManager:t,canvas:g,activateObjectOnCanvas:x,selectedObjectPositions:r}),{deleteSelectedHotspotObjects:S}=(e=>{const{mapManager:t,canvas:s,onHotspotObjectDeleted:o,activateObjectOnCanvas:r,selectedObjectPositions:l}=e,[c,u]=Object(n.useState)();return Object(n.useEffect)((()=>{c&&(t.existsByPosition(c)?r(c):t.existsByPosition(c-1)&&r(c-1),u(void 0))}),[r,c,t,l]),{deleteSelectedHotspotObjects:Object(n.useCallback)((e=>{s&&l.length&&(t.getIdsByPosition(l).map(t.getById).map((e=>e?Object.values(e):[])).reduce(((e,t)=>[...e,...t]),[]).filter((e=>e instanceof i.fabric.Object)).forEach((e=>s.remove(e))),t.removeMultiple(l,null!=e?e:a.identity),s.discardActiveObject(),u(Math.min(...l)),s.renderAll(),o())}),[s,t,o,l])}})({canvas:g,mapManager:t,activateObjectOnCanvas:x,selectedObjectPositions:r,onHotspotObjectDeleted:c});return{canvas:g,onReady:E,onResizeCanvas:C,nextHotspotObjectNumber:y,activateNextHotspotObject:k,activateLastHotspotObject:T,activateFirstHotspotObject:O,deleteSelectedHotspotObjects:S,hasActiveHotspotObjSelection:!Object(a.isEmpty)(r)}}},rQu3:function(e,t,s){"use strict";var n=s("ERkP"),a=s.n(n),i=s("Agfx");const o=Object(i.makeStyles)((e=>Object(i.createStyles)({canvasDiv:{backgroundColor:e.palette.background.b6,paddingLeft:"20px",paddingRight:"20px",border:`1px solid ${e.palette.border.main}`,position:"relative"},spinner:{top:"50%",left:"50%",position:"absolute",marginLeft:"-19px",marginTop:"-19px"}})));var r=s("eqO1"),l=s("Rco2"),c=s("+1G9"),u=s("tN4z"),d=s("VQ4P"),p=s("Pu34"),h=s("lqgZ"),m=s("E0B1");const b=e=>{const t=o(),s=Object(r.t)(),[i,b]=Object(n.useState)(!1),{question:g}=e,f=Object(d.a)(),{onReady:v,onResizeCanvas:w,addReadonlyHotspots:y}=Object(p.a)({onHotspotImageLoaded:()=>b(!0),canvasBackgroundOptions:Object(h.a)(g,s)});return Object(c.a)({shouldDrawLabels:!0,answers:g.answers||[],addHotspots:y,shouldDrawHotspots:i}),a.a.createElement("div",{className:t.canvasDiv},a.a.createElement(l.a,{canvasOptions:{...m.b},onResizeCanvas:w,onReady:v}),!i&&a.a.createElement("div",{className:t.spinner},a.a.createElement(u.AnalyticsCircularProgress,{ariaLabel:f("assessments.canvas.question.hotspot.image.loading"),size:"medium"})))};var g=s("JAGG");const f=Object(i.makeStyles)((e=>Object(i.createStyles)({optionsContainer:{paddingTop:"10px"}}))),v=({question:e})=>{const t=f();return a.a.createElement(a.a.Fragment,null,a.a.createElement(b,{question:e}),a.a.createElement("div",{className:t.optionsContainer},a.a.createElement(g.a,{question:e})))};var w=s("K9sL");s.d(t,"a",(function(){return y}));const y=e=>{const{question:t,pluginsConfig:s}=e;return a.a.createElement(a.a.Fragment,null,a.a.createElement(v,{...e}),a.a.createElement(w.d,{pluginsConfig:s,question:t}))}},sptZ:function(e,t,s){"use strict";var n=s("ERkP"),a=s.n(n),i=s("VQ4P"),o=s("GuFu"),r=s("zTL+");const l=({show:e,question:t})=>{const s=Object(i.a)(),n=Object(o.i)("assessments","assessments.organization");return e&&(null==t?void 0:t.usageCount)?a.a.createElement(a.a.Fragment,null,a.a.createElement(r.a,{severity:"warning"},s(n("assessments.canvas.question.multipleReferencesNotification.message"),{usageCount:t.usageCount}))):null};var c=s("MC1S");var u=e=>{const{type:t,messageSubkey:s}=0===(n=e.copyStatus).copiesFailed?{type:c.NotificationType.Success,messageSubkey:"success"}:{type:c.NotificationType.Failure,messageSubkey:0===n.copiesSucceeded?"failure":"error"};var n;return{positionAfter:e.positionAfter,type:t,Component:()=>{const n=Object(i.a)(),o=`questionReuse.copyResult.${s}`;const r=null!=e.autoDismiss&&!e.autoDismiss;return a.a.createElement("div",{className:"question-reuse-notification-wrapper"},a.a.createElement(c.Notification,{type:t,message:n(o,e.copyStatus),disableAutoDismiss:r,onClose:e.dismissNotification}))}}},d=s("EGyI");var p=(e,t=1)=>{const s=c.NotificationType.Processing;class n extends a.a.Component{constructor(){super(...arguments),this.notificationWrapper=a.a.createRef()}componentDidMount(){this.notificationWrapper.current.focus()}render(){const{t:e}=this.props;return a.a.createElement("div",{className:"question-reuse-notification-wrapper",tabIndex:0,ref:this.notificationWrapper},a.a.createElement(c.Notification,{type:s,message:e("questionReuse.copyProcessing",{questionCount:t})}))}}return{positionAfter:e,type:s,Component:Object(d.a)(n)}};s.d(t,"a",(function(){return l})),s.d(t,"b",(function(){return u})),s.d(t,"c",(function(){return p}))},vLEk:function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));var n=s("031P"),a=s("vymd"),i=s("E0B1");const o=n.fabric.util.createClass(n.fabric.Group,{type:a.a.HotspotRectangle,overlayRectangle:n.fabric.Rect,defaultStrokeWidth:i.i.strokeWidth,defaultStrokeDashArray:i.e.strokeDashArray,createOverlayRectangle:e=>new n.fabric.Rect({...i.i,width:(null==e?void 0:e.width)||i.i.width,height:(null==e?void 0:e.height)||i.i.height}),createWhiteRectangle:e=>new n.fabric.Rect({...i.k,width:(null==e?void 0:e.width)||i.k.width,height:(null==e?void 0:e.height)||i.k.height}),createBlueDashedRectangle:e=>new n.fabric.Rect({...i.e,width:(null==e?void 0:e.width)||i.e.width,height:(null==e?void 0:e.height)||i.e.height}),initialize(e,t){const s=this.createOverlayRectangle(t),n=[s,this.createWhiteRectangle(t),this.createBlueDashedRectangle(t)];let a={left:Number.isFinite(t.left)?t.left:i.i.left,top:Number.isFinite(t.top)?t.top:i.i.top};a=t.isModifiable?{...a,hasControls:!0,hoverCursor:"move",lockMovementX:!1,lockMovementY:!1,lockUniScaling:!0,transparentCorners:!1,lockScalingFlip:!0,cornerStrokeColor:i.c,cornerColor:"white",cornerSize:16,padding:-i.i.strokeWidth/2,borderColor:"transparent"}:{...a,selectable:!1,hasControls:!1,hoverCursor:"default"},this.callSuper("initialize",n,a),this.set("id",e||""),this.overlayRectangle=s,t.isModifiable&&(this.setControlVisible("mtr",!1),this.setControlVisible("mt",!1))},updateCoords(e,t){this.top=e,this.left=t},updateScale(e,t){this.scaleX=e,this.scaleY=t},toObject(){return n.fabric.util.object.extend(this.callSuper("toObject"),{id:this.get("id")})},resize(e){Object(a.b)(this,e),Object(a.e)(this)},getOverlayObj(){return this.overlayRectangle},getFabricObjOptionsCalcMethod:()=>e=>({width:e.width,height:e.height,scaleX:e.scaleX,scaleY:e.scaleY})})},vQ80:function(e,t,s){"use strict";var n=s("ERkP"),a=s.n(n);t.a=({image:e,passedClass:t,presentationOnly:s})=>{const n=["svg-image"];return t&&n.push(t),a.a.createElement("div",{className:n.join(" "),dangerouslySetInnerHTML:{__html:e},"aria-hidden":s})}},vymd:function(e,t,s){"use strict";s.d(t,"a",(function(){return n})),s.d(t,"d",(function(){return i})),s.d(t,"c",(function(){return o})),s.d(t,"b",(function(){return r})),s.d(t,"e",(function(){return l}));var n,a=s("KDr4");!function(e){e.HotspotRectangle="hotspotRectangle",e.HotspotPolygon="hotspotPolygon",e.HotspotCircle="hotspotCircle",e.HotspotPolygonLine="hotspotPolygonLine",e.HotspotPolygonPoint="hotspotPolygonPoint",e.HotspotLabel="hotspotLabel",e.HotspotPin="hotspotPin",e.Text="text",e.Circle="circle"}(n||(n={}));const i=e=>e.hasControls,o=e=>e.type===n.HotspotCircle,r=(e,t)=>{e.forEachObject((s=>{s.stroke&&s.set({strokeWidth:Object(a.c)(e.defaultStrokeWidth,t)}),s.strokeDashArray&&s.set({strokeDashArray:e.defaultStrokeDashArray.map((e=>Object(a.c)(e,t)))})}))},l=e=>{if(!e.canvas)return;const t=e.canvas.getZoom(),s=e.defaultStrokeWidth,n=Object(a.c)(s,t),i=e.getFabricObjOptionsCalcMethod();e.forEachObject((t=>{const s=e.width*e.scaleX-n,a=e.height*e.scaleY-n,o=1/e.scaleX,r=1/e.scaleY,l=i({width:s,height:a,scaleX:o,scaleY:r});t.set(l),t.setCoords()}))}},xMR0:function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));var n=s("031P"),a=s("vymd"),i=s("E0B1");const o=n.fabric.util.createClass(n.fabric.Group,{type:a.a.HotspotCircle,overlayCircle:n.fabric.Circle,defaultStrokeWidth:i.f.strokeWidth,defaultStrokeDashArray:i.d.strokeDashArray,createOverlayCircle:e=>new n.fabric.Circle({...i.f,radius:(null==e?void 0:e.radius)||i.f.radius}),createWhiteCircle:e=>new n.fabric.Circle({...i.j,radius:(null==e?void 0:e.radius)||i.j.radius}),createBlueDashedCircle:e=>new n.fabric.Circle({...i.d,radius:(null==e?void 0:e.radius)||i.d.radius}),initialize(e,t){const s=this.createOverlayCircle(t),n=[s,this.createWhiteCircle(t),this.createBlueDashedCircle(t)];let a={left:Number.isFinite(t.left)?t.left:i.f.left,top:Number.isFinite(t.top)?t.top:i.f.top};a=t.isModifiable?{...a,hasControls:!0,hoverCursor:"move",lockMovementX:!1,lockMovementY:!1,lockUniScaling:!0,transparentCorners:!1,lockScalingFlip:!0,cornerStrokeColor:i.c,cornerColor:"white",cornerSize:16,padding:-i.f.strokeWidth/2,borderColor:"transparent"}:{...a,selectable:!1,hasControls:!1,hoverCursor:"default"},this.callSuper("initialize",n,a),this.set("id",e||""),this.overlayCircle=s,t.isModifiable&&(this.setControlVisible("mtr",!1),this.setControlVisible("mt",!1),this.setControlVisible("mb",!1),this.setControlVisible("tl",!1),this.setControlVisible("tr",!1),this.setControlVisible("bl",!1),this.setControlVisible("br",!1))},updateCoords(e,t){this.top=e,this.left=t},updateScale(e,t){this.scaleX=e,this.scaleY=t},toObject(){return n.fabric.util.object.extend(this.callSuper("toObject"),{id:this.get("id")})},resize(e){Object(a.b)(this,e),Object(a.e)(this)},getOverlayObj(){return this.overlayCircle},getRadius(){var e;return null!==(e=this.getOverlayObj().radius)&&void 0!==e?e:i.f.radius},getFabricObjOptionsCalcMethod:()=>e=>({width:e.width,height:e.height,scaleX:e.scaleX,scaleY:e.scaleY,radius:e.width/2})})},yJL7:function(e,t,s){"use strict";var n=s("ERkP"),a=s.n(n),i=s("Agfx");const o=Object(i.makeStyles)((e=>Object(i.createStyles)({toolbar:{display:"flex",flexDirection:"row",justifyContent:"space-between",backgroundColor:e.palette.background.paper,border:`1px solid ${e.palette.border.main}`,borderRadius:"2px 2px 0 0"}})));s.d(t,"a",(function(){return r}));const r=e=>{const t=o();return a.a.createElement("div",{className:t.toolbar},e.children)}},yX1G:function(e,t,s){"use strict";s.d(t,"a",(function(){return p}));var n=s("ERkP"),a=s("nsO7"),i=s("vLEk"),o=s("xMR0"),r=s("N0Hd"),l=s("zGdY"),c=s("SEyF"),u=s("cexh"),d=s("KDr4");const p=e=>{const{canvas:t,mapManager:s}=e,p=Object(n.useCallback)(((e,s)=>{if(!t)return{};const n=e.hotspotId;let p;const h={...Object(u.b)(e.coordinates,e.type),isModifiable:!1};let m;return e.type===l.Q.Rectangle?p=new i.a(n,h):e.type===l.Q.Polygon?p=new c.a(n,h):e.type===l.Q.Circle&&(p=new o.a(n,h)),t.add(p),Object(a.isNumber)(e.hotspotNumber)&&(m=new r.a(e.hotspotNumber.toString()),t.add(m),Object(d.h)(m,p)),{object:p,label:m,position:s}}),[t]);return{addReadonlyHotspots:Object(n.useCallback)((e=>{if(!t)return;const n=e.map(((e,t)=>p(e,t+1)));n.length&&s.addMultiple(n)}),[t,p,s])}}},ym5S:function(e,t,s){"use strict";var n=s("ERkP"),a=s.n(n),i=s("65tE");var o=({show:e,instructions:t})=>a.a.createElement("div",{className:Object(i.a)(`\n        question-instructions\n        question-instructions--${e?"visible":"hidden"}\n      `),"aria-hidden":!e},t);s.d(t,"a",(function(){return o}))}}]);